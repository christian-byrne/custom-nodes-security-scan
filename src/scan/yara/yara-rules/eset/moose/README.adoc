= Linux/Moose Indicators of Compromise (IOC)
:vt-url: https://www.virustotal.com/latest-scan/
:vr-url: http://www.virusradar.com/Linux_Moose

// Olivier Bilodeau <bilodeau@eset.com>
// Thomas Dupuy <thomas.dupuy@eset.com>
// Copyright (C) 2015-2016 ESET

These IOCs were released as part of our research on this embedded Linux
threat. The full report is available here:
http://www.welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf

Blog articles are also published on WeLiveSecurity:

2015-05-26::
    * http://www.welivesecurity.com/2015/05/26/moose-router-worm/[Moose â€“ the
      router worm with an appetite for social networks]
    * http://www.welivesecurity.com/2015/05/26/dissecting-linuxmoose/[Dissecting
      Linux/Moose: a Linux Router-based Worm Hungry for Social Networks]
2016-11-02::
    * http://www.welivesecurity.com/2016/11/02/linuxmoose-still-breathing/[Linux/Moose
      still breathing]

We have other resources related to this threat available in
https://github.com/eset/malware-research/tree/master/moose[our
malware-research repository]:

We have IOCs in the form of Hashes, IP addresses, Yara rules and system
commands. Hashes, IP addresses and systems commands are documented here, the
rest is in separate files inside this folder.

We would like to thank http://www.emergingthreats.net/[Emerging Threats] for
the Snort and Suricata rules they provided to the community.

CAUTION: As soon as this information is public the malware authors will most
         likely update their technique and tools to evade detection and thwart
         analysis as they have done in the past. Consequently, be aware that
         any of the advice we give to identify or clean oneself might already
         be outdated.

WARNING: These come with no warranties. They might not detect an infection
         and/or trigger false positives. Apply judgment.

If you find false-positives, have improved IOCs or find samples that do not
match these IOCs please open an issue, provide a pull-request or contact us
at: github@eset.com.

== Malware samples

Here are the SHA1 hashes, architecture and malware version of the files we've encountered:

.Malware Samples
[cols="5*", options="header"]
|===
|File SHA-1
|Architecture/ABI
|Version footnote:[As described by the malware authors]
|C&C server
|ESET detection name

|{vt-url}10e2f7dd4b2bb4ac9ab2b0d136f48e5dc9acc451[`10e2f7dd4b2bb4ac9ab2b0d136f48e5dc9acc451`]
|ARM GNU EABI
|20
|hardcoded
|{vr-url}.C/description[Linux/Moose.C]

|{vt-url}095ee85aa648de4e557fc243de17d4f00ab2091f[`095ee85aa648de4e557fc243de17d4f00ab2091f`]
|ARM GNU EABI
|20
|hardcoded
|{vr-url}.C/description[Linux/Moose.C]

|{vt-url}bfc2a99450977dc7ba2ec0879fb17c612e248ece[`bfc2a99450977dc7ba2ec0879fb17c612e248ece`]
|MIPS MIPS32
|28
|hardcoded
|{vr-url}.A.gen/description[Linux/Moose.A]

|{vt-url}54041ce90b04698465b866ed169ddf4a269e1e76[`54041ce90b04698465b866ed169ddf4a269e1e76`]
|MIPS MIPS32 LSB
|28
|hardcoded
|{vr-url}.C/description[Linux/Moose.C]

|{vt-url}d648c405507ad62ddb3faa1dd37f659f3676cacf[`d648c405507ad62ddb3faa1dd37f659f3676cacf`]
|ARM EABI5
|28
|hardcoded
|{vr-url}.B/description[Linux/Moose.B]

|{vt-url}85c3439b6773241d11cda78f0ecfea4c07e55fd2[`85c3439b6773241d11cda78f0ecfea4c07e55fd2`]
|ARM EABI5
|28
|hardcoded
|{vr-url}.B/description[Linux/Moose.B]

|{vt-url}216014dba6f1a636c44530fbce06c598d3cf7fa1[`216014dba6f1a636c44530fbce06c598d3cf7fa1`]
|ARM EABI5
|29
|hardcoded
|{vr-url}.D/description[Linux/Moose.D]

|{vt-url}4bffc0ebfe8c373f387eb01a7c5e2835ec8e8757[`4bffc0ebfe8c373f387eb01a7c5e2835ec8e8757`]
|MIPS MIPS32
|29
|hardcoded
|{vr-url}.D.gen/description[Linux/Moose.D]

|{vt-url}dd7e8211336aa02851f6c67690e2301b9c84bb26[`dd7e8211336aa02851f6c67690e2301b9c84bb26`]
|MIPS MIPS32
|31
|hardcoded
|{vr-url}.G/description[Linux/Moose.G]

|{vt-url}c6edfa2bf916d374e60f1b5444be6dbbee099692[`c6edfa2bf916d374e60f1b5444be6dbbee099692`]
|ARM EABI5
|31
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}c9ca4820bb7be18f36b7bad8e3044b2d768a5db8[`c9ca4820bb7be18f36b7bad8e3044b2d768a5db8`]
|ARM EABI5
|31
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}5b444f1ac312b4c24b6bde304f00a5772a6a19a4[`5b444f1ac312b4c24b6bde304f00a5772a6a19a4`]
|MIPS MIPS32 LSB
|31
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}f7574b3eb708bd018932511a8a3600d26f5e3be9[`f7574b3eb708bd018932511a8a3600d26f5e3be9`]
|MIPS MIPS32 LSB
|31
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}34802456d10efdf211a7d486f7108319e052cd17[`34802456d10efdf211a7d486f7108319e052cd17`]
|ARM EABI5
|32
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}0685cb1d72107de63fa1da52930322df04a72dbc[`0685cb1d72107de63fa1da52930322df04a72dbc`]
|MIPS MIPS32
|32
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}2876cad26d6dabdc0a9679bb8575f88d40ebd960[`2876cad26d6dabdc0a9679bb8575f88d40ebd960`]
|MIPS MIPS32
|32
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}f94b6cc5aea170cee55a238eaa9339279fba962f[`f94b6cc5aea170cee55a238eaa9339279fba962f`]
|MIPS MIPS32
|32
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}274ef5884cb256fd4edd7000392b0e326ddd2398[`274ef5884cb256fd4edd7000392b0e326ddd2398`]
|MIPS MIPS32 LSB
|32
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}c3f0044ffa9d0bc950e9fd0f442c955b71a706b6[`c3f0044ffa9d0bc950e9fd0f442c955b71a706b6`]
|MIPS MIPS32 LSB
|32
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}f3daea1d06b1313ec061d93c9af12d0fe746839a[`f3daea1d06b1313ec061d93c9af12d0fe746839a`]
|MIPS MIPS32 LSB
|32
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}7767c8317fb0bbf91924bddffe6a5e45069b0182[`7767c8317fb0bbf91924bddffe6a5e45069b0182`]
|ARM EABI5
|33
|passed as argument
|{vr-url}.I/description[Linux/Moose.I]

|{vt-url}1caac933ae6ca326372f7e5dd9fff82652e22e34[`1caac933ae6ca326372f7e5dd9fff82652e22e34`]
|MIPS MIPS32
|33
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}5dea6c0c4300e432896038661db2f046c523ce35[`5dea6c0c4300e432896038661db2f046c523ce35`]
|MIPS MIPS32
|33
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}e8dc272954d5889044e92793f0f637fe4d53bb91[`e8dc272954d5889044e92793f0f637fe4d53bb91`]
|MIPS MIPS32
|33
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}0843239b3d0f62ae6c5784ba4589ef85329350fa[`0843239b3d0f62ae6c5784ba4589ef85329350fa`]
|MIPS MIPS32 LSB
|33
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}1d1d46c312045e17f8f4386adc740c1e7423a24a[`1d1d46c312045e17f8f4386adc740c1e7423a24a`]
|MIPS MIPS32 LSB
|33
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}d8b45a1114c5e0dbfa13be176723b2288ab12907[`d8b45a1114c5e0dbfa13be176723b2288ab12907`]
|MIPS MIPS32 LSB
|33
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]

|{vt-url}c35d6812913ef31c20404d9bbe96db813a764886[`c35d6812913ef31c20404d9bbe96db813a764886`]
|ARM EABI5
|34
|passed as argument
|{vr-url}.H/description[Linux/Moose.H]
|===

[appendix]
== IP Addresses

=== Active since September 2015

Traffic from infected device to these IP addresses using TCP. These are the
primary C&C servers.

    192.3.8.218
    192.3.8.219

Traffic from these IP addresses (from the whitelist) going to infected devices
on *TCP port 20012*.

    62.210.6.34
    151.80.8.2
    151.80.8.19
    151.80.8.30
    155.133.18.64
    178.19.111.181

=== Inactive since June 2015

Traffic from infected device to these IP:ports combinations using TCP. These
are the primary C&C servers.

    77.247.177.36:81
    93.190.140.221:80
    85.159.237.107:81
    85.159.237.108:81
    77.247.177.87:81

Traffic from these IP addresses (from the whitelist) going to infected devices
on TCP port 10073.

    27.124.41.11
    27.124.41.31
    27.124.41.31
    27.124.41.33
    27.124.41.33
    27.124.41.52
    27.124.41.52
    42.119.173.138
    77.247.177.31
    77.247.177.36
    77.247.178.177
    79.176.26.142
    82.146.63.15
    85.159.237.107
    85.159.237.108
    85.159.237.111
    85.159.237.111
    93.190.139.123
    93.190.139.147
    93.190.140.221
    93.190.142.113
    93.190.143.60
    103.238.216.21
    103.238.216.216
    103.238.216.217
    103.238.216.218
    103.238.216.22
    103.238.216.23
    103.238.216.24
    103.238.216.25
    103.238.216.26
    103.238.216.28
    103.238.216.29
    103.238.216.30
    103.238.216.31
    109.201.148.136
    109.201.148.201
    109.201.148.241
    109.236.86.18
    109.236.89.208
    192.126.184.234
    207.244.67.193
    217.23.12.124
    217.23.2.249
    217.23.2.251
    217.23.2.252
    217.23.2.253
    217.23.2.30
    217.23.2.47
    217.23.2.48
    217.23.2.49
    217.23.2.52
    217.23.2.79
    217.23.7.133
    217.23.7.211

== System commands

You need shell access to your router. The malware obtains shell access by
leveraging weak or default usernames and passwords via the Telnet protocol. If
there is a custom text user interface (prompt not looking like `#`) on the
router then it tries to obtain a root shell by issuing `sh`.

Once you have a root shell access to your router. You can verify for the following
indicators:

* The presence of a binary named `elan2` in `/var` or `/dev` (or anywhere else)
* The presence of a binary named `crondd` in `/tmp` (or anywhere else)
* A process `elan2` or `crondd` seen when running:
  `ps -ef | grep -e elan2 -e crondd`
* A process listening on `0.0.0.0:10073` or `0.0.0.0:20012`

This last indicator can be verified using `netstat -anp`. Depending on system
configuration the `-p` flag might not be available. If it's not, then you can
look for `lsof` or try manually correlating the content of `/proc/net/tcp/`
with `/proc/<pid>/fd` as
https://serverfault.com/questions/219984/busybox-netstat-no-p[explained here].

== Detection (YARA)

In order to identify if a file or a set of files is the Linux/Moose threat you
can use the popular https://plusvic.github.io/yara/[YARA] tool.

Using the link:linux-moose.yar[`linux-moose.yar`] YARA rule in this repository
you can recursively crawl a directory for Linux/Moose with:

    yara -r linux-moose.yar directory/

If the command yields no output then no files were identified to be
Linux/Moose. Otherwise identified filenames are printed.

Further modifications made by the malware authors to evade detection will
impact the usefulness of this YARA rule over time.

== Detection (IDS)

The fine folks at http://www.emergingthreats.net/[Emerging Threats] designed
https://snort.org/[Snort] and http://suricata-ids.org/[Suricata] rules to
detect Linux/Moose and included them in their
http://www.emergingthreats.net/open-source/open-source-community[open
ruleset]. You can also find them in this repository:
link:LinuxMooseETrules.txt[`LinuxMooseETrules.txt`]
