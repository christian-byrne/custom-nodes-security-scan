## Moose_2

#Suricata 3.1
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET TROJAN Moose CnC Request M1"; flow:to_server,established; urilen:1; content:"GET"; http_method; content:!"Referer|3a 20|"; http_header; content:"PP|3b 20|nhash="; fast_pattern:only; content:"PHPSESSID="; http_cookie; content:"AAAAAAAAAAAAAAA"; http_cookie; distance:0; content:"PP|3b 20|nhash="; http_cookie; distance:0; content:"|3b 20|chash="; http_cookie; distance:0; classtype:trojan-activity; sid:5002576; rev:1;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET TROJAN Moose CnC Response"; flow:from_server,established; content:"200"; http_stat_code; content:"PP|3b 20|expires="; fast_pattern:only; content:"PHPSESSID="; http_cookie; content:"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"; http_cookie; distance:0; content:"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"; http_cookie; distance:0; content:"PP|3b 20|expires="; http_cookie; distance:0; content:"WL="; http_cookie; content:"PP|3b 20|expires="; http_cookie; distance:0; content:"Content-Type|3a 20|text/html"; http_header; file_data; content:"<html><body><h1>It works!</h1>"; nocase; depth:30; classtype:trojan-activity; sid:5002577; rev:1;)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET TROJAN Moose CnC Request M2"; flow:to_server,established; urilen:1; content:"GET"; http_method; content:!"Referer|3a 20|"; http_header; content:"PHPSESSID="; http_cookie; content:"|3b 20|nhash="; http_cookie; distance:0; content:"|3b 20|chash="; http_cookie; distance:0; pcre:"/^Host\x3a\x20[^\r\n]+\r\nUser-Agent\x3a\x20[^\r\n]+\r\nAccept\x3a\x20[^\r\n]+\r\nAccept-Language\x3a\x20[^\r\n]+\r\nAccept-Encoding\x3a\x20[^\r\n]+\r\nConnection\x3a\x20[^\r\n]+[\r\n]+$/Hmi"; classtype:trojan-activity; sid:5002610; rev:1;)

#Snort 2.9.6
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"ET TROJAN Moose CnC Request M1"; flow:to_server,established; urilen:1; content:"GET"; http_method; content:!"Referer|3a 20|"; http_header; content:"PP|3b 20|nhash="; fast_pattern:only; content:"PHPSESSID="; http_cookie; content:"AAAAAAAAAAAAAAA"; http_cookie; distance:0; content:"PP|3b 20|nhash="; http_cookie; distance:0; content:"|3b 20|chash="; http_cookie; distance:0; classtype:trojan-activity; sid:5002576; rev:1;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"ET TROJAN Moose CnC Response"; flow:from_server,established; content:"200"; http_stat_code; content:"PP|3b 20|expires="; fast_pattern:only; content:"PHPSESSID="; http_cookie; content:"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"; http_cookie; distance:0; content:"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"; http_cookie; distance:0; content:"PP|3b 20|expires="; http_cookie; distance:0; content:"WL="; http_cookie; content:"PP|3b 20|expires="; http_cookie; distance:0; content:"Content-Type|3a 20|text/html"; http_header; file_data; content:"<html><body><h1>It works!</h1>"; nocase; depth:30; classtype:trojan-activity; sid:5002577; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"ET TROJAN Moose CnC Request M2"; flow:to_server,established; urilen:1; content:"GET"; http_method; content:!"Referer|3a 20|"; http_header; content:"PHPSESSID="; http_cookie; content:"|3b 20|nhash="; http_cookie; distance:0; content:"|3b 20|chash="; http_cookie; distance:0; pcre:"/^Host\x3a\x20[^\r\n]+\r\nUser-Agent\x3a\x20[^\r\n]+\r\nAccept\x3a\x20[^\r\n]+\r\nAccept-Language\x3a\x20[^\r\n]+\r\nAccept-Encoding\x3a\x20[^\r\n]+\r\nConnection\x3a\x20[^\r\n]+[\r\n]+$/Hmi"; classtype:trojan-activity; sid:5002610; rev:1;)

## Moose_1

#Suricata
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"ET TROJAN Linux/Moose HTTP CnC Beacon"; flow:established,to_server; content:"GET"; http_method; content:".php?p="; http_uri; fast_pattern; content:"&f="; distance:0; http_uri; content:"&m="; distance:0; http_uri; content:!"User-Agent|3a|"; http_header; content:!"Accept"; http_header; content:!"Referer|3a|"; http_header; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021147; rev:3;)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ET TROJAN Linux/Moose HTTP CnC Beacon Response"; flow:established,from_server; content:"Server|3a 20|Apache/20.2.25 (RedHat|29 0d 0a|"; http_header; fast_pattern:13,20; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021148; rev:2;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ET TROJAN Possible Linux/Moose Telnet CnC Beacon"; flow:established,to_server; dsize:40; content:"|0e 00 00 00|"; offset:4; depth:4; fast_pattern; content:!"|00|"; within:1; content:!"|00|"; distance:3; within:1; content:"|00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|"; distance:4; within:28; content:!"|00 00 00 00|"; depth:4; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021149; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ET TROJAN Linux/Moose NAT Traversal CnC Beacon set"; flow:established,to_server; dsize:4; content:"|18 00 00 00|"; fast_pattern:only; flowbits:set,ET.Linux.Moose; flowbits:noalert; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021150; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"ET TROJAN Linux/Moose NAT Traversal CnC Beacon - Sleep"; flow:established,from_server; dsize:8; content:"|16 00|"; depth:2; content:!"|00 00|"; within:2; content:!"|00|"; distance:2; within:1; content:!"|00|"; distance:5; within:1; flowbits:isset,ET.Linux.Moose; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021151; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"ET TROJAN Linux/Moose NAT Traversal CnC Beacon - Multiple Tunnel"; flow:established,from_server; dsize:8; content:"|17 00|"; depth:2; content:!"|00 00|"; within:2; content:!"|00|"; distance:2; within:1; content:!"|00|"; distance:5; within:1; flowbits:isset,ET.Linux.Moose; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021152; rev:1;)

#Snort
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"ET TROJAN Linux/Moose HTTP CnC Beacon"; flow:established,to_server; content:"GET"; http_method; content:".php?p="; http_uri; fast_pattern; content:"&f="; distance:0; http_uri; content:"&m="; distance:0; http_uri; content:!"User-Agent|3a|"; http_header; content:!"Accept"; http_header; content:!"Referer|3a|"; http_header; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021147; rev:2;)
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:"ET TROJAN Linux/Moose HTTP CnC Beacon Response"; flow:established,from_server; content:"Server|3a 20|Apache/20.2.25 (RedHat|29 0d 0a|"; http_header; fast_pattern:13,20; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021148; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ET TROJAN Possible Linux/Moose Telnet CnC Beacon"; flow:established,to_server; dsize:40; content:"|0e 00 00 00|"; offset:4; depth:4; fast_pattern; content:!"|00|"; within:1; content:!"|00|"; distance:3; within:1; content:"|00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00|"; distance:4; within:28; content:!"|00 00 00 00|"; depth:4; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021149; rev:1;)
alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"ET TROJAN Linux/Moose NAT Traversal CnC Beacon set"; flow:established,to_server; dsize:4; content:"|18 00 00 00|"; fast_pattern:only; flowbits:set,ET.Linux.Moose; flowbits:noalert; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021150; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"ET TROJAN Linux/Moose NAT Traversal CnC Beacon - Sleep"; flow:established,from_server; dsize:8; content:"|16 00|"; depth:2; content:!"|00 00|"; within:2; content:!"|00|"; distance:2; within:1; content:!"|00|"; distance:5; within:1; flowbits:isset,ET.Linux.Moose; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021151; rev:1;)
alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"ET TROJAN Linux/Moose NAT Traversal CnC Beacon - Multiple Tunnel"; flow:established,from_server; dsize:8; content:"|17 00|"; depth:2; content:!"|00 00|"; within:2; content:!"|00|"; distance:2; within:1; content:!"|00|"; distance:5; within:1; flowbits:isset,ET.Linux.Moose; reference:url,welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf; classtype:trojan-activity; sid:2021152; rev:1;)
