<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright 2020 by FireEye, Inc.
     You may not use this file except in compliance with the license. The license should have been received with this file. You may obtain a copy of the license at:
     https://github.com/fireeye/red_team_tool_countermeasures/blob/master/LICENSE.txt
  -->
<OpenIOC xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="f9681f4f-6f28-4055-92ea-7424060c4fb5" last-modified="2020-12-01T10:34:38Z" published-date="0001-01-01T00:00:00" xmlns="http://openioc.org/schemas/OpenIOC_1.1">
  <metadata>
    <short_description>LNK SMASHER (UTILITY)</short_description>
    <description>This IOC detects indicators associated with the payload generated by LNKSmasher Tool. This tool could be used by malware authors to generate a LNK payload file with an embedded payload. This is associated with MITRE ATT&amp;CK (r) Tactic(s):Persistence, Privilege Escalation, Execution and Technique(s): T1547.009, T1204.002.</description>
    <authored_by>FireEye</authored_by>
    <authored_date>2020-11-25T16:04:05Z</authored_date>
    <links></links>
  </metadata>
  <criteria>
    <Indicator operator="OR" id="e5627081-142a-4ec9-beea-c5b92e73ce3e">
      <Indicator operator="AND" id="6f73839e-7664-4969-ba32-6b14128a720b">
        <IndicatorItem id="ff1723c3-f31c-413a-b1b4-576eeb1f8410" condition="is" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/process" type="event" />
          <Content type="string">cmd.exe</Content>
        </IndicatorItem>
        <IndicatorItem id="5308f4fa-3111-48d1-b57a-4efc6f143fe5" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">\\cmd\.exe\" /c copy /b /y \*sm\.lnk</Content>
        </IndicatorItem>
        <IndicatorItem id="0d7dd573-3a91-407f-9e55-c9dc687deafc" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">\\AppData\\Roaming\\[a-z]\.txt</Content>
        </IndicatorItem>
        <IndicatorItem id="780d9639-dbed-4a66-a56f-c0674645fa45" condition="contains" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">\*rtutil.exe</Content>
        </IndicatorItem>
        <IndicatorItem id="3f941f6b-c8e8-44a9-84f9-964136c861ce" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">f\.exe \-f \-(enc\"\"odehex|decod\"\"ehex) [a-z]\.txt ([a-z]\.txt|[a-z]\.exe) 1</Content>
        </IndicatorItem>
        <IndicatorItem id="ad20ec53-c839-4f44-901e-5996b8f359f8" condition="contains" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">more +69</Content>
        </IndicatorItem>
      </Indicator>
      <Indicator operator="AND" id="30b9396a-1613-450e-8b3c-1f9bc2f2f23a">
        <IndicatorItem id="000bf745-65c5-43d1-af74-17b6bfcedc22" condition="is" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/process" type="event" />
          <Content type="string">rundll32.exe</Content>
        </IndicatorItem>
        <IndicatorItem id="bf2a7076-0dd6-4e36-a8ff-a364c5c83cb7" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">\\rundll32.exe\" SHELL32\.DLL\,ShellExec\_RunDLL</Content>
        </IndicatorItem>
        <IndicatorItem id="3fc39e69-18c7-474d-ad24-43564534ed3c" condition="contains" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">tokens=1 delims=[]</Content>
        </IndicatorItem>
        <IndicatorItem id="427dcfa8-ba1f-401d-84be-d22a68f4960e" condition="contains" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">('dir *si.lnk /b /a-d')</Content>
        </IndicatorItem>
      </Indicator>
      <Indicator operator="AND" id="29512c35-33a2-4519-82b9-29e5dda3e92c">
        <IndicatorItem id="ad47e698-c19e-48cd-b40e-bc3ebc63cb79" condition="is" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/process" type="event" />
          <Content type="string">findstr.exe</Content>
        </IndicatorItem>
        <IndicatorItem id="7fefd896-6e45-406b-8fee-3989d56480e6" condition="is" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/parentProcess" type="event" />
          <Content type="string">cmd.exe</Content>
        </IndicatorItem>
        <IndicatorItem id="3444605e-f7c5-4810-88a2-cd9b6a0b1e1e" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">^findstr\s+?/r /c\:"si\.lnk" "securitypatch_[0-9]{4}\.msi\.lnk"$</Content>
        </IndicatorItem>
      </Indicator>
      <Indicator operator="AND" id="e5d9da2b-7454-4505-93c4-410a385dd57c">
        <IndicatorItem id="be13f900-6b86-4e94-b4f6-298f7f478d51" condition="is" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/process" type="event" />
          <Content type="string">cmd.exe</Content>
        </IndicatorItem>
        <IndicatorItem id="19c19156-aac7-46da-8892-014f7eebbda0" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">^cmd  /c copy /b /y \*\.msi\.lnk \%appdata\%\\[a-z]</Content>
        </IndicatorItem>
        <IndicatorItem id="5e3fcc01-8411-4d98-a2d4-af66662f93ed" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">findstr /r \^\^MSCF [a-z]</Content>
        </IndicatorItem>
        <IndicatorItem id="293f9435-a539-4bbb-9628-94d267c9911c" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">copy /b n\.0az\+[a-z] n1.0az</Content>
        </IndicatorItem>
        <IndicatorItem id="a0cb66fe-faa3-4e59-ba0b-6fd88da5524d" condition="contains" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">expand n1.0az</Content>
        </IndicatorItem>
        <IndicatorItem id="a66f2a01-b33d-444c-9dac-7c9d287b57c9" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">del n.0az n1.0az [a-z]</Content>
        </IndicatorItem>
        <IndicatorItem id="e0f8ffc0-f0bf-428d-a315-e8616f8cb2b4" condition="matches" preserve-case="false" negate="false">
          <Context document="processEvent" search="processEvent/processCmdLine" type="event" />
          <Content type="string">\.exe\s+?$</Content>
        </IndicatorItem>
      </Indicator>
    </Indicator>
  </criteria>
  <parameters />
</OpenIOC>