
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">3968</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py</a><br>
    <b>Line number: </b>7<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	
2	import os
3	import sys
4	import traceback
5	import json
6	import asyncio
7	import subprocess
8	import shutil
9	import concurrent
10	import threading
11	
12	sys.path.append(os.path.dirname(__file__))
13	sys.path.append(os.path.join(os.path.dirname(__file__), &quot;glob&quot;))
14	import manager_core as core
15	import cm_global
16	import git
17	
18	
19	print(f&quot;\n-= ComfyUI-Manager CLI ({core.version_str}) =-\n&quot;)
20	
21	
22	if not (len(sys.argv) == 2 and sys.argv[1] in [&#x27;save-snapshot&#x27;, &#x27;restore-dependencies&#x27;, &#x27;clear&#x27;]) and len(sys.argv) &lt; 3:
23	    print(f&quot;\npython cm-cli.py [OPTIONS]\n\n&quot;
24	          f&quot;OPTIONS:\n&quot;
25	          f&quot;    [install|reinstall|uninstall|update|disable|enable|fix] node_name ... ?[--channel &lt;channel name&gt;] ?[--mode [remote|local|cache]]\n&quot;
26	          f&quot;    [update|disable|enable|fix] all ?[--channel &lt;channel name&gt;] ?[--mode [remote|local|cache]]\n&quot;
27	          f&quot;    [simple-show|show] [installed|enabled|not-installed|disabled|all|snapshot|snapshot-list] ?[--channel &lt;channel name&gt;] ?[--mode [remote|local|cache]]\n&quot;
28	          f&quot;    save-snapshot ?[--output &lt;snapshot .json/.yaml&gt;]\n&quot;
29	          f&quot;    restore-snapshot &lt;snapshot .json/.yaml&gt; ?[--pip-non-url] ?[--pip-non-local-url] ?[--pip-local-url]\n&quot;
30	          f&quot;    cli-only-mode [enable|disable]\n&quot;
31	          f&quot;    restore-dependencies\n&quot;
32	          f&quot;    deps-in-workflow --workflow &lt;workflow .json/.png&gt; --output &lt;output .json&gt;\n&quot;
33	          f&quot;    install-deps &lt;deps .json&gt;\n&quot;
34	          f&quot;    clear\n&quot;)
35	    exit(-1)
36	
37	
38	comfyui_manager_path = os.path.dirname(__file__)
39	comfy_path = os.environ.get(&#x27;COMFYUI_PATH&#x27;)
40	
41	if comfy_path is None:
42	    print(f&quot;WARN: The `COMFYUI_PATH` environment variable is not set. Assuming `custom_nodes/ComfyUI-Manager/../../` as the ComfyUI path.\n&quot;, file=sys.stderr)
43	    comfy_path = os.path.abspath(os.path.join(comfyui_manager_path, &#x27;..&#x27;, &#x27;..&#x27;))
44	
45	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
46	custom_nodes_path = os.path.join(comfy_path, &#x27;custom_nodes&#x27;)
47	
48	script_path = os.path.join(startup_script_path, &quot;install-scripts.txt&quot;)
49	restore_snapshot_path = os.path.join(startup_script_path, &quot;restore-snapshot.json&quot;)
50	pip_overrides_path = os.path.join(comfyui_manager_path, &quot;pip_overrides.json&quot;)
51	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
52	
53	cm_global.pip_downgrade_blacklist = [&#x27;torch&#x27;, &#x27;torchsde&#x27;, &#x27;torchvision&#x27;, &#x27;transformers&#x27;, &#x27;safetensors&#x27;, &#x27;kornia&#x27;]
54	cm_global.pip_overrides = {}
55	if os.path.exists(pip_overrides_path):
56	    with open(pip_overrides_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
57	        cm_global.pip_overrides = json.load(json_file)
58	
59	
60	processed_install = set()
61	
62	
63	def post_install(url):
64	    try:
65	        repository_name = url.split(&quot;/&quot;)[-1].strip()
66	        repo_path = os.path.join(custom_nodes_path, repository_name)
67	        repo_path = os.path.abspath(repo_path)
68	
69	        requirements_path = os.path.join(repo_path, &#x27;requirements.txt&#x27;)
70	        install_script_path = os.path.join(repo_path, &#x27;install.py&#x27;)
71	
72	        if os.path.exists(requirements_path):
73	            with (open(requirements_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as file):
74	                for line in file:
75	                    package_name = core.remap_pip_package(line.strip())
76	                    if package_name and not core.is_installed(package_name):
77	                        install_cmd = [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package_name]
78	                        output = subprocess.check_output(install_cmd, cwd=repo_path, text=True)
79	                        for msg_line in output.split(&#x27;\n&#x27;):
80	                            if &#x27;Requirement already satisfied:&#x27; in msg_line:
81	                                print(&#x27;.&#x27;, end=&#x27;&#x27;)
82	                            else:
83	                                print(msg_line)
84	
85	        if os.path.exists(install_script_path) and f&#x27;{repo_path}/install.py&#x27; not in processed_install:
86	            processed_install.add(f&#x27;{repo_path}/install.py&#x27;)
87	            install_cmd = [sys.executable, install_script_path]
88	            output = subprocess.check_output(install_cmd, cwd=repo_path, text=True)
89	            for msg_line in output.split(&#x27;\n&#x27;):
90	                if &#x27;Requirement already satisfied:&#x27; in msg_line:
91	                    print(&#x27;.&#x27;, end=&#x27;&#x27;)
92	                else:
93	                    print(msg_line)
94	
95	    except Exception:
96	        print(f&quot;ERROR: Restoring &#x27;{url}&#x27; is failed.&quot;)
97	
98	
99	def restore_dependencies():
100	    node_paths = [os.path.join(custom_nodes_path, name) for name in os.listdir(custom_nodes_path)
101	                  if os.path.isdir(os.path.join(custom_nodes_path, name)) and not name.endswith(&#x27;.disabled&#x27;)]
102	
103	    total = len(node_paths)
104	    i = 1
105	    for x in node_paths:
106	        print(f&quot;----------------------------------------------------------------------------------------------------&quot;)
107	        print(f&quot;Restoring [{i}/{total}]: {x}&quot;)
108	        post_install(x)
109	        i += 1
110	
111	
112	def install_deps():
113	    if not os.path.exists(sys.argv[2]):
114	        print(f&quot;File not found: {sys.argv[2]}&quot;)
115	        exit(-1)
116	    else:
117	        with open(sys.argv[2], &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
118	            json_obj = json.load(json_file)
119	            for k in json_obj[&#x27;custom_nodes&#x27;].keys():
120	                state = core.simple_check_custom_node(k)
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py</a><br>
    <b>Line number: </b>78<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
18	
19	print(f&quot;\n-= ComfyUI-Manager CLI ({core.version_str}) =-\n&quot;)
20	
21	
22	if not (len(sys.argv) == 2 and sys.argv[1] in [&#x27;save-snapshot&#x27;, &#x27;restore-dependencies&#x27;, &#x27;clear&#x27;]) and len(sys.argv) &lt; 3:
23	    print(f&quot;\npython cm-cli.py [OPTIONS]\n\n&quot;
24	          f&quot;OPTIONS:\n&quot;
25	          f&quot;    [install|reinstall|uninstall|update|disable|enable|fix] node_name ... ?[--channel &lt;channel name&gt;] ?[--mode [remote|local|cache]]\n&quot;
26	          f&quot;    [update|disable|enable|fix] all ?[--channel &lt;channel name&gt;] ?[--mode [remote|local|cache]]\n&quot;
27	          f&quot;    [simple-show|show] [installed|enabled|not-installed|disabled|all|snapshot|snapshot-list] ?[--channel &lt;channel name&gt;] ?[--mode [remote|local|cache]]\n&quot;
28	          f&quot;    save-snapshot ?[--output &lt;snapshot .json/.yaml&gt;]\n&quot;
29	          f&quot;    restore-snapshot &lt;snapshot .json/.yaml&gt; ?[--pip-non-url] ?[--pip-non-local-url] ?[--pip-local-url]\n&quot;
30	          f&quot;    cli-only-mode [enable|disable]\n&quot;
31	          f&quot;    restore-dependencies\n&quot;
32	          f&quot;    deps-in-workflow --workflow &lt;workflow .json/.png&gt; --output &lt;output .json&gt;\n&quot;
33	          f&quot;    install-deps &lt;deps .json&gt;\n&quot;
34	          f&quot;    clear\n&quot;)
35	    exit(-1)
36	
37	
38	comfyui_manager_path = os.path.dirname(__file__)
39	comfy_path = os.environ.get(&#x27;COMFYUI_PATH&#x27;)
40	
41	if comfy_path is None:
42	    print(f&quot;WARN: The `COMFYUI_PATH` environment variable is not set. Assuming `custom_nodes/ComfyUI-Manager/../../` as the ComfyUI path.\n&quot;, file=sys.stderr)
43	    comfy_path = os.path.abspath(os.path.join(comfyui_manager_path, &#x27;..&#x27;, &#x27;..&#x27;))
44	
45	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
46	custom_nodes_path = os.path.join(comfy_path, &#x27;custom_nodes&#x27;)
47	
48	script_path = os.path.join(startup_script_path, &quot;install-scripts.txt&quot;)
49	restore_snapshot_path = os.path.join(startup_script_path, &quot;restore-snapshot.json&quot;)
50	pip_overrides_path = os.path.join(comfyui_manager_path, &quot;pip_overrides.json&quot;)
51	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
52	
53	cm_global.pip_downgrade_blacklist = [&#x27;torch&#x27;, &#x27;torchsde&#x27;, &#x27;torchvision&#x27;, &#x27;transformers&#x27;, &#x27;safetensors&#x27;, &#x27;kornia&#x27;]
54	cm_global.pip_overrides = {}
55	if os.path.exists(pip_overrides_path):
56	    with open(pip_overrides_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
57	        cm_global.pip_overrides = json.load(json_file)
58	
59	
60	processed_install = set()
61	
62	
63	def post_install(url):
64	    try:
65	        repository_name = url.split(&quot;/&quot;)[-1].strip()
66	        repo_path = os.path.join(custom_nodes_path, repository_name)
67	        repo_path = os.path.abspath(repo_path)
68	
69	        requirements_path = os.path.join(repo_path, &#x27;requirements.txt&#x27;)
70	        install_script_path = os.path.join(repo_path, &#x27;install.py&#x27;)
71	
72	        if os.path.exists(requirements_path):
73	            with (open(requirements_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as file):
74	                for line in file:
75	                    package_name = core.remap_pip_package(line.strip())
76	                    if package_name and not core.is_installed(package_name):
77	                        install_cmd = [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package_name]
78	                        output = subprocess.check_output(install_cmd, cwd=repo_path, text=True)
79	                        for msg_line in output.split(&#x27;\n&#x27;):
80	                            if &#x27;Requirement already satisfied:&#x27; in msg_line:
81	                                print(&#x27;.&#x27;, end=&#x27;&#x27;)
82	                            else:
83	                                print(msg_line)
84	
85	        if os.path.exists(install_script_path) and f&#x27;{repo_path}/install.py&#x27; not in processed_install:
86	            processed_install.add(f&#x27;{repo_path}/install.py&#x27;)
87	            install_cmd = [sys.executable, install_script_path]
88	            output = subprocess.check_output(install_cmd, cwd=repo_path, text=True)
89	            for msg_line in output.split(&#x27;\n&#x27;):
90	                if &#x27;Requirement already satisfied:&#x27; in msg_line:
91	                    print(&#x27;.&#x27;, end=&#x27;&#x27;)
92	                else:
93	                    print(msg_line)
94	
95	    except Exception:
96	        print(f&quot;ERROR: Restoring &#x27;{url}&#x27; is failed.&quot;)
97	
98	
99	def restore_dependencies():
100	    node_paths = [os.path.join(custom_nodes_path, name) for name in os.listdir(custom_nodes_path)
101	                  if os.path.isdir(os.path.join(custom_nodes_path, name)) and not name.endswith(&#x27;.disabled&#x27;)]
102	
103	    total = len(node_paths)
104	    i = 1
105	    for x in node_paths:
106	        print(f&quot;----------------------------------------------------------------------------------------------------&quot;)
107	        print(f&quot;Restoring [{i}/{total}]: {x}&quot;)
108	        post_install(x)
109	        i += 1
110	
111	
112	def install_deps():
113	    if not os.path.exists(sys.argv[2]):
114	        print(f&quot;File not found: {sys.argv[2]}&quot;)
115	        exit(-1)
116	    else:
117	        with open(sys.argv[2], &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
118	            json_obj = json.load(json_file)
119	            for k in json_obj[&#x27;custom_nodes&#x27;].keys():
120	                state = core.simple_check_custom_node(k)
121	                if state == &#x27;installed&#x27;:
122	                    continue
123	                elif state == &#x27;not-installed&#x27;:
124	                    core.gitclone_install([k], instant_execution=True)
125	                else:  # disabled
126	                    core.gitclone_set_active([k], False)
127	
128	        print(&quot;Dependency installation and activation complete.&quot;)
129	
130	
131	def restore_snapshot():
132	    global processed_install
133	
134	    snapshot_name = sys.argv[2]
135	    extras = [x for x in sys.argv if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]]
136	
137	    print(f&quot;pips restore mode: {extras}&quot;)
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py</a><br>
    <b>Line number: </b>88<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
28	          f&quot;    save-snapshot ?[--output &lt;snapshot .json/.yaml&gt;]\n&quot;
29	          f&quot;    restore-snapshot &lt;snapshot .json/.yaml&gt; ?[--pip-non-url] ?[--pip-non-local-url] ?[--pip-local-url]\n&quot;
30	          f&quot;    cli-only-mode [enable|disable]\n&quot;
31	          f&quot;    restore-dependencies\n&quot;
32	          f&quot;    deps-in-workflow --workflow &lt;workflow .json/.png&gt; --output &lt;output .json&gt;\n&quot;
33	          f&quot;    install-deps &lt;deps .json&gt;\n&quot;
34	          f&quot;    clear\n&quot;)
35	    exit(-1)
36	
37	
38	comfyui_manager_path = os.path.dirname(__file__)
39	comfy_path = os.environ.get(&#x27;COMFYUI_PATH&#x27;)
40	
41	if comfy_path is None:
42	    print(f&quot;WARN: The `COMFYUI_PATH` environment variable is not set. Assuming `custom_nodes/ComfyUI-Manager/../../` as the ComfyUI path.\n&quot;, file=sys.stderr)
43	    comfy_path = os.path.abspath(os.path.join(comfyui_manager_path, &#x27;..&#x27;, &#x27;..&#x27;))
44	
45	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
46	custom_nodes_path = os.path.join(comfy_path, &#x27;custom_nodes&#x27;)
47	
48	script_path = os.path.join(startup_script_path, &quot;install-scripts.txt&quot;)
49	restore_snapshot_path = os.path.join(startup_script_path, &quot;restore-snapshot.json&quot;)
50	pip_overrides_path = os.path.join(comfyui_manager_path, &quot;pip_overrides.json&quot;)
51	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
52	
53	cm_global.pip_downgrade_blacklist = [&#x27;torch&#x27;, &#x27;torchsde&#x27;, &#x27;torchvision&#x27;, &#x27;transformers&#x27;, &#x27;safetensors&#x27;, &#x27;kornia&#x27;]
54	cm_global.pip_overrides = {}
55	if os.path.exists(pip_overrides_path):
56	    with open(pip_overrides_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
57	        cm_global.pip_overrides = json.load(json_file)
58	
59	
60	processed_install = set()
61	
62	
63	def post_install(url):
64	    try:
65	        repository_name = url.split(&quot;/&quot;)[-1].strip()
66	        repo_path = os.path.join(custom_nodes_path, repository_name)
67	        repo_path = os.path.abspath(repo_path)
68	
69	        requirements_path = os.path.join(repo_path, &#x27;requirements.txt&#x27;)
70	        install_script_path = os.path.join(repo_path, &#x27;install.py&#x27;)
71	
72	        if os.path.exists(requirements_path):
73	            with (open(requirements_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as file):
74	                for line in file:
75	                    package_name = core.remap_pip_package(line.strip())
76	                    if package_name and not core.is_installed(package_name):
77	                        install_cmd = [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package_name]
78	                        output = subprocess.check_output(install_cmd, cwd=repo_path, text=True)
79	                        for msg_line in output.split(&#x27;\n&#x27;):
80	                            if &#x27;Requirement already satisfied:&#x27; in msg_line:
81	                                print(&#x27;.&#x27;, end=&#x27;&#x27;)
82	                            else:
83	                                print(msg_line)
84	
85	        if os.path.exists(install_script_path) and f&#x27;{repo_path}/install.py&#x27; not in processed_install:
86	            processed_install.add(f&#x27;{repo_path}/install.py&#x27;)
87	            install_cmd = [sys.executable, install_script_path]
88	            output = subprocess.check_output(install_cmd, cwd=repo_path, text=True)
89	            for msg_line in output.split(&#x27;\n&#x27;):
90	                if &#x27;Requirement already satisfied:&#x27; in msg_line:
91	                    print(&#x27;.&#x27;, end=&#x27;&#x27;)
92	                else:
93	                    print(msg_line)
94	
95	    except Exception:
96	        print(f&quot;ERROR: Restoring &#x27;{url}&#x27; is failed.&quot;)
97	
98	
99	def restore_dependencies():
100	    node_paths = [os.path.join(custom_nodes_path, name) for name in os.listdir(custom_nodes_path)
101	                  if os.path.isdir(os.path.join(custom_nodes_path, name)) and not name.endswith(&#x27;.disabled&#x27;)]
102	
103	    total = len(node_paths)
104	    i = 1
105	    for x in node_paths:
106	        print(f&quot;----------------------------------------------------------------------------------------------------&quot;)
107	        print(f&quot;Restoring [{i}/{total}]: {x}&quot;)
108	        post_install(x)
109	        i += 1
110	
111	
112	def install_deps():
113	    if not os.path.exists(sys.argv[2]):
114	        print(f&quot;File not found: {sys.argv[2]}&quot;)
115	        exit(-1)
116	    else:
117	        with open(sys.argv[2], &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
118	            json_obj = json.load(json_file)
119	            for k in json_obj[&#x27;custom_nodes&#x27;].keys():
120	                state = core.simple_check_custom_node(k)
121	                if state == &#x27;installed&#x27;:
122	                    continue
123	                elif state == &#x27;not-installed&#x27;:
124	                    core.gitclone_install([k], instant_execution=True)
125	                else:  # disabled
126	                    core.gitclone_set_active([k], False)
127	
128	        print(&quot;Dependency installation and activation complete.&quot;)
129	
130	
131	def restore_snapshot():
132	    global processed_install
133	
134	    snapshot_name = sys.argv[2]
135	    extras = [x for x in sys.argv if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]]
136	
137	    print(f&quot;pips restore mode: {extras}&quot;)
138	
139	    if os.path.exists(snapshot_name):
140	        snapshot_path = os.path.abspath(snapshot_name)
141	    else:
142	        snapshot_path = os.path.join(core.comfyui_manager_path, &#x27;snapshots&#x27;, snapshot_name)
143	        if not os.path.exists(snapshot_path):
144	            print(f&quot;ERROR: `{snapshot_path}` is not exists.&quot;)
145	            exit(-1)
146	
147	    try:
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py</a><br>
    <b>Line number: </b>174<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
114	        print(f&quot;File not found: {sys.argv[2]}&quot;)
115	        exit(-1)
116	    else:
117	        with open(sys.argv[2], &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
118	            json_obj = json.load(json_file)
119	            for k in json_obj[&#x27;custom_nodes&#x27;].keys():
120	                state = core.simple_check_custom_node(k)
121	                if state == &#x27;installed&#x27;:
122	                    continue
123	                elif state == &#x27;not-installed&#x27;:
124	                    core.gitclone_install([k], instant_execution=True)
125	                else:  # disabled
126	                    core.gitclone_set_active([k], False)
127	
128	        print(&quot;Dependency installation and activation complete.&quot;)
129	
130	
131	def restore_snapshot():
132	    global processed_install
133	
134	    snapshot_name = sys.argv[2]
135	    extras = [x for x in sys.argv if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]]
136	
137	    print(f&quot;pips restore mode: {extras}&quot;)
138	
139	    if os.path.exists(snapshot_name):
140	        snapshot_path = os.path.abspath(snapshot_name)
141	    else:
142	        snapshot_path = os.path.join(core.comfyui_manager_path, &#x27;snapshots&#x27;, snapshot_name)
143	        if not os.path.exists(snapshot_path):
144	            print(f&quot;ERROR: `{snapshot_path}` is not exists.&quot;)
145	            exit(-1)
146	
147	    try:
148	        cloned_repos = []
149	        checkout_repos = []
150	        skipped_repos = []
151	        enabled_repos = []
152	        disabled_repos = []
153	        is_failed = False
154	
155	        def extract_infos(msg_lines):
156	            nonlocal is_failed
157	
158	            for x in msg_lines:
159	                if x.startswith(&quot;CLONE: &quot;):
160	                    cloned_repos.append(x[7:])
161	                elif x.startswith(&quot;CHECKOUT: &quot;):
162	                    checkout_repos.append(x[10:])
163	                elif x.startswith(&quot;SKIPPED: &quot;):
164	                    skipped_repos.append(x[9:])
165	                elif x.startswith(&quot;ENABLE: &quot;):
166	                    enabled_repos.append(x[8:])
167	                elif x.startswith(&quot;DISABLE: &quot;):
168	                    disabled_repos.append(x[9:])
169	                elif &#x27;APPLY SNAPSHOT: False&#x27; in x:
170	                    is_failed = True
171	
172	        print(f&quot;Restore snapshot.&quot;)
173	        cmd_str = [sys.executable, git_script_path, &#x27;--apply-snapshot&#x27;, snapshot_path] + extras
174	        output = subprocess.check_output(cmd_str, cwd=custom_nodes_path, text=True)
175	        msg_lines = output.split(&#x27;\n&#x27;)
176	        extract_infos(msg_lines)
177	
178	        for url in cloned_repos:
179	            post_install(url)
180	
181	        # print summary
182	        for x in cloned_repos:
183	            print(f&quot;[ INSTALLED ] {x}&quot;)
184	        for x in checkout_repos:
185	            print(f&quot;[  CHECKOUT ] {x}&quot;)
186	        for x in enabled_repos:
187	            print(f&quot;[  ENABLED  ] {x}&quot;)
188	        for x in disabled_repos:
189	            print(f&quot;[  DISABLED ] {x}&quot;)
190	
191	        if is_failed:
192	            print(&quot;ERROR: Failed to restore snapshot.&quot;)
193	
194	    except Exception:
195	        print(&quot;ERROR: Failed to restore snapshot.&quot;)
196	        traceback.print_exc()
197	        exit(-1)
198	
199	
200	def check_comfyui_hash():
201	    repo = git.Repo(comfy_path)
202	    core.comfy_ui_revision = len(list(repo.iter_commits(&#x27;HEAD&#x27;)))
203	
204	    comfy_ui_hash = repo.head.commit.hexsha
205	    cm_global.variables[&#x27;comfyui.revision&#x27;] = core.comfy_ui_revision
206	
207	    core.comfy_ui_commit_datetime = repo.head.commit.committed_datetime
208	
209	
210	check_comfyui_hash()
211	
212	
213	def read_downgrade_blacklist():
214	    try:
215	        import configparser
216	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
217	        config = configparser.ConfigParser()
218	        config.read(config_path)
219	        default_conf = config[&#x27;default&#x27;]
220	
221	        if &#x27;downgrade_blacklist&#x27; in default_conf:
222	            items = default_conf[&#x27;downgrade_blacklist&#x27;].split(&#x27;,&#x27;)
223	            items = [x.strip() for x in items if x != &#x27;&#x27;]
224	            cm_global.pip_downgrade_blacklist += items
225	            cm_global.pip_downgrade_blacklist = list(set(cm_global.pip_downgrade_blacklist))
226	    except:
227	        pass
228	
229	
230	read_downgrade_blacklist()
231	
232	channel = &#x27;default&#x27;
233	mode = &#x27;remote&#x27;
</pre>
</div>


</div>
</div>

<div id="issue-4">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/cm-cli.py</a><br>
    <b>Line number: </b>226<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
166	                    enabled_repos.append(x[8:])
167	                elif x.startswith(&quot;DISABLE: &quot;):
168	                    disabled_repos.append(x[9:])
169	                elif &#x27;APPLY SNAPSHOT: False&#x27; in x:
170	                    is_failed = True
171	
172	        print(f&quot;Restore snapshot.&quot;)
173	        cmd_str = [sys.executable, git_script_path, &#x27;--apply-snapshot&#x27;, snapshot_path] + extras
174	        output = subprocess.check_output(cmd_str, cwd=custom_nodes_path, text=True)
175	        msg_lines = output.split(&#x27;\n&#x27;)
176	        extract_infos(msg_lines)
177	
178	        for url in cloned_repos:
179	            post_install(url)
180	
181	        # print summary
182	        for x in cloned_repos:
183	            print(f&quot;[ INSTALLED ] {x}&quot;)
184	        for x in checkout_repos:
185	            print(f&quot;[  CHECKOUT ] {x}&quot;)
186	        for x in enabled_repos:
187	            print(f&quot;[  ENABLED  ] {x}&quot;)
188	        for x in disabled_repos:
189	            print(f&quot;[  DISABLED ] {x}&quot;)
190	
191	        if is_failed:
192	            print(&quot;ERROR: Failed to restore snapshot.&quot;)
193	
194	    except Exception:
195	        print(&quot;ERROR: Failed to restore snapshot.&quot;)
196	        traceback.print_exc()
197	        exit(-1)
198	
199	
200	def check_comfyui_hash():
201	    repo = git.Repo(comfy_path)
202	    core.comfy_ui_revision = len(list(repo.iter_commits(&#x27;HEAD&#x27;)))
203	
204	    comfy_ui_hash = repo.head.commit.hexsha
205	    cm_global.variables[&#x27;comfyui.revision&#x27;] = core.comfy_ui_revision
206	
207	    core.comfy_ui_commit_datetime = repo.head.commit.committed_datetime
208	
209	
210	check_comfyui_hash()
211	
212	
213	def read_downgrade_blacklist():
214	    try:
215	        import configparser
216	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
217	        config = configparser.ConfigParser()
218	        config.read(config_path)
219	        default_conf = config[&#x27;default&#x27;]
220	
221	        if &#x27;downgrade_blacklist&#x27; in default_conf:
222	            items = default_conf[&#x27;downgrade_blacklist&#x27;].split(&#x27;,&#x27;)
223	            items = [x.strip() for x in items if x != &#x27;&#x27;]
224	            cm_global.pip_downgrade_blacklist += items
225	            cm_global.pip_downgrade_blacklist = list(set(cm_global.pip_downgrade_blacklist))
226	    except:
227	        pass
228	
229	
230	read_downgrade_blacklist()
231	
232	channel = &#x27;default&#x27;
233	mode = &#x27;remote&#x27;
234	nodes = set()
235	
236	
237	def load_custom_nodes():
238	    channel_dict = core.get_channel_dict()
239	    if channel not in channel_dict:
240	        print(f&quot;ERROR: Invalid channel is specified `--channel {channel}`&quot;, file=sys.stderr)
241	        exit(-1)
242	
243	    if mode not in [&#x27;remote&#x27;, &#x27;local&#x27;, &#x27;cache&#x27;]:
244	        print(f&quot;ERROR: Invalid mode is specified `--mode {mode}`&quot;, file=sys.stderr)
245	        exit(-1)
246	
247	    channel_url = channel_dict[channel]
248	
249	    res = {}
250	    json_obj = asyncio.run(core.get_data_by_mode(mode, &#x27;custom-node-list.json&#x27;, channel_url=channel_url))
251	    for x in json_obj[&#x27;custom_nodes&#x27;]:
252	        for y in x[&#x27;files&#x27;]:
253	            if &#x27;github.com&#x27; in y and not (y.endswith(&#x27;.py&#x27;) or y.endswith(&#x27;.js&#x27;)):
254	                repo_name = y.split(&#x27;/&#x27;)[-1]
255	                res[repo_name] = (x, False)
256	
257	        if &#x27;id&#x27; in x:
258	            if x[&#x27;id&#x27;] not in res:
259	                res[x[&#x27;id&#x27;]] = (x, True)
260	
261	    return res
262	
263	
264	def process_args():
265	    global channel
266	    global mode
267	
268	    i = 2
269	    while i &lt; len(sys.argv):
270	        if sys.argv[i] == &#x27;--channel&#x27;:
271	            if i+1 &lt; len(sys.argv):
272	                channel = sys.argv[i+1]
273	                i += 1
274	        elif sys.argv[i] == &#x27;--mode&#x27;:
275	            if i+1 &lt; len(sys.argv):
276	                mode = sys.argv[i+1]
277	                i += 1
278	        else:
279	            nodes.add(sys.argv[i])
280	
281	        i += 1
282	
283	
284	process_args()
285	custom_node_map = load_custom_nodes()
286	
</pre>
</div>


</div>
</div>

<div id="issue-5">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>1<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import subprocess
2	import sys
3	import os
4	import traceback
5	
6	import git
7	import configparser
8	import re
9	import json
10	import yaml
11	from torchvision.datasets.utils import download_url
12	from tqdm.auto import tqdm
13	from git.remote import RemoteProgress
14	
15	config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
16	nodelist_path = os.path.join(os.path.dirname(__file__), &quot;custom-node-list.json&quot;)
17	working_directory = os.getcwd()
18	
19	if os.path.basename(working_directory) != &#x27;custom_nodes&#x27;:
20	    print(f&quot;WARN: This script should be executed in custom_nodes dir&quot;)
21	    print(f&quot;DBG: INFO {working_directory}&quot;)
22	    print(f&quot;DBG: INFO {sys.argv}&quot;)
23	    # exit(-1)
24	
25	
26	class GitProgress(RemoteProgress):
27	    def __init__(self):
28	        super().__init__()
29	        self.pbar = tqdm(ascii=True)
30	
31	    def update(self, op_code, cur_count, max_count=None, message=&#x27;&#x27;):
32	        self.pbar.total = max_count
33	        self.pbar.n = cur_count
34	        self.pbar.pos = 0
35	        self.pbar.refresh()
36	
37	
38	def gitclone(custom_nodes_path, url, target_hash=None):
39	    repo_name = os.path.splitext(os.path.basename(url))[0]
40	    repo_path = os.path.join(custom_nodes_path, repo_name)
41	
42	    # Clone the repository from the remote URL
43	    repo = git.Repo.clone_from(url, repo_path, recursive=True, progress=GitProgress())
44	
45	    if target_hash is not None:
46	        print(f&quot;CHECKOUT: {repo_name} [{target_hash}]&quot;)
47	        repo.git.checkout(target_hash)
48	            
49	    repo.git.clear_cache()
50	    repo.close()
51	
52	
53	def gitcheck(path, do_fetch=False):
54	    try:
55	        # Fetch the latest commits from the remote repository
56	        repo = git.Repo(path)
57	
58	        if repo.head.is_detached:
59	            print(&quot;CUSTOM NODE CHECK: True&quot;)
60	            return
61	
62	        current_branch = repo.active_branch
63	        branch_name = current_branch.name
64	
65	        remote_name = current_branch.tracking_branch().remote_name
66	        remote = repo.remote(name=remote_name)
67	
68	        if do_fetch:
69	            remote.fetch()
70	
71	        # Get the current commit hash and the commit hash of the remote branch
72	        commit_hash = repo.head.commit.hexsha
73	        remote_commit_hash = repo.refs[f&#x27;{remote_name}/{branch_name}&#x27;].object.hexsha
74	
75	        # Compare the commit hashes to determine if the local repository is behind the remote repository
76	        if commit_hash != remote_commit_hash:
77	            # Get the commit dates
78	            commit_date = repo.head.commit.committed_datetime
79	            remote_commit_date = repo.refs[f&#x27;{remote_name}/{branch_name}&#x27;].object.committed_datetime
80	
81	            # Compare the commit dates to determine if the local repository is behind the remote repository
82	            if commit_date &lt; remote_commit_date:
83	                print(&quot;CUSTOM NODE CHECK: True&quot;)
84	        else:
85	            print(&quot;CUSTOM NODE CHECK: False&quot;)
86	    except Exception as e:
87	        print(e)
88	        print(&quot;CUSTOM NODE CHECK: Error&quot;)
89	
90	
91	def switch_to_default_branch(repo):
92	    show_result = repo.git.remote(&quot;show&quot;, &quot;origin&quot;)
93	    matches = re.search(r&quot;\s*HEAD branch:\s*(.*)&quot;, show_result)
94	    if matches:
95	        default_branch = matches.group(1)
96	        repo.git.checkout(default_branch)
97	
98	
99	def gitpull(path):
100	    # Check if the path is a git repository
101	    if not os.path.exists(os.path.join(path, &#x27;.git&#x27;)):
102	        raise ValueError(&#x27;Not a git repository&#x27;)
103	
104	    # Pull the latest changes from the remote repository
105	    repo = git.Repo(path)
106	    if repo.is_dirty():
107	        repo.git.stash()
108	
109	    commit_hash = repo.head.commit.hexsha
110	    try:
111	        if repo.head.is_detached:
112	            switch_to_default_branch(repo)
113	
114	        current_branch = repo.active_branch
115	        branch_name = current_branch.name
116	
117	        remote_name = current_branch.tracking_branch().remote_name
118	        remote = repo.remote(name=remote_name)
119	
120	        remote.fetch()
</pre>
</div>


</div>
</div>

<div id="issue-6">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>351<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
291	            if not target.endswith(&#x27;.json&#x27;) and not target.endswith(&#x27;.yaml&#x27;):
292	                print(f&quot;Snapshot file not found: `{path}`&quot;)
293	                print(&quot;APPLY SNAPSHOT: False&quot;)
294	                return None
295	
296	            with open(path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;) as snapshot_file:
297	                if target.endswith(&#x27;.json&#x27;):
298	                    info = json.load(snapshot_file)
299	                elif target.endswith(&#x27;.yaml&#x27;):
300	                    info = yaml.load(snapshot_file, Loader=yaml.SafeLoader)
301	                    info = info[&#x27;custom_nodes&#x27;]
302	                else:
303	                    # impossible case
304	                    print(&quot;APPLY SNAPSHOT: False&quot;)
305	                    return None
306	
307	                comfyui_hash = info[&#x27;comfyui&#x27;]
308	                git_custom_node_infos = info[&#x27;git_custom_nodes&#x27;]
309	                file_custom_node_infos = info[&#x27;file_custom_nodes&#x27;]
310	
311	                checkout_comfyui_hash(comfyui_hash)
312	                checkout_custom_node_hash(git_custom_node_infos)
313	                invalidate_custom_node_file(file_custom_node_infos)
314	
315	                print(&quot;APPLY SNAPSHOT: True&quot;)
316	                if &#x27;pips&#x27; in info:
317	                    return info[&#x27;pips&#x27;]
318	                else:
319	                    return None
320	
321	        print(f&quot;Snapshot file not found: `{path}`&quot;)
322	        print(&quot;APPLY SNAPSHOT: False&quot;)
323	
324	        return None
325	    except Exception as e:
326	        print(e)
327	        traceback.print_exc()
328	        print(&quot;APPLY SNAPSHOT: False&quot;)
329	
330	        return None
331	
332	
333	def restore_pip_snapshot(pips, options):
334	    non_url = []
335	    local_url = []
336	    non_local_url = []
337	    for k, v in pips.items():
338	        if v == &quot;&quot;:
339	            non_url.append(v)
340	        else:
341	            if v.startswith(&#x27;file:&#x27;):
342	                local_url.append(v)
343	            else:
344	                non_local_url.append(v)
345	
346	    failed = []
347	    if &#x27;--pip-non-url&#x27; in options:
348	        # try all at once
349	        res = 1
350	        try:
351	            res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;] + non_url)
352	        except:
353	            pass
354	
355	        # fallback
356	        if res != 0:
357	            for x in non_url:
358	                res = 1
359	                try:
360	                    res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
361	                except:
362	                    pass
363	
364	                if res != 0:
365	                    failed.append(x)
366	
367	    if &#x27;--pip-non-local-url&#x27; in options:
368	        for x in non_local_url:
369	            res = 1
370	            try:
371	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
372	            except:
373	                pass
374	
375	            if res != 0:
376	                failed.append(x)
377	
378	    if &#x27;--pip-local-url&#x27; in options:
379	        for x in local_url:
380	            res = 1
381	            try:
382	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
383	            except:
384	                pass
385	
386	            if res != 0:
387	                failed.append(x)
388	
389	    print(f&quot;Installation failed for pip packages: {failed}&quot;)
390	
391	
392	def setup_environment():
393	    config = configparser.ConfigParser()
394	    config.read(config_path)
395	    if &#x27;default&#x27; in config and &#x27;git_exe&#x27; in config[&#x27;default&#x27;] and config[&#x27;default&#x27;][&#x27;git_exe&#x27;] != &#x27;&#x27;:
396	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=config[&#x27;default&#x27;][&#x27;git_exe&#x27;])
397	
398	
399	setup_environment()
400	
401	
402	try:
403	    if sys.argv[1] == &quot;--clone&quot;:
404	        gitclone(sys.argv[2], sys.argv[3])
405	    elif sys.argv[1] == &quot;--check&quot;:
406	        gitcheck(sys.argv[2], False)
407	    elif sys.argv[1] == &quot;--fetch&quot;:
408	        gitcheck(sys.argv[2], True)
409	    elif sys.argv[1] == &quot;--pull&quot;:
410	        gitpull(sys.argv[2])
</pre>
</div>


</div>
</div>

<div id="issue-7">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>352<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
292	                print(f&quot;Snapshot file not found: `{path}`&quot;)
293	                print(&quot;APPLY SNAPSHOT: False&quot;)
294	                return None
295	
296	            with open(path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;) as snapshot_file:
297	                if target.endswith(&#x27;.json&#x27;):
298	                    info = json.load(snapshot_file)
299	                elif target.endswith(&#x27;.yaml&#x27;):
300	                    info = yaml.load(snapshot_file, Loader=yaml.SafeLoader)
301	                    info = info[&#x27;custom_nodes&#x27;]
302	                else:
303	                    # impossible case
304	                    print(&quot;APPLY SNAPSHOT: False&quot;)
305	                    return None
306	
307	                comfyui_hash = info[&#x27;comfyui&#x27;]
308	                git_custom_node_infos = info[&#x27;git_custom_nodes&#x27;]
309	                file_custom_node_infos = info[&#x27;file_custom_nodes&#x27;]
310	
311	                checkout_comfyui_hash(comfyui_hash)
312	                checkout_custom_node_hash(git_custom_node_infos)
313	                invalidate_custom_node_file(file_custom_node_infos)
314	
315	                print(&quot;APPLY SNAPSHOT: True&quot;)
316	                if &#x27;pips&#x27; in info:
317	                    return info[&#x27;pips&#x27;]
318	                else:
319	                    return None
320	
321	        print(f&quot;Snapshot file not found: `{path}`&quot;)
322	        print(&quot;APPLY SNAPSHOT: False&quot;)
323	
324	        return None
325	    except Exception as e:
326	        print(e)
327	        traceback.print_exc()
328	        print(&quot;APPLY SNAPSHOT: False&quot;)
329	
330	        return None
331	
332	
333	def restore_pip_snapshot(pips, options):
334	    non_url = []
335	    local_url = []
336	    non_local_url = []
337	    for k, v in pips.items():
338	        if v == &quot;&quot;:
339	            non_url.append(v)
340	        else:
341	            if v.startswith(&#x27;file:&#x27;):
342	                local_url.append(v)
343	            else:
344	                non_local_url.append(v)
345	
346	    failed = []
347	    if &#x27;--pip-non-url&#x27; in options:
348	        # try all at once
349	        res = 1
350	        try:
351	            res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;] + non_url)
352	        except:
353	            pass
354	
355	        # fallback
356	        if res != 0:
357	            for x in non_url:
358	                res = 1
359	                try:
360	                    res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
361	                except:
362	                    pass
363	
364	                if res != 0:
365	                    failed.append(x)
366	
367	    if &#x27;--pip-non-local-url&#x27; in options:
368	        for x in non_local_url:
369	            res = 1
370	            try:
371	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
372	            except:
373	                pass
374	
375	            if res != 0:
376	                failed.append(x)
377	
378	    if &#x27;--pip-local-url&#x27; in options:
379	        for x in local_url:
380	            res = 1
381	            try:
382	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
383	            except:
384	                pass
385	
386	            if res != 0:
387	                failed.append(x)
388	
389	    print(f&quot;Installation failed for pip packages: {failed}&quot;)
390	
391	
392	def setup_environment():
393	    config = configparser.ConfigParser()
394	    config.read(config_path)
395	    if &#x27;default&#x27; in config and &#x27;git_exe&#x27; in config[&#x27;default&#x27;] and config[&#x27;default&#x27;][&#x27;git_exe&#x27;] != &#x27;&#x27;:
396	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=config[&#x27;default&#x27;][&#x27;git_exe&#x27;])
397	
398	
399	setup_environment()
400	
401	
402	try:
403	    if sys.argv[1] == &quot;--clone&quot;:
404	        gitclone(sys.argv[2], sys.argv[3])
405	    elif sys.argv[1] == &quot;--check&quot;:
406	        gitcheck(sys.argv[2], False)
407	    elif sys.argv[1] == &quot;--fetch&quot;:
408	        gitcheck(sys.argv[2], True)
409	    elif sys.argv[1] == &quot;--pull&quot;:
410	        gitpull(sys.argv[2])
411	    elif sys.argv[1] == &quot;--apply-snapshot&quot;:
412	        options = set()
</pre>
</div>


</div>
</div>

<div id="issue-8">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>360<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
300	                    info = yaml.load(snapshot_file, Loader=yaml.SafeLoader)
301	                    info = info[&#x27;custom_nodes&#x27;]
302	                else:
303	                    # impossible case
304	                    print(&quot;APPLY SNAPSHOT: False&quot;)
305	                    return None
306	
307	                comfyui_hash = info[&#x27;comfyui&#x27;]
308	                git_custom_node_infos = info[&#x27;git_custom_nodes&#x27;]
309	                file_custom_node_infos = info[&#x27;file_custom_nodes&#x27;]
310	
311	                checkout_comfyui_hash(comfyui_hash)
312	                checkout_custom_node_hash(git_custom_node_infos)
313	                invalidate_custom_node_file(file_custom_node_infos)
314	
315	                print(&quot;APPLY SNAPSHOT: True&quot;)
316	                if &#x27;pips&#x27; in info:
317	                    return info[&#x27;pips&#x27;]
318	                else:
319	                    return None
320	
321	        print(f&quot;Snapshot file not found: `{path}`&quot;)
322	        print(&quot;APPLY SNAPSHOT: False&quot;)
323	
324	        return None
325	    except Exception as e:
326	        print(e)
327	        traceback.print_exc()
328	        print(&quot;APPLY SNAPSHOT: False&quot;)
329	
330	        return None
331	
332	
333	def restore_pip_snapshot(pips, options):
334	    non_url = []
335	    local_url = []
336	    non_local_url = []
337	    for k, v in pips.items():
338	        if v == &quot;&quot;:
339	            non_url.append(v)
340	        else:
341	            if v.startswith(&#x27;file:&#x27;):
342	                local_url.append(v)
343	            else:
344	                non_local_url.append(v)
345	
346	    failed = []
347	    if &#x27;--pip-non-url&#x27; in options:
348	        # try all at once
349	        res = 1
350	        try:
351	            res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;] + non_url)
352	        except:
353	            pass
354	
355	        # fallback
356	        if res != 0:
357	            for x in non_url:
358	                res = 1
359	                try:
360	                    res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
361	                except:
362	                    pass
363	
364	                if res != 0:
365	                    failed.append(x)
366	
367	    if &#x27;--pip-non-local-url&#x27; in options:
368	        for x in non_local_url:
369	            res = 1
370	            try:
371	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
372	            except:
373	                pass
374	
375	            if res != 0:
376	                failed.append(x)
377	
378	    if &#x27;--pip-local-url&#x27; in options:
379	        for x in local_url:
380	            res = 1
381	            try:
382	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
383	            except:
384	                pass
385	
386	            if res != 0:
387	                failed.append(x)
388	
389	    print(f&quot;Installation failed for pip packages: {failed}&quot;)
390	
391	
392	def setup_environment():
393	    config = configparser.ConfigParser()
394	    config.read(config_path)
395	    if &#x27;default&#x27; in config and &#x27;git_exe&#x27; in config[&#x27;default&#x27;] and config[&#x27;default&#x27;][&#x27;git_exe&#x27;] != &#x27;&#x27;:
396	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=config[&#x27;default&#x27;][&#x27;git_exe&#x27;])
397	
398	
399	setup_environment()
400	
401	
402	try:
403	    if sys.argv[1] == &quot;--clone&quot;:
404	        gitclone(sys.argv[2], sys.argv[3])
405	    elif sys.argv[1] == &quot;--check&quot;:
406	        gitcheck(sys.argv[2], False)
407	    elif sys.argv[1] == &quot;--fetch&quot;:
408	        gitcheck(sys.argv[2], True)
409	    elif sys.argv[1] == &quot;--pull&quot;:
410	        gitpull(sys.argv[2])
411	    elif sys.argv[1] == &quot;--apply-snapshot&quot;:
412	        options = set()
413	        for x in sys.argv:
414	            if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]:
415	                options.add(x)
416	
417	        pips = apply_snapshot(sys.argv[2])
418	
419	        if pips and len(options) &gt; 0:
</pre>
</div>


</div>
</div>

<div id="issue-9">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>361<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
301	                    info = info[&#x27;custom_nodes&#x27;]
302	                else:
303	                    # impossible case
304	                    print(&quot;APPLY SNAPSHOT: False&quot;)
305	                    return None
306	
307	                comfyui_hash = info[&#x27;comfyui&#x27;]
308	                git_custom_node_infos = info[&#x27;git_custom_nodes&#x27;]
309	                file_custom_node_infos = info[&#x27;file_custom_nodes&#x27;]
310	
311	                checkout_comfyui_hash(comfyui_hash)
312	                checkout_custom_node_hash(git_custom_node_infos)
313	                invalidate_custom_node_file(file_custom_node_infos)
314	
315	                print(&quot;APPLY SNAPSHOT: True&quot;)
316	                if &#x27;pips&#x27; in info:
317	                    return info[&#x27;pips&#x27;]
318	                else:
319	                    return None
320	
321	        print(f&quot;Snapshot file not found: `{path}`&quot;)
322	        print(&quot;APPLY SNAPSHOT: False&quot;)
323	
324	        return None
325	    except Exception as e:
326	        print(e)
327	        traceback.print_exc()
328	        print(&quot;APPLY SNAPSHOT: False&quot;)
329	
330	        return None
331	
332	
333	def restore_pip_snapshot(pips, options):
334	    non_url = []
335	    local_url = []
336	    non_local_url = []
337	    for k, v in pips.items():
338	        if v == &quot;&quot;:
339	            non_url.append(v)
340	        else:
341	            if v.startswith(&#x27;file:&#x27;):
342	                local_url.append(v)
343	            else:
344	                non_local_url.append(v)
345	
346	    failed = []
347	    if &#x27;--pip-non-url&#x27; in options:
348	        # try all at once
349	        res = 1
350	        try:
351	            res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;] + non_url)
352	        except:
353	            pass
354	
355	        # fallback
356	        if res != 0:
357	            for x in non_url:
358	                res = 1
359	                try:
360	                    res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
361	                except:
362	                    pass
363	
364	                if res != 0:
365	                    failed.append(x)
366	
367	    if &#x27;--pip-non-local-url&#x27; in options:
368	        for x in non_local_url:
369	            res = 1
370	            try:
371	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
372	            except:
373	                pass
374	
375	            if res != 0:
376	                failed.append(x)
377	
378	    if &#x27;--pip-local-url&#x27; in options:
379	        for x in local_url:
380	            res = 1
381	            try:
382	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
383	            except:
384	                pass
385	
386	            if res != 0:
387	                failed.append(x)
388	
389	    print(f&quot;Installation failed for pip packages: {failed}&quot;)
390	
391	
392	def setup_environment():
393	    config = configparser.ConfigParser()
394	    config.read(config_path)
395	    if &#x27;default&#x27; in config and &#x27;git_exe&#x27; in config[&#x27;default&#x27;] and config[&#x27;default&#x27;][&#x27;git_exe&#x27;] != &#x27;&#x27;:
396	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=config[&#x27;default&#x27;][&#x27;git_exe&#x27;])
397	
398	
399	setup_environment()
400	
401	
402	try:
403	    if sys.argv[1] == &quot;--clone&quot;:
404	        gitclone(sys.argv[2], sys.argv[3])
405	    elif sys.argv[1] == &quot;--check&quot;:
406	        gitcheck(sys.argv[2], False)
407	    elif sys.argv[1] == &quot;--fetch&quot;:
408	        gitcheck(sys.argv[2], True)
409	    elif sys.argv[1] == &quot;--pull&quot;:
410	        gitpull(sys.argv[2])
411	    elif sys.argv[1] == &quot;--apply-snapshot&quot;:
412	        options = set()
413	        for x in sys.argv:
414	            if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]:
415	                options.add(x)
416	
417	        pips = apply_snapshot(sys.argv[2])
418	
419	        if pips and len(options) &gt; 0:
420	            restore_pip_snapshot(pips, options)
421	    sys.exit(0)
</pre>
</div>


</div>
</div>

<div id="issue-10">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>371<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
311	                checkout_comfyui_hash(comfyui_hash)
312	                checkout_custom_node_hash(git_custom_node_infos)
313	                invalidate_custom_node_file(file_custom_node_infos)
314	
315	                print(&quot;APPLY SNAPSHOT: True&quot;)
316	                if &#x27;pips&#x27; in info:
317	                    return info[&#x27;pips&#x27;]
318	                else:
319	                    return None
320	
321	        print(f&quot;Snapshot file not found: `{path}`&quot;)
322	        print(&quot;APPLY SNAPSHOT: False&quot;)
323	
324	        return None
325	    except Exception as e:
326	        print(e)
327	        traceback.print_exc()
328	        print(&quot;APPLY SNAPSHOT: False&quot;)
329	
330	        return None
331	
332	
333	def restore_pip_snapshot(pips, options):
334	    non_url = []
335	    local_url = []
336	    non_local_url = []
337	    for k, v in pips.items():
338	        if v == &quot;&quot;:
339	            non_url.append(v)
340	        else:
341	            if v.startswith(&#x27;file:&#x27;):
342	                local_url.append(v)
343	            else:
344	                non_local_url.append(v)
345	
346	    failed = []
347	    if &#x27;--pip-non-url&#x27; in options:
348	        # try all at once
349	        res = 1
350	        try:
351	            res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;] + non_url)
352	        except:
353	            pass
354	
355	        # fallback
356	        if res != 0:
357	            for x in non_url:
358	                res = 1
359	                try:
360	                    res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
361	                except:
362	                    pass
363	
364	                if res != 0:
365	                    failed.append(x)
366	
367	    if &#x27;--pip-non-local-url&#x27; in options:
368	        for x in non_local_url:
369	            res = 1
370	            try:
371	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
372	            except:
373	                pass
374	
375	            if res != 0:
376	                failed.append(x)
377	
378	    if &#x27;--pip-local-url&#x27; in options:
379	        for x in local_url:
380	            res = 1
381	            try:
382	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
383	            except:
384	                pass
385	
386	            if res != 0:
387	                failed.append(x)
388	
389	    print(f&quot;Installation failed for pip packages: {failed}&quot;)
390	
391	
392	def setup_environment():
393	    config = configparser.ConfigParser()
394	    config.read(config_path)
395	    if &#x27;default&#x27; in config and &#x27;git_exe&#x27; in config[&#x27;default&#x27;] and config[&#x27;default&#x27;][&#x27;git_exe&#x27;] != &#x27;&#x27;:
396	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=config[&#x27;default&#x27;][&#x27;git_exe&#x27;])
397	
398	
399	setup_environment()
400	
401	
402	try:
403	    if sys.argv[1] == &quot;--clone&quot;:
404	        gitclone(sys.argv[2], sys.argv[3])
405	    elif sys.argv[1] == &quot;--check&quot;:
406	        gitcheck(sys.argv[2], False)
407	    elif sys.argv[1] == &quot;--fetch&quot;:
408	        gitcheck(sys.argv[2], True)
409	    elif sys.argv[1] == &quot;--pull&quot;:
410	        gitpull(sys.argv[2])
411	    elif sys.argv[1] == &quot;--apply-snapshot&quot;:
412	        options = set()
413	        for x in sys.argv:
414	            if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]:
415	                options.add(x)
416	
417	        pips = apply_snapshot(sys.argv[2])
418	
419	        if pips and len(options) &gt; 0:
420	            restore_pip_snapshot(pips, options)
421	    sys.exit(0)
422	except Exception as e:
423	    print(e)
424	    sys.exit(-1)
425	    
426	    
</pre>
</div>


</div>
</div>

<div id="issue-11">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>372<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
312	                checkout_custom_node_hash(git_custom_node_infos)
313	                invalidate_custom_node_file(file_custom_node_infos)
314	
315	                print(&quot;APPLY SNAPSHOT: True&quot;)
316	                if &#x27;pips&#x27; in info:
317	                    return info[&#x27;pips&#x27;]
318	                else:
319	                    return None
320	
321	        print(f&quot;Snapshot file not found: `{path}`&quot;)
322	        print(&quot;APPLY SNAPSHOT: False&quot;)
323	
324	        return None
325	    except Exception as e:
326	        print(e)
327	        traceback.print_exc()
328	        print(&quot;APPLY SNAPSHOT: False&quot;)
329	
330	        return None
331	
332	
333	def restore_pip_snapshot(pips, options):
334	    non_url = []
335	    local_url = []
336	    non_local_url = []
337	    for k, v in pips.items():
338	        if v == &quot;&quot;:
339	            non_url.append(v)
340	        else:
341	            if v.startswith(&#x27;file:&#x27;):
342	                local_url.append(v)
343	            else:
344	                non_local_url.append(v)
345	
346	    failed = []
347	    if &#x27;--pip-non-url&#x27; in options:
348	        # try all at once
349	        res = 1
350	        try:
351	            res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;] + non_url)
352	        except:
353	            pass
354	
355	        # fallback
356	        if res != 0:
357	            for x in non_url:
358	                res = 1
359	                try:
360	                    res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
361	                except:
362	                    pass
363	
364	                if res != 0:
365	                    failed.append(x)
366	
367	    if &#x27;--pip-non-local-url&#x27; in options:
368	        for x in non_local_url:
369	            res = 1
370	            try:
371	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
372	            except:
373	                pass
374	
375	            if res != 0:
376	                failed.append(x)
377	
378	    if &#x27;--pip-local-url&#x27; in options:
379	        for x in local_url:
380	            res = 1
381	            try:
382	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
383	            except:
384	                pass
385	
386	            if res != 0:
387	                failed.append(x)
388	
389	    print(f&quot;Installation failed for pip packages: {failed}&quot;)
390	
391	
392	def setup_environment():
393	    config = configparser.ConfigParser()
394	    config.read(config_path)
395	    if &#x27;default&#x27; in config and &#x27;git_exe&#x27; in config[&#x27;default&#x27;] and config[&#x27;default&#x27;][&#x27;git_exe&#x27;] != &#x27;&#x27;:
396	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=config[&#x27;default&#x27;][&#x27;git_exe&#x27;])
397	
398	
399	setup_environment()
400	
401	
402	try:
403	    if sys.argv[1] == &quot;--clone&quot;:
404	        gitclone(sys.argv[2], sys.argv[3])
405	    elif sys.argv[1] == &quot;--check&quot;:
406	        gitcheck(sys.argv[2], False)
407	    elif sys.argv[1] == &quot;--fetch&quot;:
408	        gitcheck(sys.argv[2], True)
409	    elif sys.argv[1] == &quot;--pull&quot;:
410	        gitpull(sys.argv[2])
411	    elif sys.argv[1] == &quot;--apply-snapshot&quot;:
412	        options = set()
413	        for x in sys.argv:
414	            if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]:
415	                options.add(x)
416	
417	        pips = apply_snapshot(sys.argv[2])
418	
419	        if pips and len(options) &gt; 0:
420	            restore_pip_snapshot(pips, options)
421	    sys.exit(0)
422	except Exception as e:
423	    print(e)
424	    sys.exit(-1)
425	    
426	    
</pre>
</div>


</div>
</div>

<div id="issue-12">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>382<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
322	        print(&quot;APPLY SNAPSHOT: False&quot;)
323	
324	        return None
325	    except Exception as e:
326	        print(e)
327	        traceback.print_exc()
328	        print(&quot;APPLY SNAPSHOT: False&quot;)
329	
330	        return None
331	
332	
333	def restore_pip_snapshot(pips, options):
334	    non_url = []
335	    local_url = []
336	    non_local_url = []
337	    for k, v in pips.items():
338	        if v == &quot;&quot;:
339	            non_url.append(v)
340	        else:
341	            if v.startswith(&#x27;file:&#x27;):
342	                local_url.append(v)
343	            else:
344	                non_local_url.append(v)
345	
346	    failed = []
347	    if &#x27;--pip-non-url&#x27; in options:
348	        # try all at once
349	        res = 1
350	        try:
351	            res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;] + non_url)
352	        except:
353	            pass
354	
355	        # fallback
356	        if res != 0:
357	            for x in non_url:
358	                res = 1
359	                try:
360	                    res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
361	                except:
362	                    pass
363	
364	                if res != 0:
365	                    failed.append(x)
366	
367	    if &#x27;--pip-non-local-url&#x27; in options:
368	        for x in non_local_url:
369	            res = 1
370	            try:
371	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
372	            except:
373	                pass
374	
375	            if res != 0:
376	                failed.append(x)
377	
378	    if &#x27;--pip-local-url&#x27; in options:
379	        for x in local_url:
380	            res = 1
381	            try:
382	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
383	            except:
384	                pass
385	
386	            if res != 0:
387	                failed.append(x)
388	
389	    print(f&quot;Installation failed for pip packages: {failed}&quot;)
390	
391	
392	def setup_environment():
393	    config = configparser.ConfigParser()
394	    config.read(config_path)
395	    if &#x27;default&#x27; in config and &#x27;git_exe&#x27; in config[&#x27;default&#x27;] and config[&#x27;default&#x27;][&#x27;git_exe&#x27;] != &#x27;&#x27;:
396	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=config[&#x27;default&#x27;][&#x27;git_exe&#x27;])
397	
398	
399	setup_environment()
400	
401	
402	try:
403	    if sys.argv[1] == &quot;--clone&quot;:
404	        gitclone(sys.argv[2], sys.argv[3])
405	    elif sys.argv[1] == &quot;--check&quot;:
406	        gitcheck(sys.argv[2], False)
407	    elif sys.argv[1] == &quot;--fetch&quot;:
408	        gitcheck(sys.argv[2], True)
409	    elif sys.argv[1] == &quot;--pull&quot;:
410	        gitpull(sys.argv[2])
411	    elif sys.argv[1] == &quot;--apply-snapshot&quot;:
412	        options = set()
413	        for x in sys.argv:
414	            if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]:
415	                options.add(x)
416	
417	        pips = apply_snapshot(sys.argv[2])
418	
419	        if pips and len(options) &gt; 0:
420	            restore_pip_snapshot(pips, options)
421	    sys.exit(0)
422	except Exception as e:
423	    print(e)
424	    sys.exit(-1)
425	    
426	    
</pre>
</div>


</div>
</div>

<div id="issue-13">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/git_helper.py</a><br>
    <b>Line number: </b>383<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
323	
324	        return None
325	    except Exception as e:
326	        print(e)
327	        traceback.print_exc()
328	        print(&quot;APPLY SNAPSHOT: False&quot;)
329	
330	        return None
331	
332	
333	def restore_pip_snapshot(pips, options):
334	    non_url = []
335	    local_url = []
336	    non_local_url = []
337	    for k, v in pips.items():
338	        if v == &quot;&quot;:
339	            non_url.append(v)
340	        else:
341	            if v.startswith(&#x27;file:&#x27;):
342	                local_url.append(v)
343	            else:
344	                non_local_url.append(v)
345	
346	    failed = []
347	    if &#x27;--pip-non-url&#x27; in options:
348	        # try all at once
349	        res = 1
350	        try:
351	            res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;] + non_url)
352	        except:
353	            pass
354	
355	        # fallback
356	        if res != 0:
357	            for x in non_url:
358	                res = 1
359	                try:
360	                    res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
361	                except:
362	                    pass
363	
364	                if res != 0:
365	                    failed.append(x)
366	
367	    if &#x27;--pip-non-local-url&#x27; in options:
368	        for x in non_local_url:
369	            res = 1
370	            try:
371	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
372	            except:
373	                pass
374	
375	            if res != 0:
376	                failed.append(x)
377	
378	    if &#x27;--pip-local-url&#x27; in options:
379	        for x in local_url:
380	            res = 1
381	            try:
382	                res = subprocess.check_call([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, x])
383	            except:
384	                pass
385	
386	            if res != 0:
387	                failed.append(x)
388	
389	    print(f&quot;Installation failed for pip packages: {failed}&quot;)
390	
391	
392	def setup_environment():
393	    config = configparser.ConfigParser()
394	    config.read(config_path)
395	    if &#x27;default&#x27; in config and &#x27;git_exe&#x27; in config[&#x27;default&#x27;] and config[&#x27;default&#x27;][&#x27;git_exe&#x27;] != &#x27;&#x27;:
396	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=config[&#x27;default&#x27;][&#x27;git_exe&#x27;])
397	
398	
399	setup_environment()
400	
401	
402	try:
403	    if sys.argv[1] == &quot;--clone&quot;:
404	        gitclone(sys.argv[2], sys.argv[3])
405	    elif sys.argv[1] == &quot;--check&quot;:
406	        gitcheck(sys.argv[2], False)
407	    elif sys.argv[1] == &quot;--fetch&quot;:
408	        gitcheck(sys.argv[2], True)
409	    elif sys.argv[1] == &quot;--pull&quot;:
410	        gitpull(sys.argv[2])
411	    elif sys.argv[1] == &quot;--apply-snapshot&quot;:
412	        options = set()
413	        for x in sys.argv:
414	            if x in [&#x27;--pip-non-url&#x27;, &#x27;--pip-local-url&#x27;, &#x27;--pip-non-local-url&#x27;]:
415	                options.add(x)
416	
417	        pips = apply_snapshot(sys.argv[2])
418	
419	        if pips and len(options) &gt; 0:
420	            restore_pip_snapshot(pips, options)
421	    sys.exit(0)
422	except Exception as e:
423	    print(e)
424	    sys.exit(-1)
425	    
426	    
</pre>
</div>


</div>
</div>

<div id="issue-14">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>3<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import os
2	import sys
3	import subprocess
4	import re
5	import shutil
6	import configparser
7	import platform
8	from datetime import datetime
9	import git
10	from git.remote import RemoteProgress
11	from urllib.parse import urlparse
12	from tqdm.auto import tqdm
13	import aiohttp
14	import threading
15	import json
16	import time
17	import yaml
18	import zipfile
19	
20	glob_path = os.path.join(os.path.dirname(__file__))  # ComfyUI-Manager/glob
21	sys.path.append(glob_path)
22	
23	import cm_global
24	from manager_util import *
25	
26	version = [2, 33]
27	version_str = f&quot;V{version[0]}.{version[1]}&quot; + (f&#x27;.{version[2]}&#x27; if len(version) &gt; 2 else &#x27;&#x27;)
28	
29	comfyui_manager_path = os.path.abspath(os.path.join(os.path.dirname(__file__), &#x27;..&#x27;))
30	custom_nodes_path = os.path.abspath(os.path.join(comfyui_manager_path, &#x27;..&#x27;))
31	comfy_path = os.path.abspath(os.path.join(custom_nodes_path, &#x27;..&#x27;))
32	channel_list_path = os.path.join(comfyui_manager_path, &#x27;channels.list&#x27;)
33	config_path = os.path.join(comfyui_manager_path, &quot;config.ini&quot;)
34	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
35	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
36	cache_dir = os.path.join(comfyui_manager_path, &#x27;.cache&#x27;)
37	cached_config = None
38	js_path = None
39	
40	comfy_ui_required_revision = 1930
41	comfy_ui_required_commit_datetime = datetime(2024, 1, 24, 0, 0, 0)
42	
43	comfy_ui_revision = &quot;Unknown&quot;
44	comfy_ui_commit_datetime = datetime(1900, 1, 1, 0, 0, 0)
45	
46	
47	cache_lock = threading.Lock()
48	
49	
50	channel_dict = None
51	channel_list = None
52	pip_map = None
53	
54	
55	def remap_pip_package(pkg):
56	    if pkg in cm_global.pip_overrides:
57	        res = cm_global.pip_overrides[pkg]
58	        print(f&quot;[ComfyUI-Manager] &#x27;{pkg}&#x27; is remapped to &#x27;{res}&#x27;&quot;)
59	        return res
60	    else:
61	        return pkg
62	
63	
64	def get_installed_packages():
65	    global pip_map
66	
67	    if pip_map is None:
68	        try:
69	            result = subprocess.check_output([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;list&#x27;], universal_newlines=True)
70	
71	            pip_map = {}
72	            for line in result.split(&#x27;\n&#x27;):
73	                x = line.strip()
74	                if x:
75	                    y = line.split()
76	                    if y[0] == &#x27;Package&#x27; or y[0].startswith(&#x27;-&#x27;):
77	                        continue
78	
79	                    pip_map[y[0]] = y[1]
80	        except subprocess.CalledProcessError as e:
81	            print(f&quot;[ComfyUI-Manager] Failed to retrieve the information of installed pip packages.&quot;)
82	            return set()
83	
84	    return pip_map
85	
86	
87	def clear_pip_cache():
88	    global pip_map
89	    pip_map = None
90	
91	
92	def is_blacklisted(name):
93	    name = name.strip()
94	
95	    pattern = r&#x27;([^&lt;&gt;!=]+)([&lt;&gt;!=]=?)(.*)&#x27;
96	    match = re.search(pattern, name)
97	
98	    if match:
99	        name = match.group(1)
100	
101	    if name in cm_global.pip_downgrade_blacklist:
102	        pips = get_installed_packages()
103	
104	        if match is None:
105	            if name in pips:
106	                return True
107	        elif match.group(2) in [&#x27;&lt;=&#x27;, &#x27;==&#x27;, &#x27;&lt;&#x27;]:
108	            if name in pips:
109	                if StrictVersion(pips[name]) &gt;= StrictVersion(match.group(3)):
110	                    return True
111	
112	    return False
113	
114	
115	def is_installed(name):
116	    name = name.strip()
117	
118	    if name.startswith(&#x27;#&#x27;):
119	        return True
120	
</pre>
</div>


</div>
</div>

<div id="issue-15">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>69<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
9	import git
10	from git.remote import RemoteProgress
11	from urllib.parse import urlparse
12	from tqdm.auto import tqdm
13	import aiohttp
14	import threading
15	import json
16	import time
17	import yaml
18	import zipfile
19	
20	glob_path = os.path.join(os.path.dirname(__file__))  # ComfyUI-Manager/glob
21	sys.path.append(glob_path)
22	
23	import cm_global
24	from manager_util import *
25	
26	version = [2, 33]
27	version_str = f&quot;V{version[0]}.{version[1]}&quot; + (f&#x27;.{version[2]}&#x27; if len(version) &gt; 2 else &#x27;&#x27;)
28	
29	comfyui_manager_path = os.path.abspath(os.path.join(os.path.dirname(__file__), &#x27;..&#x27;))
30	custom_nodes_path = os.path.abspath(os.path.join(comfyui_manager_path, &#x27;..&#x27;))
31	comfy_path = os.path.abspath(os.path.join(custom_nodes_path, &#x27;..&#x27;))
32	channel_list_path = os.path.join(comfyui_manager_path, &#x27;channels.list&#x27;)
33	config_path = os.path.join(comfyui_manager_path, &quot;config.ini&quot;)
34	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
35	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
36	cache_dir = os.path.join(comfyui_manager_path, &#x27;.cache&#x27;)
37	cached_config = None
38	js_path = None
39	
40	comfy_ui_required_revision = 1930
41	comfy_ui_required_commit_datetime = datetime(2024, 1, 24, 0, 0, 0)
42	
43	comfy_ui_revision = &quot;Unknown&quot;
44	comfy_ui_commit_datetime = datetime(1900, 1, 1, 0, 0, 0)
45	
46	
47	cache_lock = threading.Lock()
48	
49	
50	channel_dict = None
51	channel_list = None
52	pip_map = None
53	
54	
55	def remap_pip_package(pkg):
56	    if pkg in cm_global.pip_overrides:
57	        res = cm_global.pip_overrides[pkg]
58	        print(f&quot;[ComfyUI-Manager] &#x27;{pkg}&#x27; is remapped to &#x27;{res}&#x27;&quot;)
59	        return res
60	    else:
61	        return pkg
62	
63	
64	def get_installed_packages():
65	    global pip_map
66	
67	    if pip_map is None:
68	        try:
69	            result = subprocess.check_output([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;list&#x27;], universal_newlines=True)
70	
71	            pip_map = {}
72	            for line in result.split(&#x27;\n&#x27;):
73	                x = line.strip()
74	                if x:
75	                    y = line.split()
76	                    if y[0] == &#x27;Package&#x27; or y[0].startswith(&#x27;-&#x27;):
77	                        continue
78	
79	                    pip_map[y[0]] = y[1]
80	        except subprocess.CalledProcessError as e:
81	            print(f&quot;[ComfyUI-Manager] Failed to retrieve the information of installed pip packages.&quot;)
82	            return set()
83	
84	    return pip_map
85	
86	
87	def clear_pip_cache():
88	    global pip_map
89	    pip_map = None
90	
91	
92	def is_blacklisted(name):
93	    name = name.strip()
94	
95	    pattern = r&#x27;([^&lt;&gt;!=]+)([&lt;&gt;!=]=?)(.*)&#x27;
96	    match = re.search(pattern, name)
97	
98	    if match:
99	        name = match.group(1)
100	
101	    if name in cm_global.pip_downgrade_blacklist:
102	        pips = get_installed_packages()
103	
104	        if match is None:
105	            if name in pips:
106	                return True
107	        elif match.group(2) in [&#x27;&lt;=&#x27;, &#x27;==&#x27;, &#x27;&lt;&#x27;]:
108	            if name in pips:
109	                if StrictVersion(pips[name]) &gt;= StrictVersion(match.group(3)):
110	                    return True
111	
112	    return False
113	
114	
115	def is_installed(name):
116	    name = name.strip()
117	
118	    if name.startswith(&#x27;#&#x27;):
119	        return True
120	
121	    pattern = r&#x27;([^&lt;&gt;!=]+)([&lt;&gt;!=]=?)(.*)&#x27;
122	    match = re.search(pattern, name)
123	
124	    if match:
125	        name = match.group(1)
126	
127	    if name in cm_global.pip_downgrade_blacklist:
128	        pips = get_installed_packages()
</pre>
</div>


</div>
</div>

<div id="issue-16">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>184<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
124	    if match:
125	        name = match.group(1)
126	
127	    if name in cm_global.pip_downgrade_blacklist:
128	        pips = get_installed_packages()
129	
130	        if match is None:
131	            if name in pips:
132	                return True
133	        elif match.group(2) in [&#x27;&lt;=&#x27;, &#x27;==&#x27;, &#x27;&lt;&#x27;]:
134	            if name in pips:
135	                if StrictVersion(pips[name]) &gt;= StrictVersion(match.group(3)):
136	                    print(f&quot;[ComfyUI-Manager] skip black listed pip installation: &#x27;{name}&#x27;&quot;)
137	                    return True
138	
139	    return name.lower() in get_installed_packages()
140	
141	
142	def get_channel_dict():
143	    global channel_dict
144	
145	    if channel_dict is None:
146	        channel_dict = {}
147	
148	        if not os.path.exists(channel_list_path):
149	            shutil.copy(channel_list_path+&#x27;.template&#x27;, channel_list_path)
150	
151	        with open(os.path.join(comfyui_manager_path, &#x27;channels.list&#x27;), &#x27;r&#x27;) as file:
152	            channels = file.read()
153	            for x in channels.split(&#x27;\n&#x27;):
154	                channel_info = x.split(&quot;::&quot;)
155	                if len(channel_info) == 2:
156	                    channel_dict[channel_info[0]] = channel_info[1]
157	
158	    return channel_dict
159	
160	
161	def get_channel_list():
162	    global channel_list
163	
164	    if channel_list is None:
165	        channel_list = []
166	        for k, v in get_channel_dict().items():
167	            channel_list.append(f&quot;{k}::{v}&quot;)
168	
169	    return channel_list
170	
171	
172	class ManagerFuncs:
173	    def __init__(self):
174	        pass
175	
176	    def get_current_preview_method(self):
177	        return &quot;none&quot;
178	
179	    def run_script(self, cmd, cwd=&#x27;.&#x27;):
180	        if len(cmd) &gt; 0 and cmd[0].startswith(&quot;#&quot;):
181	            print(f&quot;[ComfyUI-Manager] Unexpected behavior: `{cmd}`&quot;)
182	            return 0
183	
184	        subprocess.check_call(cmd, cwd=cwd)
185	
186	        return 0
187	
188	
189	manager_funcs = ManagerFuncs()
190	
191	
192	def write_config():
193	    config = configparser.ConfigParser()
194	    config[&#x27;default&#x27;] = {
195	        &#x27;preview_method&#x27;: manager_funcs.get_current_preview_method(),
196	        &#x27;badge_mode&#x27;: get_config()[&#x27;badge_mode&#x27;],
197	        &#x27;git_exe&#x27;:  get_config()[&#x27;git_exe&#x27;],
198	        &#x27;channel_url&#x27;: get_config()[&#x27;channel_url&#x27;],
199	        &#x27;share_option&#x27;: get_config()[&#x27;share_option&#x27;],
200	        &#x27;bypass_ssl&#x27;: get_config()[&#x27;bypass_ssl&#x27;],
201	        &quot;file_logging&quot;: get_config()[&#x27;file_logging&#x27;],
202	        &#x27;default_ui&#x27;: get_config()[&#x27;default_ui&#x27;],
203	        &#x27;component_policy&#x27;: get_config()[&#x27;component_policy&#x27;],
204	        &#x27;double_click_policy&#x27;: get_config()[&#x27;double_click_policy&#x27;],
205	        &#x27;windows_selector_event_loop_policy&#x27;: get_config()[&#x27;windows_selector_event_loop_policy&#x27;],
206	        &#x27;model_download_by_agent&#x27;: get_config()[&#x27;model_download_by_agent&#x27;],
207	        &#x27;downgrade_blacklist&#x27;: get_config()[&#x27;downgrade_blacklist&#x27;],
208	        &#x27;security_level&#x27;: get_config()[&#x27;security_level&#x27;],
209	    }
210	    with open(config_path, &#x27;w&#x27;) as configfile:
211	        config.write(configfile)
212	
213	
214	def read_config():
215	    try:
216	        config = configparser.ConfigParser()
217	        config.read(config_path)
218	        default_conf = config[&#x27;default&#x27;]
219	
220	        # policy migration: disable_unsecure_features -&gt; security_level
221	        if &#x27;disable_unsecure_features&#x27; in default_conf:
222	            if default_conf[&#x27;disable_unsecure_features&#x27;].lower() == &#x27;true&#x27;:
223	                security_level = &#x27;strong&#x27;
224	            else:
225	                security_level = &#x27;normal&#x27;
226	        else:
227	            security_level = default_conf[&#x27;security_level&#x27;] if &#x27;security_level&#x27; in default_conf else &#x27;normal&#x27;
228	
229	        return {
230	                    &#x27;preview_method&#x27;: default_conf[&#x27;preview_method&#x27;] if &#x27;preview_method&#x27; in default_conf else manager_funcs.get_current_preview_method(),
231	                    &#x27;badge_mode&#x27;: default_conf[&#x27;badge_mode&#x27;] if &#x27;badge_mode&#x27; in default_conf else &#x27;none&#x27;,
232	                    &#x27;git_exe&#x27;: default_conf[&#x27;git_exe&#x27;] if &#x27;git_exe&#x27; in default_conf else &#x27;&#x27;,
233	                    &#x27;channel_url&#x27;: default_conf[&#x27;channel_url&#x27;] if &#x27;channel_url&#x27; in default_conf else &#x27;https://raw.githubusercontent.com/ltdrdata/ComfyUI-Manager/main&#x27;,
234	                    &#x27;share_option&#x27;: default_conf[&#x27;share_option&#x27;] if &#x27;share_option&#x27; in default_conf else &#x27;all&#x27;,
235	                    &#x27;bypass_ssl&#x27;: default_conf[&#x27;bypass_ssl&#x27;].lower() == &#x27;true&#x27; if &#x27;bypass_ssl&#x27; in default_conf else False,
236	                    &#x27;file_logging&#x27;: default_conf[&#x27;file_logging&#x27;].lower() == &#x27;true&#x27; if &#x27;file_logging&#x27; in default_conf else True,
237	                    &#x27;default_ui&#x27;: default_conf[&#x27;default_ui&#x27;] if &#x27;default_ui&#x27; in default_conf else &#x27;none&#x27;,
238	                    &#x27;component_policy&#x27;: default_conf[&#x27;component_policy&#x27;] if &#x27;component_policy&#x27; in default_conf else &#x27;workflow&#x27;,
239	                    &#x27;double_click_policy&#x27;: default_conf[&#x27;double_click_policy&#x27;] if &#x27;double_click_policy&#x27; in default_conf else &#x27;copy-all&#x27;,
240	                    &#x27;windows_selector_event_loop_policy&#x27;: default_conf[&#x27;windows_selector_event_loop_policy&#x27;].lower() == &#x27;true&#x27; if &#x27;windows_selector_event_loop_policy&#x27; in default_conf else False,
241	                    &#x27;model_download_by_agent&#x27;: default_conf[&#x27;model_download_by_agent&#x27;].lower() == &#x27;true&#x27; if &#x27;model_download_by_agent&#x27; in default_conf else False,
242	                    &#x27;downgrade_blacklist&#x27;: default_conf[&#x27;downgrade_blacklist&#x27;] if &#x27;downgrade_blacklist&#x27; in default_conf else &#x27;&#x27;,
243	                    &#x27;security_level&#x27;: security_level
</pre>
</div>


</div>
</div>

<div id="issue-17">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>309<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
249	            &#x27;badge_mode&#x27;: &#x27;none&#x27;,
250	            &#x27;git_exe&#x27;: &#x27;&#x27;,
251	            &#x27;channel_url&#x27;: &#x27;https://raw.githubusercontent.com/ltdrdata/ComfyUI-Manager/main&#x27;,
252	            &#x27;share_option&#x27;: &#x27;all&#x27;,
253	            &#x27;bypass_ssl&#x27;: False,
254	            &#x27;file_logging&#x27;: True,
255	            &#x27;default_ui&#x27;: &#x27;none&#x27;,
256	            &#x27;component_policy&#x27;: &#x27;workflow&#x27;,
257	            &#x27;double_click_policy&#x27;: &#x27;copy-all&#x27;,
258	            &#x27;windows_selector_event_loop_policy&#x27;: False,
259	            &#x27;model_download_by_agent&#x27;: False,
260	            &#x27;downgrade_blacklist&#x27;: &#x27;&#x27;,
261	            &#x27;security_level&#x27;: &#x27;normal&#x27;,
262	        }
263	
264	
265	def get_config():
266	    global cached_config
267	
268	    if cached_config is None:
269	        cached_config = read_config()
270	
271	    return cached_config
272	
273	
274	def switch_to_default_branch(repo):
275	    show_result = repo.git.remote(&quot;show&quot;, &quot;origin&quot;)
276	    matches = re.search(r&quot;\s*HEAD branch:\s*(.*)&quot;, show_result)
277	    if matches:
278	        default_branch = matches.group(1)
279	        repo.git.checkout(default_branch)
280	
281	
282	def try_install_script(url, repo_path, install_cmd, instant_execution=False):
283	    if not instant_execution and ((len(install_cmd) &gt; 0 and install_cmd[0].startswith(&#x27;#&#x27;)) or (platform.system() == &quot;Windows&quot; and comfy_ui_commit_datetime.date() &gt;= comfy_ui_required_commit_datetime.date())):
284	        if not os.path.exists(startup_script_path):
285	            os.makedirs(startup_script_path)
286	
287	        script_path = os.path.join(startup_script_path, &quot;install-scripts.txt&quot;)
288	        with open(script_path, &quot;a&quot;) as file:
289	            obj = [repo_path] + install_cmd
290	            file.write(f&quot;{obj}\n&quot;)
291	
292	        return True
293	    else:
294	        if len(install_cmd) == 5 and install_cmd[2:4] == [&#x27;pip&#x27;, &#x27;install&#x27;]:
295	            if is_blacklisted(install_cmd[4]):
296	                print(f&quot;[ComfyUI-Manager] skip black listed pip installation: &#x27;{install_cmd[4]}&#x27;&quot;)
297	                return True
298	
299	        print(f&quot;\n## ComfyUI-Manager: EXECUTE =&gt; {install_cmd}&quot;)
300	        code = manager_funcs.run_script(install_cmd, cwd=repo_path)
301	
302	        if platform.system() != &quot;Windows&quot;:
303	            try:
304	                if comfy_ui_commit_datetime.date() &lt; comfy_ui_required_commit_datetime.date():
305	                    print(&quot;\n\n###################################################################&quot;)
306	                    print(f&quot;[WARN] ComfyUI-Manager: Your ComfyUI version ({comfy_ui_revision})[{comfy_ui_commit_datetime.date()}] is too old. Please update to the latest version.&quot;)
307	                    print(f&quot;[WARN] The extension installation feature may not work properly in the current installed ComfyUI version on Windows environment.&quot;)
308	                    print(&quot;###################################################################\n\n&quot;)
309	            except:
310	                pass
311	
312	        if code != 0:
313	            if url is None:
314	                url = os.path.dirname(repo_path)
315	            print(f&quot;install script failed: {url}&quot;)
316	            return False
317	
318	
319	# use subprocess to avoid file system lock by git (Windows)
320	def __win_check_git_update(path, do_fetch=False, do_update=False):
321	    if do_fetch:
322	        command = [sys.executable, git_script_path, &quot;--fetch&quot;, path]
323	    elif do_update:
324	        command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
325	    else:
326	        command = [sys.executable, git_script_path, &quot;--check&quot;, path]
327	
328	    process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=custom_nodes_path)
329	    output, _ = process.communicate()
330	    output = output.decode(&#x27;utf-8&#x27;).strip()
331	
332	    if &#x27;detected dubious&#x27; in output:
333	        # fix and try again
334	        safedir_path = path.replace(&#x27;\\&#x27;, &#x27;/&#x27;)
335	        try:
336	            print(f&quot;[ComfyUI-Manager] Try fixing &#x27;dubious repository&#x27; error on &#x27;{safedir_path}&#x27; repo&quot;)
337	            process = subprocess.Popen([&#x27;git&#x27;, &#x27;config&#x27;, &#x27;--global&#x27;, &#x27;--add&#x27;, &#x27;safe.directory&#x27;, safedir_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
338	            output, _ = process.communicate()
339	
340	            process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
341	            output, _ = process.communicate()
342	            output = output.decode(&#x27;utf-8&#x27;).strip()
343	        except Exception:
344	            print(f&#x27;[ComfyUI-Manager] failed to fixing&#x27;)
345	
346	        if &#x27;detected dubious&#x27; in output:
347	            print(f&#x27;\n[ComfyUI-Manager] Failed to fixing repository setup. Please execute this command on cmd: \n&#x27;
348	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;
349	                  f&#x27;git config --global --add safe.directory &quot;{safedir_path}&quot;\n&#x27;
350	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;)
351	
352	    if do_update:
353	        if &quot;CUSTOM NODE PULL: Success&quot; in output:
354	            process.wait()
355	            print(f&quot;\rUpdated: {path}&quot;)
356	            return True, True    # updated
357	        elif &quot;CUSTOM NODE PULL: None&quot; in output:
358	            process.wait()
359	            return False, True   # there is no update
360	        else:
361	            print(f&quot;\rUpdate error: {path}&quot;)
362	            process.wait()
363	            return False, False  # update failed
364	    else:
365	        if &quot;CUSTOM NODE CHECK: True&quot; in output:
366	            process.wait()
367	            return True, True
368	        elif &quot;CUSTOM NODE CHECK: False&quot; in output:
369	            process.wait()
</pre>
</div>


</div>
</div>

<div id="issue-18">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>328<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
268	    if cached_config is None:
269	        cached_config = read_config()
270	
271	    return cached_config
272	
273	
274	def switch_to_default_branch(repo):
275	    show_result = repo.git.remote(&quot;show&quot;, &quot;origin&quot;)
276	    matches = re.search(r&quot;\s*HEAD branch:\s*(.*)&quot;, show_result)
277	    if matches:
278	        default_branch = matches.group(1)
279	        repo.git.checkout(default_branch)
280	
281	
282	def try_install_script(url, repo_path, install_cmd, instant_execution=False):
283	    if not instant_execution and ((len(install_cmd) &gt; 0 and install_cmd[0].startswith(&#x27;#&#x27;)) or (platform.system() == &quot;Windows&quot; and comfy_ui_commit_datetime.date() &gt;= comfy_ui_required_commit_datetime.date())):
284	        if not os.path.exists(startup_script_path):
285	            os.makedirs(startup_script_path)
286	
287	        script_path = os.path.join(startup_script_path, &quot;install-scripts.txt&quot;)
288	        with open(script_path, &quot;a&quot;) as file:
289	            obj = [repo_path] + install_cmd
290	            file.write(f&quot;{obj}\n&quot;)
291	
292	        return True
293	    else:
294	        if len(install_cmd) == 5 and install_cmd[2:4] == [&#x27;pip&#x27;, &#x27;install&#x27;]:
295	            if is_blacklisted(install_cmd[4]):
296	                print(f&quot;[ComfyUI-Manager] skip black listed pip installation: &#x27;{install_cmd[4]}&#x27;&quot;)
297	                return True
298	
299	        print(f&quot;\n## ComfyUI-Manager: EXECUTE =&gt; {install_cmd}&quot;)
300	        code = manager_funcs.run_script(install_cmd, cwd=repo_path)
301	
302	        if platform.system() != &quot;Windows&quot;:
303	            try:
304	                if comfy_ui_commit_datetime.date() &lt; comfy_ui_required_commit_datetime.date():
305	                    print(&quot;\n\n###################################################################&quot;)
306	                    print(f&quot;[WARN] ComfyUI-Manager: Your ComfyUI version ({comfy_ui_revision})[{comfy_ui_commit_datetime.date()}] is too old. Please update to the latest version.&quot;)
307	                    print(f&quot;[WARN] The extension installation feature may not work properly in the current installed ComfyUI version on Windows environment.&quot;)
308	                    print(&quot;###################################################################\n\n&quot;)
309	            except:
310	                pass
311	
312	        if code != 0:
313	            if url is None:
314	                url = os.path.dirname(repo_path)
315	            print(f&quot;install script failed: {url}&quot;)
316	            return False
317	
318	
319	# use subprocess to avoid file system lock by git (Windows)
320	def __win_check_git_update(path, do_fetch=False, do_update=False):
321	    if do_fetch:
322	        command = [sys.executable, git_script_path, &quot;--fetch&quot;, path]
323	    elif do_update:
324	        command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
325	    else:
326	        command = [sys.executable, git_script_path, &quot;--check&quot;, path]
327	
328	    process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=custom_nodes_path)
329	    output, _ = process.communicate()
330	    output = output.decode(&#x27;utf-8&#x27;).strip()
331	
332	    if &#x27;detected dubious&#x27; in output:
333	        # fix and try again
334	        safedir_path = path.replace(&#x27;\\&#x27;, &#x27;/&#x27;)
335	        try:
336	            print(f&quot;[ComfyUI-Manager] Try fixing &#x27;dubious repository&#x27; error on &#x27;{safedir_path}&#x27; repo&quot;)
337	            process = subprocess.Popen([&#x27;git&#x27;, &#x27;config&#x27;, &#x27;--global&#x27;, &#x27;--add&#x27;, &#x27;safe.directory&#x27;, safedir_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
338	            output, _ = process.communicate()
339	
340	            process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
341	            output, _ = process.communicate()
342	            output = output.decode(&#x27;utf-8&#x27;).strip()
343	        except Exception:
344	            print(f&#x27;[ComfyUI-Manager] failed to fixing&#x27;)
345	
346	        if &#x27;detected dubious&#x27; in output:
347	            print(f&#x27;\n[ComfyUI-Manager] Failed to fixing repository setup. Please execute this command on cmd: \n&#x27;
348	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;
349	                  f&#x27;git config --global --add safe.directory &quot;{safedir_path}&quot;\n&#x27;
350	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;)
351	
352	    if do_update:
353	        if &quot;CUSTOM NODE PULL: Success&quot; in output:
354	            process.wait()
355	            print(f&quot;\rUpdated: {path}&quot;)
356	            return True, True    # updated
357	        elif &quot;CUSTOM NODE PULL: None&quot; in output:
358	            process.wait()
359	            return False, True   # there is no update
360	        else:
361	            print(f&quot;\rUpdate error: {path}&quot;)
362	            process.wait()
363	            return False, False  # update failed
364	    else:
365	        if &quot;CUSTOM NODE CHECK: True&quot; in output:
366	            process.wait()
367	            return True, True
368	        elif &quot;CUSTOM NODE CHECK: False&quot; in output:
369	            process.wait()
370	            return False, True
371	        else:
372	            print(f&quot;\rFetch error: {path}&quot;)
373	            print(f&quot;\n{output}\n&quot;)
374	            process.wait()
375	            return False, True
376	
377	
378	def __win_check_git_pull(path):
379	    command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
380	    process = subprocess.Popen(command, cwd=custom_nodes_path)
381	    process.wait()
382	
383	
384	def execute_install_script(url, repo_path, lazy_mode=False, instant_execution=False):
385	    install_script_path = os.path.join(repo_path, &quot;install.py&quot;)
386	    requirements_path = os.path.join(repo_path, &quot;requirements.txt&quot;)
387	
</pre>
</div>


</div>
</div>

<div id="issue-19">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>337<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
277	    if matches:
278	        default_branch = matches.group(1)
279	        repo.git.checkout(default_branch)
280	
281	
282	def try_install_script(url, repo_path, install_cmd, instant_execution=False):
283	    if not instant_execution and ((len(install_cmd) &gt; 0 and install_cmd[0].startswith(&#x27;#&#x27;)) or (platform.system() == &quot;Windows&quot; and comfy_ui_commit_datetime.date() &gt;= comfy_ui_required_commit_datetime.date())):
284	        if not os.path.exists(startup_script_path):
285	            os.makedirs(startup_script_path)
286	
287	        script_path = os.path.join(startup_script_path, &quot;install-scripts.txt&quot;)
288	        with open(script_path, &quot;a&quot;) as file:
289	            obj = [repo_path] + install_cmd
290	            file.write(f&quot;{obj}\n&quot;)
291	
292	        return True
293	    else:
294	        if len(install_cmd) == 5 and install_cmd[2:4] == [&#x27;pip&#x27;, &#x27;install&#x27;]:
295	            if is_blacklisted(install_cmd[4]):
296	                print(f&quot;[ComfyUI-Manager] skip black listed pip installation: &#x27;{install_cmd[4]}&#x27;&quot;)
297	                return True
298	
299	        print(f&quot;\n## ComfyUI-Manager: EXECUTE =&gt; {install_cmd}&quot;)
300	        code = manager_funcs.run_script(install_cmd, cwd=repo_path)
301	
302	        if platform.system() != &quot;Windows&quot;:
303	            try:
304	                if comfy_ui_commit_datetime.date() &lt; comfy_ui_required_commit_datetime.date():
305	                    print(&quot;\n\n###################################################################&quot;)
306	                    print(f&quot;[WARN] ComfyUI-Manager: Your ComfyUI version ({comfy_ui_revision})[{comfy_ui_commit_datetime.date()}] is too old. Please update to the latest version.&quot;)
307	                    print(f&quot;[WARN] The extension installation feature may not work properly in the current installed ComfyUI version on Windows environment.&quot;)
308	                    print(&quot;###################################################################\n\n&quot;)
309	            except:
310	                pass
311	
312	        if code != 0:
313	            if url is None:
314	                url = os.path.dirname(repo_path)
315	            print(f&quot;install script failed: {url}&quot;)
316	            return False
317	
318	
319	# use subprocess to avoid file system lock by git (Windows)
320	def __win_check_git_update(path, do_fetch=False, do_update=False):
321	    if do_fetch:
322	        command = [sys.executable, git_script_path, &quot;--fetch&quot;, path]
323	    elif do_update:
324	        command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
325	    else:
326	        command = [sys.executable, git_script_path, &quot;--check&quot;, path]
327	
328	    process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=custom_nodes_path)
329	    output, _ = process.communicate()
330	    output = output.decode(&#x27;utf-8&#x27;).strip()
331	
332	    if &#x27;detected dubious&#x27; in output:
333	        # fix and try again
334	        safedir_path = path.replace(&#x27;\\&#x27;, &#x27;/&#x27;)
335	        try:
336	            print(f&quot;[ComfyUI-Manager] Try fixing &#x27;dubious repository&#x27; error on &#x27;{safedir_path}&#x27; repo&quot;)
337	            process = subprocess.Popen([&#x27;git&#x27;, &#x27;config&#x27;, &#x27;--global&#x27;, &#x27;--add&#x27;, &#x27;safe.directory&#x27;, safedir_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
338	            output, _ = process.communicate()
339	
340	            process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
341	            output, _ = process.communicate()
342	            output = output.decode(&#x27;utf-8&#x27;).strip()
343	        except Exception:
344	            print(f&#x27;[ComfyUI-Manager] failed to fixing&#x27;)
345	
346	        if &#x27;detected dubious&#x27; in output:
347	            print(f&#x27;\n[ComfyUI-Manager] Failed to fixing repository setup. Please execute this command on cmd: \n&#x27;
348	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;
349	                  f&#x27;git config --global --add safe.directory &quot;{safedir_path}&quot;\n&#x27;
350	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;)
351	
352	    if do_update:
353	        if &quot;CUSTOM NODE PULL: Success&quot; in output:
354	            process.wait()
355	            print(f&quot;\rUpdated: {path}&quot;)
356	            return True, True    # updated
357	        elif &quot;CUSTOM NODE PULL: None&quot; in output:
358	            process.wait()
359	            return False, True   # there is no update
360	        else:
361	            print(f&quot;\rUpdate error: {path}&quot;)
362	            process.wait()
363	            return False, False  # update failed
364	    else:
365	        if &quot;CUSTOM NODE CHECK: True&quot; in output:
366	            process.wait()
367	            return True, True
368	        elif &quot;CUSTOM NODE CHECK: False&quot; in output:
369	            process.wait()
370	            return False, True
371	        else:
372	            print(f&quot;\rFetch error: {path}&quot;)
373	            print(f&quot;\n{output}\n&quot;)
374	            process.wait()
375	            return False, True
376	
377	
378	def __win_check_git_pull(path):
379	    command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
380	    process = subprocess.Popen(command, cwd=custom_nodes_path)
381	    process.wait()
382	
383	
384	def execute_install_script(url, repo_path, lazy_mode=False, instant_execution=False):
385	    install_script_path = os.path.join(repo_path, &quot;install.py&quot;)
386	    requirements_path = os.path.join(repo_path, &quot;requirements.txt&quot;)
387	
388	    if lazy_mode:
389	        install_cmd = [&quot;#LAZY-INSTALL-SCRIPT&quot;,  sys.executable]
390	        try_install_script(url, repo_path, install_cmd)
391	    else:
392	        if os.path.exists(requirements_path):
393	            print(&quot;Install: pip packages&quot;)
394	            with open(requirements_path, &quot;r&quot;) as requirements_file:
395	                for line in requirements_file:
396	                    package_name = remap_pip_package(line.strip())
</pre>
</div>


</div>
</div>

<div id="issue-20">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>337<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
277	    if matches:
278	        default_branch = matches.group(1)
279	        repo.git.checkout(default_branch)
280	
281	
282	def try_install_script(url, repo_path, install_cmd, instant_execution=False):
283	    if not instant_execution and ((len(install_cmd) &gt; 0 and install_cmd[0].startswith(&#x27;#&#x27;)) or (platform.system() == &quot;Windows&quot; and comfy_ui_commit_datetime.date() &gt;= comfy_ui_required_commit_datetime.date())):
284	        if not os.path.exists(startup_script_path):
285	            os.makedirs(startup_script_path)
286	
287	        script_path = os.path.join(startup_script_path, &quot;install-scripts.txt&quot;)
288	        with open(script_path, &quot;a&quot;) as file:
289	            obj = [repo_path] + install_cmd
290	            file.write(f&quot;{obj}\n&quot;)
291	
292	        return True
293	    else:
294	        if len(install_cmd) == 5 and install_cmd[2:4] == [&#x27;pip&#x27;, &#x27;install&#x27;]:
295	            if is_blacklisted(install_cmd[4]):
296	                print(f&quot;[ComfyUI-Manager] skip black listed pip installation: &#x27;{install_cmd[4]}&#x27;&quot;)
297	                return True
298	
299	        print(f&quot;\n## ComfyUI-Manager: EXECUTE =&gt; {install_cmd}&quot;)
300	        code = manager_funcs.run_script(install_cmd, cwd=repo_path)
301	
302	        if platform.system() != &quot;Windows&quot;:
303	            try:
304	                if comfy_ui_commit_datetime.date() &lt; comfy_ui_required_commit_datetime.date():
305	                    print(&quot;\n\n###################################################################&quot;)
306	                    print(f&quot;[WARN] ComfyUI-Manager: Your ComfyUI version ({comfy_ui_revision})[{comfy_ui_commit_datetime.date()}] is too old. Please update to the latest version.&quot;)
307	                    print(f&quot;[WARN] The extension installation feature may not work properly in the current installed ComfyUI version on Windows environment.&quot;)
308	                    print(&quot;###################################################################\n\n&quot;)
309	            except:
310	                pass
311	
312	        if code != 0:
313	            if url is None:
314	                url = os.path.dirname(repo_path)
315	            print(f&quot;install script failed: {url}&quot;)
316	            return False
317	
318	
319	# use subprocess to avoid file system lock by git (Windows)
320	def __win_check_git_update(path, do_fetch=False, do_update=False):
321	    if do_fetch:
322	        command = [sys.executable, git_script_path, &quot;--fetch&quot;, path]
323	    elif do_update:
324	        command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
325	    else:
326	        command = [sys.executable, git_script_path, &quot;--check&quot;, path]
327	
328	    process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=custom_nodes_path)
329	    output, _ = process.communicate()
330	    output = output.decode(&#x27;utf-8&#x27;).strip()
331	
332	    if &#x27;detected dubious&#x27; in output:
333	        # fix and try again
334	        safedir_path = path.replace(&#x27;\\&#x27;, &#x27;/&#x27;)
335	        try:
336	            print(f&quot;[ComfyUI-Manager] Try fixing &#x27;dubious repository&#x27; error on &#x27;{safedir_path}&#x27; repo&quot;)
337	            process = subprocess.Popen([&#x27;git&#x27;, &#x27;config&#x27;, &#x27;--global&#x27;, &#x27;--add&#x27;, &#x27;safe.directory&#x27;, safedir_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
338	            output, _ = process.communicate()
339	
340	            process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
341	            output, _ = process.communicate()
342	            output = output.decode(&#x27;utf-8&#x27;).strip()
343	        except Exception:
344	            print(f&#x27;[ComfyUI-Manager] failed to fixing&#x27;)
345	
346	        if &#x27;detected dubious&#x27; in output:
347	            print(f&#x27;\n[ComfyUI-Manager] Failed to fixing repository setup. Please execute this command on cmd: \n&#x27;
348	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;
349	                  f&#x27;git config --global --add safe.directory &quot;{safedir_path}&quot;\n&#x27;
350	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;)
351	
352	    if do_update:
353	        if &quot;CUSTOM NODE PULL: Success&quot; in output:
354	            process.wait()
355	            print(f&quot;\rUpdated: {path}&quot;)
356	            return True, True    # updated
357	        elif &quot;CUSTOM NODE PULL: None&quot; in output:
358	            process.wait()
359	            return False, True   # there is no update
360	        else:
361	            print(f&quot;\rUpdate error: {path}&quot;)
362	            process.wait()
363	            return False, False  # update failed
364	    else:
365	        if &quot;CUSTOM NODE CHECK: True&quot; in output:
366	            process.wait()
367	            return True, True
368	        elif &quot;CUSTOM NODE CHECK: False&quot; in output:
369	            process.wait()
370	            return False, True
371	        else:
372	            print(f&quot;\rFetch error: {path}&quot;)
373	            print(f&quot;\n{output}\n&quot;)
374	            process.wait()
375	            return False, True
376	
377	
378	def __win_check_git_pull(path):
379	    command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
380	    process = subprocess.Popen(command, cwd=custom_nodes_path)
381	    process.wait()
382	
383	
384	def execute_install_script(url, repo_path, lazy_mode=False, instant_execution=False):
385	    install_script_path = os.path.join(repo_path, &quot;install.py&quot;)
386	    requirements_path = os.path.join(repo_path, &quot;requirements.txt&quot;)
387	
388	    if lazy_mode:
389	        install_cmd = [&quot;#LAZY-INSTALL-SCRIPT&quot;,  sys.executable]
390	        try_install_script(url, repo_path, install_cmd)
391	    else:
392	        if os.path.exists(requirements_path):
393	            print(&quot;Install: pip packages&quot;)
394	            with open(requirements_path, &quot;r&quot;) as requirements_file:
395	                for line in requirements_file:
396	                    package_name = remap_pip_package(line.strip())
</pre>
</div>


</div>
</div>

<div id="issue-21">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>340<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
280	
281	
282	def try_install_script(url, repo_path, install_cmd, instant_execution=False):
283	    if not instant_execution and ((len(install_cmd) &gt; 0 and install_cmd[0].startswith(&#x27;#&#x27;)) or (platform.system() == &quot;Windows&quot; and comfy_ui_commit_datetime.date() &gt;= comfy_ui_required_commit_datetime.date())):
284	        if not os.path.exists(startup_script_path):
285	            os.makedirs(startup_script_path)
286	
287	        script_path = os.path.join(startup_script_path, &quot;install-scripts.txt&quot;)
288	        with open(script_path, &quot;a&quot;) as file:
289	            obj = [repo_path] + install_cmd
290	            file.write(f&quot;{obj}\n&quot;)
291	
292	        return True
293	    else:
294	        if len(install_cmd) == 5 and install_cmd[2:4] == [&#x27;pip&#x27;, &#x27;install&#x27;]:
295	            if is_blacklisted(install_cmd[4]):
296	                print(f&quot;[ComfyUI-Manager] skip black listed pip installation: &#x27;{install_cmd[4]}&#x27;&quot;)
297	                return True
298	
299	        print(f&quot;\n## ComfyUI-Manager: EXECUTE =&gt; {install_cmd}&quot;)
300	        code = manager_funcs.run_script(install_cmd, cwd=repo_path)
301	
302	        if platform.system() != &quot;Windows&quot;:
303	            try:
304	                if comfy_ui_commit_datetime.date() &lt; comfy_ui_required_commit_datetime.date():
305	                    print(&quot;\n\n###################################################################&quot;)
306	                    print(f&quot;[WARN] ComfyUI-Manager: Your ComfyUI version ({comfy_ui_revision})[{comfy_ui_commit_datetime.date()}] is too old. Please update to the latest version.&quot;)
307	                    print(f&quot;[WARN] The extension installation feature may not work properly in the current installed ComfyUI version on Windows environment.&quot;)
308	                    print(&quot;###################################################################\n\n&quot;)
309	            except:
310	                pass
311	
312	        if code != 0:
313	            if url is None:
314	                url = os.path.dirname(repo_path)
315	            print(f&quot;install script failed: {url}&quot;)
316	            return False
317	
318	
319	# use subprocess to avoid file system lock by git (Windows)
320	def __win_check_git_update(path, do_fetch=False, do_update=False):
321	    if do_fetch:
322	        command = [sys.executable, git_script_path, &quot;--fetch&quot;, path]
323	    elif do_update:
324	        command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
325	    else:
326	        command = [sys.executable, git_script_path, &quot;--check&quot;, path]
327	
328	    process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=custom_nodes_path)
329	    output, _ = process.communicate()
330	    output = output.decode(&#x27;utf-8&#x27;).strip()
331	
332	    if &#x27;detected dubious&#x27; in output:
333	        # fix and try again
334	        safedir_path = path.replace(&#x27;\\&#x27;, &#x27;/&#x27;)
335	        try:
336	            print(f&quot;[ComfyUI-Manager] Try fixing &#x27;dubious repository&#x27; error on &#x27;{safedir_path}&#x27; repo&quot;)
337	            process = subprocess.Popen([&#x27;git&#x27;, &#x27;config&#x27;, &#x27;--global&#x27;, &#x27;--add&#x27;, &#x27;safe.directory&#x27;, safedir_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
338	            output, _ = process.communicate()
339	
340	            process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
341	            output, _ = process.communicate()
342	            output = output.decode(&#x27;utf-8&#x27;).strip()
343	        except Exception:
344	            print(f&#x27;[ComfyUI-Manager] failed to fixing&#x27;)
345	
346	        if &#x27;detected dubious&#x27; in output:
347	            print(f&#x27;\n[ComfyUI-Manager] Failed to fixing repository setup. Please execute this command on cmd: \n&#x27;
348	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;
349	                  f&#x27;git config --global --add safe.directory &quot;{safedir_path}&quot;\n&#x27;
350	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;)
351	
352	    if do_update:
353	        if &quot;CUSTOM NODE PULL: Success&quot; in output:
354	            process.wait()
355	            print(f&quot;\rUpdated: {path}&quot;)
356	            return True, True    # updated
357	        elif &quot;CUSTOM NODE PULL: None&quot; in output:
358	            process.wait()
359	            return False, True   # there is no update
360	        else:
361	            print(f&quot;\rUpdate error: {path}&quot;)
362	            process.wait()
363	            return False, False  # update failed
364	    else:
365	        if &quot;CUSTOM NODE CHECK: True&quot; in output:
366	            process.wait()
367	            return True, True
368	        elif &quot;CUSTOM NODE CHECK: False&quot; in output:
369	            process.wait()
370	            return False, True
371	        else:
372	            print(f&quot;\rFetch error: {path}&quot;)
373	            print(f&quot;\n{output}\n&quot;)
374	            process.wait()
375	            return False, True
376	
377	
378	def __win_check_git_pull(path):
379	    command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
380	    process = subprocess.Popen(command, cwd=custom_nodes_path)
381	    process.wait()
382	
383	
384	def execute_install_script(url, repo_path, lazy_mode=False, instant_execution=False):
385	    install_script_path = os.path.join(repo_path, &quot;install.py&quot;)
386	    requirements_path = os.path.join(repo_path, &quot;requirements.txt&quot;)
387	
388	    if lazy_mode:
389	        install_cmd = [&quot;#LAZY-INSTALL-SCRIPT&quot;,  sys.executable]
390	        try_install_script(url, repo_path, install_cmd)
391	    else:
392	        if os.path.exists(requirements_path):
393	            print(&quot;Install: pip packages&quot;)
394	            with open(requirements_path, &quot;r&quot;) as requirements_file:
395	                for line in requirements_file:
396	                    package_name = remap_pip_package(line.strip())
397	                    if package_name and not package_name.startswith(&#x27;#&#x27;):
398	                        install_cmd = [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package_name]
399	                        if package_name.strip() != &quot;&quot;:
</pre>
</div>


</div>
</div>

<div id="issue-22">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>380<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
320	def __win_check_git_update(path, do_fetch=False, do_update=False):
321	    if do_fetch:
322	        command = [sys.executable, git_script_path, &quot;--fetch&quot;, path]
323	    elif do_update:
324	        command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
325	    else:
326	        command = [sys.executable, git_script_path, &quot;--check&quot;, path]
327	
328	    process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=custom_nodes_path)
329	    output, _ = process.communicate()
330	    output = output.decode(&#x27;utf-8&#x27;).strip()
331	
332	    if &#x27;detected dubious&#x27; in output:
333	        # fix and try again
334	        safedir_path = path.replace(&#x27;\\&#x27;, &#x27;/&#x27;)
335	        try:
336	            print(f&quot;[ComfyUI-Manager] Try fixing &#x27;dubious repository&#x27; error on &#x27;{safedir_path}&#x27; repo&quot;)
337	            process = subprocess.Popen([&#x27;git&#x27;, &#x27;config&#x27;, &#x27;--global&#x27;, &#x27;--add&#x27;, &#x27;safe.directory&#x27;, safedir_path], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
338	            output, _ = process.communicate()
339	
340	            process = subprocess.Popen(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
341	            output, _ = process.communicate()
342	            output = output.decode(&#x27;utf-8&#x27;).strip()
343	        except Exception:
344	            print(f&#x27;[ComfyUI-Manager] failed to fixing&#x27;)
345	
346	        if &#x27;detected dubious&#x27; in output:
347	            print(f&#x27;\n[ComfyUI-Manager] Failed to fixing repository setup. Please execute this command on cmd: \n&#x27;
348	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;
349	                  f&#x27;git config --global --add safe.directory &quot;{safedir_path}&quot;\n&#x27;
350	                  f&#x27;-----------------------------------------------------------------------------------------\n&#x27;)
351	
352	    if do_update:
353	        if &quot;CUSTOM NODE PULL: Success&quot; in output:
354	            process.wait()
355	            print(f&quot;\rUpdated: {path}&quot;)
356	            return True, True    # updated
357	        elif &quot;CUSTOM NODE PULL: None&quot; in output:
358	            process.wait()
359	            return False, True   # there is no update
360	        else:
361	            print(f&quot;\rUpdate error: {path}&quot;)
362	            process.wait()
363	            return False, False  # update failed
364	    else:
365	        if &quot;CUSTOM NODE CHECK: True&quot; in output:
366	            process.wait()
367	            return True, True
368	        elif &quot;CUSTOM NODE CHECK: False&quot; in output:
369	            process.wait()
370	            return False, True
371	        else:
372	            print(f&quot;\rFetch error: {path}&quot;)
373	            print(f&quot;\n{output}\n&quot;)
374	            process.wait()
375	            return False, True
376	
377	
378	def __win_check_git_pull(path):
379	    command = [sys.executable, git_script_path, &quot;--pull&quot;, path]
380	    process = subprocess.Popen(command, cwd=custom_nodes_path)
381	    process.wait()
382	
383	
384	def execute_install_script(url, repo_path, lazy_mode=False, instant_execution=False):
385	    install_script_path = os.path.join(repo_path, &quot;install.py&quot;)
386	    requirements_path = os.path.join(repo_path, &quot;requirements.txt&quot;)
387	
388	    if lazy_mode:
389	        install_cmd = [&quot;#LAZY-INSTALL-SCRIPT&quot;,  sys.executable]
390	        try_install_script(url, repo_path, install_cmd)
391	    else:
392	        if os.path.exists(requirements_path):
393	            print(&quot;Install: pip packages&quot;)
394	            with open(requirements_path, &quot;r&quot;) as requirements_file:
395	                for line in requirements_file:
396	                    package_name = remap_pip_package(line.strip())
397	                    if package_name and not package_name.startswith(&#x27;#&#x27;):
398	                        install_cmd = [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package_name]
399	                        if package_name.strip() != &quot;&quot;:
400	                            try_install_script(url, repo_path, install_cmd, instant_execution=instant_execution)
401	
402	        if os.path.exists(install_script_path):
403	            print(f&quot;Install: install script&quot;)
404	            install_cmd = [sys.executable, &quot;install.py&quot;]
405	            try_install_script(url, repo_path, install_cmd, instant_execution=instant_execution)
406	
407	    return True
408	
409	
410	def git_repo_has_updates(path, do_fetch=False, do_update=False):
411	    if do_fetch:
412	        print(f&quot;\x1b[2K\rFetching: {path}&quot;, end=&#x27;&#x27;)
413	    elif do_update:
414	        print(f&quot;\x1b[2K\rUpdating: {path}&quot;, end=&#x27;&#x27;)
415	
416	    # Check if the path is a git repository
417	    if not os.path.exists(os.path.join(path, &#x27;.git&#x27;)):
418	        raise ValueError(&#x27;Not a git repository&#x27;)
419	
420	    if platform.system() == &quot;Windows&quot;:
421	        updated, success = __win_check_git_update(path, do_fetch, do_update)
422	        if updated and success:
423	            execute_install_script(None, path, lazy_mode=True)
424	        return updated, success
425	    else:
426	        # Fetch the latest commits from the remote repository
427	        repo = git.Repo(path)
428	
429	        current_branch = repo.active_branch
430	        branch_name = current_branch.name
431	
432	        remote_name = &#x27;origin&#x27;
433	        remote = repo.remote(name=remote_name)
434	
435	        # Get the current commit hash
436	        commit_hash = repo.head.commit.hexsha
437	
438	        if do_fetch or do_update:
439	            remote.fetch()
</pre>
</div>


</div>
</div>

<div id="issue-23">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>856<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
796	
797	def gitclone_update(files, instant_execution=False, skip_script=False, msg_prefix=&quot;&quot;):
798	    import os
799	
800	    print(f&quot;{msg_prefix}Update: {files}&quot;)
801	    for url in files:
802	        if url.endswith(&quot;/&quot;):
803	            url = url[:-1]
804	        try:
805	            repo_name = os.path.splitext(os.path.basename(url))[0].replace(&quot;.git&quot;, &quot;&quot;)
806	            repo_path = os.path.join(custom_nodes_path, repo_name)
807	
808	            if os.path.exists(repo_path+&#x27;.disabled&#x27;):
809	                repo_path = repo_path+&#x27;.disabled&#x27;
810	
811	            git_pull(repo_path)
812	
813	            if not skip_script:
814	                if instant_execution:
815	                    if not execute_install_script(url, repo_path, lazy_mode=False, instant_execution=True):
816	                        return False
817	                else:
818	                    if not execute_install_script(url, repo_path, lazy_mode=True):
819	                        return False
820	
821	        except Exception as e:
822	            print(f&quot;Update(git-clone) error: {url} / {e}&quot;, file=sys.stderr)
823	            return False
824	
825	    if not skip_script:
826	        print(&quot;Update was successful.&quot;)
827	    return True
828	
829	
830	def update_path(repo_path, instant_execution=False):
831	    if not os.path.exists(os.path.join(repo_path, &#x27;.git&#x27;)):
832	        return &quot;fail&quot;
833	
834	    # version check
835	    repo = git.Repo(repo_path)
836	
837	    if repo.head.is_detached:
838	        switch_to_default_branch(repo)
839	
840	    current_branch = repo.active_branch
841	    branch_name = current_branch.name
842	
843	    if current_branch.tracking_branch() is None:
844	        print(f&quot;[ComfyUI-Manager] There is no tracking branch ({current_branch})&quot;)
845	        remote_name = &#x27;origin&#x27;
846	    else:
847	        remote_name = current_branch.tracking_branch().remote_name
848	    remote = repo.remote(name=remote_name)
849	
850	    try:
851	        remote.fetch()
852	    except Exception as e:
853	        if &#x27;detected dubious&#x27; in str(e):
854	            print(f&quot;[ComfyUI-Manager] Try fixing &#x27;dubious repository&#x27; error on &#x27;ComfyUI&#x27; repository&quot;)
855	            safedir_path = comfy_path.replace(&#x27;\\&#x27;, &#x27;/&#x27;)
856	            subprocess.run([&#x27;git&#x27;, &#x27;config&#x27;, &#x27;--global&#x27;, &#x27;--add&#x27;, &#x27;safe.directory&#x27;, safedir_path])
857	            try:
858	                remote.fetch()
859	            except Exception:
860	                print(f&quot;\n[ComfyUI-Manager] Failed to fixing repository setup. Please execute this command on cmd: \n&quot;
861	                      f&quot;-----------------------------------------------------------------------------------------\n&quot;
862	                      f&#x27;git config --global --add safe.directory &quot;{safedir_path}&quot;\n&#x27;
863	                      f&quot;-----------------------------------------------------------------------------------------\n&quot;)
864	
865	    commit_hash = repo.head.commit.hexsha
866	    remote_commit_hash = repo.refs[f&#x27;{remote_name}/{branch_name}&#x27;].object.hexsha
867	
868	    if commit_hash != remote_commit_hash:
869	        git_pull(repo_path)
870	        execute_install_script(&quot;ComfyUI&quot;, repo_path, instant_execution=instant_execution)
871	        return &quot;updated&quot;
872	    else:
873	        return &quot;skipped&quot;
874	
875	
876	def lookup_customnode_by_url(data, target):
877	    for x in data[&#x27;custom_nodes&#x27;]:
878	        if target in x[&#x27;files&#x27;]:
879	            dir_name = os.path.splitext(os.path.basename(target))[0].replace(&quot;.git&quot;, &quot;&quot;)
880	            dir_path = os.path.join(custom_nodes_path, dir_name)
881	            if os.path.exists(dir_path):
882	                x[&#x27;installed&#x27;] = &#x27;True&#x27;
883	            elif os.path.exists(dir_path + &quot;.disabled&quot;):
884	                x[&#x27;installed&#x27;] = &#x27;Disabled&#x27;
885	            return x
886	
887	    return None
888	
889	
890	def simple_check_custom_node(url):
891	    dir_name = os.path.splitext(os.path.basename(url))[0].replace(&quot;.git&quot;, &quot;&quot;)
892	    dir_path = os.path.join(custom_nodes_path, dir_name)
893	    if os.path.exists(dir_path):
894	        return &#x27;installed&#x27;
895	    elif os.path.exists(dir_path+&#x27;.disabled&#x27;):
896	        return &#x27;disabled&#x27;
897	
898	    return &#x27;not-installed&#x27;
899	
900	
901	def check_a_custom_node_installed(item, do_fetch=False, do_update_check=True, do_update=False):
902	    item[&#x27;installed&#x27;] = &#x27;None&#x27;
903	
904	    if item[&#x27;install_type&#x27;] == &#x27;git-clone&#x27; and len(item[&#x27;files&#x27;]) == 1:
905	        url = item[&#x27;files&#x27;][0]
906	
907	        if url.endswith(&quot;/&quot;):
908	            url = url[:-1]
909	
910	        dir_name = os.path.splitext(os.path.basename(url))[0].replace(&quot;.git&quot;, &quot;&quot;)
911	        dir_path = os.path.join(custom_nodes_path, dir_name)
912	        if os.path.exists(dir_path):
913	            try:
914	                item[&#x27;installed&#x27;] = &#x27;True&#x27;  # default
915	
</pre>
</div>


</div>
</div>

<div id="issue-24">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>856<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
796	
797	def gitclone_update(files, instant_execution=False, skip_script=False, msg_prefix=&quot;&quot;):
798	    import os
799	
800	    print(f&quot;{msg_prefix}Update: {files}&quot;)
801	    for url in files:
802	        if url.endswith(&quot;/&quot;):
803	            url = url[:-1]
804	        try:
805	            repo_name = os.path.splitext(os.path.basename(url))[0].replace(&quot;.git&quot;, &quot;&quot;)
806	            repo_path = os.path.join(custom_nodes_path, repo_name)
807	
808	            if os.path.exists(repo_path+&#x27;.disabled&#x27;):
809	                repo_path = repo_path+&#x27;.disabled&#x27;
810	
811	            git_pull(repo_path)
812	
813	            if not skip_script:
814	                if instant_execution:
815	                    if not execute_install_script(url, repo_path, lazy_mode=False, instant_execution=True):
816	                        return False
817	                else:
818	                    if not execute_install_script(url, repo_path, lazy_mode=True):
819	                        return False
820	
821	        except Exception as e:
822	            print(f&quot;Update(git-clone) error: {url} / {e}&quot;, file=sys.stderr)
823	            return False
824	
825	    if not skip_script:
826	        print(&quot;Update was successful.&quot;)
827	    return True
828	
829	
830	def update_path(repo_path, instant_execution=False):
831	    if not os.path.exists(os.path.join(repo_path, &#x27;.git&#x27;)):
832	        return &quot;fail&quot;
833	
834	    # version check
835	    repo = git.Repo(repo_path)
836	
837	    if repo.head.is_detached:
838	        switch_to_default_branch(repo)
839	
840	    current_branch = repo.active_branch
841	    branch_name = current_branch.name
842	
843	    if current_branch.tracking_branch() is None:
844	        print(f&quot;[ComfyUI-Manager] There is no tracking branch ({current_branch})&quot;)
845	        remote_name = &#x27;origin&#x27;
846	    else:
847	        remote_name = current_branch.tracking_branch().remote_name
848	    remote = repo.remote(name=remote_name)
849	
850	    try:
851	        remote.fetch()
852	    except Exception as e:
853	        if &#x27;detected dubious&#x27; in str(e):
854	            print(f&quot;[ComfyUI-Manager] Try fixing &#x27;dubious repository&#x27; error on &#x27;ComfyUI&#x27; repository&quot;)
855	            safedir_path = comfy_path.replace(&#x27;\\&#x27;, &#x27;/&#x27;)
856	            subprocess.run([&#x27;git&#x27;, &#x27;config&#x27;, &#x27;--global&#x27;, &#x27;--add&#x27;, &#x27;safe.directory&#x27;, safedir_path])
857	            try:
858	                remote.fetch()
859	            except Exception:
860	                print(f&quot;\n[ComfyUI-Manager] Failed to fixing repository setup. Please execute this command on cmd: \n&quot;
861	                      f&quot;-----------------------------------------------------------------------------------------\n&quot;
862	                      f&#x27;git config --global --add safe.directory &quot;{safedir_path}&quot;\n&#x27;
863	                      f&quot;-----------------------------------------------------------------------------------------\n&quot;)
864	
865	    commit_hash = repo.head.commit.hexsha
866	    remote_commit_hash = repo.refs[f&#x27;{remote_name}/{branch_name}&#x27;].object.hexsha
867	
868	    if commit_hash != remote_commit_hash:
869	        git_pull(repo_path)
870	        execute_install_script(&quot;ComfyUI&quot;, repo_path, instant_execution=instant_execution)
871	        return &quot;updated&quot;
872	    else:
873	        return &quot;skipped&quot;
874	
875	
876	def lookup_customnode_by_url(data, target):
877	    for x in data[&#x27;custom_nodes&#x27;]:
878	        if target in x[&#x27;files&#x27;]:
879	            dir_name = os.path.splitext(os.path.basename(target))[0].replace(&quot;.git&quot;, &quot;&quot;)
880	            dir_path = os.path.join(custom_nodes_path, dir_name)
881	            if os.path.exists(dir_path):
882	                x[&#x27;installed&#x27;] = &#x27;True&#x27;
883	            elif os.path.exists(dir_path + &quot;.disabled&quot;):
884	                x[&#x27;installed&#x27;] = &#x27;Disabled&#x27;
885	            return x
886	
887	    return None
888	
889	
890	def simple_check_custom_node(url):
891	    dir_name = os.path.splitext(os.path.basename(url))[0].replace(&quot;.git&quot;, &quot;&quot;)
892	    dir_path = os.path.join(custom_nodes_path, dir_name)
893	    if os.path.exists(dir_path):
894	        return &#x27;installed&#x27;
895	    elif os.path.exists(dir_path+&#x27;.disabled&#x27;):
896	        return &#x27;disabled&#x27;
897	
898	    return &#x27;not-installed&#x27;
899	
900	
901	def check_a_custom_node_installed(item, do_fetch=False, do_update_check=True, do_update=False):
902	    item[&#x27;installed&#x27;] = &#x27;None&#x27;
903	
904	    if item[&#x27;install_type&#x27;] == &#x27;git-clone&#x27; and len(item[&#x27;files&#x27;]) == 1:
905	        url = item[&#x27;files&#x27;][0]
906	
907	        if url.endswith(&quot;/&quot;):
908	            url = url[:-1]
909	
910	        dir_name = os.path.splitext(os.path.basename(url))[0].replace(&quot;.git&quot;, &quot;&quot;)
911	        dir_path = os.path.join(custom_nodes_path, dir_name)
912	        if os.path.exists(dir_path):
913	            try:
914	                item[&#x27;installed&#x27;] = &#x27;True&#x27;  # default
915	
</pre>
</div>


</div>
</div>

<div id="issue-25">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_core.py</a><br>
    <b>Line number: </b>961<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
901	def check_a_custom_node_installed(item, do_fetch=False, do_update_check=True, do_update=False):
902	    item[&#x27;installed&#x27;] = &#x27;None&#x27;
903	
904	    if item[&#x27;install_type&#x27;] == &#x27;git-clone&#x27; and len(item[&#x27;files&#x27;]) == 1:
905	        url = item[&#x27;files&#x27;][0]
906	
907	        if url.endswith(&quot;/&quot;):
908	            url = url[:-1]
909	
910	        dir_name = os.path.splitext(os.path.basename(url))[0].replace(&quot;.git&quot;, &quot;&quot;)
911	        dir_path = os.path.join(custom_nodes_path, dir_name)
912	        if os.path.exists(dir_path):
913	            try:
914	                item[&#x27;installed&#x27;] = &#x27;True&#x27;  # default
915	
916	                if cm_global.try_call(api=&quot;cm.is_import_failed_extension&quot;, name=dir_name):
917	                    item[&#x27;installed&#x27;] = &#x27;Fail&#x27;
918	
919	                if do_update_check:
920	                    update_state, success = git_repo_has_updates(dir_path, do_fetch, do_update)
921	                    if (do_update_check or do_update) and update_state:
922	                        item[&#x27;installed&#x27;] = &#x27;Update&#x27;
923	                    elif do_update and not success:
924	                        item[&#x27;installed&#x27;] = &#x27;Fail&#x27;
925	            except:
926	                if cm_global.try_call(api=&quot;cm.is_import_failed_extension&quot;, name=dir_name):
927	                    item[&#x27;installed&#x27;] = &#x27;Fail&#x27;
928	                else:
929	                    item[&#x27;installed&#x27;] = &#x27;True&#x27;
930	
931	        elif os.path.exists(dir_path + &quot;.disabled&quot;):
932	            item[&#x27;installed&#x27;] = &#x27;Disabled&#x27;
933	
934	        else:
935	            item[&#x27;installed&#x27;] = &#x27;False&#x27;
936	
937	    elif item[&#x27;install_type&#x27;] == &#x27;copy&#x27; and len(item[&#x27;files&#x27;]) == 1:
938	        dir_name = os.path.basename(item[&#x27;files&#x27;][0])
939	
940	        if item[&#x27;files&#x27;][0].endswith(&#x27;.py&#x27;):
941	            base_path = custom_nodes_path
942	        elif &#x27;js_path&#x27; in item:
943	            base_path = os.path.join(js_path, item[&#x27;js_path&#x27;])
944	        else:
945	            base_path = js_path
946	
947	        file_path = os.path.join(base_path, dir_name)
948	        if os.path.exists(file_path):
949	            if cm_global.try_call(api=&quot;cm.is_import_failed_extension&quot;, name=dir_name):
950	                item[&#x27;installed&#x27;] = &#x27;Fail&#x27;
951	            else:
952	                item[&#x27;installed&#x27;] = &#x27;True&#x27;
953	        elif os.path.exists(file_path + &quot;.disabled&quot;):
954	            item[&#x27;installed&#x27;] = &#x27;Disabled&#x27;
955	        else:
956	            item[&#x27;installed&#x27;] = &#x27;False&#x27;
957	
958	
959	def get_installed_pip_packages():
960	    # extract pip package infos
961	    pips = subprocess.check_output([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;freeze&#x27;], text=True).split(&#x27;\n&#x27;)
962	
963	    res = {}
964	    for x in pips:
965	        if x.strip() == &quot;&quot;:
966	            continue
967	
968	        if &#x27; @ &#x27; in x:
969	            spec_url = x.split(&#x27; @ &#x27;)
970	            res[spec_url[0]] = spec_url[1]
971	        else:
972	            res[x] = &quot;&quot;
973	
974	    return res
975	
976	
977	def get_current_snapshot():
978	    # Get ComfyUI hash
979	    repo_path = comfy_path
980	
981	    print(f&quot;comfy_path: {comfy_path}&quot;)
982	    if not os.path.exists(os.path.join(repo_path, &#x27;.git&#x27;)):
983	        print(f&quot;ComfyUI update fail: The installed ComfyUI does not have a Git repository.&quot;)
984	        return {}
985	
986	    repo = git.Repo(repo_path)
987	    comfyui_commit_hash = repo.head.commit.hexsha
988	
989	    git_custom_nodes = {}
990	    file_custom_nodes = []
991	
992	    # Get custom nodes hash
993	    for path in os.listdir(custom_nodes_path):
994	        fullpath = os.path.join(custom_nodes_path, path)
995	
996	        if os.path.isdir(fullpath):
997	            is_disabled = path.endswith(&quot;.disabled&quot;)
998	
999	            try:
1000	                git_dir = os.path.join(fullpath, &#x27;.git&#x27;)
1001	
1002	                if not os.path.exists(git_dir):
1003	                    continue
1004	
1005	                repo = git.Repo(fullpath)
1006	                commit_hash = repo.head.commit.hexsha
1007	                url = repo.remotes.origin.url
1008	                git_custom_nodes[url] = {
1009	                    &#x27;hash&#x27;: commit_hash,
1010	                    &#x27;disabled&#x27;: is_disabled
1011	                }
1012	
1013	            except:
1014	                print(f&quot;Failed to extract snapshots for the custom node &#x27;{path}&#x27;.&quot;)
1015	
1016	        elif path.endswith(&#x27;.py&#x27;):
1017	            is_disabled = path.endswith(&quot;.py.disabled&quot;)
1018	            filename = os.path.basename(path)
1019	            item = {
1020	                &#x27;filename&#x27;: filename,
</pre>
</div>


</div>
</div>

<div id="issue-26">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>6<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import mimetypes
2	import traceback
3	
4	import folder_paths
5	import locale
6	import subprocess  # don&#x27;t remove this
7	import concurrent
8	import nodes
9	import hashlib
10	import os
11	import sys
12	import threading
13	import re
14	import shutil
15	import git
16	
17	from server import PromptServer
18	import manager_core as core
19	import cm_global
20	
21	print(f&quot;### Loading: ComfyUI-Manager ({core.version_str})&quot;)
22	
23	comfy_ui_hash = &quot;-&quot;
24	
25	
26	def handle_stream(stream, prefix):
27	    stream.reconfigure(encoding=locale.getpreferredencoding(), errors=&#x27;replace&#x27;)
28	    for msg in stream:
29	        if prefix == &#x27;[!]&#x27; and (&#x27;it/s]&#x27; in msg or &#x27;s/it]&#x27; in msg) and (&#x27;%|&#x27; in msg or &#x27;it [&#x27; in msg):
30	            if msg.startswith(&#x27;100%&#x27;):
31	                print(&#x27;\r&#x27; + msg, end=&quot;&quot;, file=sys.stderr),
32	            else:
33	                print(&#x27;\r&#x27; + msg[:-1], end=&quot;&quot;, file=sys.stderr),
34	        else:
35	            if prefix == &#x27;[!]&#x27;:
36	                print(prefix, msg, end=&quot;&quot;, file=sys.stderr)
37	            else:
38	                print(prefix, msg, end=&quot;&quot;)
39	
40	
41	from comfy.cli_args import args
42	import latent_preview
43	
44	
45	is_local_mode = args.listen.startswith(&#x27;127.&#x27;)
46	
47	
48	def is_allowed_security_level(level):
49	    if level == &#x27;high&#x27;:
50	        if is_local_mode:
51	            return core.get_config()[&#x27;security_level&#x27;].lower() in [&#x27;weak&#x27;, &#x27;normal&#x27;]
52	        else:
53	            return core.get_config()[&#x27;security_level&#x27;].lower() == &#x27;weak&#x27;
54	    elif level == &#x27;middle&#x27;:
55	        return core.get_config()[&#x27;security_level&#x27;].lower() in [&#x27;weak&#x27;, &#x27;normal&#x27;]
56	    else:
57	        return True
58	
59	
60	async def get_risky_level(files):
61	    json_data1 = await core.get_data_by_mode(&#x27;local&#x27;, &#x27;custom-node-list.json&#x27;)
62	    json_data2 = await core.get_data_by_mode(&#x27;cache&#x27;, &#x27;custom-node-list.json&#x27;, channel_url=&#x27;https://github.com/ltdrdata/ComfyUI-Manager/raw/main/custom-node-list.json&#x27;)
63	
64	    all_urls = set()
65	    for x in json_data1[&#x27;custom_nodes&#x27;] + json_data2[&#x27;custom_nodes&#x27;]:
66	        all_urls.update(x[&#x27;files&#x27;])
67	
68	    for x in files:
69	        if x not in all_urls:
70	            return &quot;high&quot;
71	
72	    return &quot;middle&quot;
73	
74	
75	class ManagerFuncsInComfyUI(core.ManagerFuncs):
76	    def get_current_preview_method(self):
77	        if args.preview_method == latent_preview.LatentPreviewMethod.Auto:
78	            return &quot;auto&quot;
79	        elif args.preview_method == latent_preview.LatentPreviewMethod.Latent2RGB:
80	            return &quot;latent2rgb&quot;
81	        elif args.preview_method == latent_preview.LatentPreviewMethod.TAESD:
82	            return &quot;taesd&quot;
83	        else:
84	            return &quot;none&quot;
85	
86	    def run_script(self, cmd, cwd=&#x27;.&#x27;):
87	        if len(cmd) &gt; 0 and cmd[0].startswith(&quot;#&quot;):
88	            print(f&quot;[ComfyUI-Manager] Unexpected behavior: `{cmd}`&quot;)
89	            return 0
90	
91	        process = subprocess.Popen(cmd, cwd=cwd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True, bufsize=1)
92	
93	        stdout_thread = threading.Thread(target=handle_stream, args=(process.stdout, &quot;&quot;))
94	        stderr_thread = threading.Thread(target=handle_stream, args=(process.stderr, &quot;[!]&quot;))
95	
96	        stdout_thread.start()
97	        stderr_thread.start()
98	
99	        stdout_thread.join()
100	        stderr_thread.join()
101	
102	        return process.wait()
103	
104	
105	core.manager_funcs = ManagerFuncsInComfyUI()
106	
107	sys.path.append(&#x27;../..&#x27;)
108	
109	from torchvision.datasets.utils import download_url
110	
111	core.comfy_path = os.path.dirname(folder_paths.__file__)
112	core.js_path = os.path.join(core.comfy_path, &quot;web&quot;, &quot;extensions&quot;)
113	
114	local_db_model = os.path.join(core.comfyui_manager_path, &quot;model-list.json&quot;)
115	local_db_alter = os.path.join(core.comfyui_manager_path, &quot;alter-list.json&quot;)
116	local_db_custom_node_list = os.path.join(core.comfyui_manager_path, &quot;custom-node-list.json&quot;)
117	local_db_extension_node_mappings = os.path.join(core.comfyui_manager_path, &quot;extension-node-map.json&quot;)
118	components_path = os.path.join(core.comfyui_manager_path, &#x27;components&#x27;)
119	
120	
</pre>
</div>


</div>
</div>

<div id="issue-27">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>91<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
31	                print(&#x27;\r&#x27; + msg, end=&quot;&quot;, file=sys.stderr),
32	            else:
33	                print(&#x27;\r&#x27; + msg[:-1], end=&quot;&quot;, file=sys.stderr),
34	        else:
35	            if prefix == &#x27;[!]&#x27;:
36	                print(prefix, msg, end=&quot;&quot;, file=sys.stderr)
37	            else:
38	                print(prefix, msg, end=&quot;&quot;)
39	
40	
41	from comfy.cli_args import args
42	import latent_preview
43	
44	
45	is_local_mode = args.listen.startswith(&#x27;127.&#x27;)
46	
47	
48	def is_allowed_security_level(level):
49	    if level == &#x27;high&#x27;:
50	        if is_local_mode:
51	            return core.get_config()[&#x27;security_level&#x27;].lower() in [&#x27;weak&#x27;, &#x27;normal&#x27;]
52	        else:
53	            return core.get_config()[&#x27;security_level&#x27;].lower() == &#x27;weak&#x27;
54	    elif level == &#x27;middle&#x27;:
55	        return core.get_config()[&#x27;security_level&#x27;].lower() in [&#x27;weak&#x27;, &#x27;normal&#x27;]
56	    else:
57	        return True
58	
59	
60	async def get_risky_level(files):
61	    json_data1 = await core.get_data_by_mode(&#x27;local&#x27;, &#x27;custom-node-list.json&#x27;)
62	    json_data2 = await core.get_data_by_mode(&#x27;cache&#x27;, &#x27;custom-node-list.json&#x27;, channel_url=&#x27;https://github.com/ltdrdata/ComfyUI-Manager/raw/main/custom-node-list.json&#x27;)
63	
64	    all_urls = set()
65	    for x in json_data1[&#x27;custom_nodes&#x27;] + json_data2[&#x27;custom_nodes&#x27;]:
66	        all_urls.update(x[&#x27;files&#x27;])
67	
68	    for x in files:
69	        if x not in all_urls:
70	            return &quot;high&quot;
71	
72	    return &quot;middle&quot;
73	
74	
75	class ManagerFuncsInComfyUI(core.ManagerFuncs):
76	    def get_current_preview_method(self):
77	        if args.preview_method == latent_preview.LatentPreviewMethod.Auto:
78	            return &quot;auto&quot;
79	        elif args.preview_method == latent_preview.LatentPreviewMethod.Latent2RGB:
80	            return &quot;latent2rgb&quot;
81	        elif args.preview_method == latent_preview.LatentPreviewMethod.TAESD:
82	            return &quot;taesd&quot;
83	        else:
84	            return &quot;none&quot;
85	
86	    def run_script(self, cmd, cwd=&#x27;.&#x27;):
87	        if len(cmd) &gt; 0 and cmd[0].startswith(&quot;#&quot;):
88	            print(f&quot;[ComfyUI-Manager] Unexpected behavior: `{cmd}`&quot;)
89	            return 0
90	
91	        process = subprocess.Popen(cmd, cwd=cwd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True, bufsize=1)
92	
93	        stdout_thread = threading.Thread(target=handle_stream, args=(process.stdout, &quot;&quot;))
94	        stderr_thread = threading.Thread(target=handle_stream, args=(process.stderr, &quot;[!]&quot;))
95	
96	        stdout_thread.start()
97	        stderr_thread.start()
98	
99	        stdout_thread.join()
100	        stderr_thread.join()
101	
102	        return process.wait()
103	
104	
105	core.manager_funcs = ManagerFuncsInComfyUI()
106	
107	sys.path.append(&#x27;../..&#x27;)
108	
109	from torchvision.datasets.utils import download_url
110	
111	core.comfy_path = os.path.dirname(folder_paths.__file__)
112	core.js_path = os.path.join(core.comfy_path, &quot;web&quot;, &quot;extensions&quot;)
113	
114	local_db_model = os.path.join(core.comfyui_manager_path, &quot;model-list.json&quot;)
115	local_db_alter = os.path.join(core.comfyui_manager_path, &quot;alter-list.json&quot;)
116	local_db_custom_node_list = os.path.join(core.comfyui_manager_path, &quot;custom-node-list.json&quot;)
117	local_db_extension_node_mappings = os.path.join(core.comfyui_manager_path, &quot;extension-node-map.json&quot;)
118	components_path = os.path.join(core.comfyui_manager_path, &#x27;components&#x27;)
119	
120	
121	def set_preview_method(method):
122	    if method == &#x27;auto&#x27;:
123	        args.preview_method = latent_preview.LatentPreviewMethod.Auto
124	    elif method == &#x27;latent2rgb&#x27;:
125	        args.preview_method = latent_preview.LatentPreviewMethod.Latent2RGB
126	    elif method == &#x27;taesd&#x27;:
127	        args.preview_method = latent_preview.LatentPreviewMethod.TAESD
128	    else:
129	        args.preview_method = latent_preview.LatentPreviewMethod.NoPreviews
130	
131	    core.get_config()[&#x27;preview_method&#x27;] = args.preview_method
132	
133	
134	set_preview_method(core.get_config()[&#x27;preview_method&#x27;])
135	
136	
137	def set_badge_mode(mode):
138	    core.get_config()[&#x27;badge_mode&#x27;] = mode
139	
140	
141	def set_default_ui_mode(mode):
142	    core.get_config()[&#x27;default_ui&#x27;] = mode
143	
144	
145	def set_component_policy(mode):
146	    core.get_config()[&#x27;component_policy&#x27;] = mode
147	
148	
149	def set_double_click_policy(mode):
150	    core.get_config()[&#x27;double_click_policy&#x27;] = mode
</pre>
</div>


</div>
</div>

<div id="issue-28">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>173<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
113	
114	local_db_model = os.path.join(core.comfyui_manager_path, &quot;model-list.json&quot;)
115	local_db_alter = os.path.join(core.comfyui_manager_path, &quot;alter-list.json&quot;)
116	local_db_custom_node_list = os.path.join(core.comfyui_manager_path, &quot;custom-node-list.json&quot;)
117	local_db_extension_node_mappings = os.path.join(core.comfyui_manager_path, &quot;extension-node-map.json&quot;)
118	components_path = os.path.join(core.comfyui_manager_path, &#x27;components&#x27;)
119	
120	
121	def set_preview_method(method):
122	    if method == &#x27;auto&#x27;:
123	        args.preview_method = latent_preview.LatentPreviewMethod.Auto
124	    elif method == &#x27;latent2rgb&#x27;:
125	        args.preview_method = latent_preview.LatentPreviewMethod.Latent2RGB
126	    elif method == &#x27;taesd&#x27;:
127	        args.preview_method = latent_preview.LatentPreviewMethod.TAESD
128	    else:
129	        args.preview_method = latent_preview.LatentPreviewMethod.NoPreviews
130	
131	    core.get_config()[&#x27;preview_method&#x27;] = args.preview_method
132	
133	
134	set_preview_method(core.get_config()[&#x27;preview_method&#x27;])
135	
136	
137	def set_badge_mode(mode):
138	    core.get_config()[&#x27;badge_mode&#x27;] = mode
139	
140	
141	def set_default_ui_mode(mode):
142	    core.get_config()[&#x27;default_ui&#x27;] = mode
143	
144	
145	def set_component_policy(mode):
146	    core.get_config()[&#x27;component_policy&#x27;] = mode
147	
148	
149	def set_double_click_policy(mode):
150	    core.get_config()[&#x27;double_click_policy&#x27;] = mode
151	
152	
153	def print_comfyui_version():
154	    global comfy_ui_hash
155	
156	    is_detached = False
157	    try:
158	        repo = git.Repo(os.path.dirname(folder_paths.__file__))
159	        core.comfy_ui_revision = len(list(repo.iter_commits(&#x27;HEAD&#x27;)))
160	
161	        comfy_ui_hash = repo.head.commit.hexsha
162	        cm_global.variables[&#x27;comfyui.revision&#x27;] = core.comfy_ui_revision
163	
164	        core.comfy_ui_commit_datetime = repo.head.commit.committed_datetime
165	        cm_global.variables[&#x27;comfyui.commit_datetime&#x27;] = core.comfy_ui_commit_datetime
166	
167	        is_detached = repo.head.is_detached
168	        current_branch = repo.active_branch.name
169	
170	        try:
171	            if core.comfy_ui_commit_datetime.date() &lt; core.comfy_ui_required_commit_datetime.date():
172	                print(f&quot;\n\n## [WARN] ComfyUI-Manager: Your ComfyUI version ({core.comfy_ui_revision})[{core.comfy_ui_commit_datetime.date()}] is too old. Please update to the latest version. ##\n\n&quot;)
173	        except:
174	            pass
175	
176	        # process on_revision_detected --&gt;
177	        if &#x27;cm.on_revision_detected_handler&#x27; in cm_global.variables:
178	            for k, f in cm_global.variables[&#x27;cm.on_revision_detected_handler&#x27;]:
179	                try:
180	                    f(core.comfy_ui_revision)
181	                except Exception:
182	                    print(f&quot;[ERROR] &#x27;{k}&#x27; on_revision_detected_handler&quot;)
183	                    traceback.print_exc()
184	
185	            del cm_global.variables[&#x27;cm.on_revision_detected_handler&#x27;]
186	        else:
187	            print(f&quot;[ComfyUI-Manager] Some features are restricted due to your ComfyUI being outdated.&quot;)
188	        # &lt;--
189	
190	        if current_branch == &quot;master&quot;:
191	            print(f&quot;### ComfyUI Revision: {core.comfy_ui_revision} [{comfy_ui_hash[:8]}] | Released on &#x27;{core.comfy_ui_commit_datetime.date()}&#x27;&quot;)
192	        else:
193	            print(f&quot;### ComfyUI Revision: {core.comfy_ui_revision} on &#x27;{current_branch}&#x27; [{comfy_ui_hash[:8]}] | Released on &#x27;{core.comfy_ui_commit_datetime.date()}&#x27;&quot;)
194	    except:
195	        if is_detached:
196	            print(f&quot;### ComfyUI Revision: {core.comfy_ui_revision} [{comfy_ui_hash[:8]}] *DETACHED | Released on &#x27;{core.comfy_ui_commit_datetime.date()}&#x27;&quot;)
197	        else:
198	            print(&quot;### ComfyUI Revision: UNKNOWN (The currently installed ComfyUI is not a Git repository)&quot;)
199	
200	
201	print_comfyui_version()
202	
203	
204	async def populate_github_stats(json_obj, filename, silent=False):
205	    uri = os.path.join(core.comfyui_manager_path, filename)
206	    with open(uri, &quot;r&quot;, encoding=&#x27;utf-8&#x27;) as f:
207	        github_stats = json.load(f)
208	    if &#x27;custom_nodes&#x27; in json_obj:
209	        for i, node in enumerate(json_obj[&#x27;custom_nodes&#x27;]):
210	            url = node[&#x27;reference&#x27;]
211	            if url in github_stats:
212	                json_obj[&#x27;custom_nodes&#x27;][i][&#x27;stars&#x27;] = github_stats[url][&#x27;stars&#x27;]
213	                json_obj[&#x27;custom_nodes&#x27;][i][&#x27;last_update&#x27;] = github_stats[url][&#x27;last_update&#x27;]
214	            else:
215	                json_obj[&#x27;custom_nodes&#x27;][i][&#x27;stars&#x27;] = -1
216	                json_obj[&#x27;custom_nodes&#x27;][i][&#x27;last_update&#x27;] = -1
217	        return json_obj
218	
219	
220	def setup_environment():
221	    git_exe = core.get_config()[&#x27;git_exe&#x27;]
222	
223	    if git_exe != &#x27;&#x27;:
224	        git.Git().update_environment(GIT_PYTHON_GIT_EXECUTABLE=git_exe)
225	
226	
227	setup_environment()
228	
229	# Expand Server api
230	
231	import server
232	from aiohttp import web
233	import aiohttp
</pre>
</div>


</div>
</div>

<div id="issue-29">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Audit url open for permitted schemes. Allowing use of file:/ or custom schemes is often unexpected.<br>
    <b>Test ID:</b> B310<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>657<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen</a><br>

<div class="code">
<pre>
597	            os.remove(path)
598	
599	        return web.Response(status=200)
600	    except:
601	        return web.Response(status=400)
602	
603	
604	@PromptServer.instance.routes.get(&quot;/snapshot/restore&quot;)
605	async def remove_snapshot(request):
606	    if not is_allowed_security_level(&#x27;middle&#x27;):
607	        print(f&quot;ERROR: To use this action, a security_level of `middle or below` is required.  Please contact the administrator.&quot;)
608	        return web.Response(status=403)
609	    
610	    try:
611	        target = request.rel_url.query[&quot;target&quot;]
612	
613	        path = os.path.join(core.comfyui_manager_path, &#x27;snapshots&#x27;, f&quot;{target}.json&quot;)
614	        if os.path.exists(path):
615	            if not os.path.exists(core.startup_script_path):
616	                os.makedirs(core.startup_script_path)
617	
618	            target_path = os.path.join(core.startup_script_path, &quot;restore-snapshot.json&quot;)
619	            shutil.copy(path, target_path)
620	
621	            print(f&quot;Snapshot restore scheduled: `{target}`&quot;)
622	            return web.Response(status=200)
623	
624	        print(f&quot;Snapshot file not found: `{path}`&quot;)
625	        return web.Response(status=400)
626	    except:
627	        return web.Response(status=400)
628	
629	
630	@PromptServer.instance.routes.get(&quot;/snapshot/get_current&quot;)
631	async def get_current_snapshot_api(request):
632	    try:
633	        return web.json_response(core.get_current_snapshot(), content_type=&#x27;application/json&#x27;)
634	    except:
635	        return web.Response(status=400)
636	
637	
638	@PromptServer.instance.routes.get(&quot;/snapshot/save&quot;)
639	async def save_snapshot(request):
640	    try:
641	        core.save_snapshot_with_postfix(&#x27;snapshot&#x27;)
642	        return web.Response(status=200)
643	    except:
644	        return web.Response(status=400)
645	
646	
647	def unzip_install(files):
648	    temp_filename = &#x27;manager-temp.zip&#x27;
649	    for url in files:
650	        if url.endswith(&quot;/&quot;):
651	            url = url[:-1]
652	        try:
653	            headers = {
654	                &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&#x27;}
655	
656	            req = urllib.request.Request(url, headers=headers)
657	            response = urllib.request.urlopen(req)
658	            data = response.read()
659	
660	            with open(temp_filename, &#x27;wb&#x27;) as f:
661	                f.write(data)
662	
663	            with zipfile.ZipFile(temp_filename, &#x27;r&#x27;) as zip_ref:
664	                zip_ref.extractall(core.custom_nodes_path)
665	
666	            os.remove(temp_filename)
667	        except Exception as e:
668	            print(f&quot;Install(unzip) error: {url} / {e}&quot;, file=sys.stderr)
669	            return False
670	
671	    print(&quot;Installation was successful.&quot;)
672	    return True
673	
674	
675	def download_url_with_agent(url, save_path):
676	    try:
677	        headers = {
678	            &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&#x27;}
679	
680	        req = urllib.request.Request(url, headers=headers)
681	        response = urllib.request.urlopen(req)
682	        data = response.read()
683	
684	        if not os.path.exists(os.path.dirname(save_path)):
685	            os.makedirs(os.path.dirname(save_path))
686	
687	        with open(save_path, &#x27;wb&#x27;) as f:
688	            f.write(data)
689	
690	    except Exception as e:
691	        print(f&quot;Download error: {url} / {e}&quot;, file=sys.stderr)
692	        return False
693	
694	    print(&quot;Installation was successful.&quot;)
695	    return True
696	
697	
698	def copy_install(files, js_path_name=None):
699	    for url in files:
700	        if url.endswith(&quot;/&quot;):
701	            url = url[:-1]
702	        try:
703	            if url.endswith(&quot;.py&quot;):
704	                download_url(url, core.custom_nodes_path)
705	            else:
706	                path = os.path.join(core.js_path, js_path_name) if js_path_name is not None else core.js_path
707	                if not os.path.exists(path):
708	                    os.makedirs(path)
709	                download_url(url, path)
710	
711	        except Exception as e:
712	            print(f&quot;Install(copy) error: {url} / {e}&quot;, file=sys.stderr)
713	            return False
714	
715	    print(&quot;Installation was successful.&quot;)
716	    return True
</pre>
</div>


</div>
</div>

<div id="issue-30">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Audit url open for permitted schemes. Allowing use of file:/ or custom schemes is often unexpected.<br>
    <b>Test ID:</b> B310<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>681<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen</a><br>

<div class="code">
<pre>
621	            print(f&quot;Snapshot restore scheduled: `{target}`&quot;)
622	            return web.Response(status=200)
623	
624	        print(f&quot;Snapshot file not found: `{path}`&quot;)
625	        return web.Response(status=400)
626	    except:
627	        return web.Response(status=400)
628	
629	
630	@PromptServer.instance.routes.get(&quot;/snapshot/get_current&quot;)
631	async def get_current_snapshot_api(request):
632	    try:
633	        return web.json_response(core.get_current_snapshot(), content_type=&#x27;application/json&#x27;)
634	    except:
635	        return web.Response(status=400)
636	
637	
638	@PromptServer.instance.routes.get(&quot;/snapshot/save&quot;)
639	async def save_snapshot(request):
640	    try:
641	        core.save_snapshot_with_postfix(&#x27;snapshot&#x27;)
642	        return web.Response(status=200)
643	    except:
644	        return web.Response(status=400)
645	
646	
647	def unzip_install(files):
648	    temp_filename = &#x27;manager-temp.zip&#x27;
649	    for url in files:
650	        if url.endswith(&quot;/&quot;):
651	            url = url[:-1]
652	        try:
653	            headers = {
654	                &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&#x27;}
655	
656	            req = urllib.request.Request(url, headers=headers)
657	            response = urllib.request.urlopen(req)
658	            data = response.read()
659	
660	            with open(temp_filename, &#x27;wb&#x27;) as f:
661	                f.write(data)
662	
663	            with zipfile.ZipFile(temp_filename, &#x27;r&#x27;) as zip_ref:
664	                zip_ref.extractall(core.custom_nodes_path)
665	
666	            os.remove(temp_filename)
667	        except Exception as e:
668	            print(f&quot;Install(unzip) error: {url} / {e}&quot;, file=sys.stderr)
669	            return False
670	
671	    print(&quot;Installation was successful.&quot;)
672	    return True
673	
674	
675	def download_url_with_agent(url, save_path):
676	    try:
677	        headers = {
678	            &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3&#x27;}
679	
680	        req = urllib.request.Request(url, headers=headers)
681	        response = urllib.request.urlopen(req)
682	        data = response.read()
683	
684	        if not os.path.exists(os.path.dirname(save_path)):
685	            os.makedirs(os.path.dirname(save_path))
686	
687	        with open(save_path, &#x27;wb&#x27;) as f:
688	            f.write(data)
689	
690	    except Exception as e:
691	        print(f&quot;Download error: {url} / {e}&quot;, file=sys.stderr)
692	        return False
693	
694	    print(&quot;Installation was successful.&quot;)
695	    return True
696	
697	
698	def copy_install(files, js_path_name=None):
699	    for url in files:
700	        if url.endswith(&quot;/&quot;):
701	            url = url[:-1]
702	        try:
703	            if url.endswith(&quot;.py&quot;):
704	                download_url(url, core.custom_nodes_path)
705	            else:
706	                path = os.path.join(core.js_path, js_path_name) if js_path_name is not None else core.js_path
707	                if not os.path.exists(path):
708	                    os.makedirs(path)
709	                download_url(url, path)
710	
711	        except Exception as e:
712	            print(f&quot;Install(copy) error: {url} / {e}&quot;, file=sys.stderr)
713	            return False
714	
715	    print(&quot;Installation was successful.&quot;)
716	    return True
717	
718	
719	def copy_uninstall(files, js_path_name=&#x27;.&#x27;):
720	    for url in files:
721	        if url.endswith(&quot;/&quot;):
722	            url = url[:-1]
723	        dir_name = os.path.basename(url)
724	        base_path = core.custom_nodes_path if url.endswith(&#x27;.py&#x27;) else os.path.join(core.js_path, js_path_name)
725	        file_path = os.path.join(base_path, dir_name)
726	
727	        try:
728	            if os.path.exists(file_path):
729	                os.remove(file_path)
730	            elif os.path.exists(file_path + &quot;.disabled&quot;):
731	                os.remove(file_path + &quot;.disabled&quot;)
732	        except Exception as e:
733	            print(f&quot;Uninstall(copy) error: {url} / {e}&quot;, file=sys.stderr)
734	            return False
735	
736	    print(&quot;Uninstallation was successful.&quot;)
737	    return True
738	
739	
740	def copy_set_active(files, is_disable, js_path_name=&#x27;.&#x27;):
</pre>
</div>


</div>
</div>

<div id="issue-31">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>1144<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
1084	
1085	
1086	@PromptServer.instance.routes.get(&quot;/manager/dbl_click/policy&quot;)
1087	async def dbl_click_policy(request):
1088	    if &quot;value&quot; in request.rel_url.query:
1089	        set_double_click_policy(request.rel_url.query[&#x27;value&#x27;])
1090	        core.write_config()
1091	    else:
1092	        return web.Response(text=core.get_config()[&#x27;double_click_policy&#x27;], status=200)
1093	
1094	    return web.Response(status=200)
1095	
1096	
1097	@PromptServer.instance.routes.get(&quot;/manager/channel_url_list&quot;)
1098	async def channel_url_list(request):
1099	    channels = core.get_channel_dict()
1100	    if &quot;value&quot; in request.rel_url.query:
1101	        channel_url = channels.get(request.rel_url.query[&#x27;value&#x27;])
1102	        if channel_url is not None:
1103	            core.get_config()[&#x27;channel_url&#x27;] = channel_url
1104	            core.write_config()
1105	    else:
1106	        selected = &#x27;custom&#x27;
1107	        selected_url = core.get_config()[&#x27;channel_url&#x27;]
1108	
1109	        for name, url in channels.items():
1110	            if url == selected_url:
1111	                selected = name
1112	                break
1113	
1114	        res = {&#x27;selected&#x27;: selected,
1115	               &#x27;list&#x27;: core.get_channel_list()}
1116	        return web.json_response(res, status=200)
1117	
1118	    return web.Response(status=200)
1119	
1120	
1121	@PromptServer.instance.routes.get(&quot;/manager/notice&quot;)
1122	async def get_notice(request):
1123	    url = &quot;github.com&quot;
1124	    path = &quot;/ltdrdata/ltdrdata.github.io/wiki/News&quot;
1125	
1126	    async with aiohttp.ClientSession(trust_env=True, connector=aiohttp.TCPConnector(verify_ssl=False)) as session:
1127	        async with session.get(f&quot;https://{url}{path}&quot;) as response:
1128	            if response.status == 200:
1129	                # html_content = response.read().decode(&#x27;utf-8&#x27;)
1130	                html_content = await response.text()
1131	
1132	                pattern = re.compile(r&#x27;&lt;div class=&quot;markdown-body&quot;&gt;([\s\S]*?)&lt;/div&gt;&#x27;)
1133	                match = pattern.search(html_content)
1134	
1135	                if match:
1136	                    markdown_content = match.group(1)
1137	                    markdown_content += f&quot;&lt;HR&gt;ComfyUI: {core.comfy_ui_revision}[{comfy_ui_hash[:6]}]({core.comfy_ui_commit_datetime.date()})&quot;
1138	                    # markdown_content += f&quot;&lt;BR&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;()&quot;
1139	                    markdown_content += f&quot;&lt;BR&gt;Manager: {core.version_str}&quot;
1140	
1141	                    try:
1142	                        if core.comfy_ui_required_commit_datetime.date() &gt; core.comfy_ui_commit_datetime.date():
1143	                            markdown_content = f&#x27;&lt;P style=&quot;text-align: center; color:red; background-color:white; font-weight:bold&quot;&gt;Your ComfyUI is too OUTDATED!!!&lt;/P&gt;&#x27; + markdown_content
1144	                    except:
1145	                        pass
1146	
1147	                    return web.Response(text=markdown_content, status=200)
1148	                else:
1149	                    return web.Response(text=&quot;Unable to retrieve Notice&quot;, status=200)
1150	            else:
1151	                return web.Response(text=&quot;Unable to retrieve Notice&quot;, status=200)
1152	
1153	
1154	@PromptServer.instance.routes.get(&quot;/manager/reboot&quot;)
1155	def restart(self):
1156	    if not is_allowed_security_level(&#x27;middle&#x27;):
1157	        print(f&quot;ERROR: To use this action, a security_level of `middle or below` is required.  Please contact the administrator.&quot;)
1158	        return web.Response(status=403)
1159	
1160	    try:
1161	        sys.stdout.close_log()
1162	    except Exception as e:
1163	        pass
1164	
1165	    if &#x27;__COMFY_CLI_SESSION__&#x27; in os.environ:
1166	        with open(os.path.join(os.environ[&#x27;__COMFY_CLI_SESSION__&#x27;] + &#x27;.reboot&#x27;), &#x27;w&#x27;) as file:
1167	            pass
1168	
1169	        print(f&quot;\nRestarting...\n\n&quot;)
1170	        exit(0)
1171	
1172	    print(f&quot;\nRestarting... [Legacy Mode]\n\n&quot;)
1173	    if sys.platform.startswith(&#x27;win32&#x27;):
1174	        return os.execv(sys.executable, [&#x27;&quot;&#x27; + sys.executable + &#x27;&quot;&#x27;, &#x27;&quot;&#x27; + sys.argv[0] + &#x27;&quot;&#x27;] + sys.argv[1:])
1175	    else:
1176	        return os.execv(sys.executable, [sys.executable] + sys.argv)
1177	
1178	
1179	def sanitize_filename(input_string):
1180	    # 알파벳, 숫자, 및 밑줄 이외의 문자를 밑줄로 대체
1181	    result_string = re.sub(r&#x27;[^a-zA-Z0-9_]&#x27;, &#x27;_&#x27;, input_string)
1182	    return result_string
1183	
1184	
1185	@PromptServer.instance.routes.post(&quot;/manager/component/save&quot;)
1186	async def save_component(request):
1187	    try:
1188	        data = await request.json()
1189	        name = data[&#x27;name&#x27;]
1190	        workflow = data[&#x27;workflow&#x27;]
1191	
1192	        if not os.path.exists(components_path):
1193	            os.mkdir(components_path)
1194	
1195	        if &#x27;packname&#x27; in workflow and workflow[&#x27;packname&#x27;] != &#x27;&#x27;:
1196	            sanitized_name = sanitize_filename(workflow[&#x27;packname&#x27;]) + &#x27;.pack&#x27;
1197	        else:
1198	            sanitized_name = sanitize_filename(name) + &#x27;.json&#x27;
1199	
1200	        filepath = os.path.join(components_path, sanitized_name)
1201	        components = {}
1202	        if os.path.exists(filepath):
1203	            with open(filepath) as f:
1204	                components = json.load(f)
</pre>
</div>


</div>
</div>

<div id="issue-32">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>1162<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
1102	        if channel_url is not None:
1103	            core.get_config()[&#x27;channel_url&#x27;] = channel_url
1104	            core.write_config()
1105	    else:
1106	        selected = &#x27;custom&#x27;
1107	        selected_url = core.get_config()[&#x27;channel_url&#x27;]
1108	
1109	        for name, url in channels.items():
1110	            if url == selected_url:
1111	                selected = name
1112	                break
1113	
1114	        res = {&#x27;selected&#x27;: selected,
1115	               &#x27;list&#x27;: core.get_channel_list()}
1116	        return web.json_response(res, status=200)
1117	
1118	    return web.Response(status=200)
1119	
1120	
1121	@PromptServer.instance.routes.get(&quot;/manager/notice&quot;)
1122	async def get_notice(request):
1123	    url = &quot;github.com&quot;
1124	    path = &quot;/ltdrdata/ltdrdata.github.io/wiki/News&quot;
1125	
1126	    async with aiohttp.ClientSession(trust_env=True, connector=aiohttp.TCPConnector(verify_ssl=False)) as session:
1127	        async with session.get(f&quot;https://{url}{path}&quot;) as response:
1128	            if response.status == 200:
1129	                # html_content = response.read().decode(&#x27;utf-8&#x27;)
1130	                html_content = await response.text()
1131	
1132	                pattern = re.compile(r&#x27;&lt;div class=&quot;markdown-body&quot;&gt;([\s\S]*?)&lt;/div&gt;&#x27;)
1133	                match = pattern.search(html_content)
1134	
1135	                if match:
1136	                    markdown_content = match.group(1)
1137	                    markdown_content += f&quot;&lt;HR&gt;ComfyUI: {core.comfy_ui_revision}[{comfy_ui_hash[:6]}]({core.comfy_ui_commit_datetime.date()})&quot;
1138	                    # markdown_content += f&quot;&lt;BR&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;()&quot;
1139	                    markdown_content += f&quot;&lt;BR&gt;Manager: {core.version_str}&quot;
1140	
1141	                    try:
1142	                        if core.comfy_ui_required_commit_datetime.date() &gt; core.comfy_ui_commit_datetime.date():
1143	                            markdown_content = f&#x27;&lt;P style=&quot;text-align: center; color:red; background-color:white; font-weight:bold&quot;&gt;Your ComfyUI is too OUTDATED!!!&lt;/P&gt;&#x27; + markdown_content
1144	                    except:
1145	                        pass
1146	
1147	                    return web.Response(text=markdown_content, status=200)
1148	                else:
1149	                    return web.Response(text=&quot;Unable to retrieve Notice&quot;, status=200)
1150	            else:
1151	                return web.Response(text=&quot;Unable to retrieve Notice&quot;, status=200)
1152	
1153	
1154	@PromptServer.instance.routes.get(&quot;/manager/reboot&quot;)
1155	def restart(self):
1156	    if not is_allowed_security_level(&#x27;middle&#x27;):
1157	        print(f&quot;ERROR: To use this action, a security_level of `middle or below` is required.  Please contact the administrator.&quot;)
1158	        return web.Response(status=403)
1159	
1160	    try:
1161	        sys.stdout.close_log()
1162	    except Exception as e:
1163	        pass
1164	
1165	    if &#x27;__COMFY_CLI_SESSION__&#x27; in os.environ:
1166	        with open(os.path.join(os.environ[&#x27;__COMFY_CLI_SESSION__&#x27;] + &#x27;.reboot&#x27;), &#x27;w&#x27;) as file:
1167	            pass
1168	
1169	        print(f&quot;\nRestarting...\n\n&quot;)
1170	        exit(0)
1171	
1172	    print(f&quot;\nRestarting... [Legacy Mode]\n\n&quot;)
1173	    if sys.platform.startswith(&#x27;win32&#x27;):
1174	        return os.execv(sys.executable, [&#x27;&quot;&#x27; + sys.executable + &#x27;&quot;&#x27;, &#x27;&quot;&#x27; + sys.argv[0] + &#x27;&quot;&#x27;] + sys.argv[1:])
1175	    else:
1176	        return os.execv(sys.executable, [sys.executable] + sys.argv)
1177	
1178	
1179	def sanitize_filename(input_string):
1180	    # 알파벳, 숫자, 및 밑줄 이외의 문자를 밑줄로 대체
1181	    result_string = re.sub(r&#x27;[^a-zA-Z0-9_]&#x27;, &#x27;_&#x27;, input_string)
1182	    return result_string
1183	
1184	
1185	@PromptServer.instance.routes.post(&quot;/manager/component/save&quot;)
1186	async def save_component(request):
1187	    try:
1188	        data = await request.json()
1189	        name = data[&#x27;name&#x27;]
1190	        workflow = data[&#x27;workflow&#x27;]
1191	
1192	        if not os.path.exists(components_path):
1193	            os.mkdir(components_path)
1194	
1195	        if &#x27;packname&#x27; in workflow and workflow[&#x27;packname&#x27;] != &#x27;&#x27;:
1196	            sanitized_name = sanitize_filename(workflow[&#x27;packname&#x27;]) + &#x27;.pack&#x27;
1197	        else:
1198	            sanitized_name = sanitize_filename(name) + &#x27;.json&#x27;
1199	
1200	        filepath = os.path.join(components_path, sanitized_name)
1201	        components = {}
1202	        if os.path.exists(filepath):
1203	            with open(filepath) as f:
1204	                components = json.load(f)
1205	
1206	        components[name] = workflow
1207	
1208	        with open(filepath, &#x27;w&#x27;) as f:
1209	            json.dump(components, f, indent=4, sort_keys=True)
1210	        return web.Response(text=filepath, status=200)
1211	    except:
1212	        return web.Response(status=400)
1213	
1214	
1215	@PromptServer.instance.routes.post(&quot;/manager/component/loads&quot;)
1216	async def load_components(request):
1217	    try:
1218	        json_files = [f for f in os.listdir(components_path) if f.endswith(&#x27;.json&#x27;)]
1219	        pack_files = [f for f in os.listdir(components_path) if f.endswith(&#x27;.pack&#x27;)]
1220	
1221	        components = {}
1222	        for json_file in json_files + pack_files:
</pre>
</div>


</div>
</div>

<div id="issue-33">
<div class="issue-block issue-sev-low">
    <b>start_process_with_no_shell: </b> Starting a process without a shell.<br>
    <b>Test ID:</b> B606<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>MEDIUM<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>1174<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b606_start_process_with_no_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b606_start_process_with_no_shell.html</a><br>

<div class="code">
<pre>
1114	        res = {&#x27;selected&#x27;: selected,
1115	               &#x27;list&#x27;: core.get_channel_list()}
1116	        return web.json_response(res, status=200)
1117	
1118	    return web.Response(status=200)
1119	
1120	
1121	@PromptServer.instance.routes.get(&quot;/manager/notice&quot;)
1122	async def get_notice(request):
1123	    url = &quot;github.com&quot;
1124	    path = &quot;/ltdrdata/ltdrdata.github.io/wiki/News&quot;
1125	
1126	    async with aiohttp.ClientSession(trust_env=True, connector=aiohttp.TCPConnector(verify_ssl=False)) as session:
1127	        async with session.get(f&quot;https://{url}{path}&quot;) as response:
1128	            if response.status == 200:
1129	                # html_content = response.read().decode(&#x27;utf-8&#x27;)
1130	                html_content = await response.text()
1131	
1132	                pattern = re.compile(r&#x27;&lt;div class=&quot;markdown-body&quot;&gt;([\s\S]*?)&lt;/div&gt;&#x27;)
1133	                match = pattern.search(html_content)
1134	
1135	                if match:
1136	                    markdown_content = match.group(1)
1137	                    markdown_content += f&quot;&lt;HR&gt;ComfyUI: {core.comfy_ui_revision}[{comfy_ui_hash[:6]}]({core.comfy_ui_commit_datetime.date()})&quot;
1138	                    # markdown_content += f&quot;&lt;BR&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;()&quot;
1139	                    markdown_content += f&quot;&lt;BR&gt;Manager: {core.version_str}&quot;
1140	
1141	                    try:
1142	                        if core.comfy_ui_required_commit_datetime.date() &gt; core.comfy_ui_commit_datetime.date():
1143	                            markdown_content = f&#x27;&lt;P style=&quot;text-align: center; color:red; background-color:white; font-weight:bold&quot;&gt;Your ComfyUI is too OUTDATED!!!&lt;/P&gt;&#x27; + markdown_content
1144	                    except:
1145	                        pass
1146	
1147	                    return web.Response(text=markdown_content, status=200)
1148	                else:
1149	                    return web.Response(text=&quot;Unable to retrieve Notice&quot;, status=200)
1150	            else:
1151	                return web.Response(text=&quot;Unable to retrieve Notice&quot;, status=200)
1152	
1153	
1154	@PromptServer.instance.routes.get(&quot;/manager/reboot&quot;)
1155	def restart(self):
1156	    if not is_allowed_security_level(&#x27;middle&#x27;):
1157	        print(f&quot;ERROR: To use this action, a security_level of `middle or below` is required.  Please contact the administrator.&quot;)
1158	        return web.Response(status=403)
1159	
1160	    try:
1161	        sys.stdout.close_log()
1162	    except Exception as e:
1163	        pass
1164	
1165	    if &#x27;__COMFY_CLI_SESSION__&#x27; in os.environ:
1166	        with open(os.path.join(os.environ[&#x27;__COMFY_CLI_SESSION__&#x27;] + &#x27;.reboot&#x27;), &#x27;w&#x27;) as file:
1167	            pass
1168	
1169	        print(f&quot;\nRestarting...\n\n&quot;)
1170	        exit(0)
1171	
1172	    print(f&quot;\nRestarting... [Legacy Mode]\n\n&quot;)
1173	    if sys.platform.startswith(&#x27;win32&#x27;):
1174	        return os.execv(sys.executable, [&#x27;&quot;&#x27; + sys.executable + &#x27;&quot;&#x27;, &#x27;&quot;&#x27; + sys.argv[0] + &#x27;&quot;&#x27;] + sys.argv[1:])
1175	    else:
1176	        return os.execv(sys.executable, [sys.executable] + sys.argv)
1177	
1178	
1179	def sanitize_filename(input_string):
1180	    # 알파벳, 숫자, 및 밑줄 이외의 문자를 밑줄로 대체
1181	    result_string = re.sub(r&#x27;[^a-zA-Z0-9_]&#x27;, &#x27;_&#x27;, input_string)
1182	    return result_string
1183	
1184	
1185	@PromptServer.instance.routes.post(&quot;/manager/component/save&quot;)
1186	async def save_component(request):
1187	    try:
1188	        data = await request.json()
1189	        name = data[&#x27;name&#x27;]
1190	        workflow = data[&#x27;workflow&#x27;]
1191	
1192	        if not os.path.exists(components_path):
1193	            os.mkdir(components_path)
1194	
1195	        if &#x27;packname&#x27; in workflow and workflow[&#x27;packname&#x27;] != &#x27;&#x27;:
1196	            sanitized_name = sanitize_filename(workflow[&#x27;packname&#x27;]) + &#x27;.pack&#x27;
1197	        else:
1198	            sanitized_name = sanitize_filename(name) + &#x27;.json&#x27;
1199	
1200	        filepath = os.path.join(components_path, sanitized_name)
1201	        components = {}
1202	        if os.path.exists(filepath):
1203	            with open(filepath) as f:
1204	                components = json.load(f)
1205	
1206	        components[name] = workflow
1207	
1208	        with open(filepath, &#x27;w&#x27;) as f:
1209	            json.dump(components, f, indent=4, sort_keys=True)
1210	        return web.Response(text=filepath, status=200)
1211	    except:
1212	        return web.Response(status=400)
1213	
1214	
1215	@PromptServer.instance.routes.post(&quot;/manager/component/loads&quot;)
1216	async def load_components(request):
1217	    try:
1218	        json_files = [f for f in os.listdir(components_path) if f.endswith(&#x27;.json&#x27;)]
1219	        pack_files = [f for f in os.listdir(components_path) if f.endswith(&#x27;.pack&#x27;)]
1220	
1221	        components = {}
1222	        for json_file in json_files + pack_files:
1223	            file_path = os.path.join(components_path, json_file)
1224	            with open(file_path, &#x27;r&#x27;) as file:
1225	                try:
1226	                    # When there is a conflict between the .pack and the .json, the pack takes precedence and overrides.
1227	                    components.update(json.load(file))
1228	                except json.JSONDecodeError as e:
1229	                    print(f&quot;[ComfyUI-Manager] Error decoding component file in file {json_file}: {e}&quot;)
1230	
1231	        return web.json_response(components)
1232	    except Exception as e:
1233	        print(f&quot;[ComfyUI-Manager] failed to load components\n{e}&quot;)
</pre>
</div>


</div>
</div>

<div id="issue-34">
<div class="issue-block issue-sev-low">
    <b>start_process_with_no_shell: </b> Starting a process without a shell.<br>
    <b>Test ID:</b> B606<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>MEDIUM<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/glob/manager_server.py</a><br>
    <b>Line number: </b>1176<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b606_start_process_with_no_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b606_start_process_with_no_shell.html</a><br>

<div class="code">
<pre>
1116	        return web.json_response(res, status=200)
1117	
1118	    return web.Response(status=200)
1119	
1120	
1121	@PromptServer.instance.routes.get(&quot;/manager/notice&quot;)
1122	async def get_notice(request):
1123	    url = &quot;github.com&quot;
1124	    path = &quot;/ltdrdata/ltdrdata.github.io/wiki/News&quot;
1125	
1126	    async with aiohttp.ClientSession(trust_env=True, connector=aiohttp.TCPConnector(verify_ssl=False)) as session:
1127	        async with session.get(f&quot;https://{url}{path}&quot;) as response:
1128	            if response.status == 200:
1129	                # html_content = response.read().decode(&#x27;utf-8&#x27;)
1130	                html_content = await response.text()
1131	
1132	                pattern = re.compile(r&#x27;&lt;div class=&quot;markdown-body&quot;&gt;([\s\S]*?)&lt;/div&gt;&#x27;)
1133	                match = pattern.search(html_content)
1134	
1135	                if match:
1136	                    markdown_content = match.group(1)
1137	                    markdown_content += f&quot;&lt;HR&gt;ComfyUI: {core.comfy_ui_revision}[{comfy_ui_hash[:6]}]({core.comfy_ui_commit_datetime.date()})&quot;
1138	                    # markdown_content += f&quot;&lt;BR&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;()&quot;
1139	                    markdown_content += f&quot;&lt;BR&gt;Manager: {core.version_str}&quot;
1140	
1141	                    try:
1142	                        if core.comfy_ui_required_commit_datetime.date() &gt; core.comfy_ui_commit_datetime.date():
1143	                            markdown_content = f&#x27;&lt;P style=&quot;text-align: center; color:red; background-color:white; font-weight:bold&quot;&gt;Your ComfyUI is too OUTDATED!!!&lt;/P&gt;&#x27; + markdown_content
1144	                    except:
1145	                        pass
1146	
1147	                    return web.Response(text=markdown_content, status=200)
1148	                else:
1149	                    return web.Response(text=&quot;Unable to retrieve Notice&quot;, status=200)
1150	            else:
1151	                return web.Response(text=&quot;Unable to retrieve Notice&quot;, status=200)
1152	
1153	
1154	@PromptServer.instance.routes.get(&quot;/manager/reboot&quot;)
1155	def restart(self):
1156	    if not is_allowed_security_level(&#x27;middle&#x27;):
1157	        print(f&quot;ERROR: To use this action, a security_level of `middle or below` is required.  Please contact the administrator.&quot;)
1158	        return web.Response(status=403)
1159	
1160	    try:
1161	        sys.stdout.close_log()
1162	    except Exception as e:
1163	        pass
1164	
1165	    if &#x27;__COMFY_CLI_SESSION__&#x27; in os.environ:
1166	        with open(os.path.join(os.environ[&#x27;__COMFY_CLI_SESSION__&#x27;] + &#x27;.reboot&#x27;), &#x27;w&#x27;) as file:
1167	            pass
1168	
1169	        print(f&quot;\nRestarting...\n\n&quot;)
1170	        exit(0)
1171	
1172	    print(f&quot;\nRestarting... [Legacy Mode]\n\n&quot;)
1173	    if sys.platform.startswith(&#x27;win32&#x27;):
1174	        return os.execv(sys.executable, [&#x27;&quot;&#x27; + sys.executable + &#x27;&quot;&#x27;, &#x27;&quot;&#x27; + sys.argv[0] + &#x27;&quot;&#x27;] + sys.argv[1:])
1175	    else:
1176	        return os.execv(sys.executable, [sys.executable] + sys.argv)
1177	
1178	
1179	def sanitize_filename(input_string):
1180	    # 알파벳, 숫자, 및 밑줄 이외의 문자를 밑줄로 대체
1181	    result_string = re.sub(r&#x27;[^a-zA-Z0-9_]&#x27;, &#x27;_&#x27;, input_string)
1182	    return result_string
1183	
1184	
1185	@PromptServer.instance.routes.post(&quot;/manager/component/save&quot;)
1186	async def save_component(request):
1187	    try:
1188	        data = await request.json()
1189	        name = data[&#x27;name&#x27;]
1190	        workflow = data[&#x27;workflow&#x27;]
1191	
1192	        if not os.path.exists(components_path):
1193	            os.mkdir(components_path)
1194	
1195	        if &#x27;packname&#x27; in workflow and workflow[&#x27;packname&#x27;] != &#x27;&#x27;:
1196	            sanitized_name = sanitize_filename(workflow[&#x27;packname&#x27;]) + &#x27;.pack&#x27;
1197	        else:
1198	            sanitized_name = sanitize_filename(name) + &#x27;.json&#x27;
1199	
1200	        filepath = os.path.join(components_path, sanitized_name)
1201	        components = {}
1202	        if os.path.exists(filepath):
1203	            with open(filepath) as f:
1204	                components = json.load(f)
1205	
1206	        components[name] = workflow
1207	
1208	        with open(filepath, &#x27;w&#x27;) as f:
1209	            json.dump(components, f, indent=4, sort_keys=True)
1210	        return web.Response(text=filepath, status=200)
1211	    except:
1212	        return web.Response(status=400)
1213	
1214	
1215	@PromptServer.instance.routes.post(&quot;/manager/component/loads&quot;)
1216	async def load_components(request):
1217	    try:
1218	        json_files = [f for f in os.listdir(components_path) if f.endswith(&#x27;.json&#x27;)]
1219	        pack_files = [f for f in os.listdir(components_path) if f.endswith(&#x27;.pack&#x27;)]
1220	
1221	        components = {}
1222	        for json_file in json_files + pack_files:
1223	            file_path = os.path.join(components_path, json_file)
1224	            with open(file_path, &#x27;r&#x27;) as file:
1225	                try:
1226	                    # When there is a conflict between the .pack and the .json, the pack takes precedence and overrides.
1227	                    components.update(json.load(file))
1228	                except json.JSONDecodeError as e:
1229	                    print(f&quot;[ComfyUI-Manager] Error decoding component file in file {json_file}: {e}&quot;)
1230	
1231	        return web.json_response(components)
1232	    except Exception as e:
1233	        print(f&quot;[ComfyUI-Manager] failed to load components\n{e}&quot;)
1234	        return web.Response(status=400)
1235	
</pre>
</div>


</div>
</div>

<div id="issue-35">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>3<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import datetime
2	import os
3	import subprocess
4	import sys
5	import atexit
6	import threading
7	import re
8	import locale
9	import platform
10	import json
11	
12	
13	glob_path = os.path.join(os.path.dirname(__file__), &quot;glob&quot;)
14	sys.path.append(glob_path)
15	
16	from manager_util import *
17	import cm_global
18	
19	
20	cm_global.pip_downgrade_blacklist = [&#x27;torch&#x27;, &#x27;torchsde&#x27;, &#x27;torchvision&#x27;, &#x27;transformers&#x27;, &#x27;safetensors&#x27;, &#x27;kornia&#x27;]
21	
22	
23	def skip_pip_spam(x):
24	    return (&#x27;Requirement already satisfied:&#x27; in x) or (&quot;DEPRECATION: Loading egg at&quot; in x)
25	
26	
27	message_collapses = [skip_pip_spam]
28	import_failed_extensions = set()
29	cm_global.variables[&#x27;cm.on_revision_detected_handler&#x27;] = []
30	enable_file_logging = True
31	
32	
33	def register_message_collapse(f):
34	    global message_collapses
35	    message_collapses.append(f)
36	
37	
38	def is_import_failed_extension(name):
39	    global import_failed_extensions
40	    return name in import_failed_extensions
41	
42	
43	def check_file_logging():
44	    global enable_file_logging
45	    try:
46	        import configparser
47	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
48	        config = configparser.ConfigParser()
49	        config.read(config_path)
50	        default_conf = config[&#x27;default&#x27;]
51	
52	        if &#x27;file_logging&#x27; in default_conf and default_conf[&#x27;file_logging&#x27;].lower() == &#x27;false&#x27;:
53	            enable_file_logging = False
54	    except Exception:
55	        pass
56	
57	
58	check_file_logging()
59	
60	
61	sys.__comfyui_manager_register_message_collapse = register_message_collapse
62	sys.__comfyui_manager_is_import_failed_extension = is_import_failed_extension
63	cm_global.register_api(&#x27;cm.register_message_collapse&#x27;, register_message_collapse)
64	cm_global.register_api(&#x27;cm.is_import_failed_extension&#x27;, is_import_failed_extension)
65	
66	
67	comfyui_manager_path = os.path.dirname(__file__)
68	custom_nodes_path = os.path.abspath(os.path.join(comfyui_manager_path, &quot;..&quot;))
69	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
70	restore_snapshot_path = os.path.join(startup_script_path, &quot;restore-snapshot.json&quot;)
71	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
72	pip_overrides_path = os.path.join(comfyui_manager_path, &quot;pip_overrides.json&quot;)
73	
74	
75	cm_global.pip_overrides = {}
76	if os.path.exists(pip_overrides_path):
77	    with open(pip_overrides_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
78	        cm_global.pip_overrides = json.load(json_file)
79	
80	
81	def remap_pip_package(pkg):
82	    if pkg in cm_global.pip_overrides:
83	        res = cm_global.pip_overrides[pkg]
84	        print(f&quot;[ComfyUI-Manager] &#x27;{pkg}&#x27; is remapped to &#x27;{res}&#x27;&quot;)
85	        return res
86	    else:
87	        return pkg
88	
89	
90	std_log_lock = threading.Lock()
91	
92	
93	class TerminalHook:
94	    def __init__(self):
95	        self.hooks = {}
96	
97	    def add_hook(self, k, v):
98	        self.hooks[k] = v
99	
100	    def remove_hook(self, k):
101	        if k in self.hooks:
102	            del self.hooks[k]
103	
104	    def write_stderr(self, msg):
105	        for v in self.hooks.values():
106	            try:
107	                v.write_stderr(msg)
108	            except Exception:
109	                pass
110	
111	    def write_stdout(self, msg):
112	        for v in self.hooks.values():
113	            try:
114	                v.write_stdout(msg)
115	            except Exception:
116	                pass
117	
118	
119	terminal_hook = TerminalHook()
120	sys.__comfyui_manager_terminal_hook = terminal_hook
</pre>
</div>


</div>
</div>

<div id="issue-36">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>54<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
1	import datetime
2	import os
3	import subprocess
4	import sys
5	import atexit
6	import threading
7	import re
8	import locale
9	import platform
10	import json
11	
12	
13	glob_path = os.path.join(os.path.dirname(__file__), &quot;glob&quot;)
14	sys.path.append(glob_path)
15	
16	from manager_util import *
17	import cm_global
18	
19	
20	cm_global.pip_downgrade_blacklist = [&#x27;torch&#x27;, &#x27;torchsde&#x27;, &#x27;torchvision&#x27;, &#x27;transformers&#x27;, &#x27;safetensors&#x27;, &#x27;kornia&#x27;]
21	
22	
23	def skip_pip_spam(x):
24	    return (&#x27;Requirement already satisfied:&#x27; in x) or (&quot;DEPRECATION: Loading egg at&quot; in x)
25	
26	
27	message_collapses = [skip_pip_spam]
28	import_failed_extensions = set()
29	cm_global.variables[&#x27;cm.on_revision_detected_handler&#x27;] = []
30	enable_file_logging = True
31	
32	
33	def register_message_collapse(f):
34	    global message_collapses
35	    message_collapses.append(f)
36	
37	
38	def is_import_failed_extension(name):
39	    global import_failed_extensions
40	    return name in import_failed_extensions
41	
42	
43	def check_file_logging():
44	    global enable_file_logging
45	    try:
46	        import configparser
47	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
48	        config = configparser.ConfigParser()
49	        config.read(config_path)
50	        default_conf = config[&#x27;default&#x27;]
51	
52	        if &#x27;file_logging&#x27; in default_conf and default_conf[&#x27;file_logging&#x27;].lower() == &#x27;false&#x27;:
53	            enable_file_logging = False
54	    except Exception:
55	        pass
56	
57	
58	check_file_logging()
59	
60	
61	sys.__comfyui_manager_register_message_collapse = register_message_collapse
62	sys.__comfyui_manager_is_import_failed_extension = is_import_failed_extension
63	cm_global.register_api(&#x27;cm.register_message_collapse&#x27;, register_message_collapse)
64	cm_global.register_api(&#x27;cm.is_import_failed_extension&#x27;, is_import_failed_extension)
65	
66	
67	comfyui_manager_path = os.path.dirname(__file__)
68	custom_nodes_path = os.path.abspath(os.path.join(comfyui_manager_path, &quot;..&quot;))
69	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
70	restore_snapshot_path = os.path.join(startup_script_path, &quot;restore-snapshot.json&quot;)
71	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
72	pip_overrides_path = os.path.join(comfyui_manager_path, &quot;pip_overrides.json&quot;)
73	
74	
75	cm_global.pip_overrides = {}
76	if os.path.exists(pip_overrides_path):
77	    with open(pip_overrides_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
78	        cm_global.pip_overrides = json.load(json_file)
79	
80	
81	def remap_pip_package(pkg):
82	    if pkg in cm_global.pip_overrides:
83	        res = cm_global.pip_overrides[pkg]
84	        print(f&quot;[ComfyUI-Manager] &#x27;{pkg}&#x27; is remapped to &#x27;{res}&#x27;&quot;)
85	        return res
86	    else:
87	        return pkg
88	
89	
90	std_log_lock = threading.Lock()
91	
92	
93	class TerminalHook:
94	    def __init__(self):
95	        self.hooks = {}
96	
97	    def add_hook(self, k, v):
98	        self.hooks[k] = v
99	
100	    def remove_hook(self, k):
101	        if k in self.hooks:
102	            del self.hooks[k]
103	
104	    def write_stderr(self, msg):
105	        for v in self.hooks.values():
106	            try:
107	                v.write_stderr(msg)
108	            except Exception:
109	                pass
110	
111	    def write_stdout(self, msg):
112	        for v in self.hooks.values():
113	            try:
114	                v.write_stdout(msg)
115	            except Exception:
116	                pass
117	
118	
119	terminal_hook = TerminalHook()
120	sys.__comfyui_manager_terminal_hook = terminal_hook
121	
</pre>
</div>


</div>
</div>

<div id="issue-37">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>108<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
48	        config = configparser.ConfigParser()
49	        config.read(config_path)
50	        default_conf = config[&#x27;default&#x27;]
51	
52	        if &#x27;file_logging&#x27; in default_conf and default_conf[&#x27;file_logging&#x27;].lower() == &#x27;false&#x27;:
53	            enable_file_logging = False
54	    except Exception:
55	        pass
56	
57	
58	check_file_logging()
59	
60	
61	sys.__comfyui_manager_register_message_collapse = register_message_collapse
62	sys.__comfyui_manager_is_import_failed_extension = is_import_failed_extension
63	cm_global.register_api(&#x27;cm.register_message_collapse&#x27;, register_message_collapse)
64	cm_global.register_api(&#x27;cm.is_import_failed_extension&#x27;, is_import_failed_extension)
65	
66	
67	comfyui_manager_path = os.path.dirname(__file__)
68	custom_nodes_path = os.path.abspath(os.path.join(comfyui_manager_path, &quot;..&quot;))
69	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
70	restore_snapshot_path = os.path.join(startup_script_path, &quot;restore-snapshot.json&quot;)
71	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
72	pip_overrides_path = os.path.join(comfyui_manager_path, &quot;pip_overrides.json&quot;)
73	
74	
75	cm_global.pip_overrides = {}
76	if os.path.exists(pip_overrides_path):
77	    with open(pip_overrides_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
78	        cm_global.pip_overrides = json.load(json_file)
79	
80	
81	def remap_pip_package(pkg):
82	    if pkg in cm_global.pip_overrides:
83	        res = cm_global.pip_overrides[pkg]
84	        print(f&quot;[ComfyUI-Manager] &#x27;{pkg}&#x27; is remapped to &#x27;{res}&#x27;&quot;)
85	        return res
86	    else:
87	        return pkg
88	
89	
90	std_log_lock = threading.Lock()
91	
92	
93	class TerminalHook:
94	    def __init__(self):
95	        self.hooks = {}
96	
97	    def add_hook(self, k, v):
98	        self.hooks[k] = v
99	
100	    def remove_hook(self, k):
101	        if k in self.hooks:
102	            del self.hooks[k]
103	
104	    def write_stderr(self, msg):
105	        for v in self.hooks.values():
106	            try:
107	                v.write_stderr(msg)
108	            except Exception:
109	                pass
110	
111	    def write_stdout(self, msg):
112	        for v in self.hooks.values():
113	            try:
114	                v.write_stdout(msg)
115	            except Exception:
116	                pass
117	
118	
119	terminal_hook = TerminalHook()
120	sys.__comfyui_manager_terminal_hook = terminal_hook
121	
122	
123	def handle_stream(stream, prefix):
124	    stream.reconfigure(encoding=locale.getpreferredencoding(), errors=&#x27;replace&#x27;)
125	    for msg in stream:
126	        if prefix == &#x27;[!]&#x27; and (&#x27;it/s]&#x27; in msg or &#x27;s/it]&#x27; in msg) and (&#x27;%|&#x27; in msg or &#x27;it [&#x27; in msg):
127	            if msg.startswith(&#x27;100%&#x27;):
128	                print(&#x27;\r&#x27; + msg, end=&quot;&quot;, file=sys.stderr),
129	            else:
130	                print(&#x27;\r&#x27; + msg[:-1], end=&quot;&quot;, file=sys.stderr),
131	        else:
132	            if prefix == &#x27;[!]&#x27;:
133	                print(prefix, msg, end=&quot;&quot;, file=sys.stderr)
134	            else:
135	                print(prefix, msg, end=&quot;&quot;)
136	
137	
138	def process_wrap(cmd_str, cwd_path, handler=None):
139	    process = subprocess.Popen(cmd_str, cwd=cwd_path, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True, bufsize=1)
140	
141	    if handler is None:
142	        handler = handle_stream
143	
144	    stdout_thread = threading.Thread(target=handler, args=(process.stdout, &quot;&quot;))
145	    stderr_thread = threading.Thread(target=handler, args=(process.stderr, &quot;[!]&quot;))
146	
147	    stdout_thread.start()
148	    stderr_thread.start()
149	
150	    stdout_thread.join()
151	    stderr_thread.join()
152	
153	    return process.wait()
154	
155	
156	try:
157	    if &#x27;--port&#x27; in sys.argv:
158	        port_index = sys.argv.index(&#x27;--port&#x27;)
159	        if port_index + 1 &lt; len(sys.argv):
160	            port = int(sys.argv[port_index + 1])
161	            postfix = f&quot;_{port}&quot;
162	    else:
163	        postfix = &quot;&quot;
164	
165	    # Logger setup
166	    if enable_file_logging:
167	        if os.path.exists(f&quot;comfyui{postfix}.log&quot;):
168	            if os.path.exists(f&quot;comfyui{postfix}.prev.log&quot;):
</pre>
</div>


</div>
</div>

<div id="issue-38">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>115<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
55	        pass
56	
57	
58	check_file_logging()
59	
60	
61	sys.__comfyui_manager_register_message_collapse = register_message_collapse
62	sys.__comfyui_manager_is_import_failed_extension = is_import_failed_extension
63	cm_global.register_api(&#x27;cm.register_message_collapse&#x27;, register_message_collapse)
64	cm_global.register_api(&#x27;cm.is_import_failed_extension&#x27;, is_import_failed_extension)
65	
66	
67	comfyui_manager_path = os.path.dirname(__file__)
68	custom_nodes_path = os.path.abspath(os.path.join(comfyui_manager_path, &quot;..&quot;))
69	startup_script_path = os.path.join(comfyui_manager_path, &quot;startup-scripts&quot;)
70	restore_snapshot_path = os.path.join(startup_script_path, &quot;restore-snapshot.json&quot;)
71	git_script_path = os.path.join(comfyui_manager_path, &quot;git_helper.py&quot;)
72	pip_overrides_path = os.path.join(comfyui_manager_path, &quot;pip_overrides.json&quot;)
73	
74	
75	cm_global.pip_overrides = {}
76	if os.path.exists(pip_overrides_path):
77	    with open(pip_overrides_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as json_file:
78	        cm_global.pip_overrides = json.load(json_file)
79	
80	
81	def remap_pip_package(pkg):
82	    if pkg in cm_global.pip_overrides:
83	        res = cm_global.pip_overrides[pkg]
84	        print(f&quot;[ComfyUI-Manager] &#x27;{pkg}&#x27; is remapped to &#x27;{res}&#x27;&quot;)
85	        return res
86	    else:
87	        return pkg
88	
89	
90	std_log_lock = threading.Lock()
91	
92	
93	class TerminalHook:
94	    def __init__(self):
95	        self.hooks = {}
96	
97	    def add_hook(self, k, v):
98	        self.hooks[k] = v
99	
100	    def remove_hook(self, k):
101	        if k in self.hooks:
102	            del self.hooks[k]
103	
104	    def write_stderr(self, msg):
105	        for v in self.hooks.values():
106	            try:
107	                v.write_stderr(msg)
108	            except Exception:
109	                pass
110	
111	    def write_stdout(self, msg):
112	        for v in self.hooks.values():
113	            try:
114	                v.write_stdout(msg)
115	            except Exception:
116	                pass
117	
118	
119	terminal_hook = TerminalHook()
120	sys.__comfyui_manager_terminal_hook = terminal_hook
121	
122	
123	def handle_stream(stream, prefix):
124	    stream.reconfigure(encoding=locale.getpreferredencoding(), errors=&#x27;replace&#x27;)
125	    for msg in stream:
126	        if prefix == &#x27;[!]&#x27; and (&#x27;it/s]&#x27; in msg or &#x27;s/it]&#x27; in msg) and (&#x27;%|&#x27; in msg or &#x27;it [&#x27; in msg):
127	            if msg.startswith(&#x27;100%&#x27;):
128	                print(&#x27;\r&#x27; + msg, end=&quot;&quot;, file=sys.stderr),
129	            else:
130	                print(&#x27;\r&#x27; + msg[:-1], end=&quot;&quot;, file=sys.stderr),
131	        else:
132	            if prefix == &#x27;[!]&#x27;:
133	                print(prefix, msg, end=&quot;&quot;, file=sys.stderr)
134	            else:
135	                print(prefix, msg, end=&quot;&quot;)
136	
137	
138	def process_wrap(cmd_str, cwd_path, handler=None):
139	    process = subprocess.Popen(cmd_str, cwd=cwd_path, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True, bufsize=1)
140	
141	    if handler is None:
142	        handler = handle_stream
143	
144	    stdout_thread = threading.Thread(target=handler, args=(process.stdout, &quot;&quot;))
145	    stderr_thread = threading.Thread(target=handler, args=(process.stderr, &quot;[!]&quot;))
146	
147	    stdout_thread.start()
148	    stderr_thread.start()
149	
150	    stdout_thread.join()
151	    stderr_thread.join()
152	
153	    return process.wait()
154	
155	
156	try:
157	    if &#x27;--port&#x27; in sys.argv:
158	        port_index = sys.argv.index(&#x27;--port&#x27;)
159	        if port_index + 1 &lt; len(sys.argv):
160	            port = int(sys.argv[port_index + 1])
161	            postfix = f&quot;_{port}&quot;
162	    else:
163	        postfix = &quot;&quot;
164	
165	    # Logger setup
166	    if enable_file_logging:
167	        if os.path.exists(f&quot;comfyui{postfix}.log&quot;):
168	            if os.path.exists(f&quot;comfyui{postfix}.prev.log&quot;):
169	                if os.path.exists(f&quot;comfyui{postfix}.prev2.log&quot;):
170	                    os.remove(f&quot;comfyui{postfix}.prev2.log&quot;)
171	                os.rename(f&quot;comfyui{postfix}.prev.log&quot;, f&quot;comfyui{postfix}.prev2.log&quot;)
172	            os.rename(f&quot;comfyui{postfix}.log&quot;, f&quot;comfyui{postfix}.prev.log&quot;)
173	
174	        log_file = open(f&quot;comfyui{postfix}.log&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;, errors=&quot;ignore&quot;)
175	
</pre>
</div>


</div>
</div>

<div id="issue-39">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>139<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
79	
80	
81	def remap_pip_package(pkg):
82	    if pkg in cm_global.pip_overrides:
83	        res = cm_global.pip_overrides[pkg]
84	        print(f&quot;[ComfyUI-Manager] &#x27;{pkg}&#x27; is remapped to &#x27;{res}&#x27;&quot;)
85	        return res
86	    else:
87	        return pkg
88	
89	
90	std_log_lock = threading.Lock()
91	
92	
93	class TerminalHook:
94	    def __init__(self):
95	        self.hooks = {}
96	
97	    def add_hook(self, k, v):
98	        self.hooks[k] = v
99	
100	    def remove_hook(self, k):
101	        if k in self.hooks:
102	            del self.hooks[k]
103	
104	    def write_stderr(self, msg):
105	        for v in self.hooks.values():
106	            try:
107	                v.write_stderr(msg)
108	            except Exception:
109	                pass
110	
111	    def write_stdout(self, msg):
112	        for v in self.hooks.values():
113	            try:
114	                v.write_stdout(msg)
115	            except Exception:
116	                pass
117	
118	
119	terminal_hook = TerminalHook()
120	sys.__comfyui_manager_terminal_hook = terminal_hook
121	
122	
123	def handle_stream(stream, prefix):
124	    stream.reconfigure(encoding=locale.getpreferredencoding(), errors=&#x27;replace&#x27;)
125	    for msg in stream:
126	        if prefix == &#x27;[!]&#x27; and (&#x27;it/s]&#x27; in msg or &#x27;s/it]&#x27; in msg) and (&#x27;%|&#x27; in msg or &#x27;it [&#x27; in msg):
127	            if msg.startswith(&#x27;100%&#x27;):
128	                print(&#x27;\r&#x27; + msg, end=&quot;&quot;, file=sys.stderr),
129	            else:
130	                print(&#x27;\r&#x27; + msg[:-1], end=&quot;&quot;, file=sys.stderr),
131	        else:
132	            if prefix == &#x27;[!]&#x27;:
133	                print(prefix, msg, end=&quot;&quot;, file=sys.stderr)
134	            else:
135	                print(prefix, msg, end=&quot;&quot;)
136	
137	
138	def process_wrap(cmd_str, cwd_path, handler=None):
139	    process = subprocess.Popen(cmd_str, cwd=cwd_path, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True, bufsize=1)
140	
141	    if handler is None:
142	        handler = handle_stream
143	
144	    stdout_thread = threading.Thread(target=handler, args=(process.stdout, &quot;&quot;))
145	    stderr_thread = threading.Thread(target=handler, args=(process.stderr, &quot;[!]&quot;))
146	
147	    stdout_thread.start()
148	    stderr_thread.start()
149	
150	    stdout_thread.join()
151	    stderr_thread.join()
152	
153	    return process.wait()
154	
155	
156	try:
157	    if &#x27;--port&#x27; in sys.argv:
158	        port_index = sys.argv.index(&#x27;--port&#x27;)
159	        if port_index + 1 &lt; len(sys.argv):
160	            port = int(sys.argv[port_index + 1])
161	            postfix = f&quot;_{port}&quot;
162	    else:
163	        postfix = &quot;&quot;
164	
165	    # Logger setup
166	    if enable_file_logging:
167	        if os.path.exists(f&quot;comfyui{postfix}.log&quot;):
168	            if os.path.exists(f&quot;comfyui{postfix}.prev.log&quot;):
169	                if os.path.exists(f&quot;comfyui{postfix}.prev2.log&quot;):
170	                    os.remove(f&quot;comfyui{postfix}.prev2.log&quot;)
171	                os.rename(f&quot;comfyui{postfix}.prev.log&quot;, f&quot;comfyui{postfix}.prev2.log&quot;)
172	            os.rename(f&quot;comfyui{postfix}.log&quot;, f&quot;comfyui{postfix}.prev.log&quot;)
173	
174	        log_file = open(f&quot;comfyui{postfix}.log&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;, errors=&quot;ignore&quot;)
175	
176	    log_lock = threading.Lock()
177	
178	    original_stdout = sys.stdout
179	    original_stderr = sys.stderr
180	
181	    if original_stdout.encoding.lower() == &#x27;utf-8&#x27;:
182	        write_stdout = original_stdout.write
183	        write_stderr = original_stderr.write
184	    else:
185	        def wrapper_stdout(msg):
186	            original_stdout.write(msg.encode(&#x27;utf-8&#x27;).decode(original_stdout.encoding, errors=&quot;ignore&quot;))
187	            
188	        def wrapper_stderr(msg):
189	            original_stderr.write(msg.encode(&#x27;utf-8&#x27;).decode(original_stderr.encoding, errors=&quot;ignore&quot;))
190	
191	        write_stdout = wrapper_stdout
192	        write_stderr = wrapper_stderr
193	
194	    pat_tqdm = r&#x27;\d+%.*\[(.*?)\]&#x27;
195	    pat_import_fail = r&#x27;seconds \(IMPORT FAILED\):.*[/\\]custom_nodes[/\\](.*)$&#x27;
196	
197	    is_start_mode = True
198	
</pre>
</div>


</div>
</div>

<div id="issue-40">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>311<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
251	                log_file.flush()
252	                self.last_char = message if message == &#x27;&#x27; else message[-1]
253	
254	            with std_log_lock:
255	                if self.is_stdout:
256	                    write_stdout(message)
257	                    original_stdout.flush()
258	                    terminal_hook.write_stderr(message)
259	                else:
260	                    write_stderr(message)
261	                    original_stderr.flush()
262	                    terminal_hook.write_stdout(message)
263	
264	        def flush(self):
265	            log_file.flush()
266	
267	            with std_log_lock:
268	                if self.is_stdout:
269	                    original_stdout.flush()
270	                else:
271	                    original_stderr.flush()
272	
273	        def close(self):
274	            self.flush()
275	
276	        def reconfigure(self, *args, **kwargs):
277	            pass
278	
279	        # You can close through sys.stderr.close_log()
280	        def close_log(self):
281	            sys.stderr = original_stderr
282	            sys.stdout = original_stdout
283	            log_file.close()
284	            
285	    def close_log():
286	        sys.stderr = original_stderr
287	        sys.stdout = original_stdout
288	        log_file.close()
289	
290	
291	    if enable_file_logging:
292	        sys.stdout = ComfyUIManagerLogger(True)
293	        sys.stderr = ComfyUIManagerLogger(False)
294	
295	        atexit.register(close_log)
296	    else:
297	        sys.stdout.close_log = lambda: None
298	
299	except Exception as e:
300	    print(f&quot;[ComfyUI-Manager] Logging failed: {e}&quot;)
301	
302	
303	try:
304	    import git
305	except ModuleNotFoundError:
306	    my_path = os.path.dirname(__file__)
307	    requirements_path = os.path.join(my_path, &quot;requirements.txt&quot;)
308	
309	    print(f&quot;## ComfyUI-Manager: installing dependencies. (GitPython)&quot;)
310	    try:
311	        result = subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;-r&#x27;, requirements_path])
312	    except subprocess.CalledProcessError as e:
313	        print(f&quot;## [ERROR] ComfyUI-Manager: Attempting to reinstall dependencies using an alternative method.&quot;)
314	        try:
315	            result = subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;--user&#x27;, &#x27;-r&#x27;, requirements_path])
316	        except subprocess.CalledProcessError as e:
317	            print(f&quot;## [ERROR] ComfyUI-Manager: Failed to install the GitPython package in the correct Python environment. Please install it manually in the appropriate environment. (You can seek help at https://app.element.io/#/room/%23comfyui_space%3Amatrix.org)&quot;)
318	
319	try:
320	    import git
321	    print(f&quot;## ComfyUI-Manager: installing dependencies done.&quot;)
322	except:
323	    # maybe we should sys.exit() here? there is at least two screens worth of error messages still being pumped after our error messages
324	    print(f&quot;## [ERROR] ComfyUI-Manager: GitPython package seems to be installed, but failed to load somehow. Make sure you have a working git client installed&quot;)
325	
326	
327	print(&quot;** ComfyUI startup time:&quot;, datetime.datetime.now())
328	print(&quot;** Platform:&quot;, platform.system())
329	print(&quot;** Python version:&quot;, sys.version)
330	print(&quot;** Python executable:&quot;, sys.executable)
331	
332	if enable_file_logging:
333	    print(&quot;** Log path:&quot;, os.path.abspath(&#x27;comfyui.log&#x27;))
334	else:
335	    print(&quot;** Log path: file logging is disabled&quot;)
336	
337	
338	def read_downgrade_blacklist():
339	    try:
340	        import configparser
341	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
342	        config = configparser.ConfigParser()
343	        config.read(config_path)
344	        default_conf = config[&#x27;default&#x27;]
345	
346	        if &#x27;downgrade_blacklist&#x27; in default_conf:
347	            items = default_conf[&#x27;downgrade_blacklist&#x27;].split(&#x27;,&#x27;)
348	            items = [x.strip() for x in items if x != &#x27;&#x27;]
349	            cm_global.pip_downgrade_blacklist += items
350	            cm_global.pip_downgrade_blacklist = list(set(cm_global.pip_downgrade_blacklist))
351	    except:
352	        pass
353	
354	
355	read_downgrade_blacklist()
356	
357	
358	def check_bypass_ssl():
359	    try:
360	        import configparser
361	        import ssl
362	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
363	        config = configparser.ConfigParser()
364	        config.read(config_path)
365	        default_conf = config[&#x27;default&#x27;]
366	
367	        if &#x27;bypass_ssl&#x27; in default_conf and default_conf[&#x27;bypass_ssl&#x27;].lower() == &#x27;true&#x27;:
368	            print(f&quot;[ComfyUI-Manager] WARN: Unsafe - SSL verification bypass option is Enabled. (see ComfyUI-Manager/config.ini)&quot;)
369	            ssl._create_default_https_context = ssl._create_unverified_context  # SSL certificate error fix.
370	    except Exception:
</pre>
</div>


</div>
</div>

<div id="issue-41">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>315<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
255	                if self.is_stdout:
256	                    write_stdout(message)
257	                    original_stdout.flush()
258	                    terminal_hook.write_stderr(message)
259	                else:
260	                    write_stderr(message)
261	                    original_stderr.flush()
262	                    terminal_hook.write_stdout(message)
263	
264	        def flush(self):
265	            log_file.flush()
266	
267	            with std_log_lock:
268	                if self.is_stdout:
269	                    original_stdout.flush()
270	                else:
271	                    original_stderr.flush()
272	
273	        def close(self):
274	            self.flush()
275	
276	        def reconfigure(self, *args, **kwargs):
277	            pass
278	
279	        # You can close through sys.stderr.close_log()
280	        def close_log(self):
281	            sys.stderr = original_stderr
282	            sys.stdout = original_stdout
283	            log_file.close()
284	            
285	    def close_log():
286	        sys.stderr = original_stderr
287	        sys.stdout = original_stdout
288	        log_file.close()
289	
290	
291	    if enable_file_logging:
292	        sys.stdout = ComfyUIManagerLogger(True)
293	        sys.stderr = ComfyUIManagerLogger(False)
294	
295	        atexit.register(close_log)
296	    else:
297	        sys.stdout.close_log = lambda: None
298	
299	except Exception as e:
300	    print(f&quot;[ComfyUI-Manager] Logging failed: {e}&quot;)
301	
302	
303	try:
304	    import git
305	except ModuleNotFoundError:
306	    my_path = os.path.dirname(__file__)
307	    requirements_path = os.path.join(my_path, &quot;requirements.txt&quot;)
308	
309	    print(f&quot;## ComfyUI-Manager: installing dependencies. (GitPython)&quot;)
310	    try:
311	        result = subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;-r&#x27;, requirements_path])
312	    except subprocess.CalledProcessError as e:
313	        print(f&quot;## [ERROR] ComfyUI-Manager: Attempting to reinstall dependencies using an alternative method.&quot;)
314	        try:
315	            result = subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;--user&#x27;, &#x27;-r&#x27;, requirements_path])
316	        except subprocess.CalledProcessError as e:
317	            print(f&quot;## [ERROR] ComfyUI-Manager: Failed to install the GitPython package in the correct Python environment. Please install it manually in the appropriate environment. (You can seek help at https://app.element.io/#/room/%23comfyui_space%3Amatrix.org)&quot;)
318	
319	try:
320	    import git
321	    print(f&quot;## ComfyUI-Manager: installing dependencies done.&quot;)
322	except:
323	    # maybe we should sys.exit() here? there is at least two screens worth of error messages still being pumped after our error messages
324	    print(f&quot;## [ERROR] ComfyUI-Manager: GitPython package seems to be installed, but failed to load somehow. Make sure you have a working git client installed&quot;)
325	
326	
327	print(&quot;** ComfyUI startup time:&quot;, datetime.datetime.now())
328	print(&quot;** Platform:&quot;, platform.system())
329	print(&quot;** Python version:&quot;, sys.version)
330	print(&quot;** Python executable:&quot;, sys.executable)
331	
332	if enable_file_logging:
333	    print(&quot;** Log path:&quot;, os.path.abspath(&#x27;comfyui.log&#x27;))
334	else:
335	    print(&quot;** Log path: file logging is disabled&quot;)
336	
337	
338	def read_downgrade_blacklist():
339	    try:
340	        import configparser
341	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
342	        config = configparser.ConfigParser()
343	        config.read(config_path)
344	        default_conf = config[&#x27;default&#x27;]
345	
346	        if &#x27;downgrade_blacklist&#x27; in default_conf:
347	            items = default_conf[&#x27;downgrade_blacklist&#x27;].split(&#x27;,&#x27;)
348	            items = [x.strip() for x in items if x != &#x27;&#x27;]
349	            cm_global.pip_downgrade_blacklist += items
350	            cm_global.pip_downgrade_blacklist = list(set(cm_global.pip_downgrade_blacklist))
351	    except:
352	        pass
353	
354	
355	read_downgrade_blacklist()
356	
357	
358	def check_bypass_ssl():
359	    try:
360	        import configparser
361	        import ssl
362	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
363	        config = configparser.ConfigParser()
364	        config.read(config_path)
365	        default_conf = config[&#x27;default&#x27;]
366	
367	        if &#x27;bypass_ssl&#x27; in default_conf and default_conf[&#x27;bypass_ssl&#x27;].lower() == &#x27;true&#x27;:
368	            print(f&quot;[ComfyUI-Manager] WARN: Unsafe - SSL verification bypass option is Enabled. (see ComfyUI-Manager/config.ini)&quot;)
369	            ssl._create_default_https_context = ssl._create_unverified_context  # SSL certificate error fix.
370	    except Exception:
371	        pass
372	
373	
374	check_bypass_ssl()
</pre>
</div>


</div>
</div>

<div id="issue-42">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>351<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
291	    if enable_file_logging:
292	        sys.stdout = ComfyUIManagerLogger(True)
293	        sys.stderr = ComfyUIManagerLogger(False)
294	
295	        atexit.register(close_log)
296	    else:
297	        sys.stdout.close_log = lambda: None
298	
299	except Exception as e:
300	    print(f&quot;[ComfyUI-Manager] Logging failed: {e}&quot;)
301	
302	
303	try:
304	    import git
305	except ModuleNotFoundError:
306	    my_path = os.path.dirname(__file__)
307	    requirements_path = os.path.join(my_path, &quot;requirements.txt&quot;)
308	
309	    print(f&quot;## ComfyUI-Manager: installing dependencies. (GitPython)&quot;)
310	    try:
311	        result = subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;-r&#x27;, requirements_path])
312	    except subprocess.CalledProcessError as e:
313	        print(f&quot;## [ERROR] ComfyUI-Manager: Attempting to reinstall dependencies using an alternative method.&quot;)
314	        try:
315	            result = subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;--user&#x27;, &#x27;-r&#x27;, requirements_path])
316	        except subprocess.CalledProcessError as e:
317	            print(f&quot;## [ERROR] ComfyUI-Manager: Failed to install the GitPython package in the correct Python environment. Please install it manually in the appropriate environment. (You can seek help at https://app.element.io/#/room/%23comfyui_space%3Amatrix.org)&quot;)
318	
319	try:
320	    import git
321	    print(f&quot;## ComfyUI-Manager: installing dependencies done.&quot;)
322	except:
323	    # maybe we should sys.exit() here? there is at least two screens worth of error messages still being pumped after our error messages
324	    print(f&quot;## [ERROR] ComfyUI-Manager: GitPython package seems to be installed, but failed to load somehow. Make sure you have a working git client installed&quot;)
325	
326	
327	print(&quot;** ComfyUI startup time:&quot;, datetime.datetime.now())
328	print(&quot;** Platform:&quot;, platform.system())
329	print(&quot;** Python version:&quot;, sys.version)
330	print(&quot;** Python executable:&quot;, sys.executable)
331	
332	if enable_file_logging:
333	    print(&quot;** Log path:&quot;, os.path.abspath(&#x27;comfyui.log&#x27;))
334	else:
335	    print(&quot;** Log path: file logging is disabled&quot;)
336	
337	
338	def read_downgrade_blacklist():
339	    try:
340	        import configparser
341	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
342	        config = configparser.ConfigParser()
343	        config.read(config_path)
344	        default_conf = config[&#x27;default&#x27;]
345	
346	        if &#x27;downgrade_blacklist&#x27; in default_conf:
347	            items = default_conf[&#x27;downgrade_blacklist&#x27;].split(&#x27;,&#x27;)
348	            items = [x.strip() for x in items if x != &#x27;&#x27;]
349	            cm_global.pip_downgrade_blacklist += items
350	            cm_global.pip_downgrade_blacklist = list(set(cm_global.pip_downgrade_blacklist))
351	    except:
352	        pass
353	
354	
355	read_downgrade_blacklist()
356	
357	
358	def check_bypass_ssl():
359	    try:
360	        import configparser
361	        import ssl
362	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
363	        config = configparser.ConfigParser()
364	        config.read(config_path)
365	        default_conf = config[&#x27;default&#x27;]
366	
367	        if &#x27;bypass_ssl&#x27; in default_conf and default_conf[&#x27;bypass_ssl&#x27;].lower() == &#x27;true&#x27;:
368	            print(f&quot;[ComfyUI-Manager] WARN: Unsafe - SSL verification bypass option is Enabled. (see ComfyUI-Manager/config.ini)&quot;)
369	            ssl._create_default_https_context = ssl._create_unverified_context  # SSL certificate error fix.
370	    except Exception:
371	        pass
372	
373	
374	check_bypass_ssl()
375	
376	
377	# Perform install
378	processed_install = set()
379	script_list_path = os.path.join(os.path.dirname(os.path.realpath(__file__)), &quot;startup-scripts&quot;, &quot;install-scripts.txt&quot;)
380	pip_map = None
381	
382	
383	def get_installed_packages():
384	    global pip_map
385	
386	    if pip_map is None:
387	        try:
388	            result = subprocess.check_output([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;list&#x27;], universal_newlines=True)
389	
390	            pip_map = {}
391	            for line in result.split(&#x27;\n&#x27;):
392	                x = line.strip()
393	                if x:
394	                    y = line.split()
395	                    if y[0] == &#x27;Package&#x27; or y[0].startswith(&#x27;-&#x27;):
396	                        continue
397	
398	                    pip_map[y[0]] = y[1]
399	        except subprocess.CalledProcessError as e:
400	            print(f&quot;[ComfyUI-Manager] Failed to retrieve the information of installed pip packages.&quot;)
401	            return set()
402	
403	    return pip_map
404	
405	
406	def is_installed(name):
407	    name = name.strip()
408	
409	    if name.startswith(&#x27;#&#x27;):
410	        return True
411	
</pre>
</div>


</div>
</div>

<div id="issue-43">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>370<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
310	    try:
311	        result = subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;-r&#x27;, requirements_path])
312	    except subprocess.CalledProcessError as e:
313	        print(f&quot;## [ERROR] ComfyUI-Manager: Attempting to reinstall dependencies using an alternative method.&quot;)
314	        try:
315	            result = subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;--user&#x27;, &#x27;-r&#x27;, requirements_path])
316	        except subprocess.CalledProcessError as e:
317	            print(f&quot;## [ERROR] ComfyUI-Manager: Failed to install the GitPython package in the correct Python environment. Please install it manually in the appropriate environment. (You can seek help at https://app.element.io/#/room/%23comfyui_space%3Amatrix.org)&quot;)
318	
319	try:
320	    import git
321	    print(f&quot;## ComfyUI-Manager: installing dependencies done.&quot;)
322	except:
323	    # maybe we should sys.exit() here? there is at least two screens worth of error messages still being pumped after our error messages
324	    print(f&quot;## [ERROR] ComfyUI-Manager: GitPython package seems to be installed, but failed to load somehow. Make sure you have a working git client installed&quot;)
325	
326	
327	print(&quot;** ComfyUI startup time:&quot;, datetime.datetime.now())
328	print(&quot;** Platform:&quot;, platform.system())
329	print(&quot;** Python version:&quot;, sys.version)
330	print(&quot;** Python executable:&quot;, sys.executable)
331	
332	if enable_file_logging:
333	    print(&quot;** Log path:&quot;, os.path.abspath(&#x27;comfyui.log&#x27;))
334	else:
335	    print(&quot;** Log path: file logging is disabled&quot;)
336	
337	
338	def read_downgrade_blacklist():
339	    try:
340	        import configparser
341	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
342	        config = configparser.ConfigParser()
343	        config.read(config_path)
344	        default_conf = config[&#x27;default&#x27;]
345	
346	        if &#x27;downgrade_blacklist&#x27; in default_conf:
347	            items = default_conf[&#x27;downgrade_blacklist&#x27;].split(&#x27;,&#x27;)
348	            items = [x.strip() for x in items if x != &#x27;&#x27;]
349	            cm_global.pip_downgrade_blacklist += items
350	            cm_global.pip_downgrade_blacklist = list(set(cm_global.pip_downgrade_blacklist))
351	    except:
352	        pass
353	
354	
355	read_downgrade_blacklist()
356	
357	
358	def check_bypass_ssl():
359	    try:
360	        import configparser
361	        import ssl
362	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
363	        config = configparser.ConfigParser()
364	        config.read(config_path)
365	        default_conf = config[&#x27;default&#x27;]
366	
367	        if &#x27;bypass_ssl&#x27; in default_conf and default_conf[&#x27;bypass_ssl&#x27;].lower() == &#x27;true&#x27;:
368	            print(f&quot;[ComfyUI-Manager] WARN: Unsafe - SSL verification bypass option is Enabled. (see ComfyUI-Manager/config.ini)&quot;)
369	            ssl._create_default_https_context = ssl._create_unverified_context  # SSL certificate error fix.
370	    except Exception:
371	        pass
372	
373	
374	check_bypass_ssl()
375	
376	
377	# Perform install
378	processed_install = set()
379	script_list_path = os.path.join(os.path.dirname(os.path.realpath(__file__)), &quot;startup-scripts&quot;, &quot;install-scripts.txt&quot;)
380	pip_map = None
381	
382	
383	def get_installed_packages():
384	    global pip_map
385	
386	    if pip_map is None:
387	        try:
388	            result = subprocess.check_output([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;list&#x27;], universal_newlines=True)
389	
390	            pip_map = {}
391	            for line in result.split(&#x27;\n&#x27;):
392	                x = line.strip()
393	                if x:
394	                    y = line.split()
395	                    if y[0] == &#x27;Package&#x27; or y[0].startswith(&#x27;-&#x27;):
396	                        continue
397	
398	                    pip_map[y[0]] = y[1]
399	        except subprocess.CalledProcessError as e:
400	            print(f&quot;[ComfyUI-Manager] Failed to retrieve the information of installed pip packages.&quot;)
401	            return set()
402	
403	    return pip_map
404	
405	
406	def is_installed(name):
407	    name = name.strip()
408	
409	    if name.startswith(&#x27;#&#x27;):
410	        return True
411	
412	    pattern = r&#x27;([^&lt;&gt;!=]+)([&lt;&gt;!=]=?)(.*)&#x27;
413	    match = re.search(pattern, name)
414	
415	    if match:
416	        name = match.group(1)
417	
418	    if name in cm_global.pip_downgrade_blacklist:
419	        pips = get_installed_packages()
420	
421	        if match is None:
422	            if name in pips:
423	                return True
424	        elif match.group(2) in [&#x27;&lt;=&#x27;, &#x27;==&#x27;, &#x27;&lt;&#x27;]:
425	            if name in pips:
426	                if StrictVersion(pips[name]) &gt;= StrictVersion(match.group(3)):
427	                    print(f&quot;[ComfyUI-Manager] skip black listed pip installation: &#x27;{name}&#x27;&quot;)
428	                    return True
429	
430	    return name.lower() in get_installed_packages()
</pre>
</div>


</div>
</div>

<div id="issue-44">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>388<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
328	print(&quot;** Platform:&quot;, platform.system())
329	print(&quot;** Python version:&quot;, sys.version)
330	print(&quot;** Python executable:&quot;, sys.executable)
331	
332	if enable_file_logging:
333	    print(&quot;** Log path:&quot;, os.path.abspath(&#x27;comfyui.log&#x27;))
334	else:
335	    print(&quot;** Log path: file logging is disabled&quot;)
336	
337	
338	def read_downgrade_blacklist():
339	    try:
340	        import configparser
341	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
342	        config = configparser.ConfigParser()
343	        config.read(config_path)
344	        default_conf = config[&#x27;default&#x27;]
345	
346	        if &#x27;downgrade_blacklist&#x27; in default_conf:
347	            items = default_conf[&#x27;downgrade_blacklist&#x27;].split(&#x27;,&#x27;)
348	            items = [x.strip() for x in items if x != &#x27;&#x27;]
349	            cm_global.pip_downgrade_blacklist += items
350	            cm_global.pip_downgrade_blacklist = list(set(cm_global.pip_downgrade_blacklist))
351	    except:
352	        pass
353	
354	
355	read_downgrade_blacklist()
356	
357	
358	def check_bypass_ssl():
359	    try:
360	        import configparser
361	        import ssl
362	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
363	        config = configparser.ConfigParser()
364	        config.read(config_path)
365	        default_conf = config[&#x27;default&#x27;]
366	
367	        if &#x27;bypass_ssl&#x27; in default_conf and default_conf[&#x27;bypass_ssl&#x27;].lower() == &#x27;true&#x27;:
368	            print(f&quot;[ComfyUI-Manager] WARN: Unsafe - SSL verification bypass option is Enabled. (see ComfyUI-Manager/config.ini)&quot;)
369	            ssl._create_default_https_context = ssl._create_unverified_context  # SSL certificate error fix.
370	    except Exception:
371	        pass
372	
373	
374	check_bypass_ssl()
375	
376	
377	# Perform install
378	processed_install = set()
379	script_list_path = os.path.join(os.path.dirname(os.path.realpath(__file__)), &quot;startup-scripts&quot;, &quot;install-scripts.txt&quot;)
380	pip_map = None
381	
382	
383	def get_installed_packages():
384	    global pip_map
385	
386	    if pip_map is None:
387	        try:
388	            result = subprocess.check_output([sys.executable, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;list&#x27;], universal_newlines=True)
389	
390	            pip_map = {}
391	            for line in result.split(&#x27;\n&#x27;):
392	                x = line.strip()
393	                if x:
394	                    y = line.split()
395	                    if y[0] == &#x27;Package&#x27; or y[0].startswith(&#x27;-&#x27;):
396	                        continue
397	
398	                    pip_map[y[0]] = y[1]
399	        except subprocess.CalledProcessError as e:
400	            print(f&quot;[ComfyUI-Manager] Failed to retrieve the information of installed pip packages.&quot;)
401	            return set()
402	
403	    return pip_map
404	
405	
406	def is_installed(name):
407	    name = name.strip()
408	
409	    if name.startswith(&#x27;#&#x27;):
410	        return True
411	
412	    pattern = r&#x27;([^&lt;&gt;!=]+)([&lt;&gt;!=]=?)(.*)&#x27;
413	    match = re.search(pattern, name)
414	
415	    if match:
416	        name = match.group(1)
417	
418	    if name in cm_global.pip_downgrade_blacklist:
419	        pips = get_installed_packages()
420	
421	        if match is None:
422	            if name in pips:
423	                return True
424	        elif match.group(2) in [&#x27;&lt;=&#x27;, &#x27;==&#x27;, &#x27;&lt;&#x27;]:
425	            if name in pips:
426	                if StrictVersion(pips[name]) &gt;= StrictVersion(match.group(3)):
427	                    print(f&quot;[ComfyUI-Manager] skip black listed pip installation: &#x27;{name}&#x27;&quot;)
428	                    return True
429	
430	    return name.lower() in get_installed_packages()
431	
432	
433	if os.path.exists(restore_snapshot_path):
434	    try:
435	        cloned_repos = []
436	
437	        def msg_capture(stream, prefix):
438	            stream.reconfigure(encoding=locale.getpreferredencoding(), errors=&#x27;replace&#x27;)
439	            for msg in stream:
440	                if msg.startswith(&quot;CLONE: &quot;):
441	                    cloned_repos.append(msg[7:])
442	                    if prefix == &#x27;[!]&#x27;:
443	                        print(prefix, msg, end=&quot;&quot;, file=sys.stderr)
444	                    else:
445	                        print(prefix, msg, end=&quot;&quot;)
446	
447	                elif prefix == &#x27;[!]&#x27; and (&#x27;it/s]&#x27; in msg or &#x27;s/it]&#x27; in msg) and (&#x27;%|&#x27; in msg or &#x27;it [&#x27; in msg):
</pre>
</div>


</div>
</div>

<div id="issue-45">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>544<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
484	                    install_cmd = [sys.executable, install_script_path]
485	                    print(f&quot;&gt;&gt;&gt; {install_cmd} / {repo_path}&quot;)
486	                    this_exit_code += process_wrap(install_cmd, repo_path)
487	
488	                if this_exit_code != 0:
489	                    print(f&quot;[ComfyUI-Manager] Restoring &#x27;{repository_name}&#x27; is failed.&quot;)
490	
491	            except Exception as e:
492	                print(e)
493	                print(f&quot;[ComfyUI-Manager] Restoring &#x27;{repository_name}&#x27; is failed.&quot;)
494	
495	        if exit_code != 0:
496	            print(f&quot;[ComfyUI-Manager] Restore snapshot failed.&quot;)
497	        else:
498	            print(f&quot;[ComfyUI-Manager] Restore snapshot done.&quot;)
499	
500	    except Exception as e:
501	        print(e)
502	        print(f&quot;[ComfyUI-Manager] Restore snapshot failed.&quot;)
503	
504	    os.remove(restore_snapshot_path)
505	
506	
507	def execute_lazy_install_script(repo_path, executable):
508	    global processed_install
509	
510	    install_script_path = os.path.join(repo_path, &quot;install.py&quot;)
511	    requirements_path = os.path.join(repo_path, &quot;requirements.txt&quot;)
512	
513	    if os.path.exists(requirements_path):
514	        print(f&quot;Install: pip packages for &#x27;{repo_path}&#x27;&quot;)
515	        with open(requirements_path, &quot;r&quot;) as requirements_file:
516	            for line in requirements_file:
517	                package_name = remap_pip_package(line.strip())
518	                if package_name and not is_installed(package_name):
519	                    install_cmd = [executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package_name]
520	                    process_wrap(install_cmd, repo_path)
521	
522	    if os.path.exists(install_script_path) and f&#x27;{repo_path}/install.py&#x27; not in processed_install:
523	        processed_install.add(f&#x27;{repo_path}/install.py&#x27;)
524	        print(f&quot;Install: install script for &#x27;{repo_path}&#x27;&quot;)
525	        install_cmd = [executable, &quot;install.py&quot;]
526	        process_wrap(install_cmd, repo_path)
527	
528	
529	# Check if script_list_path exists
530	if os.path.exists(script_list_path):
531	    print(&quot;\n#######################################################################&quot;)
532	    print(&quot;[ComfyUI-Manager] Starting dependency installation/(de)activation for the extension\n&quot;)
533	
534	    executed = set()
535	    # Read each line from the file and convert it to a list using eval
536	    with open(script_list_path, &#x27;r&#x27;, encoding=&quot;UTF-8&quot;, errors=&quot;ignore&quot;) as file:
537	        for line in file:
538	            if line in executed:
539	                continue
540	
541	            executed.add(line)
542	
543	            try:
544	                script = eval(line)
545	
546	                if script[1].startswith(&#x27;#&#x27;) and script[1] != &#x27;#FORCE&#x27;:
547	                    if script[1] == &quot;#LAZY-INSTALL-SCRIPT&quot;:
548	                        execute_lazy_install_script(script[0], script[2])
549	
550	                elif os.path.exists(script[0]):
551	                    if script[1] == &quot;#FORCE&quot;:
552	                        del script[1]
553	                    else:
554	                        if &#x27;pip&#x27; in script[1:] and &#x27;install&#x27; in script[1:] and is_installed(script[-1]):
555	                            continue
556	
557	                    print(f&quot;\n## ComfyUI-Manager: EXECUTE =&gt; {script[1:]}&quot;)
558	                    print(f&quot;\n## Execute install/(de)activation script for &#x27;{script[0]}&#x27;&quot;)
559	
560	                    exit_code = process_wrap(script[1:], script[0])
561	
562	                    if exit_code != 0:
563	                        print(f&quot;install/(de)activation script failed: {script[0]}&quot;)
564	                else:
565	                    print(f&quot;\n## ComfyUI-Manager: CANCELED =&gt; {script[1:]}&quot;)
566	
567	            except Exception as e:
568	                print(f&quot;[ERROR] Failed to execute install/(de)activation script: {line} / {e}&quot;)
569	
570	    # Remove the script_list_path file
571	    if os.path.exists(script_list_path):
572	        os.remove(script_list_path)
573	        
574	    print(&quot;\n[ComfyUI-Manager] Startup script completed.&quot;)
575	    print(&quot;#######################################################################\n&quot;)
576	
577	del processed_install
578	del pip_map
579	
580	
581	def check_windows_event_loop_policy():
582	    try:
583	        import configparser
584	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
585	        config = configparser.ConfigParser()
586	        config.read(config_path)
587	        default_conf = config[&#x27;default&#x27;]
588	
589	        if &#x27;windows_selector_event_loop_policy&#x27; in default_conf and default_conf[&#x27;windows_selector_event_loop_policy&#x27;].lower() == &#x27;true&#x27;:
590	            try:
591	                import asyncio
592	                import asyncio.windows_events
593	                asyncio.set_event_loop_policy(asyncio.windows_events.WindowsSelectorEventLoopPolicy())
594	                print(f&quot;[ComfyUI-Manager] Windows event loop policy mode enabled&quot;)
595	            except Exception as e:
596	                print(f&quot;[ComfyUI-Manager] WARN: Windows initialization fail: {e}&quot;)
597	    except Exception:
598	        pass
599	
600	
601	if platform.system() == &#x27;Windows&#x27;:
602	    check_windows_event_loop_policy()
</pre>
</div>


</div>
</div>

<div id="issue-46">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/prestartup_script.py</a><br>
    <b>Line number: </b>597<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
537	        for line in file:
538	            if line in executed:
539	                continue
540	
541	            executed.add(line)
542	
543	            try:
544	                script = eval(line)
545	
546	                if script[1].startswith(&#x27;#&#x27;) and script[1] != &#x27;#FORCE&#x27;:
547	                    if script[1] == &quot;#LAZY-INSTALL-SCRIPT&quot;:
548	                        execute_lazy_install_script(script[0], script[2])
549	
550	                elif os.path.exists(script[0]):
551	                    if script[1] == &quot;#FORCE&quot;:
552	                        del script[1]
553	                    else:
554	                        if &#x27;pip&#x27; in script[1:] and &#x27;install&#x27; in script[1:] and is_installed(script[-1]):
555	                            continue
556	
557	                    print(f&quot;\n## ComfyUI-Manager: EXECUTE =&gt; {script[1:]}&quot;)
558	                    print(f&quot;\n## Execute install/(de)activation script for &#x27;{script[0]}&#x27;&quot;)
559	
560	                    exit_code = process_wrap(script[1:], script[0])
561	
562	                    if exit_code != 0:
563	                        print(f&quot;install/(de)activation script failed: {script[0]}&quot;)
564	                else:
565	                    print(f&quot;\n## ComfyUI-Manager: CANCELED =&gt; {script[1:]}&quot;)
566	
567	            except Exception as e:
568	                print(f&quot;[ERROR] Failed to execute install/(de)activation script: {line} / {e}&quot;)
569	
570	    # Remove the script_list_path file
571	    if os.path.exists(script_list_path):
572	        os.remove(script_list_path)
573	        
574	    print(&quot;\n[ComfyUI-Manager] Startup script completed.&quot;)
575	    print(&quot;#######################################################################\n&quot;)
576	
577	del processed_install
578	del pip_map
579	
580	
581	def check_windows_event_loop_policy():
582	    try:
583	        import configparser
584	        config_path = os.path.join(os.path.dirname(__file__), &quot;config.ini&quot;)
585	        config = configparser.ConfigParser()
586	        config.read(config_path)
587	        default_conf = config[&#x27;default&#x27;]
588	
589	        if &#x27;windows_selector_event_loop_policy&#x27; in default_conf and default_conf[&#x27;windows_selector_event_loop_policy&#x27;].lower() == &#x27;true&#x27;:
590	            try:
591	                import asyncio
592	                import asyncio.windows_events
593	                asyncio.set_event_loop_policy(asyncio.windows_events.WindowsSelectorEventLoopPolicy())
594	                print(f&quot;[ComfyUI-Manager] Windows event loop policy mode enabled&quot;)
595	            except Exception as e:
596	                print(f&quot;[ComfyUI-Manager] WARN: Windows initialization fail: {e}&quot;)
597	    except Exception:
598	        pass
599	
600	
601	if platform.system() == &#x27;Windows&#x27;:
602	    check_windows_event_loop_policy()
</pre>
</div>


</div>
</div>

<div id="issue-47">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py</a><br>
    <b>Line number: </b>2<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import os
2	import subprocess
3	
4	
5	def get_enabled_subdirectories_with_files(base_directory):
6	    subdirs_with_files = []
7	    for subdir in os.listdir(base_directory):
8	        try:
9	            full_path = os.path.join(base_directory, subdir)
10	            if os.path.isdir(full_path) and not subdir.endswith(&quot;.disabled&quot;) and not subdir.startswith(&#x27;.&#x27;) and subdir != &#x27;__pycache__&#x27;:
11	                print(f&quot;## Install dependencies for &#x27;{subdir}&#x27;&quot;)
12	                requirements_file = os.path.join(full_path, &quot;requirements.txt&quot;)
13	                install_script = os.path.join(full_path, &quot;install.py&quot;)
14	
15	                if os.path.exists(requirements_file) or os.path.exists(install_script):
16	                    subdirs_with_files.append((full_path, requirements_file, install_script))
17	        except Exception as e:
18	            print(f&quot;EXCEPTION During Dependencies INSTALL on &#x27;{subdir}&#x27;:\n{e}&quot;)
19	
20	    return subdirs_with_files
21	
22	
23	def install_requirements(requirements_file_path):
24	    if os.path.exists(requirements_file_path):
25	        subprocess.run([&quot;pip&quot;, &quot;install&quot;, &quot;-r&quot;, requirements_file_path])
26	
27	
28	def run_install_script(install_script_path):
29	    if os.path.exists(install_script_path):
30	        subprocess.run([&quot;python&quot;, install_script_path])
31	
32	
33	custom_nodes_directory = &quot;custom_nodes&quot;
34	subdirs_with_files = get_enabled_subdirectories_with_files(custom_nodes_directory)
35	
36	
37	for subdir, requirements_file, install_script in subdirs_with_files:
38	    install_requirements(requirements_file)
39	    run_install_script(install_script)
</pre>
</div>


</div>
</div>

<div id="issue-48">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py</a><br>
    <b>Line number: </b>25<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
1	import os
2	import subprocess
3	
4	
5	def get_enabled_subdirectories_with_files(base_directory):
6	    subdirs_with_files = []
7	    for subdir in os.listdir(base_directory):
8	        try:
9	            full_path = os.path.join(base_directory, subdir)
10	            if os.path.isdir(full_path) and not subdir.endswith(&quot;.disabled&quot;) and not subdir.startswith(&#x27;.&#x27;) and subdir != &#x27;__pycache__&#x27;:
11	                print(f&quot;## Install dependencies for &#x27;{subdir}&#x27;&quot;)
12	                requirements_file = os.path.join(full_path, &quot;requirements.txt&quot;)
13	                install_script = os.path.join(full_path, &quot;install.py&quot;)
14	
15	                if os.path.exists(requirements_file) or os.path.exists(install_script):
16	                    subdirs_with_files.append((full_path, requirements_file, install_script))
17	        except Exception as e:
18	            print(f&quot;EXCEPTION During Dependencies INSTALL on &#x27;{subdir}&#x27;:\n{e}&quot;)
19	
20	    return subdirs_with_files
21	
22	
23	def install_requirements(requirements_file_path):
24	    if os.path.exists(requirements_file_path):
25	        subprocess.run([&quot;pip&quot;, &quot;install&quot;, &quot;-r&quot;, requirements_file_path])
26	
27	
28	def run_install_script(install_script_path):
29	    if os.path.exists(install_script_path):
30	        subprocess.run([&quot;python&quot;, install_script_path])
31	
32	
33	custom_nodes_directory = &quot;custom_nodes&quot;
34	subdirs_with_files = get_enabled_subdirectories_with_files(custom_nodes_directory)
35	
36	
37	for subdir, requirements_file, install_script in subdirs_with_files:
38	    install_requirements(requirements_file)
39	    run_install_script(install_script)
</pre>
</div>


</div>
</div>

<div id="issue-49">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py</a><br>
    <b>Line number: </b>25<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
1	import os
2	import subprocess
3	
4	
5	def get_enabled_subdirectories_with_files(base_directory):
6	    subdirs_with_files = []
7	    for subdir in os.listdir(base_directory):
8	        try:
9	            full_path = os.path.join(base_directory, subdir)
10	            if os.path.isdir(full_path) and not subdir.endswith(&quot;.disabled&quot;) and not subdir.startswith(&#x27;.&#x27;) and subdir != &#x27;__pycache__&#x27;:
11	                print(f&quot;## Install dependencies for &#x27;{subdir}&#x27;&quot;)
12	                requirements_file = os.path.join(full_path, &quot;requirements.txt&quot;)
13	                install_script = os.path.join(full_path, &quot;install.py&quot;)
14	
15	                if os.path.exists(requirements_file) or os.path.exists(install_script):
16	                    subdirs_with_files.append((full_path, requirements_file, install_script))
17	        except Exception as e:
18	            print(f&quot;EXCEPTION During Dependencies INSTALL on &#x27;{subdir}&#x27;:\n{e}&quot;)
19	
20	    return subdirs_with_files
21	
22	
23	def install_requirements(requirements_file_path):
24	    if os.path.exists(requirements_file_path):
25	        subprocess.run([&quot;pip&quot;, &quot;install&quot;, &quot;-r&quot;, requirements_file_path])
26	
27	
28	def run_install_script(install_script_path):
29	    if os.path.exists(install_script_path):
30	        subprocess.run([&quot;python&quot;, install_script_path])
31	
32	
33	custom_nodes_directory = &quot;custom_nodes&quot;
34	subdirs_with_files = get_enabled_subdirectories_with_files(custom_nodes_directory)
35	
36	
37	for subdir, requirements_file, install_script in subdirs_with_files:
38	    install_requirements(requirements_file)
39	    run_install_script(install_script)
</pre>
</div>


</div>
</div>

<div id="issue-50">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py</a><br>
    <b>Line number: </b>30<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
1	import os
2	import subprocess
3	
4	
5	def get_enabled_subdirectories_with_files(base_directory):
6	    subdirs_with_files = []
7	    for subdir in os.listdir(base_directory):
8	        try:
9	            full_path = os.path.join(base_directory, subdir)
10	            if os.path.isdir(full_path) and not subdir.endswith(&quot;.disabled&quot;) and not subdir.startswith(&#x27;.&#x27;) and subdir != &#x27;__pycache__&#x27;:
11	                print(f&quot;## Install dependencies for &#x27;{subdir}&#x27;&quot;)
12	                requirements_file = os.path.join(full_path, &quot;requirements.txt&quot;)
13	                install_script = os.path.join(full_path, &quot;install.py&quot;)
14	
15	                if os.path.exists(requirements_file) or os.path.exists(install_script):
16	                    subdirs_with_files.append((full_path, requirements_file, install_script))
17	        except Exception as e:
18	            print(f&quot;EXCEPTION During Dependencies INSTALL on &#x27;{subdir}&#x27;:\n{e}&quot;)
19	
20	    return subdirs_with_files
21	
22	
23	def install_requirements(requirements_file_path):
24	    if os.path.exists(requirements_file_path):
25	        subprocess.run([&quot;pip&quot;, &quot;install&quot;, &quot;-r&quot;, requirements_file_path])
26	
27	
28	def run_install_script(install_script_path):
29	    if os.path.exists(install_script_path):
30	        subprocess.run([&quot;python&quot;, install_script_path])
31	
32	
33	custom_nodes_directory = &quot;custom_nodes&quot;
34	subdirs_with_files = get_enabled_subdirectories_with_files(custom_nodes_directory)
35	
36	
37	for subdir, requirements_file, install_script in subdirs_with_files:
38	    install_requirements(requirements_file)
39	    run_install_script(install_script)
</pre>
</div>


</div>
</div>

<div id="issue-51">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py" target="_blank">/home/c_byrne/tools/sd/sd-interfaces/ComfyUI/custom_nodes/ComfyUI-Manager/scripts/colab-dependencies.py</a><br>
    <b>Line number: </b>30<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
1	import os
2	import subprocess
3	
4	
5	def get_enabled_subdirectories_with_files(base_directory):
6	    subdirs_with_files = []
7	    for subdir in os.listdir(base_directory):
8	        try:
9	            full_path = os.path.join(base_directory, subdir)
10	            if os.path.isdir(full_path) and not subdir.endswith(&quot;.disabled&quot;) and not subdir.startswith(&#x27;.&#x27;) and subdir != &#x27;__pycache__&#x27;:
11	                print(f&quot;## Install dependencies for &#x27;{subdir}&#x27;&quot;)
12	                requirements_file = os.path.join(full_path, &quot;requirements.txt&quot;)
13	                install_script = os.path.join(full_path, &quot;install.py&quot;)
14	
15	                if os.path.exists(requirements_file) or os.path.exists(install_script):
16	                    subdirs_with_files.append((full_path, requirements_file, install_script))
17	        except Exception as e:
18	            print(f&quot;EXCEPTION During Dependencies INSTALL on &#x27;{subdir}&#x27;:\n{e}&quot;)
19	
20	    return subdirs_with_files
21	
22	
23	def install_requirements(requirements_file_path):
24	    if os.path.exists(requirements_file_path):
25	        subprocess.run([&quot;pip&quot;, &quot;install&quot;, &quot;-r&quot;, requirements_file_path])
26	
27	
28	def run_install_script(install_script_path):
29	    if os.path.exists(install_script_path):
30	        subprocess.run([&quot;python&quot;, install_script_path])
31	
32	
33	custom_nodes_directory = &quot;custom_nodes&quot;
34	subdirs_with_files = get_enabled_subdirectories_with_files(custom_nodes_directory)
35	
36	
37	for subdir, requirements_file, install_script in subdirs_with_files:
38	    install_requirements(requirements_file)
39	    run_install_script(install_script)
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
