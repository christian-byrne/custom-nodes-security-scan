
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">4325</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Advanced-ControlNet/adv_control/control_lllite.py" target="_blank">/ComfyUI-Advanced-ControlNet/adv_control/control_lllite.py</a><br>
    <b>Line number: </b>112<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
96	        for module in self.modules.values():
97	            module.cleanup()
98	        #    total_cleaned += 1
99	        #logger.info(f&quot;cleaned modules: {total_cleaned}, {id(self)}&quot;)
100	        #logger.error(f&quot;cleanup LLLitePatch: {id(self)}&quot;)
101	
102	    # make sure deepcopy does not copy control, and deepcopied LLLitePatch should be assigned to control
103	    def __deepcopy__(self, memo):
104	        self.cleanup()
105	        to_return: LLLitePatch = deepcopy_with_sharing(self, shared_attribute_names = [&#x27;control&#x27;], memo=memo)
106	        #logger.warn(f&quot;patch {id(self)} turned into {id(to_return)}&quot;)
107	        try:
108	            if self.patch_type == self.ATTN1:
109	                to_return.control.patch_attn1 = to_return
110	            elif self.patch_type == self.ATTN2:
111	                to_return.control.patch_attn2 = to_return
112	        except Exception:
113	            pass
114	        return to_return
115	
116	
117	# TODO: use comfy.ops to support fp8 properly
118	class LLLiteModule(torch.nn.Module):
119	    def __init__(
120	        self,
121	        name: str,
122	        is_conv2d: bool,
123	        in_dim: int,
124	        depth: int,
125	        cond_emb_dim: int,
126	        mlp_dim: int,
127	    ):
128	        super().__init__()
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Advanced-ControlNet/adv_control/control_reference.py" target="_blank">/ComfyUI-Advanced-ControlNet/adv_control/control_reference.py</a><br>
    <b>Line number: </b>473<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
457	        block.forward = self.original_forward
458	    
459	    def clean(self):
460	        self.bank_styles.clean()
461	
462	
463	class ReferenceInjections:
464	    def __init__(self, attn_modules: list[&#x27;RefBasicTransformerBlock&#x27;]=None, gn_modules: list[&#x27;RefTimestepEmbedSequential&#x27;]=None):
465	        self.attn_modules = attn_modules if attn_modules else []
466	        self.gn_modules = gn_modules if gn_modules else []
467	        self.diffusion_model_orig_forward: Callable = None
468	    
469	    def clean_module_mem(self):
470	        for attn_module in self.attn_modules:
471	            try:
472	                attn_module.injection_holder.clean()
473	            except Exception:
474	                pass
475	        for gn_module in self.gn_modules:
476	            try:
477	                gn_module.injection_holder.clean()
478	            except Exception:
479	                pass
480	
481	    def cleanup(self):
482	        self.clean_module_mem()
483	        del self.attn_modules
484	        self.attn_modules = []
485	        del self.gn_modules
486	        self.gn_modules = []
487	        self.diffusion_model_orig_forward = None
488	
489	
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Advanced-ControlNet/adv_control/control_reference.py" target="_blank">/ComfyUI-Advanced-ControlNet/adv_control/control_reference.py</a><br>
    <b>Line number: </b>478<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
462	
463	class ReferenceInjections:
464	    def __init__(self, attn_modules: list[&#x27;RefBasicTransformerBlock&#x27;]=None, gn_modules: list[&#x27;RefTimestepEmbedSequential&#x27;]=None):
465	        self.attn_modules = attn_modules if attn_modules else []
466	        self.gn_modules = gn_modules if gn_modules else []
467	        self.diffusion_model_orig_forward: Callable = None
468	    
469	    def clean_module_mem(self):
470	        for attn_module in self.attn_modules:
471	            try:
472	                attn_module.injection_holder.clean()
473	            except Exception:
474	                pass
475	        for gn_module in self.gn_modules:
476	            try:
477	                gn_module.injection_holder.clean()
478	            except Exception:
479	                pass
480	
481	    def cleanup(self):
482	        self.clean_module_mem()
483	        del self.attn_modules
484	        self.attn_modules = []
485	        del self.gn_modules
486	        self.gn_modules = []
487	        self.diffusion_model_orig_forward = None
488	
489	
490	def factory_forward_inject_UNetModel(reference_injections: ReferenceInjections):
491	    def forward_inject_UNetModel(self, x: Tensor, *args, **kwargs):
492	        # get control and transformer_options from kwargs
493	        real_args = list(args)
494	        real_kwargs = list(kwargs.keys())
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Advanced-ControlNet/adv_control/control_sparsectrl.py" target="_blank">/ComfyUI-Advanced-ControlNet/adv_control/control_sparsectrl.py</a><br>
    <b>Line number: </b>111<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
95	        return outs
96	
97	
98	class SparseModelPatcher(ModelPatcher):
99	    def __init__(self, *args, **kwargs):
100	        self.model: SparseControlNet
101	        super().__init__(*args, **kwargs)
102	    
103	    def patch_model(self, device_to=None, patch_weights=True):
104	        if patch_weights:
105	            patched_model = super().patch_model(device_to)
106	        else:
107	            patched_model = super().patch_model(device_to, patch_weights)
108	        try:
109	            if self.model.motion_wrapper is not None:
110	                self.model.motion_wrapper.to(device=device_to)
111	        except Exception:
112	            pass
113	        return patched_model
114	
115	    def unpatch_model(self, device_to=None, unpatch_weights=True):
116	        try:
117	            if self.model.motion_wrapper is not None:
118	                self.model.motion_wrapper.to(device=device_to)
119	        except Exception:
120	            pass
121	        if unpatch_weights:
122	            return super().unpatch_model(device_to)
123	        else:
124	            return super().unpatch_model(device_to, unpatch_weights)
125	
126	    def clone(self):
127	        # normal ModelPatcher clone actions
</pre>
</div>


</div>
</div>

<div id="issue-4">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Advanced-ControlNet/adv_control/control_sparsectrl.py" target="_blank">/ComfyUI-Advanced-ControlNet/adv_control/control_sparsectrl.py</a><br>
    <b>Line number: </b>119<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
103	    def patch_model(self, device_to=None, patch_weights=True):
104	        if patch_weights:
105	            patched_model = super().patch_model(device_to)
106	        else:
107	            patched_model = super().patch_model(device_to, patch_weights)
108	        try:
109	            if self.model.motion_wrapper is not None:
110	                self.model.motion_wrapper.to(device=device_to)
111	        except Exception:
112	            pass
113	        return patched_model
114	
115	    def unpatch_model(self, device_to=None, unpatch_weights=True):
116	        try:
117	            if self.model.motion_wrapper is not None:
118	                self.model.motion_wrapper.to(device=device_to)
119	        except Exception:
120	            pass
121	        if unpatch_weights:
122	            return super().unpatch_model(device_to)
123	        else:
124	            return super().unpatch_model(device_to, unpatch_weights)
125	
126	    def clone(self):
127	        # normal ModelPatcher clone actions
128	        n = SparseModelPatcher(self.model, self.load_device, self.offload_device, self.size, self.current_device, weight_inplace_update=self.weight_inplace_update)
129	        n.patches = {}
130	        for k in self.patches:
131	            n.patches[k] = self.patches[k][:]
132	        if hasattr(n, &quot;patches_uuid&quot;):
133	            self.patches_uuid = n.patches_uuid
134	
135	        n.object_patches = self.object_patches.copy()
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
