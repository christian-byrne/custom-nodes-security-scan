
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">6495</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/half_json.py" target="_blank">/ComfyUI-Prompt-MZ/half_json.py</a><br>
    <b>Line number: </b>28<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
12	    line: str
13	    origin: bool
14	
15	
16	class JSONFixer:
17	    def __init__(self, max_try: int = 20, max_stack: int = 3, *, js_style: bool = False) -&gt; None:
18	        self._max_try = max_try
19	        self._max_stack = max_stack
20	        self._js_style = js_style
21	        self.last_fix: Optional[bool] = None
22	        self.fix_stack: List[str] = []
23	
24	    def fix(self, line: str, *, strict: bool = True) -&gt; FixResult:
25	        try:
26	            json.loads(line, strict=strict)
27	            return FixResult(success=True, line=line, origin=True)
28	        except Exception:
29	            pass
30	
31	        ok, new_line = self.fixwithtry(line, strict=strict)
32	        return FixResult(success=ok, line=new_line, origin=False)
33	
34	    def fixwithtry(self, line: str, *, strict: bool = True) -&gt; Tuple[bool, str]:
35	        if self._max_try &lt;= 0:
36	            return False, line
37	
38	        self.fix_stack = []
39	        self.last_fix = None
40	
41	        ok = False
42	        for _ in range(self._max_try):
43	            ok, new_line = self.patch_line(line, strict=strict)
44	            if ok:
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_gen_translate.py" target="_blank">/ComfyUI-Prompt-MZ/mz_gen_translate.py</a><br>
    <b>Line number: </b>104<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
88	                        &quot;optional&quot;, {})
89	                    nodes[key][&quot;inputs&quot;] = {}
90	                    for widget_name, _ in node_INPUT_TYPES_optional.items():
91	                        widget_name_zh = widget_name
92	                        for k, v in ZH_Replace_Map.items():
93	                            widget_name_zh = widget_name_zh.replace(k, v)
94	                        nodes[key][&quot;inputs&quot;][widget_name] = widget_name_zh
95	
96	                    try:
97	                        node_RETURN_NAMES = node.RETURN_NAMES
98	                        nodes[key][&quot;outputs&quot;] = {}
99	                        for widget_name in node_RETURN_NAMES:
100	                            widget_name_zh = widget_name
101	                            for k, v in ZH_Replace_Map.items():
102	                                widget_name_zh = widget_name_zh.replace(k, v)
103	                            nodes[key][&quot;outputs&quot;][widget_name] = widget_name_zh
104	                    except:
105	                        pass
106	
107	            with open(translation_config, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
108	                f.write(json.dumps(nodes, indent=4, ensure_ascii=False))
109	
110	    else:
111	        print(&quot;No translation dir found!&quot;)
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_llama_cpp.py" target="_blank">/ComfyUI-Prompt-MZ/mz_llama_cpp.py</a><br>
    <b>Line number: </b>6<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import copy
2	import importlib
3	import json
4	import os
5	import shutil
6	import subprocess
7	import sys
8	import torch
9	try:
10	    from . import mz_prompt_utils
11	    from . import mz_prompt_webserver
12	except ImportError:
13	    pass
14	
15	
16	def check_llama_cpp_requirements():
17	    min_version = &quot;0.2.63&quot;
18	    last_version = &quot;0.2.76&quot;
19	    try:
20	        from llama_cpp import Llama
21	        import llama_cpp
22	        if llama_cpp.__version__ &lt; min_version:
23	            raise ImportError(&quot;llama_cpp version is too low. (llama_cpp版本过低)&quot;)
24	    except ImportError:
25	        py_version = &quot;&quot;
26	        if sys.version_info.major == 3:
27	            if sys.version_info.minor == 10:
28	                py_version = &quot;310&quot;
29	            elif sys.version_info.minor == 11:
30	                py_version = &quot;311&quot;
31	            elif sys.version_info.minor == 12:
32	                py_version = &quot;312&quot;
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_llama_cpp.py" target="_blank">/ComfyUI-Prompt-MZ/mz_llama_cpp.py</a><br>
    <b>Line number: </b>75<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
59	                &quot;Please download the corresponding whl file from https://github.com/abetlen/llama-cpp-python/releases and install it using pip install {whl file path} (请手动前往https://github.com/abetlen/llama-cpp-python/releases 下载对应的whl文件后 使用pip install {whl文件路径}安装)&quot;)
60	        elif sys.platform == &quot;win32&quot;:
61	            system_name = &quot;win_amd64&quot;
62	        else:
63	            raise ValueError(
64	                f&quot;Unsupported platform. (不支持的平台) {sys.platform} (请手动前往https://github.com/abetlen/llama-cpp-python/releases 下载对应的whl文件后 使用pip install &#x27;whl文件路径&#x27; 安装)&quot;)
65	
66	        wheel_name = f&quot;llama_cpp_python-{last_version}-cp{py_version}-cp{py_version}-{system_name}.whl&quot;
67	        if cuda_version == &quot;cpu&quot;:
68	            wheel_url = f&quot;https://github.com/abetlen/llama-cpp-python/releases/download/v{last_version}/{wheel_name}&quot;
69	        else:
70	            wheel_url = f&quot;https://github.com/abetlen/llama-cpp-python/releases/download/v{last_version}-{cuda_version}/{wheel_name}&quot;
71	
72	        print(f&quot;pip install {wheel_url}&quot;)
73	        modelscope_url = f&quot;https://www.modelscope.cn/api/v1/models/wailovet/MinusZoneAIModels/repo?Revision=master&amp;FilePath=llama-cpp-python-win%2F{cuda_version}%2F{wheel_name}&quot;
74	        if mz_prompt_utils.Utils.testDownloadSpeed(wheel_url):
75	            ret = subprocess.run([
76	                sys.executable, &quot;-m&quot;,
77	                &quot;pip&quot;, &quot;install&quot;, wheel_url], check=True)
78	        elif mz_prompt_utils.Utils.testDownloadSpeed(modelscope_url):
79	            import tempfile
80	            whl_download_file = os.path.join(
81	                tempfile.gettempdir(), wheel_name)
82	            mz_prompt_utils.Utils.download_file(
83	                modelscope_url, whl_download_file)
84	            print(f&quot;pip install {whl_download_file}&quot;)
85	            ret = subprocess.run([
86	                sys.executable, &quot;-m&quot;,
87	                &quot;pip&quot;, &quot;install&quot;, whl_download_file], check=True)
88	        else:
89	
90	            # 兜底方案
91	            modelscope_url = f&quot;https://www.modelscope.cn/api/v1/models/wailovet/MinusZoneAIModels/repo?Revision=master&amp;FilePath=llama-cpp-python-win%2Fcu121%2Fllama_cpp_python-0.2.76-cp310-cp310-win_amd64.whl&quot;
92	            if py_version == &quot;310&quot; and system_name == &quot;win_amd64&quot; and mz_prompt_utils.Utils.testDownloadSpeed(modelscope_url):
</pre>
</div>


</div>
</div>

<div id="issue-4">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_llama_cpp.py" target="_blank">/ComfyUI-Prompt-MZ/mz_llama_cpp.py</a><br>
    <b>Line number: </b>85<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
69	        else:
70	            wheel_url = f&quot;https://github.com/abetlen/llama-cpp-python/releases/download/v{last_version}-{cuda_version}/{wheel_name}&quot;
71	
72	        print(f&quot;pip install {wheel_url}&quot;)
73	        modelscope_url = f&quot;https://www.modelscope.cn/api/v1/models/wailovet/MinusZoneAIModels/repo?Revision=master&amp;FilePath=llama-cpp-python-win%2F{cuda_version}%2F{wheel_name}&quot;
74	        if mz_prompt_utils.Utils.testDownloadSpeed(wheel_url):
75	            ret = subprocess.run([
76	                sys.executable, &quot;-m&quot;,
77	                &quot;pip&quot;, &quot;install&quot;, wheel_url], check=True)
78	        elif mz_prompt_utils.Utils.testDownloadSpeed(modelscope_url):
79	            import tempfile
80	            whl_download_file = os.path.join(
81	                tempfile.gettempdir(), wheel_name)
82	            mz_prompt_utils.Utils.download_file(
83	                modelscope_url, whl_download_file)
84	            print(f&quot;pip install {whl_download_file}&quot;)
85	            ret = subprocess.run([
86	                sys.executable, &quot;-m&quot;,
87	                &quot;pip&quot;, &quot;install&quot;, whl_download_file], check=True)
88	        else:
89	
90	            # 兜底方案
91	            modelscope_url = f&quot;https://www.modelscope.cn/api/v1/models/wailovet/MinusZoneAIModels/repo?Revision=master&amp;FilePath=llama-cpp-python-win%2Fcu121%2Fllama_cpp_python-0.2.76-cp310-cp310-win_amd64.whl&quot;
92	            if py_version == &quot;310&quot; and system_name == &quot;win_amd64&quot; and mz_prompt_utils.Utils.testDownloadSpeed(modelscope_url):
93	                import tempfile
94	                whl_download_file = os.path.join(
95	                    tempfile.gettempdir(), wheel_name)
96	                mz_prompt_utils.Utils.download_file(
97	                    modelscope_url, whl_download_file)
98	                print(f&quot;pip install {whl_download_file}&quot;)
99	                ret = subprocess.run([
100	                    sys.executable, &quot;-m&quot;,
101	                    &quot;pip&quot;, &quot;install&quot;, whl_download_file], check=True)
102	            else:
</pre>
</div>


</div>
</div>

<div id="issue-5">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_llama_cpp.py" target="_blank">/ComfyUI-Prompt-MZ/mz_llama_cpp.py</a><br>
    <b>Line number: </b>99<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
83	                modelscope_url, whl_download_file)
84	            print(f&quot;pip install {whl_download_file}&quot;)
85	            ret = subprocess.run([
86	                sys.executable, &quot;-m&quot;,
87	                &quot;pip&quot;, &quot;install&quot;, whl_download_file], check=True)
88	        else:
89	
90	            # 兜底方案
91	            modelscope_url = f&quot;https://www.modelscope.cn/api/v1/models/wailovet/MinusZoneAIModels/repo?Revision=master&amp;FilePath=llama-cpp-python-win%2Fcu121%2Fllama_cpp_python-0.2.76-cp310-cp310-win_amd64.whl&quot;
92	            if py_version == &quot;310&quot; and system_name == &quot;win_amd64&quot; and mz_prompt_utils.Utils.testDownloadSpeed(modelscope_url):
93	                import tempfile
94	                whl_download_file = os.path.join(
95	                    tempfile.gettempdir(), wheel_name)
96	                mz_prompt_utils.Utils.download_file(
97	                    modelscope_url, whl_download_file)
98	                print(f&quot;pip install {whl_download_file}&quot;)
99	                ret = subprocess.run([
100	                    sys.executable, &quot;-m&quot;,
101	                    &quot;pip&quot;, &quot;install&quot;, whl_download_file], check=True)
102	            else:
103	                ret = subprocess.run([
104	                    sys.executable, &quot;-m&quot;,
105	                    &quot;pip&quot;, &quot;install&quot;, wheel_url], check=True)
106	
107	        if ret.returncode != 0:
108	            raise ValueError(&quot;Failed to install llama_cpp. (安装llama_cpp失败)&quot;)
109	        else:
110	            print(&quot;llama_cpp installed successfully. (llama_cpp安装成功)&quot;)
111	
112	
113	def get_llama_cpp_chat_handlers():
114	    check_llama_cpp_requirements()
115	    from llama_cpp import llama_chat_format
116	    chat_handlers = llama_chat_format.LlamaChatCompletionHandlerRegistry()._chat_handlers
</pre>
</div>


</div>
</div>

<div id="issue-6">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_llama_cpp.py" target="_blank">/ComfyUI-Prompt-MZ/mz_llama_cpp.py</a><br>
    <b>Line number: </b>103<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
87	                &quot;pip&quot;, &quot;install&quot;, whl_download_file], check=True)
88	        else:
89	
90	            # 兜底方案
91	            modelscope_url = f&quot;https://www.modelscope.cn/api/v1/models/wailovet/MinusZoneAIModels/repo?Revision=master&amp;FilePath=llama-cpp-python-win%2Fcu121%2Fllama_cpp_python-0.2.76-cp310-cp310-win_amd64.whl&quot;
92	            if py_version == &quot;310&quot; and system_name == &quot;win_amd64&quot; and mz_prompt_utils.Utils.testDownloadSpeed(modelscope_url):
93	                import tempfile
94	                whl_download_file = os.path.join(
95	                    tempfile.gettempdir(), wheel_name)
96	                mz_prompt_utils.Utils.download_file(
97	                    modelscope_url, whl_download_file)
98	                print(f&quot;pip install {whl_download_file}&quot;)
99	                ret = subprocess.run([
100	                    sys.executable, &quot;-m&quot;,
101	                    &quot;pip&quot;, &quot;install&quot;, whl_download_file], check=True)
102	            else:
103	                ret = subprocess.run([
104	                    sys.executable, &quot;-m&quot;,
105	                    &quot;pip&quot;, &quot;install&quot;, wheel_url], check=True)
106	
107	        if ret.returncode != 0:
108	            raise ValueError(&quot;Failed to install llama_cpp. (安装llama_cpp失败)&quot;)
109	        else:
110	            print(&quot;llama_cpp installed successfully. (llama_cpp安装成功)&quot;)
111	
112	
113	def get_llama_cpp_chat_handlers():
114	    check_llama_cpp_requirements()
115	    from llama_cpp import llama_chat_format
116	    chat_handlers = llama_chat_format.LlamaChatCompletionHandlerRegistry()._chat_handlers
117	    chat_handlers = list(chat_handlers.keys())
118	
119	    return chat_handlers
120	
</pre>
</div>


</div>
</div>

<div id="issue-7">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_openaiapi.py" target="_blank">/ComfyUI-Prompt-MZ/mz_openaiapi.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import os
2	import sys
3	import json
4	import subprocess
5	
6	from . import mz_prompt_utils
7	from . import mz_llama_cpp
8	from . import mz_llama_core_nodes
9	from . import mz_prompts
10	
11	
12	def zhipu_json_fix(input_data):
13	    if type(input_data) == dict:
14	        if &quot;Items&quot; in input_data:
15	            return input_data[&quot;Items&quot;]
16	        else:
17	            for key, value in input_data.items():
18	                input_data[key] = zhipu_json_fix(value)
19	            return input_data
20	
21	    elif type(input_data) == list:
22	        for i in range(len(input_data)):
23	            input_data[i] = zhipu_json_fix(input_data[i])
24	        return input_data
25	
26	    else:
27	        return input_data
28	
29	
30	def query_beautify_prompt_text(args_dict):
31	    try:
32	        from openai import OpenAI
</pre>
</div>


</div>
</div>

<div id="issue-8">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_openaiapi.py" target="_blank">/ComfyUI-Prompt-MZ/mz_openaiapi.py</a><br>
    <b>Line number: </b>35<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
19	            return input_data
20	
21	    elif type(input_data) == list:
22	        for i in range(len(input_data)):
23	            input_data[i] = zhipu_json_fix(input_data[i])
24	        return input_data
25	
26	    else:
27	        return input_data
28	
29	
30	def query_beautify_prompt_text(args_dict):
31	    try:
32	        from openai import OpenAI
33	        import openai
34	    except ImportError:
35	        subprocess.check_call(
36	            [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, &quot;openai&quot;])
37	        from openai import OpenAI
38	        import openai
39	
40	    api_key = args_dict.get(&quot;api_key&quot;, None)
41	    base_url = args_dict.get(&quot;base_url&quot;, None)
42	
43	    text = args_dict.get(&quot;text&quot;, &quot;&quot;)
44	    style_presets = args_dict.get(&quot;style_presets&quot;, &quot;&quot;)
45	
46	    if api_key is None:
47	        raise ValueError(&quot;api_key is required&quot;)
48	
49	    client = OpenAI(
50	        api_key=api_key,
51	        default_headers={&quot;x-foo&quot;: &quot;true&quot;}
</pre>
</div>


</div>
</div>

<div id="issue-9">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_prompt_utils.py" target="_blank">/ComfyUI-Prompt-MZ/mz_prompt_utils.py</a><br>
    <b>Line number: </b>5<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	
2	import json
3	import os
4	import shutil
5	import subprocess
6	import sys
7	import threading
8	import time
9	import numpy as np
10	import folder_paths
11	import base64
12	from PIL import Image, ImageFilter
13	import io
14	import torch
15	import re
16	import hashlib
17	import cv2
18	# sys.path.append(os.path.join(os.path.dirname(__file__)))
19	temp_directory = folder_paths.get_temp_directory()
20	from tqdm import tqdm
21	import requests
22	import comfy.utils
23	
24	
25	CACHE_POOL = {}
26	
27	
28	class Utils:
29	    def Md5(str):
30	        return hashlib.md5(str.encode(&#x27;utf-8&#x27;)).hexdigest()
31	
32	    def check_frames_path(frames_path):
</pre>
</div>


</div>
</div>

<div id="issue-10">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak MD5 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_prompt_utils.py" target="_blank">/ComfyUI-Prompt-MZ/mz_prompt_utils.py</a><br>
    <b>Line number: </b>30<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
14	import torch
15	import re
16	import hashlib
17	import cv2
18	# sys.path.append(os.path.join(os.path.dirname(__file__)))
19	temp_directory = folder_paths.get_temp_directory()
20	from tqdm import tqdm
21	import requests
22	import comfy.utils
23	
24	
25	CACHE_POOL = {}
26	
27	
28	class Utils:
29	    def Md5(str):
30	        return hashlib.md5(str.encode(&#x27;utf-8&#x27;)).hexdigest()
31	
32	    def check_frames_path(frames_path):
33	
34	        if frames_path == &quot;&quot; or frames_path.startswith(&quot;.&quot;) or frames_path.startswith(&quot;/&quot;) or frames_path.endswith(&quot;/&quot;) or frames_path.endswith(&quot;\\&quot;):
35	            return &quot;frames_path不能为空&quot;
36	
37	        frames_path = os.path.join(
38	            folder_paths.get_output_directory(), frames_path)
39	
40	        if frames_path == folder_paths.get_output_directory():
41	            return &quot;frames_path不能为output目录&quot;
42	
43	        return &quot;&quot;
44	
45	    def base64_to_pil_image(base64_str):
</pre>
</div>


</div>
</div>

<div id="issue-11">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_prompt_utils.py" target="_blank">/ComfyUI-Prompt-MZ/mz_prompt_utils.py</a><br>
    <b>Line number: </b>191<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
175	            folder_paths.models_dir, &quot;gguf&quot;)
176	        os.makedirs(models_path, exist_ok=True)
177	        return models_path
178	
179	    def get_translate_object(from_code, to_code):
180	        try:
181	            is_disabel_argostranslate = Utils.cache_get(
182	                &quot;is_disabel_argostranslate&quot;)
183	
184	            if is_disabel_argostranslate is not None:
185	                return None
186	
187	            try:
188	                import argostranslate
189	                from argostranslate import translate, package
190	            except ImportError:
191	                subprocess.run([
192	                    sys.executable, &quot;-m&quot;,
193	                    &quot;pip&quot;, &quot;install&quot;, &quot;argostranslate&quot;], check=True)
194	
195	                try:
196	                    import argostranslate
197	                    from argostranslate import translate, package
198	                except ImportError:
199	                    Utils.cache_set(&quot;is_disabel_argostranslate&quot;, True)
200	                    print(
201	                        &quot;argostranslate not found and install failed , will disable it&quot;)
202	                    return None
203	
204	            packages = package.get_installed_packages()
205	            installed_packages = {}
206	            for p in packages:
207	                installed_packages[f&quot;{p.from_code}_{p.to_code}&quot;] = p
208	
</pre>
</div>


</div>
</div>

<div id="issue-12">
<div class="issue-block issue-sev-medium">
    <b>request_without_timeout: </b> Requests call without timeout<br>
    <b>Test ID:</b> B113<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>LOW<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/400.html" target="_blank">CWE-400</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_prompt_utils.py" target="_blank">/ComfyUI-Prompt-MZ/mz_prompt_utils.py</a><br>
    <b>Line number: </b>426<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html</a><br>

<div class="code">
<pre>
410	        if src_h &lt; src_w:
411	            newWidth = dst_w
412	            newHeight = dst_w * src_h // src_w
413	        else:
414	            newWidth = dst_h * src_w // src_h
415	            newHeight = dst_h
416	
417	        newHeight = newHeight // 8 * 8
418	        newWidth = newWidth // 8 * 8
419	
420	        return im.resize((newWidth, newHeight), Image.Resampling.LANCZOS)
421	
422	    def get_device():
423	        return comfy.model_management.get_torch_device()
424	
425	    def download_small_file(url, filepath):
426	        response = requests.get(url)
427	        os.makedirs(os.path.dirname(filepath), exist_ok=True)
428	        with open(filepath, &quot;wb&quot;) as f:
429	            f.write(response.content)
430	        return filepath
431	
432	    def download_file(url, filepath, threads=8, retries=6):
433	
434	        get_size_tmp = requests.get(url, stream=True)
435	        total_size = int(get_size_tmp.headers.get(&quot;content-length&quot;, 0))
436	
437	        print(f&quot;Downloading {url} to {filepath} with size {total_size} bytes&quot;)
438	
439	        # 如果文件大小小于 50MB,使用download_small_file
440	        if total_size &lt; 50 * 1024 * 1024:
441	            return Utils.download_small_file(url, filepath)
</pre>
</div>


</div>
</div>

<div id="issue-13">
<div class="issue-block issue-sev-medium">
    <b>request_without_timeout: </b> Requests call without timeout<br>
    <b>Test ID:</b> B113<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>LOW<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/400.html" target="_blank">CWE-400</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_prompt_utils.py" target="_blank">/ComfyUI-Prompt-MZ/mz_prompt_utils.py</a><br>
    <b>Line number: </b>434<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html</a><br>

<div class="code">
<pre>
418	        newWidth = newWidth // 8 * 8
419	
420	        return im.resize((newWidth, newHeight), Image.Resampling.LANCZOS)
421	
422	    def get_device():
423	        return comfy.model_management.get_torch_device()
424	
425	    def download_small_file(url, filepath):
426	        response = requests.get(url)
427	        os.makedirs(os.path.dirname(filepath), exist_ok=True)
428	        with open(filepath, &quot;wb&quot;) as f:
429	            f.write(response.content)
430	        return filepath
431	
432	    def download_file(url, filepath, threads=8, retries=6):
433	
434	        get_size_tmp = requests.get(url, stream=True)
435	        total_size = int(get_size_tmp.headers.get(&quot;content-length&quot;, 0))
436	
437	        print(f&quot;Downloading {url} to {filepath} with size {total_size} bytes&quot;)
438	
439	        # 如果文件大小小于 50MB,使用download_small_file
440	        if total_size &lt; 50 * 1024 * 1024:
441	            return Utils.download_small_file(url, filepath)
442	
443	
444	        base_filename = os.path.basename(filepath)
445	        cache_dir = os.path.join(os.path.dirname(
446	            filepath), f&quot;{base_filename}.t_{threads}_cache&quot;)
447	        os.makedirs(cache_dir, exist_ok=True)
448	
449	        def get_total_existing_size():
</pre>
</div>


</div>
</div>

<div id="issue-14">
<div class="issue-block issue-sev-medium">
    <b>request_without_timeout: </b> Requests call without timeout<br>
    <b>Test ID:</b> B113<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>LOW<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/400.html" target="_blank">CWE-400</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_prompt_utils.py" target="_blank">/ComfyUI-Prompt-MZ/mz_prompt_utils.py</a><br>
    <b>Line number: </b>489<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html</a><br>

<div class="code">
<pre>
473	
474	                    # Check if the file already exists
475	                    if os.path.exists(cache_filepath):
476	                        # Get the size of the existing file
477	                        existing_size = os.path.getsize(cache_filepath)
478	                    else:
479	                        existing_size = 0
480	
481	                    headers = {&quot;Range&quot;: f&quot;bytes={start + existing_size}-{end}&quot;}
482	                    if end == total_size:
483	                        headers = {&quot;Range&quot;: f&quot;bytes={start + existing_size}-&quot;}
484	                    if start + existing_size &gt;= end:
485	                        continue
486	                    # print(f&quot;Downloading {cache_filepath} with headers bytes={start + existing_size}-{end}&quot;)
487	
488	                    # Streaming, so we can iterate over the response.
489	                    response = requests.get(url, stream=True, headers=headers)
490	
491	                    def download_file_thread(response, cache_filepath):
492	                        block_size = 1024
493	                        if end - (start + existing_size) &lt; block_size:
494	                            block_size = end - (start + existing_size)
495	                        with open(cache_filepath, &quot;ab&quot;) as file:
496	                            for data in response.iter_content(block_size):
497	                                file.write(data)
498	                                progress_bar.update(
499	                                    len(data)
500	                                )
501	
502	                    t = threading.Thread(
503	                        target=download_file_thread, args=(response, cache_filepath))
504	
</pre>
</div>


</div>
</div>

<div id="issue-15">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_prompt_utils.py" target="_blank">/ComfyUI-Prompt-MZ/mz_prompt_utils.py</a><br>
    <b>Line number: </b>822<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
806	
807	    def set_cache_by_local(key, value):
808	        try:
809	            cache_json_file = os.path.join(
810	                Utils.get_models_path(), f&quot;caches.json&quot;)
811	
812	            if not os.path.exists(cache_json_file):
813	                cache_json = {}
814	            else:
815	                with open(cache_json_file, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:
816	                    cache_json = json.load(f)
817	
818	            cache_json[key] = value
819	
820	            with open(cache_json_file, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
821	                json.dump(cache_json, f, indent=4)
822	        except:
823	            pass
824	
825	    def file_sha256(file_path):
826	        # 获取文件的更新时间
827	        file_stat = os.stat(file_path)
828	        file_mtime = file_stat.st_mtime
829	        file_size = file_stat.st_size
830	        cache_key = f&quot;{file_path}_{file_mtime}_{file_size}&quot;
831	        cache_value = Utils.get_cache_by_local(cache_key)
832	        if cache_value is not None:
833	            return cache_value
834	
835	        sha256 = Utils.file_hash(file_path, hashlib.sha256)
836	        Utils.set_cache_by_local(cache_key, sha256)
837	        return sha256
838	
</pre>
</div>


</div>
</div>

<div id="issue-16">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_prompt_utils.py" target="_blank">/ComfyUI-Prompt-MZ/mz_prompt_utils.py</a><br>
    <b>Line number: </b>910<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
894	            _ = requests.get(url, headers=headers, timeout=5)
895	            end = time.time()
896	            print(
897	                f&quot;Download speed: {round(5.00 / (float(end) - float(start)) / 1024, 2)} KB/s&quot;)
898	            return float(end) - float(start) &lt; 4
899	        except Exception as e:
900	            print(f&quot;Test download speed failed: {e}&quot;)
901	            return False
902	
903	    def get_model_zoo(tags_filter=None):
904	        source_model_zoo_file = os.path.join(
905	            os.path.dirname(__file__), &quot;configs&quot;, &quot;model_zoo.json&quot;)
906	        source_model_zoo_json = []
907	        try:
908	            with open(source_model_zoo_file, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:
909	                source_model_zoo_json = json.load(f)
910	        except:
911	            pass
912	
913	        # Utils.print_log(f&quot;source_model_zoo_json: {json.dumps(source_model_zoo_json, indent=4)}&quot;)
914	        if tags_filter is not None:
915	            source_model_zoo_json = [
916	                m for m in source_model_zoo_json if tags_filter in m[&quot;tags&quot;]]
917	
918	        return source_model_zoo_json
919	
920	
921	modelscope_models_map = {
922	    &quot;llama3&quot;: {
923	        &quot;Meta-Llama-3-8B-Instruct.Q4_K_M.gguf&quot;: {
924	            &quot;url&quot;: &quot;https://www.modelscope.cn/api/v1/models/wailovet/MinusZoneAIModels/repo?Revision=master&amp;FilePath=Meta-Llama-3-8B-Instruct-GGUF%2FMeta-Llama-3-8B-Instruct.Q4_K_M.gguf&quot;,
925	            &quot;output&quot;: &quot;modelscope_models/Meta-Llama-3-8B-Instruct-GGUF/Meta-Llama-3-8B-Instruct.Q4_K_M.gguf&quot;,
926	            &quot;SHA256&quot;: &quot;647a2b64cbcdbe670432d0502ebb2592b36dd364d51a9ef7a1387b7a4365781f&quot;,
</pre>
</div>


</div>
</div>

<div id="issue-17">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_transformers.py" target="_blank">/ComfyUI-Prompt-MZ/mz_transformers.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import json
2	import os
3	import shutil
4	import subprocess
5	import traceback
6	
7	
8	def transformers_captioner(args_dict, myfunc):
9	    from . import mz_prompt_utils
10	    import PIL.Image as Image
11	    captioner_config = args_dict.get(&quot;captioner_config&quot;, {})
12	    directory = captioner_config.get(&quot;directory&quot;, None)
13	    force_update = captioner_config.get(&quot;force_update&quot;, False)
14	    caption_suffix = captioner_config.get(&quot;caption_suffix&quot;, &quot;&quot;)
15	    retry_keyword = captioner_config.get(&quot;retry_keyword&quot;, &quot;&quot;)
16	    batch_size = captioner_config.get(&quot;batch_size&quot;, 1)
17	    retry_keywords = retry_keyword.split(&quot;,&quot;)
18	
19	    retry_keywords = [k.strip() for k in retry_keywords]
20	    retry_keywords = [k for k in retry_keywords if k != &quot;&quot;]
21	
22	    pre_images = []
23	    # print(&quot;directory:&quot;, directory)
24	    for root, dirs, files in os.walk(directory):
25	        for file in files:
26	            if file.endswith(&quot;.jpg&quot;) or file.endswith(&quot;.jpeg&quot;) or file.endswith(&quot;.png&quot;) or file.endswith(&quot;.webp&quot;):
27	                image_path = os.path.join(root, file)
28	                base_file_path = os.path.splitext(image_path)[0]
29	                caption_file = os.path.join(
30	                    root, base_file_path + caption_suffix)
31	                if os.path.exists(caption_file) and force_update is False:
32	                    continue
</pre>
</div>


</div>
</div>

<div id="issue-18">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_transformers.py" target="_blank">/ComfyUI-Prompt-MZ/mz_transformers.py</a><br>
    <b>Line number: </b>197<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
181	    }
182	
183	    llm_path = os.path.join(
184	        folder_paths.models_dir,
185	        &quot;LLM&quot;,
186	    )
187	    os.makedirs(llm_path, exist_ok=True)
188	
189	    model_name = args_dict.get(&quot;model_name&quot;, &quot;Florence-2-large&quot;)
190	
191	    model_path = os.path.join(llm_path, model_name)
192	
193	    if not os.path.exists(model_path):
194	        # GIT_LFS_SKIP_SMUDGE=1 git clone https://www.modelscope.cn/AI-ModelScope/Florence-2-large.git
195	        original_env = os.environ.get(&quot;GIT_LFS_SKIP_SMUDGE&quot;)
196	        os.environ[&quot;GIT_LFS_SKIP_SMUDGE&quot;] = &quot;1&quot;
197	        subprocess.run(
198	            [&quot;git&quot;, &quot;clone&quot;, &quot;https://www.modelscope.cn/AI-ModelScope/Florence-2-large.git&quot;, model_path])
199	        if original_env is not None:
200	            os.environ[&quot;GIT_LFS_SKIP_SMUDGE&quot;] = original_env
201	
202	    florence2_large_files = florence2_large_files_map.get(model_name, [])
203	    for file_info in florence2_large_files:
204	        file_path = os.path.join(model_path, file_info[&quot;file_path&quot;])
205	        # 判断文件大小小于1M
206	        if not os.path.exists(file_path) or os.path.getsize(file_path) &lt; 1024 * 1024:
207	            Utils.download_file(file_info[&quot;url&quot;], file_path)
208	
209	    # with open(os.path.join(os.path.dirname(__file__), &quot;hook&quot;, &quot;modeling_florence2.py&quot;), &quot;r&quot;) as f:
210	    #     code = f.read()
211	    shutil.copyfile(
212	        os.path.join(os.path.dirname(__file__),
213	                     &quot;hook&quot;, &quot;modeling_florence2.py&quot;),
</pre>
</div>


</div>
</div>

<div id="issue-19">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-Prompt-MZ/mz_transformers.py" target="_blank">/ComfyUI-Prompt-MZ/mz_transformers.py</a><br>
    <b>Line number: </b>197<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
181	    }
182	
183	    llm_path = os.path.join(
184	        folder_paths.models_dir,
185	        &quot;LLM&quot;,
186	    )
187	    os.makedirs(llm_path, exist_ok=True)
188	
189	    model_name = args_dict.get(&quot;model_name&quot;, &quot;Florence-2-large&quot;)
190	
191	    model_path = os.path.join(llm_path, model_name)
192	
193	    if not os.path.exists(model_path):
194	        # GIT_LFS_SKIP_SMUDGE=1 git clone https://www.modelscope.cn/AI-ModelScope/Florence-2-large.git
195	        original_env = os.environ.get(&quot;GIT_LFS_SKIP_SMUDGE&quot;)
196	        os.environ[&quot;GIT_LFS_SKIP_SMUDGE&quot;] = &quot;1&quot;
197	        subprocess.run(
198	            [&quot;git&quot;, &quot;clone&quot;, &quot;https://www.modelscope.cn/AI-ModelScope/Florence-2-large.git&quot;, model_path])
199	        if original_env is not None:
200	            os.environ[&quot;GIT_LFS_SKIP_SMUDGE&quot;] = original_env
201	
202	    florence2_large_files = florence2_large_files_map.get(model_name, [])
203	    for file_info in florence2_large_files:
204	        file_path = os.path.join(model_path, file_info[&quot;file_path&quot;])
205	        # 判断文件大小小于1M
206	        if not os.path.exists(file_path) or os.path.getsize(file_path) &lt; 1024 * 1024:
207	            Utils.download_file(file_info[&quot;url&quot;], file_path)
208	
209	    # with open(os.path.join(os.path.dirname(__file__), &quot;hook&quot;, &quot;modeling_florence2.py&quot;), &quot;r&quot;) as f:
210	    #     code = f.read()
211	    shutil.copyfile(
212	        os.path.join(os.path.dirname(__file__),
213	                     &quot;hook&quot;, &quot;modeling_florence2.py&quot;),
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
