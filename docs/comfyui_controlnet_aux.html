
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">183960</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/node_wrappers/mediapipe_face.py" target="_blank">comfyui_controlnet_aux/node_wrappers/mediapipe_face.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	from ..utils import common_annotator_call, create_node_input_types, run_script
2	import comfy.model_management as model_management
3	import os, sys
4	import subprocess, threading
5	
6	def install_deps():
7	    try:
8	        import mediapipe
9	    except ImportError:
10	        run_script([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;mediapipe&#x27;])
11	        run_script([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;--upgrade&#x27;, &#x27;protobuf&#x27;])
12	
13	class Media_Pipe_Face_Mesh_Preprocessor:
14	    @classmethod
15	    def INPUT_TYPES(s):
16	        return create_node_input_types(
17	            max_faces=(&quot;INT&quot;, {&quot;default&quot;: 10, &quot;min&quot;: 1, &quot;max&quot;: 50, &quot;step&quot;: 1}), #Which image has more than 50 detectable faces?
18	            min_confidence=(&quot;FLOAT&quot;, {&quot;default&quot;: 0.5, &quot;min&quot;: 0.01, &quot;max&quot;: 1.0, &quot;step&quot;: 0.01})
19	        )
20	        
21	    RETURN_TYPES = (&quot;IMAGE&quot;,)
22	    FUNCTION = &quot;detect&quot;
23	
24	    CATEGORY = &quot;ControlNet Preprocessors/Faces and Poses Estimators&quot;
25	
26	    def detect(self, image, max_faces, min_confidence, resolution=512):
27	        #Ref: https://github.com/Fannovel16/comfy_controlnet_preprocessors/issues/70#issuecomment-1677967369
28	        install_deps()
29	        from controlnet_aux.mediapipe_face import MediapipeFaceDetector
30	        return (common_annotator_call(MediapipeFaceDetector(), image, max_faces=max_faces, min_confidence=min_confidence, resolution=resolution), )
31	
32	NODE_CLASS_MAPPINGS = {
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/node_wrappers/mesh_graphormer.py" target="_blank">comfyui_controlnet_aux/node_wrappers/mesh_graphormer.py</a><br>
    <b>Line number: </b>7<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	from ..utils import common_annotator_call, create_node_input_types, MAX_RESOLUTION, run_script
2	import comfy.model_management as model_management
3	import numpy as np
4	import torch
5	from einops import rearrange
6	import os, sys
7	import subprocess, threading
8	import scipy.ndimage
9	import cv2
10	import torch.nn.functional as F
11	
12	def install_deps():
13	    try:
14	        import mediapipe
15	    except ImportError:
16	        run_script([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;mediapipe&#x27;])
17	        run_script([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;--upgrade&#x27;, &#x27;protobuf&#x27;])
18	    
19	    try:
20	        import trimesh
21	    except ImportError:
22	        run_script([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;trimesh[easy]&#x27;])
23	
24	#Sauce: https://github.com/comfyanonymous/ComfyUI/blob/8c6493578b3dda233e9b9a953feeaf1e6ca434ad/comfy_extras/nodes_mask.py#L309
25	def expand_mask(mask, expand, tapered_corners):
26	    c = 0 if tapered_corners else 1
27	    kernel = np.array([[c, 1, c],
28	                        [1, 1, 1],
29	                        [c, 1, c]])
30	    mask = mask.reshape((-1, mask.shape[-2], mask.shape[-1]))
31	    out = []
32	    for m in mask:
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py</a><br>
    <b>Line number: </b>10<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) Meta Platforms, Inc. and affiliates.
2	# All rights reserved.
3	#
4	# This source code is licensed under the license found in the
5	# LICENSE file in the root directory of this source tree.
6	
7	import logging
8	import os
9	import random
10	import subprocess
11	from urllib.parse import urlparse
12	
13	import numpy as np
14	import torch
15	from torch import nn
16	
17	
18	logger = logging.getLogger(&quot;dinov2&quot;)
19	
20	
21	def load_pretrained_weights(model, pretrained_weights, checkpoint_key):
22	    if urlparse(pretrained_weights).scheme:  # If it looks like an URL
23	        state_dict = torch.hub.load_state_dict_from_url(pretrained_weights, map_location=&quot;cpu&quot;)
24	    else:
25	        state_dict = torch.load(pretrained_weights, map_location=&quot;cpu&quot;)
26	    if checkpoint_key is not None and checkpoint_key in state_dict:
27	        logger.info(f&quot;Take key {checkpoint_key} in provided checkpoint dict&quot;)
28	        state_dict = state_dict[checkpoint_key]
29	    # remove `module.` prefix
30	    state_dict = {k.replace(&quot;module.&quot;, &quot;&quot;): v for k, v in state_dict.items()}
31	    # remove `backbone.` prefix induced by multicrop wrapper
32	    state_dict = {k.replace(&quot;backbone.&quot;, &quot;&quot;): v for k, v in state_dict.items()}
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py</a><br>
    <b>Line number: </b>51<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
35	
36	
37	def fix_random_seeds(seed=31):
38	    &quot;&quot;&quot;
39	    Fix random seeds.
40	    &quot;&quot;&quot;
41	    torch.manual_seed(seed)
42	    torch.cuda.manual_seed_all(seed)
43	    np.random.seed(seed)
44	    random.seed(seed)
45	
46	
47	def get_sha():
48	    cwd = os.path.dirname(os.path.abspath(__file__))
49	
50	    def _run(command):
51	        return subprocess.check_output(command, cwd=cwd).decode(&quot;ascii&quot;).strip()
52	
53	    sha = &quot;N/A&quot;
54	    diff = &quot;clean&quot;
55	    branch = &quot;N/A&quot;
56	    try:
57	        sha = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;])
58	        subprocess.check_output([&quot;git&quot;, &quot;diff&quot;], cwd=cwd)
59	        diff = _run([&quot;git&quot;, &quot;diff-index&quot;, &quot;HEAD&quot;])
60	        diff = &quot;has uncommitted changes&quot; if diff else &quot;clean&quot;
61	        branch = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;--abbrev-ref&quot;, &quot;HEAD&quot;])
62	    except Exception:
63	        pass
64	    message = f&quot;sha: {sha}, status: {diff}, branch: {branch}&quot;
65	    return message
66	
</pre>
</div>


</div>
</div>

<div id="issue-4">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py</a><br>
    <b>Line number: </b>58<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
42	    torch.cuda.manual_seed_all(seed)
43	    np.random.seed(seed)
44	    random.seed(seed)
45	
46	
47	def get_sha():
48	    cwd = os.path.dirname(os.path.abspath(__file__))
49	
50	    def _run(command):
51	        return subprocess.check_output(command, cwd=cwd).decode(&quot;ascii&quot;).strip()
52	
53	    sha = &quot;N/A&quot;
54	    diff = &quot;clean&quot;
55	    branch = &quot;N/A&quot;
56	    try:
57	        sha = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;])
58	        subprocess.check_output([&quot;git&quot;, &quot;diff&quot;], cwd=cwd)
59	        diff = _run([&quot;git&quot;, &quot;diff-index&quot;, &quot;HEAD&quot;])
60	        diff = &quot;has uncommitted changes&quot; if diff else &quot;clean&quot;
61	        branch = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;--abbrev-ref&quot;, &quot;HEAD&quot;])
62	    except Exception:
63	        pass
64	    message = f&quot;sha: {sha}, status: {diff}, branch: {branch}&quot;
65	    return message
66	
67	
68	class CosineScheduler(object):
69	    def __init__(self, base_value, final_value, total_iters, warmup_iters=0, start_warmup_value=0, freeze_iters=0):
70	        super().__init__()
71	        self.final_value = final_value
72	        self.total_iters = total_iters
73	
</pre>
</div>


</div>
</div>

<div id="issue-5">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py</a><br>
    <b>Line number: </b>58<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
42	    torch.cuda.manual_seed_all(seed)
43	    np.random.seed(seed)
44	    random.seed(seed)
45	
46	
47	def get_sha():
48	    cwd = os.path.dirname(os.path.abspath(__file__))
49	
50	    def _run(command):
51	        return subprocess.check_output(command, cwd=cwd).decode(&quot;ascii&quot;).strip()
52	
53	    sha = &quot;N/A&quot;
54	    diff = &quot;clean&quot;
55	    branch = &quot;N/A&quot;
56	    try:
57	        sha = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;])
58	        subprocess.check_output([&quot;git&quot;, &quot;diff&quot;], cwd=cwd)
59	        diff = _run([&quot;git&quot;, &quot;diff-index&quot;, &quot;HEAD&quot;])
60	        diff = &quot;has uncommitted changes&quot; if diff else &quot;clean&quot;
61	        branch = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;--abbrev-ref&quot;, &quot;HEAD&quot;])
62	    except Exception:
63	        pass
64	    message = f&quot;sha: {sha}, status: {diff}, branch: {branch}&quot;
65	    return message
66	
67	
68	class CosineScheduler(object):
69	    def __init__(self, base_value, final_value, total_iters, warmup_iters=0, start_warmup_value=0, freeze_iters=0):
70	        super().__init__()
71	        self.final_value = final_value
72	        self.total_iters = total_iters
73	
</pre>
</div>


</div>
</div>

<div id="issue-6">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/depth_anything/torchhub/facebookresearch_dinov2_main/dinov2/utils/utils.py</a><br>
    <b>Line number: </b>62<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
46	
47	def get_sha():
48	    cwd = os.path.dirname(os.path.abspath(__file__))
49	
50	    def _run(command):
51	        return subprocess.check_output(command, cwd=cwd).decode(&quot;ascii&quot;).strip()
52	
53	    sha = &quot;N/A&quot;
54	    diff = &quot;clean&quot;
55	    branch = &quot;N/A&quot;
56	    try:
57	        sha = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;])
58	        subprocess.check_output([&quot;git&quot;, &quot;diff&quot;], cwd=cwd)
59	        diff = _run([&quot;git&quot;, &quot;diff-index&quot;, &quot;HEAD&quot;])
60	        diff = &quot;has uncommitted changes&quot; if diff else &quot;clean&quot;
61	        branch = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;--abbrev-ref&quot;, &quot;HEAD&quot;])
62	    except Exception:
63	        pass
64	    message = f&quot;sha: {sha}, status: {diff}, branch: {branch}&quot;
65	    return message
66	
67	
68	class CosineScheduler(object):
69	    def __init__(self, base_value, final_value, total_iters, warmup_iters=0, start_warmup_value=0, freeze_iters=0):
70	        super().__init__()
71	        self.final_value = final_value
72	        self.total_iters = total_iters
73	
74	        freeze_schedule = np.zeros((freeze_iters))
75	
76	        warmup_schedule = np.linspace(start_warmup_value, base_value, warmup_iters)
77	
78	        iters = np.arange(total_iters - warmup_iters - freeze_iters)
</pre>
</div>


</div>
</div>

<div id="issue-7">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/data.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/data.py</a><br>
    <b>Line number: </b>16<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	import torch
2	import torchvision.transforms as T
3	import torch.utils.data as data
4	import torch.nn as nn
5	from pathlib import Path
6	from functools import partial
7	from controlnet_aux.diffusion_edge.denoising_diffusion_pytorch.utils import exists, convert_image_to_fn, normalize_to_neg_one_to_one
8	from PIL import Image, ImageDraw
9	import torch.nn.functional as F
10	import math
11	import torchvision.transforms.functional as F2
12	import torchvision.transforms as transforms
13	import torchvision.datasets as datasets
14	from typing import Any, Callable, Optional, Tuple
15	import os
16	import pickle
17	import numpy as np
18	import copy
19	import custom_albumentations as albumentations
20	from torchvision.transforms.functional import InterpolationMode
21	
22	def get_imgs_list(imgs_dir):
23	    imgs_list = os.listdir(imgs_dir)
24	    imgs_list.sort()
25	    return [os.path.join(imgs_dir, f) for f in imgs_list if f.endswith(&#x27;.jpg&#x27;) or f.endswith(&#x27;.JPG&#x27;)or f.endswith(&#x27;.png&#x27;) or f.endswith(&#x27;.pgm&#x27;) or f.endswith(&#x27;.ppm&#x27;)]
26	
27	
28	def fit_img_postfix(img_path):
29	    if not os.path.exists(img_path) and img_path.endswith(&quot;.jpg&quot;):
30	        img_path = img_path[:-4] + &quot;.png&quot;
31	    if not os.path.exists(img_path) and img_path.endswith(&quot;.png&quot;):
32	        img_path = img_path[:-4] + &quot;.jpg&quot;
</pre>
</div>


</div>
</div>

<div id="issue-8">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py</a><br>
    <b>Line number: </b>1<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	import os, yaml, pickle, shutil, tarfile, glob
2	import cv2
3	import custom_albumentations as albumentations
4	import PIL
5	import numpy as np
6	import torchvision.transforms.functional as TF
7	# from omegaconf import OmegaConf
8	from functools import partial
9	from PIL import Image
10	from tqdm import tqdm
11	from torch.utils.data import Dataset, Subset
12	
13	import taming.data.utils as tdu
14	from controlnet_aux.diffusion_edge.taming.data.imagenet import str_to_indices, give_synsets_from_indices, download, retrieve
15	from controlnet_aux.diffusion_edge.taming.data.imagenet import ImagePaths
16	
17	# from ldm.modules.image_degradation import degradation_fn_bsr, degradation_fn_bsr_light
18	
19	
20	def synset2idx(path_to_yaml=&quot;data/index_synset.yaml&quot;):
21	    with open(path_to_yaml) as f:
22	        di2s = yaml.load(f)
23	    return dict((v,k) for k,v in di2s.items())
24	
25	
26	class ImageNetBase(Dataset):
27	    def __init__(self, config=None):
28	        self.config = config
29	        # if not type(self.config)==dict:
30	        #     self.config = OmegaConf.to_container(self.config)
31	        self.keep_orig_class_label = self.config.get(&quot;keep_orig_class_label&quot;, False)
32	        self.process_images = True  # if False we skip loading &amp; processing images and self.data contains filepaths
</pre>
</div>


</div>
</div>

<div id="issue-9">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py</a><br>
    <b>Line number: </b>22<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
6	import torchvision.transforms.functional as TF
7	# from omegaconf import OmegaConf
8	from functools import partial
9	from PIL import Image
10	from tqdm import tqdm
11	from torch.utils.data import Dataset, Subset
12	
13	import taming.data.utils as tdu
14	from controlnet_aux.diffusion_edge.taming.data.imagenet import str_to_indices, give_synsets_from_indices, download, retrieve
15	from controlnet_aux.diffusion_edge.taming.data.imagenet import ImagePaths
16	
17	# from ldm.modules.image_degradation import degradation_fn_bsr, degradation_fn_bsr_light
18	
19	
20	def synset2idx(path_to_yaml=&quot;data/index_synset.yaml&quot;):
21	    with open(path_to_yaml) as f:
22	        di2s = yaml.load(f)
23	    return dict((v,k) for k,v in di2s.items())
24	
25	
26	class ImageNetBase(Dataset):
27	    def __init__(self, config=None):
28	        self.config = config
29	        # if not type(self.config)==dict:
30	        #     self.config = OmegaConf.to_container(self.config)
31	        self.keep_orig_class_label = self.config.get(&quot;keep_orig_class_label&quot;, False)
32	        self.process_images = True  # if False we skip loading &amp; processing images and self.data contains filepaths
33	        self._prepare()
34	        self._prepare_synset_to_human()
35	        self._prepare_idx_to_synset()
36	        self._prepare_human_to_integer_label()
37	        self._load()
</pre>
</div>


</div>
</div>

<div id="issue-10">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py</a><br>
    <b>Line number: </b>178<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
162	        self.random_crop = self.config.get(&quot;random_crop&quot;, default=True)
163	        if not tdu.is_prepared(self.root):
164	            # prep
165	            print(&quot;Preparing dataset {} in {}&quot;.format(self.NAME, self.root))
166	
167	            datadir = self.datadir
168	            if not os.path.exists(datadir):
169	                path = os.path.join(self.root, self.FILES[0])
170	                if not os.path.exists(path) or not os.path.getsize(path)==self.SIZES[0]:
171	                    import academictorrents as at
172	                    atpath = at.get(self.AT_HASH, datastore=self.root)
173	                    assert atpath == path
174	
175	                print(&quot;Extracting {} to {}&quot;.format(path, datadir))
176	                os.makedirs(datadir, exist_ok=True)
177	                with tarfile.open(path, &quot;r:&quot;) as tar:
178	                    tar.extractall(path=datadir)
179	
180	                print(&quot;Extracting sub-tars.&quot;)
181	                subpaths = sorted(glob.glob(os.path.join(datadir, &quot;*.tar&quot;)))
182	                for subpath in tqdm(subpaths):
183	                    subdir = subpath[:-len(&quot;.tar&quot;)]
184	                    os.makedirs(subdir, exist_ok=True)
185	                    with tarfile.open(subpath, &quot;r:&quot;) as tar:
186	                        tar.extractall(path=subdir)
187	
188	            filelist = glob.glob(os.path.join(datadir, &quot;**&quot;, &quot;*.JPEG&quot;))
189	            filelist = [os.path.relpath(p, start=datadir) for p in filelist]
190	            filelist = sorted(filelist)
191	            filelist = &quot;\n&quot;.join(filelist)+&quot;\n&quot;
192	            with open(self.txt_filelist, &quot;w&quot;) as f:
193	                f.write(filelist)
</pre>
</div>


</div>
</div>

<div id="issue-11">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py</a><br>
    <b>Line number: </b>186<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
170	                if not os.path.exists(path) or not os.path.getsize(path)==self.SIZES[0]:
171	                    import academictorrents as at
172	                    atpath = at.get(self.AT_HASH, datastore=self.root)
173	                    assert atpath == path
174	
175	                print(&quot;Extracting {} to {}&quot;.format(path, datadir))
176	                os.makedirs(datadir, exist_ok=True)
177	                with tarfile.open(path, &quot;r:&quot;) as tar:
178	                    tar.extractall(path=datadir)
179	
180	                print(&quot;Extracting sub-tars.&quot;)
181	                subpaths = sorted(glob.glob(os.path.join(datadir, &quot;*.tar&quot;)))
182	                for subpath in tqdm(subpaths):
183	                    subdir = subpath[:-len(&quot;.tar&quot;)]
184	                    os.makedirs(subdir, exist_ok=True)
185	                    with tarfile.open(subpath, &quot;r:&quot;) as tar:
186	                        tar.extractall(path=subdir)
187	
188	            filelist = glob.glob(os.path.join(datadir, &quot;**&quot;, &quot;*.JPEG&quot;))
189	            filelist = [os.path.relpath(p, start=datadir) for p in filelist]
190	            filelist = sorted(filelist)
191	            filelist = &quot;\n&quot;.join(filelist)+&quot;\n&quot;
192	            with open(self.txt_filelist, &quot;w&quot;) as f:
193	                f.write(filelist)
194	
195	            tdu.mark_prepared(self.root)
196	
197	
198	class ImageNetValidation(ImageNetBase):
199	    NAME = &quot;ILSVRC2012_validation&quot;
200	    URL = &quot;http://www.image-net.org/challenges/LSVRC/2012/&quot;
201	    AT_HASH = &quot;5d6d0df7ed81efd49ca99ea4737e0ae5e3a5f2e5&quot;
</pre>
</div>


</div>
</div>

<div id="issue-12">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py</a><br>
    <b>Line number: </b>243<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
227	        self.random_crop = self.config.get(&quot;random_crop&quot;, default=False)
228	        if not tdu.is_prepared(self.root):
229	            # prep
230	            print(&quot;Preparing dataset {} in {}&quot;.format(self.NAME, self.root))
231	
232	            datadir = self.datadir
233	            if not os.path.exists(datadir):
234	                path = os.path.join(self.root, self.FILES[0])
235	                if not os.path.exists(path) or not os.path.getsize(path)==self.SIZES[0]:
236	                    import academictorrents as at
237	                    atpath = at.get(self.AT_HASH, datastore=self.root)
238	                    assert atpath == path
239	
240	                print(&quot;Extracting {} to {}&quot;.format(path, datadir))
241	                os.makedirs(datadir, exist_ok=True)
242	                with tarfile.open(path, &quot;r:&quot;) as tar:
243	                    tar.extractall(path=datadir)
244	
245	                vspath = os.path.join(self.root, self.FILES[1])
246	                if not os.path.exists(vspath) or not os.path.getsize(vspath)==self.SIZES[1]:
247	                    download(self.VS_URL, vspath)
248	
249	                with open(vspath, &quot;r&quot;) as f:
250	                    synset_dict = f.read().splitlines()
251	                    synset_dict = dict(line.split() for line in synset_dict)
252	
253	                print(&quot;Reorganizing into synset folders&quot;)
254	                synsets = np.unique(list(synset_dict.values()))
255	                for s in synsets:
256	                    os.makedirs(os.path.join(datadir, s), exist_ok=True)
257	                for k, v in synset_dict.items():
258	                    src = os.path.join(datadir, k)
</pre>
</div>


</div>
</div>

<div id="issue-13">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py</a><br>
    <b>Line number: </b>382<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
366	
367	        else:
368	            LR_image = self.degradation_process(image=image)[&quot;image&quot;]
369	
370	        example[&quot;image&quot;] = (image/127.5 - 1.0).astype(np.float32)
371	        example[&quot;LR_image&quot;] = (LR_image/127.5 - 1.0).astype(np.float32)
372	
373	        return example
374	
375	
376	class ImageNetSRTrain(ImageNetSR):
377	    def __init__(self, **kwargs):
378	        super().__init__(**kwargs)
379	
380	    def get_base(self):
381	        with open(&quot;data/imagenet_train_hr_indices.p&quot;, &quot;rb&quot;) as f:
382	            indices = pickle.load(f)
383	        dset = ImageNetTrain(process_images=False,)
384	        return Subset(dset, indices)
385	
386	
387	class ImageNetSRValidation(ImageNetSR):
388	    def __init__(self, **kwargs):
389	        super().__init__(**kwargs)
390	
391	    def get_base(self):
392	        with open(&quot;data/imagenet_val_hr_indices.p&quot;, &quot;rb&quot;) as f:
393	            indices = pickle.load(f)
394	        dset = ImageNetValidation(process_images=False,)
395	        return Subset(dset, indices)
</pre>
</div>


</div>
</div>

<div id="issue-14">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/denoising_diffusion_pytorch/imagenet.py</a><br>
    <b>Line number: </b>393<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
377	    def __init__(self, **kwargs):
378	        super().__init__(**kwargs)
379	
380	    def get_base(self):
381	        with open(&quot;data/imagenet_train_hr_indices.p&quot;, &quot;rb&quot;) as f:
382	            indices = pickle.load(f)
383	        dset = ImageNetTrain(process_images=False,)
384	        return Subset(dset, indices)
385	
386	
387	class ImageNetSRValidation(ImageNetSR):
388	    def __init__(self, **kwargs):
389	        super().__init__(**kwargs)
390	
391	    def get_base(self):
392	        with open(&quot;data/imagenet_val_hr_indices.p&quot;, &quot;rb&quot;) as f:
393	            indices = pickle.load(f)
394	        dset = ImageNetValidation(process_images=False,)
395	        return Subset(dset, indices)
</pre>
</div>


</div>
</div>

<div id="issue-15">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/model.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/model.py</a><br>
    <b>Line number: </b>16<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
1	import numpy as np
2	import yaml
3	import argparse
4	import math
5	import torch
6	from controlnet_aux.diffusion_edge.denoising_diffusion_pytorch.utils import *
7	from controlnet_aux.diffusion_edge.denoising_diffusion_pytorch.encoder_decoder import AutoencoderKL
8	# from controlnet_aux.diffusion_edge.denoising_diffusion_pytorch.transmodel import TransModel
9	from controlnet_aux.diffusion_edge.denoising_diffusion_pytorch.uncond_unet import Unet
10	from controlnet_aux.diffusion_edge.denoising_diffusion_pytorch.data import *
11	from fvcore.common.config import CfgNode
12	from pathlib import Path
13	
14	def load_conf(config_file, conf={}):
15	    with open(config_file) as f:
16	        exp_conf = yaml.load(f, Loader=yaml.FullLoader)
17	        for k, v in exp_conf.items():
18	            conf[k] = v
19	    return conf
20	
21	def prepare_args(ckpt_path, sampling_timesteps=1):
22	    return argparse.Namespace(
23	        cfg=load_conf(Path(__file__).parent / &quot;default.yaml&quot;),
24	        pre_weight=ckpt_path,
25	        sampling_timesteps=sampling_timesteps
26	    )
27	
28	class DiffusionEdge:
29	    def __init__(self, args) -&gt; None:
30	        self.cfg = CfgNode(args.cfg)
31	        torch.manual_seed(42)
32	        np.random.seed(42)
</pre>
</div>


</div>
</div>

<div id="issue-16">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/imagenet.py</a><br>
    <b>Line number: </b>18<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
2	import yaml
3	import numpy as np
4	from tqdm import tqdm
5	from PIL import Image
6	import custom_albumentations as albumentations
7	from omegaconf import OmegaConf
8	from torch.utils.data import Dataset
9	
10	from controlnet_aux.diffusion_edge.taming.data.base import ImagePaths
11	from controlnet_aux.diffusion_edge.taming.util import download, retrieve
12	import taming.data.utils as bdu
13	
14	
15	def give_synsets_from_indices(indices, path_to_yaml=&quot;data/imagenet_idx_to_synset.yaml&quot;):
16	    synsets = []
17	    with open(path_to_yaml) as f:
18	        di2s = yaml.load(f)
19	    for idx in indices:
20	        synsets.append(str(di2s[idx]))
21	    print(&quot;Using {} different synsets for construction of Restriced Imagenet.&quot;.format(len(synsets)))
22	    return synsets
23	
24	
25	def str_to_indices(string):
26	    &quot;&quot;&quot;Expects a string in the format &#x27;32-123, 256, 280-321&#x27;&quot;&quot;&quot;
27	    assert not string.endswith(&quot;,&quot;), &quot;provided string &#x27;{}&#x27; ends with a comma, pls remove it&quot;.format(string)
28	    subs = string.split(&quot;,&quot;)
29	    indices = []
30	    for sub in subs:
31	        subsubs = sub.split(&quot;-&quot;)
32	        assert len(subsubs) &gt; 0
33	        if len(subsubs) == 1:
</pre>
</div>


</div>
</div>

<div id="issue-17">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/imagenet.py</a><br>
    <b>Line number: </b>157<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
141	        self.expected_length = 1281167
142	        if not bdu.is_prepared(self.root):
143	            # prep
144	            print(&quot;Preparing dataset {} in {}&quot;.format(self.NAME, self.root))
145	
146	            datadir = self.datadir
147	            if not os.path.exists(datadir):
148	                path = os.path.join(self.root, self.FILES[0])
149	                if not os.path.exists(path) or not os.path.getsize(path)==self.SIZES[0]:
150	                    import academictorrents as at
151	                    atpath = at.get(self.AT_HASH, datastore=self.root)
152	                    assert atpath == path
153	
154	                print(&quot;Extracting {} to {}&quot;.format(path, datadir))
155	                os.makedirs(datadir, exist_ok=True)
156	                with tarfile.open(path, &quot;r:&quot;) as tar:
157	                    tar.extractall(path=datadir)
158	
159	                print(&quot;Extracting sub-tars.&quot;)
160	                subpaths = sorted(glob.glob(os.path.join(datadir, &quot;*.tar&quot;)))
161	                for subpath in tqdm(subpaths):
162	                    subdir = subpath[:-len(&quot;.tar&quot;)]
163	                    os.makedirs(subdir, exist_ok=True)
164	                    with tarfile.open(subpath, &quot;r:&quot;) as tar:
165	                        tar.extractall(path=subdir)
166	
167	
168	            filelist = glob.glob(os.path.join(datadir, &quot;**&quot;, &quot;*.JPEG&quot;))
169	            filelist = [os.path.relpath(p, start=datadir) for p in filelist]
170	            filelist = sorted(filelist)
171	            filelist = &quot;\n&quot;.join(filelist)+&quot;\n&quot;
172	            with open(self.txt_filelist, &quot;w&quot;) as f:
</pre>
</div>


</div>
</div>

<div id="issue-18">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/imagenet.py</a><br>
    <b>Line number: </b>165<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
149	                if not os.path.exists(path) or not os.path.getsize(path)==self.SIZES[0]:
150	                    import academictorrents as at
151	                    atpath = at.get(self.AT_HASH, datastore=self.root)
152	                    assert atpath == path
153	
154	                print(&quot;Extracting {} to {}&quot;.format(path, datadir))
155	                os.makedirs(datadir, exist_ok=True)
156	                with tarfile.open(path, &quot;r:&quot;) as tar:
157	                    tar.extractall(path=datadir)
158	
159	                print(&quot;Extracting sub-tars.&quot;)
160	                subpaths = sorted(glob.glob(os.path.join(datadir, &quot;*.tar&quot;)))
161	                for subpath in tqdm(subpaths):
162	                    subdir = subpath[:-len(&quot;.tar&quot;)]
163	                    os.makedirs(subdir, exist_ok=True)
164	                    with tarfile.open(subpath, &quot;r:&quot;) as tar:
165	                        tar.extractall(path=subdir)
166	
167	
168	            filelist = glob.glob(os.path.join(datadir, &quot;**&quot;, &quot;*.JPEG&quot;))
169	            filelist = [os.path.relpath(p, start=datadir) for p in filelist]
170	            filelist = sorted(filelist)
171	            filelist = &quot;\n&quot;.join(filelist)+&quot;\n&quot;
172	            with open(self.txt_filelist, &quot;w&quot;) as f:
173	                f.write(filelist)
174	
175	            bdu.mark_prepared(self.root)
176	
177	
178	class ImageNetValidation(ImageNetBase):
179	    NAME = &quot;ILSVRC2012_validation&quot;
180	    URL = &quot;http://www.image-net.org/challenges/LSVRC/2012/&quot;
</pre>
</div>


</div>
</div>

<div id="issue-19">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/imagenet.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/imagenet.py</a><br>
    <b>Line number: </b>215<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
199	        self.expected_length = 50000
200	        if not bdu.is_prepared(self.root):
201	            # prep
202	            print(&quot;Preparing dataset {} in {}&quot;.format(self.NAME, self.root))
203	
204	            datadir = self.datadir
205	            if not os.path.exists(datadir):
206	                path = os.path.join(self.root, self.FILES[0])
207	                if not os.path.exists(path) or not os.path.getsize(path)==self.SIZES[0]:
208	                    import academictorrents as at
209	                    atpath = at.get(self.AT_HASH, datastore=self.root)
210	                    assert atpath == path
211	
212	                print(&quot;Extracting {} to {}&quot;.format(path, datadir))
213	                os.makedirs(datadir, exist_ok=True)
214	                with tarfile.open(path, &quot;r:&quot;) as tar:
215	                    tar.extractall(path=datadir)
216	
217	                vspath = os.path.join(self.root, self.FILES[1])
218	                if not os.path.exists(vspath) or not os.path.getsize(vspath)==self.SIZES[1]:
219	                    download(self.VS_URL, vspath)
220	
221	                with open(vspath, &quot;r&quot;) as f:
222	                    synset_dict = f.read().splitlines()
223	                    synset_dict = dict(line.split() for line in synset_dict)
224	
225	                print(&quot;Reorganizing into synset folders&quot;)
226	                synsets = np.unique(list(synset_dict.values()))
227	                for s in synsets:
228	                    os.makedirs(os.path.join(datadir, s), exist_ok=True)
229	                for k, v in synset_dict.items():
230	                    src = os.path.join(datadir, k)
</pre>
</div>


</div>
</div>

<div id="issue-20">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/utils.py</a><br>
    <b>Line number: </b>19<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
3	import tarfile
4	import urllib
5	import zipfile
6	from pathlib import Path
7	
8	import numpy as np
9	import torch
10	from controlnet_aux.diffusion_edge.taming.data.helper_types import Annotation
11	from torch._six import string_classes
12	from torch.utils.data._utils.collate import np_str_obj_array_pattern, default_collate_err_msg_format
13	from tqdm import tqdm
14	
15	
16	def unpack(path):
17	    if path.endswith(&quot;tar.gz&quot;):
18	        with tarfile.open(path, &quot;r:gz&quot;) as tar:
19	            tar.extractall(path=os.path.split(path)[0])
20	    elif path.endswith(&quot;tar&quot;):
21	        with tarfile.open(path, &quot;r:&quot;) as tar:
22	            tar.extractall(path=os.path.split(path)[0])
23	    elif path.endswith(&quot;zip&quot;):
24	        with zipfile.ZipFile(path, &quot;r&quot;) as f:
25	            f.extractall(path=os.path.split(path)[0])
26	    else:
27	        raise NotImplementedError(
28	            &quot;Unknown file extension: {}&quot;.format(os.path.splitext(path)[1])
29	        )
30	
31	
32	def reporthook(bar):
33	    &quot;&quot;&quot;tqdm progress bar for downloads.&quot;&quot;&quot;
34	
</pre>
</div>


</div>
</div>

<div id="issue-21">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/utils.py</a><br>
    <b>Line number: </b>22<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
6	from pathlib import Path
7	
8	import numpy as np
9	import torch
10	from controlnet_aux.diffusion_edge.taming.data.helper_types import Annotation
11	from torch._six import string_classes
12	from torch.utils.data._utils.collate import np_str_obj_array_pattern, default_collate_err_msg_format
13	from tqdm import tqdm
14	
15	
16	def unpack(path):
17	    if path.endswith(&quot;tar.gz&quot;):
18	        with tarfile.open(path, &quot;r:gz&quot;) as tar:
19	            tar.extractall(path=os.path.split(path)[0])
20	    elif path.endswith(&quot;tar&quot;):
21	        with tarfile.open(path, &quot;r:&quot;) as tar:
22	            tar.extractall(path=os.path.split(path)[0])
23	    elif path.endswith(&quot;zip&quot;):
24	        with zipfile.ZipFile(path, &quot;r&quot;) as f:
25	            f.extractall(path=os.path.split(path)[0])
26	    else:
27	        raise NotImplementedError(
28	            &quot;Unknown file extension: {}&quot;.format(os.path.splitext(path)[1])
29	        )
30	
31	
32	def reporthook(bar):
33	    &quot;&quot;&quot;tqdm progress bar for downloads.&quot;&quot;&quot;
34	
35	    def hook(b=1, bsize=1, tsize=None):
36	        if tsize is not None:
37	            bar.total = tsize
</pre>
</div>


</div>
</div>

<div id="issue-22">
<div class="issue-block issue-sev-high">
    <b>tarfile_unsafe_members: </b> tarfile.extractall used without any validation. Please check and discard dangerous members.<br>
    <b>Test ID:</b> B202<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/utils.py</a><br>
    <b>Line number: </b>25<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b202_tarfile_unsafe_members.html</a><br>

<div class="code">
<pre>
9	import torch
10	from controlnet_aux.diffusion_edge.taming.data.helper_types import Annotation
11	from torch._six import string_classes
12	from torch.utils.data._utils.collate import np_str_obj_array_pattern, default_collate_err_msg_format
13	from tqdm import tqdm
14	
15	
16	def unpack(path):
17	    if path.endswith(&quot;tar.gz&quot;):
18	        with tarfile.open(path, &quot;r:gz&quot;) as tar:
19	            tar.extractall(path=os.path.split(path)[0])
20	    elif path.endswith(&quot;tar&quot;):
21	        with tarfile.open(path, &quot;r:&quot;) as tar:
22	            tar.extractall(path=os.path.split(path)[0])
23	    elif path.endswith(&quot;zip&quot;):
24	        with zipfile.ZipFile(path, &quot;r&quot;) as f:
25	            f.extractall(path=os.path.split(path)[0])
26	    else:
27	        raise NotImplementedError(
28	            &quot;Unknown file extension: {}&quot;.format(os.path.splitext(path)[1])
29	        )
30	
31	
32	def reporthook(bar):
33	    &quot;&quot;&quot;tqdm progress bar for downloads.&quot;&quot;&quot;
34	
35	    def hook(b=1, bsize=1, tsize=None):
36	        if tsize is not None:
37	            bar.total = tsize
38	        bar.update(b * bsize - bar.n)
39	
40	    return hook
</pre>
</div>


</div>
</div>

<div id="issue-23">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Audit url open for permitted schemes. Allowing use of file:/ or custom schemes is often unexpected.<br>
    <b>Test ID:</b> B310<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/data/utils.py</a><br>
    <b>Line number: </b>84<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen</a><br>

<div class="code">
<pre>
68	        if content_dir is not None:
69	            print(
70	                &quot;Or place its content into &#x27;{}&#x27;.&quot;.format(
71	                    os.path.join(target_dir, content_dir)
72	                )
73	            )
74	        input(&quot;Press Enter when done...&quot;)
75	    return targetpath
76	
77	
78	def download_url(file_, url, target_dir):
79	    targetpath = os.path.join(target_dir, file_)
80	    os.makedirs(target_dir, exist_ok=True)
81	    with tqdm(
82	        unit=&quot;B&quot;, unit_scale=True, unit_divisor=1024, miniters=1, desc=file_
83	    ) as bar:
84	        urllib.request.urlretrieve(url, targetpath, reporthook=reporthook(bar))
85	    return targetpath
86	
87	
88	def download_urls(urls, target_dir):
89	    paths = dict()
90	    for fname, url in urls.items():
91	        outpath = download_url(fname, url, target_dir)
92	        paths[fname] = outpath
93	    return paths
94	
95	
96	def quadratic_crop(x, bbox, alpha=1.0):
97	    &quot;&quot;&quot;bbox is xmin, ymin, xmax, ymax&quot;&quot;&quot;
98	    im_h, im_w = x.shape[:2]
99	    bbox = np.array(bbox, dtype=np.float32)
</pre>
</div>


</div>
</div>

<div id="issue-24">
<div class="issue-block issue-sev-medium">
    <b>request_without_timeout: </b> Requests call without timeout<br>
    <b>Test ID:</b> B113<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>LOW<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/400.html" target="_blank">CWE-400</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/modules/losses/util.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/modules/losses/util.py</a><br>
    <b>Line number: </b>20<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html</a><br>

<div class="code">
<pre>
4	
5	URL_MAP = {
6	    &quot;vgg_lpips&quot;: &quot;https://heibox.uni-heidelberg.de/f/607503859c864bc1b30b/?dl=1&quot;
7	}
8	
9	CKPT_MAP = {
10	    &quot;vgg_lpips&quot;: &quot;vgg.pth&quot;
11	}
12	
13	MD5_MAP = {
14	    &quot;vgg_lpips&quot;: &quot;d507d7349b931f0638a25a48a722f98a&quot;
15	}
16	
17	
18	def download(url, local_path, chunk_size=1024):
19	    os.makedirs(os.path.split(local_path)[0], exist_ok=True)
20	    with requests.get(url, stream=True) as r:
21	        total_size = int(r.headers.get(&quot;content-length&quot;, 0))
22	        with tqdm(total=total_size, unit=&quot;B&quot;, unit_scale=True) as pbar:
23	            with open(local_path, &quot;wb&quot;) as f:
24	                for data in r.iter_content(chunk_size=chunk_size):
25	                    if data:
26	                        f.write(data)
27	                        pbar.update(chunk_size)
28	
29	
30	def md5_hash(path):
31	    with open(path, &quot;rb&quot;) as f:
32	        content = f.read()
33	    return hashlib.md5(content).hexdigest()
34	
35	
</pre>
</div>


</div>
</div>

<div id="issue-25">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak MD5 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/modules/losses/util.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/modules/losses/util.py</a><br>
    <b>Line number: </b>33<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
17	
18	def download(url, local_path, chunk_size=1024):
19	    os.makedirs(os.path.split(local_path)[0], exist_ok=True)
20	    with requests.get(url, stream=True) as r:
21	        total_size = int(r.headers.get(&quot;content-length&quot;, 0))
22	        with tqdm(total=total_size, unit=&quot;B&quot;, unit_scale=True) as pbar:
23	            with open(local_path, &quot;wb&quot;) as f:
24	                for data in r.iter_content(chunk_size=chunk_size):
25	                    if data:
26	                        f.write(data)
27	                        pbar.update(chunk_size)
28	
29	
30	def md5_hash(path):
31	    with open(path, &quot;rb&quot;) as f:
32	        content = f.read()
33	    return hashlib.md5(content).hexdigest()
34	
35	
36	def get_ckpt_path(name, root, check=False):
37	    assert name in URL_MAP
38	    path = os.path.join(root, CKPT_MAP[name])
39	    if not os.path.exists(path) or (check and not md5_hash(path) == MD5_MAP[name]):
40	        print(&quot;Downloading {} model from {} to {}&quot;.format(name, URL_MAP[name], path))
41	        download(URL_MAP[name], path)
42	        md5 = md5_hash(path)
43	        assert md5 == MD5_MAP[name], md5
44	    return path
45	
46	
47	class KeyNotFoundError(Exception):
48	    def __init__(self, cause, keys=None, visited=None):
</pre>
</div>


</div>
</div>

<div id="issue-26">
<div class="issue-block issue-sev-medium">
    <b>request_without_timeout: </b> Requests call without timeout<br>
    <b>Test ID:</b> B113<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>LOW<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/400.html" target="_blank">CWE-400</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/util.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/util.py</a><br>
    <b>Line number: </b>20<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html</a><br>

<div class="code">
<pre>
4	
5	URL_MAP = {
6	    &quot;vgg_lpips&quot;: &quot;https://heibox.uni-heidelberg.de/f/607503859c864bc1b30b/?dl=1&quot;
7	}
8	
9	CKPT_MAP = {
10	    &quot;vgg_lpips&quot;: &quot;vgg.pth&quot;
11	}
12	
13	MD5_MAP = {
14	    &quot;vgg_lpips&quot;: &quot;d507d7349b931f0638a25a48a722f98a&quot;
15	}
16	
17	
18	def download(url, local_path, chunk_size=1024):
19	    os.makedirs(os.path.split(local_path)[0], exist_ok=True)
20	    with requests.get(url, stream=True) as r:
21	        total_size = int(r.headers.get(&quot;content-length&quot;, 0))
22	        with tqdm(total=total_size, unit=&quot;B&quot;, unit_scale=True) as pbar:
23	            with open(local_path, &quot;wb&quot;) as f:
24	                for data in r.iter_content(chunk_size=chunk_size):
25	                    if data:
26	                        f.write(data)
27	                        pbar.update(chunk_size)
28	
29	
30	def md5_hash(path):
31	    with open(path, &quot;rb&quot;) as f:
32	        content = f.read()
33	    return hashlib.md5(content).hexdigest()
34	
35	
</pre>
</div>


</div>
</div>

<div id="issue-27">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak MD5 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/util.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/diffusion_edge/taming/util.py</a><br>
    <b>Line number: </b>33<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
17	
18	def download(url, local_path, chunk_size=1024):
19	    os.makedirs(os.path.split(local_path)[0], exist_ok=True)
20	    with requests.get(url, stream=True) as r:
21	        total_size = int(r.headers.get(&quot;content-length&quot;, 0))
22	        with tqdm(total=total_size, unit=&quot;B&quot;, unit_scale=True) as pbar:
23	            with open(local_path, &quot;wb&quot;) as f:
24	                for data in r.iter_content(chunk_size=chunk_size):
25	                    if data:
26	                        f.write(data)
27	                        pbar.update(chunk_size)
28	
29	
30	def md5_hash(path):
31	    with open(path, &quot;rb&quot;) as f:
32	        content = f.read()
33	    return hashlib.md5(content).hexdigest()
34	
35	
36	def get_ckpt_path(name, root, check=False):
37	    assert name in URL_MAP
38	    path = os.path.join(root, CKPT_MAP[name])
39	    if not os.path.exists(path) or (check and not md5_hash(path) == MD5_MAP[name]):
40	        print(&quot;Downloading {} model from {} to {}&quot;.format(name, URL_MAP[name], path))
41	        download(URL_MAP[name], path)
42	        md5 = md5_hash(path)
43	        assert md5 == MD5_MAP[name], md5
44	    return path
45	
46	
47	class KeyNotFoundError(Exception):
48	    def __init__(self, cause, keys=None, visited=None):
</pre>
</div>


</div>
</div>

<div id="issue-28">
<div class="issue-block issue-sev-medium">
    <b>exec_used: </b> Use of exec detected.<br>
    <b>Test ID:</b> B102<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/dsine/models/submodules/efficientnet_repo/setup.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/dsine/models/submodules/efficientnet_repo/setup.py</a><br>
    <b>Line number: </b>13<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html</a><br>

<div class="code">
<pre>
1	&quot;&quot;&quot; Setup
2	&quot;&quot;&quot;
3	from setuptools import setup, find_packages
4	from codecs import open
5	from os import path
6	
7	here = path.abspath(path.dirname(__file__))
8	
9	# Get the long description from the README file
10	with open(path.join(here, &#x27;README.md&#x27;), encoding=&#x27;utf-8&#x27;) as f:
11	    long_description = f.read()
12	
13	exec(open(&#x27;geffnet/version.py&#x27;).read())
14	setup(
15	    name=&#x27;geffnet&#x27;,
16	    version=__version__,
17	    description=&#x27;(Generic) EfficientNets for PyTorch&#x27;,
18	    long_description=long_description,
19	    long_description_content_type=&#x27;text/markdown&#x27;,
20	    url=&#x27;https://github.com/rwightman/gen-efficientnet-pytorch&#x27;,
21	    author=&#x27;Ross Wightman&#x27;,
22	    author_email=&#x27;hello@rwightman.com&#x27;,
23	    classifiers=[
24	        # How mature is this project? Common values are
25	        #   3 - Alpha
26	        #   4 - Beta
27	        #   5 - Production/Stable
28	        &#x27;Development Status :: 3 - Alpha&#x27;,
29	        &#x27;Intended Audience :: Education&#x27;,
30	        &#x27;Intended Audience :: Science/Research&#x27;,
31	        &#x27;License :: OSI Approved :: Apache Software License&#x27;,
32	        &#x27;Programming Language :: Python :: 3.6&#x27;,
</pre>
</div>


</div>
</div>

<div id="issue-29">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/mlsd/__init__.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/mlsd/__init__.py</a><br>
    <b>Line number: </b>43<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
27	
28	    def to(self, device):
29	        self.model.to(device)
30	        return self
31	    
32	    def __call__(self, input_image, thr_v=0.1, thr_d=0.1, detect_resolution=512, output_type=&quot;pil&quot;, upscale_method=&quot;INTER_AREA&quot;, **kwargs):
33	        input_image, output_type = common_input_validate(input_image, output_type, **kwargs)
34	        detected_map, remove_pad = resize_image_with_pad(input_image, detect_resolution, upscale_method)
35	        img = detected_map
36	        img_output = np.zeros_like(img)
37	        try:
38	            with torch.no_grad():
39	                lines = pred_lines(img, self.model, [img.shape[0], img.shape[1]], thr_v, thr_d)
40	                for line in lines:
41	                    x_start, y_start, x_end, y_end = [int(val) for val in line]
42	                    cv2.line(img_output, (x_start, y_start), (x_end, y_end), [255, 255, 255], 1)
43	        except Exception as e:
44	            pass
45	
46	        detected_map = remove_pad(HWC3(img_output[:, :, 0]))
47	
48	        if output_type == &quot;pil&quot;:
49	            detected_map = Image.fromarray(detected_map)
50	            
51	        return detected_map
</pre>
</div>


</div>
</div>

<div id="issue-30">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/mlsd/utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/mlsd/utils.py</a><br>
    <b>Line number: </b>555<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
539	        &#x27;&#x27;&#x27;
540	        score_w = [overlap, degree, area, center, length]
541	        &#x27;&#x27;&#x27;
542	        score_w = [0.0, 1.0, 10.0, 0.5, 1.0]
543	        score_array = params[&#x27;w_overlap&#x27;] * overlap_scores \
544	                      + params[&#x27;w_degree&#x27;] * degree_scores \
545	                      + params[&#x27;w_area&#x27;] * area_scores \
546	                      - params[&#x27;w_center&#x27;] * center_scores \
547	                      + params[&#x27;w_length&#x27;] * length_scores
548	
549	        best_square = []
550	
551	        sorted_idx = np.argsort(score_array)[::-1]
552	        score_array = score_array[sorted_idx]
553	        squares = squares[sorted_idx]
554	
555	    except Exception as e:
556	        pass
557	
558	    &#x27;&#x27;&#x27;return list
559	    merged_lines, squares, scores
560	    &#x27;&#x27;&#x27;
561	
562	    try:
563	        new_segments[:, 0] = new_segments[:, 0] * 2 / input_shape[1] * original_shape[1]
564	        new_segments[:, 1] = new_segments[:, 1] * 2 / input_shape[0] * original_shape[0]
565	        new_segments[:, 2] = new_segments[:, 2] * 2 / input_shape[1] * original_shape[1]
566	        new_segments[:, 3] = new_segments[:, 3] * 2 / input_shape[0] * original_shape[0]
567	    except:
568	        new_segments = []
569	
570	    try:
571	        squares[:, :, 0] = squares[:, :, 0] * 2 / input_shape[1] * original_shape[1]
</pre>
</div>


</div>
</div>

<div id="issue-31">
<div class="issue-block issue-sev-medium">
    <b>exec_used: </b> Use of exec detected.<br>
    <b>Test ID:</b> B102<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/normalbae/nets/submodules/efficientnet_repo/setup.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/normalbae/nets/submodules/efficientnet_repo/setup.py</a><br>
    <b>Line number: </b>13<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html</a><br>

<div class="code">
<pre>
1	&quot;&quot;&quot; Setup
2	&quot;&quot;&quot;
3	from setuptools import setup, find_packages
4	from codecs import open
5	from os import path
6	
7	here = path.abspath(path.dirname(__file__))
8	
9	# Get the long description from the README file
10	with open(path.join(here, &#x27;README.md&#x27;), encoding=&#x27;utf-8&#x27;) as f:
11	    long_description = f.read()
12	
13	exec(open(&#x27;geffnet/version.py&#x27;).read())
14	setup(
15	    name=&#x27;geffnet&#x27;,
16	    version=__version__,
17	    description=&#x27;(Generic) EfficientNets for PyTorch&#x27;,
18	    long_description=long_description,
19	    long_description_content_type=&#x27;text/markdown&#x27;,
20	    url=&#x27;https://github.com/rwightman/gen-efficientnet-pytorch&#x27;,
21	    author=&#x27;Ross Wightman&#x27;,
22	    author_email=&#x27;hello@rwightman.com&#x27;,
23	    classifiers=[
24	        # How mature is this project? Common values are
25	        #   3 - Alpha
26	        #   4 - Beta
27	        #   5 - Production/Stable
28	        &#x27;Development Status :: 3 - Alpha&#x27;,
29	        &#x27;Intended Audience :: Education&#x27;,
30	        &#x27;Intended Audience :: Science/Research&#x27;,
31	        &#x27;License :: OSI Approved :: Apache Software License&#x27;,
32	        &#x27;Programming Language :: Python :: 3.6&#x27;,
</pre>
</div>


</div>
</div>

<div id="issue-32">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/unimatch/utils/dist_utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/unimatch/utils/dist_utils.py</a><br>
    <b>Line number: </b>5<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	# https://github.com/open-mmlab/mmcv/blob/7540cf73ac7e5d1e14d0ffbd9b6759e83929ecfc/mmcv/runner/dist_utils.py
3	
4	import os
5	import subprocess
6	
7	import torch
8	import torch.multiprocessing as mp
9	from torch import distributed as dist
10	
11	
12	def init_dist(launcher, backend=&#x27;nccl&#x27;, **kwargs):
13	    if mp.get_start_method(allow_none=True) is None:
14	        mp.set_start_method(&#x27;spawn&#x27;)
15	    if launcher == &#x27;pytorch&#x27;:
16	        _init_dist_pytorch(backend, **kwargs)
17	    elif launcher == &#x27;mpi&#x27;:
18	        _init_dist_mpi(backend, **kwargs)
19	    elif launcher == &#x27;slurm&#x27;:
20	        _init_dist_slurm(backend, **kwargs)
21	    else:
22	        raise ValueError(f&#x27;Invalid launcher type: {launcher}&#x27;)
23	
24	
25	def _init_dist_pytorch(backend, **kwargs):
26	    # TODO: use local_rank instead of rank % num_gpus
27	    rank = int(os.environ[&#x27;RANK&#x27;])
28	    num_gpus = torch.cuda.device_count()
29	    torch.cuda.set_device(rank % num_gpus)
30	    dist.init_process_group(backend=backend, **kwargs)
31	
32	
</pre>
</div>


</div>
</div>

<div id="issue-33">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/controlnet_aux/unimatch/utils/dist_utils.py" target="_blank">comfyui_controlnet_aux/src/controlnet_aux/unimatch/utils/dist_utils.py</a><br>
    <b>Line number: </b>55<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
39	
40	
41	def _init_dist_slurm(backend, port=None):
42	    &quot;&quot;&quot;Initialize slurm distributed training environment.
43	    If argument ``port`` is not specified, then the master port will be system
44	    environment variable ``MASTER_PORT``. If ``MASTER_PORT`` is not in system
45	    environment variable, then a default port ``29500`` will be used.
46	    Args:
47	        backend (str): Backend of torch.distributed.
48	        port (int, optional): Master port. Defaults to None.
49	    &quot;&quot;&quot;
50	    proc_id = int(os.environ[&#x27;SLURM_PROCID&#x27;])
51	    ntasks = int(os.environ[&#x27;SLURM_NTASKS&#x27;])
52	    node_list = os.environ[&#x27;SLURM_NODELIST&#x27;]
53	    num_gpus = torch.cuda.device_count()
54	    torch.cuda.set_device(proc_id % num_gpus)
55	    addr = subprocess.getoutput(
56	        f&#x27;scontrol show hostname {node_list} | head -n1&#x27;)
57	    # specify master port
58	    if port is not None:
59	        os.environ[&#x27;MASTER_PORT&#x27;] = str(port)
60	    elif &#x27;MASTER_PORT&#x27; in os.environ:
61	        pass  # use MASTER_PORT in the environment variable
62	    else:
63	        # 29500 is torch.distributed default port
64	        os.environ[&#x27;MASTER_PORT&#x27;] = &#x27;29500&#x27;
65	    # use MASTER_ADDR in the environment variable if it already exists
66	    if &#x27;MASTER_ADDR&#x27; not in os.environ:
67	        os.environ[&#x27;MASTER_ADDR&#x27;] = addr
68	    os.environ[&#x27;WORLD_SIZE&#x27;] = str(ntasks)
69	    os.environ[&#x27;LOCAL_RANK&#x27;] = str(proc_id % num_gpus)
70	    os.environ[&#x27;RANK&#x27;] = str(proc_id)
71	    dist.init_process_group(backend=backend)
</pre>
</div>


</div>
</div>

<div id="issue-34">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/checkpoint/detection_checkpoint.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/checkpoint/detection_checkpoint.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) Facebook, Inc. and its affiliates.
2	import logging
3	import os
4	import pickle
5	from urllib.parse import parse_qs, urlparse
6	import torch
7	from fvcore.common.checkpoint import Checkpointer
8	from torch.nn.parallel import DistributedDataParallel
9	
10	import custom_detectron2.utils.comm as comm
11	from custom_detectron2.utils.file_io import PathManager
12	
13	from .c2_model_loading import align_and_update_state_dicts
14	
15	
16	class DetectionCheckpointer(Checkpointer):
17	    &quot;&quot;&quot;
18	    Same as :class:`Checkpointer`, but is able to:
19	    1. handle models in detectron &amp; detectron2 model zoo, and apply conversions for legacy models.
20	    2. correctly load checkpoints that are only available on the master worker
21	    &quot;&quot;&quot;
22	
23	    def __init__(self, model, save_dir=&quot;&quot;, *, save_to_disk=None, **checkpointables):
24	        is_main_process = comm.is_main_process()
25	        super().__init__(
26	            model,
27	            save_dir,
28	            save_to_disk=is_main_process if save_to_disk is None else save_to_disk,
29	            **checkpointables,
30	        )
31	        self.path_manager = PathManager
32	        self._parsed_url_during_load = None
</pre>
</div>


</div>
</div>

<div id="issue-35">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/checkpoint/detection_checkpoint.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/checkpoint/detection_checkpoint.py</a><br>
    <b>Line number: </b>75<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
59	            self._parsed_url_during_load = parsed_url
60	            path = parsed_url._replace(query=&quot;&quot;).geturl()  # remove query from filename
61	            path = self.path_manager.get_local_path(path)
62	
63	        self.logger.setLevel(&#x27;CRITICAL&#x27;)
64	        ret = super().load(path, *args, **kwargs)
65	
66	        if need_sync:
67	            logger.info(&quot;Broadcasting model states from main worker ...&quot;)
68	            self.model._sync_params_and_buffers()
69	        self._parsed_url_during_load = None  # reset to None
70	        return ret
71	
72	    def _load_file(self, filename):
73	        if filename.endswith(&quot;.pkl&quot;):
74	            with PathManager.open(filename, &quot;rb&quot;) as f:
75	                data = pickle.load(f, encoding=&quot;latin1&quot;)
76	            if &quot;model&quot; in data and &quot;__author__&quot; in data:
77	                # file is in Detectron2 model zoo format
78	                self.logger.info(&quot;Reading a file from &#x27;{}&#x27;&quot;.format(data[&quot;__author__&quot;]))
79	                return data
80	            else:
81	                # assume file is from Caffe2 / Detectron1 model zoo
82	                if &quot;blobs&quot; in data:
83	                    # Detection models have &quot;blobs&quot;, but ImageNet models don&#x27;t
84	                    data = data[&quot;blobs&quot;]
85	                data = {k: v for k, v in data.items() if not k.endswith(&quot;_momentum&quot;)}
86	                return {&quot;model&quot;: data, &quot;__author__&quot;: &quot;Caffe2&quot;, &quot;matching_heuristics&quot;: True}
87	        elif filename.endswith(&quot;.pyth&quot;):
88	            # assume file is from pycls; no one else seems to use the &quot;.pyth&quot; extension
89	            with PathManager.open(filename, &quot;rb&quot;) as f:
90	                data = torch.load(f)
</pre>
</div>


</div>
</div>

<div id="issue-36">
<div class="issue-block issue-sev-medium">
    <b>exec_used: </b> Use of exec detected.<br>
    <b>Test ID:</b> B102<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/config/lazy.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/config/lazy.py</a><br>
    <b>Line number: </b>161<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html</a><br>

<div class="code">
<pre>
145	    def new_import(name, globals=None, locals=None, fromlist=(), level=0):
146	        if (
147	            # Only deal with relative imports inside config files
148	            level != 0
149	            and globals is not None
150	            and (globals.get(&quot;__package__&quot;, &quot;&quot;) or &quot;&quot;).startswith(_CFG_PACKAGE_NAME)
151	        ):
152	            cur_file = find_relative_file(globals[&quot;__file__&quot;], name, level)
153	            _validate_py_syntax(cur_file)
154	            spec = importlib.machinery.ModuleSpec(
155	                _random_package_name(cur_file), None, origin=cur_file
156	            )
157	            module = importlib.util.module_from_spec(spec)
158	            module.__file__ = cur_file
159	            with PathManager.open(cur_file) as f:
160	                content = f.read()
161	            exec(compile(content, cur_file, &quot;exec&quot;), module.__dict__)
162	            for name in fromlist:  # turn imported dict into DictConfig automatically
163	                val = _cast_to_config(module.__dict__[name])
164	                module.__dict__[name] = val
165	            return module
166	        return old_import(name, globals, locals, fromlist=fromlist, level=level)
167	
168	    builtins.__import__ = new_import
169	    yield new_import
170	    builtins.__import__ = old_import
171	
172	
173	class LazyConfig:
174	    &quot;&quot;&quot;
175	    Provide methods to save, load, and overrides an omegaconf config object
176	    which may contain definition of lazily-constructed objects.
</pre>
</div>


</div>
</div>

<div id="issue-37">
<div class="issue-block issue-sev-medium">
    <b>exec_used: </b> Use of exec detected.<br>
    <b>Test ID:</b> B102<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/config/lazy.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/config/lazy.py</a><br>
    <b>Line number: </b>223<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html</a><br>

<div class="code">
<pre>
207	        if os.path.splitext(filename)[1] not in [&quot;.py&quot;, &quot;.yaml&quot;, &quot;.yml&quot;]:
208	            raise ValueError(f&quot;Config file {filename} has to be a python or yaml file.&quot;)
209	        if filename.endswith(&quot;.py&quot;):
210	            _validate_py_syntax(filename)
211	
212	            with _patch_import():
213	                # Record the filename
214	                module_namespace = {
215	                    &quot;__file__&quot;: filename,
216	                    &quot;__package__&quot;: _random_package_name(filename),
217	                }
218	                with PathManager.open(filename) as f:
219	                    content = f.read()
220	                # Compile first with filename to:
221	                # 1. make filename appears in stacktrace
222	                # 2. make load_rel able to find its parent&#x27;s (possibly remote) location
223	                exec(compile(content, filename, &quot;exec&quot;), module_namespace)
224	
225	            ret = module_namespace
226	        else:
227	            with PathManager.open(filename) as f:
228	                obj = yaml.unsafe_load(f)
229	            ret = OmegaConf.create(obj, flags={&quot;allow_objects&quot;: True})
230	
231	        if has_keys:
232	            if isinstance(keys, str):
233	                return _cast_to_config(ret[keys])
234	            else:
235	                return tuple(_cast_to_config(ret[a]) for a in keys)
236	        else:
237	            if filename.endswith(&quot;.py&quot;):
238	                # when not specified, only load those that are config objects
</pre>
</div>


</div>
</div>

<div id="issue-38">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/config/lazy.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/config/lazy.py</a><br>
    <b>Line number: </b>265<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
249	
250	    @staticmethod
251	    def save(cfg, filename: str):
252	        &quot;&quot;&quot;
253	        Save a config object to a yaml file.
254	        Note that when the config dictionary contains complex objects (e.g. lambda),
255	        it can&#x27;t be saved to yaml. In that case we will print an error and
256	        attempt to save to a pkl file instead.
257	
258	        Args:
259	            cfg: an omegaconf config object
260	            filename: yaml file name to save the config file
261	        &quot;&quot;&quot;
262	        logger = logging.getLogger(__name__)
263	        try:
264	            cfg = deepcopy(cfg)
265	        except Exception:
266	            pass
267	        else:
268	            # if it&#x27;s deep-copyable, then...
269	            def _replace_type_by_name(x):
270	                if &quot;_target_&quot; in x and callable(x._target_):
271	                    try:
272	                        x._target_ = _convert_target_to_string(x._target_)
273	                    except AttributeError:
274	                        pass
275	
276	            # not necessary, but makes yaml looks nicer
277	            _visit_dict_config(cfg, _replace_type_by_name)
278	
279	        save_pkl = False
280	        try:
281	            dict = OmegaConf.to_container(
</pre>
</div>


</div>
</div>

<div id="issue-39">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/config/lazy.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/config/lazy.py</a><br>
    <b>Line number: </b>367<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
351	
352	        if has_hydra:
353	            parser = OverridesParser.create()
354	            overrides = parser.parse_overrides(overrides)
355	            for o in overrides:
356	                key = o.key_or_group
357	                value = o.value()
358	                if o.is_delete():
359	                    # TODO support this
360	                    raise NotImplementedError(&quot;deletion is not yet a supported override&quot;)
361	                safe_update(cfg, key, value)
362	        else:
363	            # Fallback. Does not support all the features and error checking like hydra.
364	            for o in overrides:
365	                key, value = o.split(&quot;=&quot;)
366	                try:
367	                    value = eval(value, {})
368	                except NameError:
369	                    pass
370	                safe_update(cfg, key, value)
371	        return cfg
372	
373	    # @staticmethod
374	    # def to_py(cfg, prefix: str = &quot;cfg.&quot;):
375	    #     &quot;&quot;&quot;
376	    #     Try to convert a config object into Python-like psuedo code.
377	    #
378	    #     Note that perfect conversion is not always possible. So the returned
379	    #     results are mainly meant to be human-readable, and not meant to be executed.
380	    #
381	    #     Args:
382	    #         cfg: an omegaconf config object
</pre>
</div>


</div>
</div>

<div id="issue-40">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/data/build.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/data/build.py</a><br>
    <b>Line number: </b>6<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) Facebook, Inc. and its affiliates.
2	import itertools
3	import logging
4	import numpy as np
5	import operator
6	import pickle
7	from typing import Any, Callable, Dict, List, Optional, Union
8	import torch
9	import torch.utils.data as torchdata
10	from tabulate import tabulate
11	from termcolor import colored
12	
13	from custom_detectron2.config import configurable
14	from custom_detectron2.structures import BoxMode
15	from custom_detectron2.utils.comm import get_world_size
16	from custom_detectron2.utils.env import seed_all_rng
17	from custom_detectron2.utils.file_io import PathManager
18	from custom_detectron2.utils.logger import _log_api_usage, log_first_n
19	
20	from .catalog import DatasetCatalog, MetadataCatalog
21	from .common import AspectRatioGroupedDataset, DatasetFromList, MapDataset, ToIterableDataset
22	from .dataset_mapper import DatasetMapper
23	from .detection_utils import check_metadata_consistency
24	from .samplers import (
25	    InferenceSampler,
26	    RandomSubsetTrainingSampler,
27	    RepeatFactorTrainingSampler,
28	    TrainingSampler,
29	)
30	
31	&quot;&quot;&quot;
32	This file contains the default logic to build a dataloader for training or testing.
</pre>
</div>


</div>
</div>

<div id="issue-41">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/data/build.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/data/build.py</a><br>
    <b>Line number: </b>133<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
117	    - &quot;boxes&quot;: list[np.ndarray], each is an Nx4 array of boxes corresponding to the image id
118	    - &quot;objectness_logits&quot;: list[np.ndarray], each is an N sized array of objectness scores
119	      corresponding to the boxes.
120	    - &quot;bbox_mode&quot;: the BoxMode of the boxes array. Defaults to ``BoxMode.XYXY_ABS``.
121	
122	    Args:
123	        dataset_dicts (list[dict]): annotations in Detectron2 Dataset format.
124	        proposal_file (str): file path of pre-computed proposals, in pkl format.
125	
126	    Returns:
127	        list[dict]: the same format as dataset_dicts, but added proposal field.
128	    &quot;&quot;&quot;
129	    logger = logging.getLogger(__name__)
130	    logger.info(&quot;Loading proposals from: {}&quot;.format(proposal_file))
131	
132	    with PathManager.open(proposal_file, &quot;rb&quot;) as f:
133	        proposals = pickle.load(f, encoding=&quot;latin1&quot;)
134	
135	    # Rename the key names in D1 proposal files
136	    rename_keys = {&quot;indexes&quot;: &quot;ids&quot;, &quot;scores&quot;: &quot;objectness_logits&quot;}
137	    for key in rename_keys:
138	        if key in proposals:
139	            proposals[rename_keys[key]] = proposals.pop(key)
140	
141	    # Fetch the indexes of all proposals that are in the dataset
142	    # Convert image_id to str since they could be int.
143	    img_ids = set({str(record[&quot;image_id&quot;]) for record in dataset_dicts})
144	    id_to_index = {str(id): i for i, id in enumerate(proposals[&quot;ids&quot;]) if str(id) in img_ids}
145	
146	    # Assuming default bbox_mode of precomputed proposals are &#x27;XYXY_ABS&#x27;
147	    bbox_mode = BoxMode(proposals[&quot;bbox_mode&quot;]) if &quot;bbox_mode&quot; in proposals else BoxMode.XYXY_ABS
148	
</pre>
</div>


</div>
</div>

<div id="issue-42">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/data/common.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/data/common.py</a><br>
    <b>Line number: </b>7<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) Facebook, Inc. and its affiliates.
2	import contextlib
3	import copy
4	import itertools
5	import logging
6	import numpy as np
7	import pickle
8	import random
9	from typing import Callable, Union
10	import torch
11	import torch.utils.data as data
12	from torch.utils.data.sampler import Sampler
13	
14	from custom_detectron2.utils.serialize import PicklableWrapper
15	
16	__all__ = [&quot;MapDataset&quot;, &quot;DatasetFromList&quot;, &quot;AspectRatioGroupedDataset&quot;, &quot;ToIterableDataset&quot;]
17	
18	logger = logging.getLogger(__name__)
19	
20	
21	def _shard_iterator_dataloader_worker(iterable):
22	    # Shard the iterable if we&#x27;re currently inside pytorch dataloader worker.
23	    worker_info = data.get_worker_info()
24	    if worker_info is None or worker_info.num_workers == 1:
25	        # do nothing
26	        yield from iterable
27	    else:
28	        yield from itertools.islice(iterable, worker_info.id, None, worker_info.num_workers)
29	
30	
31	class _MapIterableDataset(data.IterableDataset):
32	    &quot;&quot;&quot;
</pre>
</div>


</div>
</div>

<div id="issue-43">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/data/common.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/data/common.py</a><br>
    <b>Line number: </b>156<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
140	        )
141	        self._lst = [_serialize(x) for x in self._lst]
142	        self._addr = np.asarray([len(x) for x in self._lst], dtype=np.int64)
143	        self._addr = torch.from_numpy(np.cumsum(self._addr))
144	        self._lst = torch.from_numpy(np.concatenate(self._lst))
145	        logger.info(&quot;Serialized dataset takes {:.2f} MiB&quot;.format(len(self._lst) / 1024**2))
146	
147	    def __len__(self):
148	        return len(self._addr)
149	
150	    def __getitem__(self, idx):
151	        start_addr = 0 if idx == 0 else self._addr[idx - 1].item()
152	        end_addr = self._addr[idx].item()
153	        bytes = memoryview(self._lst[start_addr:end_addr].numpy())
154	
155	        # @lint-ignore PYTHONPICKLEISBAD
156	        return pickle.loads(bytes)
157	
158	
159	_DEFAULT_DATASET_FROM_LIST_SERIALIZE_METHOD = _TorchSerializedList
160	
161	
162	@contextlib.contextmanager
163	def set_default_dataset_from_list_serialize_method(new):
164	    &quot;&quot;&quot;
165	    Context manager for using custom serialize function when creating DatasetFromList
166	    &quot;&quot;&quot;
167	
168	    global _DEFAULT_DATASET_FROM_LIST_SERIALIZE_METHOD
169	    orig = _DEFAULT_DATASET_FROM_LIST_SERIALIZE_METHOD
170	    _DEFAULT_DATASET_FROM_LIST_SERIALIZE_METHOD = new
171	    yield
</pre>
</div>


</div>
</div>

<div id="issue-44">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Using xml.etree.ElementTree to parse untrusted XML data is known to be vulnerable to XML attacks. Replace xml.etree.ElementTree with the equivalent defusedxml package, or make sure defusedxml.defuse_stdlib() is called.<br>
    <b>Test ID:</b> B405<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/data/datasets/pascal_voc.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/data/datasets/pascal_voc.py</a><br>
    <b>Line number: </b>6<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b405-import-xml-etree" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b405-import-xml-etree</a><br>

<div class="code">
<pre>
1	# -*- coding: utf-8 -*-
2	# Copyright (c) Facebook, Inc. and its affiliates.
3	
4	import numpy as np
5	import os
6	import xml.etree.ElementTree as ET
7	from typing import List, Tuple, Union
8	
9	from custom_detectron2.data import DatasetCatalog, MetadataCatalog
10	from custom_detectron2.structures import BoxMode
11	from custom_detectron2.utils.file_io import PathManager
12	
13	__all__ = [&quot;load_voc_instances&quot;, &quot;register_pascal_voc&quot;]
14	
15	
16	# fmt: off
17	CLASS_NAMES = (
18	    &quot;aeroplane&quot;, &quot;bicycle&quot;, &quot;bird&quot;, &quot;boat&quot;, &quot;bottle&quot;, &quot;bus&quot;, &quot;car&quot;, &quot;cat&quot;,
19	    &quot;chair&quot;, &quot;cow&quot;, &quot;diningtable&quot;, &quot;dog&quot;, &quot;horse&quot;, &quot;motorbike&quot;, &quot;person&quot;,
20	    &quot;pottedplant&quot;, &quot;sheep&quot;, &quot;sofa&quot;, &quot;train&quot;, &quot;tvmonitor&quot;
21	)
22	# fmt: on
23	
24	
25	def load_voc_instances(dirname: str, split: str, class_names: Union[List[str], Tuple[str, ...]]):
26	    &quot;&quot;&quot;
27	    Load Pascal VOC detection annotations to Detectron2 format.
28	
29	    Args:
30	        dirname: Contain &quot;Annotations&quot;, &quot;ImageSets&quot;, &quot;JPEGImages&quot;
31	        split (str): one of &quot;train&quot;, &quot;test&quot;, &quot;val&quot;, &quot;trainval&quot;
32	        class_names: list or tuple of class names
</pre>
</div>


</div>
</div>

<div id="issue-45">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Using xml.etree.ElementTree.parse to parse untrusted XML data is known to be vulnerable to XML attacks. Replace xml.etree.ElementTree.parse with its defusedxml equivalent function or make sure defusedxml.defuse_stdlib() is called<br>
    <b>Test ID:</b> B314<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/data/datasets/pascal_voc.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/data/datasets/pascal_voc.py</a><br>
    <b>Line number: </b>45<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b313-b320-xml-bad-elementtree" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b313-b320-xml-bad-elementtree</a><br>

<div class="code">
<pre>
29	    Args:
30	        dirname: Contain &quot;Annotations&quot;, &quot;ImageSets&quot;, &quot;JPEGImages&quot;
31	        split (str): one of &quot;train&quot;, &quot;test&quot;, &quot;val&quot;, &quot;trainval&quot;
32	        class_names: list or tuple of class names
33	    &quot;&quot;&quot;
34	    with PathManager.open(os.path.join(dirname, &quot;ImageSets&quot;, &quot;Main&quot;, split + &quot;.txt&quot;)) as f:
35	        fileids = np.loadtxt(f, dtype=np.str)
36	
37	    # Needs to read many small annotation files. Makes sense at local
38	    annotation_dirname = PathManager.get_local_path(os.path.join(dirname, &quot;Annotations/&quot;))
39	    dicts = []
40	    for fileid in fileids:
41	        anno_file = os.path.join(annotation_dirname, fileid + &quot;.xml&quot;)
42	        jpeg_file = os.path.join(dirname, &quot;JPEGImages&quot;, fileid + &quot;.jpg&quot;)
43	
44	        with PathManager.open(anno_file) as f:
45	            tree = ET.parse(f)
46	
47	        r = {
48	            &quot;file_name&quot;: jpeg_file,
49	            &quot;image_id&quot;: fileid,
50	            &quot;height&quot;: int(tree.findall(&quot;./size/height&quot;)[0].text),
51	            &quot;width&quot;: int(tree.findall(&quot;./size/width&quot;)[0].text),
52	        }
53	        instances = []
54	
55	        for obj in tree.findall(&quot;object&quot;):
56	            cls = obj.find(&quot;name&quot;).text
57	            # We include &quot;difficult&quot; samples in training.
58	            # Based on limited experiments, they don&#x27;t hurt accuracy.
59	            # difficult = int(obj.find(&quot;difficult&quot;).text)
60	            # if difficult == 1:
</pre>
</div>


</div>
</div>

<div id="issue-46">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/evaluation/coco_evaluation.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/evaluation/coco_evaluation.py</a><br>
    <b>Line number: </b>10<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) Facebook, Inc. and its affiliates.
2	import contextlib
3	import copy
4	import io
5	import itertools
6	import json
7	import logging
8	import numpy as np
9	import os
10	import pickle
11	from collections import OrderedDict
12	import custom_pycocotools.mask as mask_util
13	import torch
14	from custom_pycocotools.coco import COCO
15	from custom_pycocotools.cocoeval import COCOeval
16	from tabulate import tabulate
17	
18	import custom_detectron2.utils.comm as comm
19	from custom_detectron2.config import CfgNode
20	from custom_detectron2.data import MetadataCatalog
21	from custom_detectron2.data.datasets.coco import convert_to_coco_json
22	from custom_detectron2.structures import Boxes, BoxMode, pairwise_iou
23	from custom_detectron2.utils.file_io import PathManager
24	from custom_detectron2.utils.logger import create_small_table
25	
26	from .evaluator import DatasetEvaluator
27	
28	try:
29	    from custom_detectron2.evaluation.fast_eval_api import COCOeval_opt
30	except ImportError:
31	    COCOeval_opt = COCOeval
32	
</pre>
</div>


</div>
</div>

<div id="issue-47">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/evaluation/lvis_evaluation.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/evaluation/lvis_evaluation.py</a><br>
    <b>Line number: </b>7<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) Facebook, Inc. and its affiliates.
2	import copy
3	import itertools
4	import json
5	import logging
6	import os
7	import pickle
8	from collections import OrderedDict
9	import torch
10	
11	import custom_detectron2.utils.comm as comm
12	from custom_detectron2.config import CfgNode
13	from custom_detectron2.data import MetadataCatalog
14	from custom_detectron2.structures import Boxes, BoxMode, pairwise_iou
15	from custom_detectron2.utils.file_io import PathManager
16	from custom_detectron2.utils.logger import create_small_table
17	
18	from .coco_evaluation import instances_to_coco_json
19	from .evaluator import DatasetEvaluator
20	
21	
22	class LVISEvaluator(DatasetEvaluator):
23	    &quot;&quot;&quot;
24	    Evaluate object proposal and instance detection/segmentation outputs using
25	    LVIS&#x27;s metrics and evaluation API.
26	    &quot;&quot;&quot;
27	
28	    def __init__(
29	        self,
30	        dataset_name,
31	        tasks=None,
32	        distributed=True,
</pre>
</div>


</div>
</div>

<div id="issue-48">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Using xml.etree.ElementTree to parse untrusted XML data is known to be vulnerable to XML attacks. Replace xml.etree.ElementTree with the equivalent defusedxml package, or make sure defusedxml.defuse_stdlib() is called.<br>
    <b>Test ID:</b> B405<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/evaluation/pascal_voc_evaluation.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/evaluation/pascal_voc_evaluation.py</a><br>
    <b>Line number: </b>8<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b405-import-xml-etree" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b405-import-xml-etree</a><br>

<div class="code">
<pre>
1	# -*- coding: utf-8 -*-
2	# Copyright (c) Facebook, Inc. and its affiliates.
3	
4	import logging
5	import numpy as np
6	import os
7	import tempfile
8	import xml.etree.ElementTree as ET
9	from collections import OrderedDict, defaultdict
10	from functools import lru_cache
11	import torch
12	
13	from custom_detectron2.data import MetadataCatalog
14	from custom_detectron2.utils import comm
15	from custom_detectron2.utils.file_io import PathManager
16	
17	from .evaluator import DatasetEvaluator
18	
19	
20	class PascalVOCDetectionEvaluator(DatasetEvaluator):
21	    &quot;&quot;&quot;
22	    Evaluate Pascal VOC style AP for Pascal VOC dataset.
23	    It contains a synchronization, therefore has to be called from all ranks.
24	
25	    Note that the concept of AP can be implemented in different ways and may not
26	    produce identical results. This class mimics the implementation of the official
27	    Pascal VOC Matlab API, and should produce similar but not identical results to the
28	    official API.
29	    &quot;&quot;&quot;
30	
31	    def __init__(self, dataset_name):
32	        &quot;&quot;&quot;
</pre>
</div>


</div>
</div>

<div id="issue-49">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Using xml.etree.ElementTree.parse to parse untrusted XML data is known to be vulnerable to XML attacks. Replace xml.etree.ElementTree.parse with its defusedxml equivalent function or make sure defusedxml.defuse_stdlib() is called<br>
    <b>Test ID:</b> B314<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/evaluation/pascal_voc_evaluation.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/evaluation/pascal_voc_evaluation.py</a><br>
    <b>Line number: </b>135<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b313-b320-xml-bad-elementtree" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b313-b320-xml-bad-elementtree</a><br>

<div class="code">
<pre>
119	#
120	# Below code is modified from
121	# https://github.com/rbgirshick/py-faster-rcnn/blob/master/lib/datasets/voc_eval.py
122	# --------------------------------------------------------
123	# Fast/er R-CNN
124	# Licensed under The MIT License [see LICENSE for details]
125	# Written by Bharath Hariharan
126	# --------------------------------------------------------
127	
128	&quot;&quot;&quot;Python implementation of the PASCAL VOC devkit&#x27;s AP evaluation code.&quot;&quot;&quot;
129	
130	
131	@lru_cache(maxsize=None)
132	def parse_rec(filename):
133	    &quot;&quot;&quot;Parse a PASCAL VOC xml file.&quot;&quot;&quot;
134	    with PathManager.open(filename) as f:
135	        tree = ET.parse(f)
136	    objects = []
137	    for obj in tree.findall(&quot;object&quot;):
138	        obj_struct = {}
139	        obj_struct[&quot;name&quot;] = obj.find(&quot;name&quot;).text
140	        obj_struct[&quot;pose&quot;] = obj.find(&quot;pose&quot;).text
141	        obj_struct[&quot;truncated&quot;] = int(obj.find(&quot;truncated&quot;).text)
142	        obj_struct[&quot;difficult&quot;] = int(obj.find(&quot;difficult&quot;).text)
143	        bbox = obj.find(&quot;bndbox&quot;)
144	        obj_struct[&quot;bbox&quot;] = [
145	            int(bbox.find(&quot;xmin&quot;).text),
146	            int(bbox.find(&quot;ymin&quot;).text),
147	            int(bbox.find(&quot;xmax&quot;).text),
148	            int(bbox.find(&quot;ymax&quot;).text),
149	        ]
150	        objects.append(obj_struct)
</pre>
</div>


</div>
</div>

<div id="issue-50">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py</a><br>
    <b>Line number: </b>6<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) Facebook, Inc. and its affiliates.
2	import importlib
3	import numpy as np
4	import os
5	import re
6	import subprocess
7	import sys
8	from collections import defaultdict
9	import PIL
10	import torch
11	import torchvision
12	from tabulate import tabulate
13	
14	__all__ = [&quot;collect_env_info&quot;]
15	
16	
17	def collect_torch_env():
18	    try:
19	        import torch.__config__
20	
21	        return torch.__config__.show()
22	    except ImportError:
23	        # compatible with older versions of pytorch
24	        from torch.utils.collect_env import get_pretty_env_info
25	
26	        return get_pretty_env_info()
27	
28	
29	def get_env_module():
30	    var_name = &quot;DETECTRON2_ENV_MODULE&quot;
31	    return var_name, os.environ.get(var_name, &quot;&lt;not set&gt;&quot;)
32	
</pre>
</div>


</div>
</div>

<div id="issue-51">
<div class="issue-block issue-sev-high">
    <b>subprocess_popen_with_shell_equals_true: </b> subprocess call with shell=True identified, security issue.<br>
    <b>Test ID:</b> B602<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py</a><br>
    <b>Line number: </b>39<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html</a><br>

<div class="code">
<pre>
23	        # compatible with older versions of pytorch
24	        from torch.utils.collect_env import get_pretty_env_info
25	
26	        return get_pretty_env_info()
27	
28	
29	def get_env_module():
30	    var_name = &quot;DETECTRON2_ENV_MODULE&quot;
31	    return var_name, os.environ.get(var_name, &quot;&lt;not set&gt;&quot;)
32	
33	
34	def detect_compute_compatibility(CUDA_HOME, so_file):
35	    try:
36	        cuobjdump = os.path.join(CUDA_HOME, &quot;bin&quot;, &quot;cuobjdump&quot;)
37	        if os.path.isfile(cuobjdump):
38	            output = subprocess.check_output(
39	                &quot;&#x27;{}&#x27; --list-elf &#x27;{}&#x27;&quot;.format(cuobjdump, so_file), shell=True
40	            )
41	            output = output.decode(&quot;utf-8&quot;).strip().split(&quot;\n&quot;)
42	            arch = []
43	            for line in output:
44	                line = re.findall(r&quot;\.sm_([0-9]*)\.&quot;, line)[0]
45	                arch.append(&quot;.&quot;.join(line))
46	            arch = sorted(set(arch))
47	            return &quot;, &quot;.join(arch)
48	        else:
49	            return so_file + &quot;; cannot find cuobjdump&quot;
50	    except Exception:
51	        # unhandled failure
52	        return so_file
53	
54	
55	def collect_env_info():
56	    has_gpu = torch.cuda.is_available()  # true for both CUDA &amp; ROCM
</pre>
</div>


</div>
</div>

<div id="issue-52">
<div class="issue-block issue-sev-high">
    <b>subprocess_popen_with_shell_equals_true: </b> subprocess call with shell=True identified, security issue.<br>
    <b>Test ID:</b> B602<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py</a><br>
    <b>Line number: </b>93<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html</a><br>

<div class="code">
<pre>
77	        )
78	    except ImportError:
79	        data.append((&quot;detectron2&quot;, &quot;failed to import&quot;))
80	    except AttributeError:
81	        data.append((&quot;detectron2&quot;, &quot;imported a wrong installation&quot;))
82	
83	    try:
84	        import custom_detectron2._C as _C
85	    except ImportError as e:
86	        data.append((&quot;detectron2._C&quot;, f&quot;not built correctly: {e}&quot;))
87	
88	        # print system compilers when extension fails to build
89	        if sys.platform != &quot;win32&quot;:  # don&#x27;t know what to do for windows
90	            try:
91	                # this is how torch/utils/cpp_extensions.py choose compiler
92	                cxx = os.environ.get(&quot;CXX&quot;, &quot;c++&quot;)
93	                cxx = subprocess.check_output(&quot;&#x27;{}&#x27; --version&quot;.format(cxx), shell=True)
94	                cxx = cxx.decode(&quot;utf-8&quot;).strip().split(&quot;\n&quot;)[0]
95	            except subprocess.SubprocessError:
96	                cxx = &quot;Not found&quot;
97	            data.append((&quot;Compiler ($CXX)&quot;, cxx))
98	
99	            if has_cuda and CUDA_HOME is not None:
100	                try:
101	                    nvcc = os.path.join(CUDA_HOME, &quot;bin&quot;, &quot;nvcc&quot;)
102	                    nvcc = subprocess.check_output(&quot;&#x27;{}&#x27; -V&quot;.format(nvcc), shell=True)
103	                    nvcc = nvcc.decode(&quot;utf-8&quot;).strip().split(&quot;\n&quot;)[-1]
104	                except subprocess.SubprocessError:
105	                    nvcc = &quot;Not found&quot;
106	                data.append((&quot;CUDA compiler&quot;, nvcc))
107	        if has_cuda and sys.platform != &quot;win32&quot;:
108	            try:
</pre>
</div>


</div>
</div>

<div id="issue-53">
<div class="issue-block issue-sev-high">
    <b>subprocess_popen_with_shell_equals_true: </b> subprocess call with shell=True identified, security issue.<br>
    <b>Test ID:</b> B602<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py</a><br>
    <b>Line number: </b>102<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html</a><br>

<div class="code">
<pre>
86	        data.append((&quot;detectron2._C&quot;, f&quot;not built correctly: {e}&quot;))
87	
88	        # print system compilers when extension fails to build
89	        if sys.platform != &quot;win32&quot;:  # don&#x27;t know what to do for windows
90	            try:
91	                # this is how torch/utils/cpp_extensions.py choose compiler
92	                cxx = os.environ.get(&quot;CXX&quot;, &quot;c++&quot;)
93	                cxx = subprocess.check_output(&quot;&#x27;{}&#x27; --version&quot;.format(cxx), shell=True)
94	                cxx = cxx.decode(&quot;utf-8&quot;).strip().split(&quot;\n&quot;)[0]
95	            except subprocess.SubprocessError:
96	                cxx = &quot;Not found&quot;
97	            data.append((&quot;Compiler ($CXX)&quot;, cxx))
98	
99	            if has_cuda and CUDA_HOME is not None:
100	                try:
101	                    nvcc = os.path.join(CUDA_HOME, &quot;bin&quot;, &quot;nvcc&quot;)
102	                    nvcc = subprocess.check_output(&quot;&#x27;{}&#x27; -V&quot;.format(nvcc), shell=True)
103	                    nvcc = nvcc.decode(&quot;utf-8&quot;).strip().split(&quot;\n&quot;)[-1]
104	                except subprocess.SubprocessError:
105	                    nvcc = &quot;Not found&quot;
106	                data.append((&quot;CUDA compiler&quot;, nvcc))
107	        if has_cuda and sys.platform != &quot;win32&quot;:
108	            try:
109	                so_file = importlib.util.find_spec(&quot;detectron2._C&quot;).origin
110	            except (ImportError, AttributeError):
111	                pass
112	            else:
113	                data.append(
114	                    (&quot;detectron2 arch flags&quot;, detect_compute_compatibility(CUDA_HOME, so_file))
115	                )
116	    else:
117	        # print compilers that are used to build extension
</pre>
</div>


</div>
</div>

<div id="issue-54">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py</a><br>
    <b>Line number: </b>130<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
114	                    (&quot;detectron2 arch flags&quot;, detect_compute_compatibility(CUDA_HOME, so_file))
115	                )
116	    else:
117	        # print compilers that are used to build extension
118	        data.append((&quot;Compiler&quot;, _C.get_compiler_version()))
119	        data.append((&quot;CUDA compiler&quot;, _C.get_cuda_version()))  # cuda or hip
120	        if has_cuda and getattr(_C, &quot;has_cuda&quot;, lambda: True)():
121	            data.append(
122	                (&quot;detectron2 arch flags&quot;, detect_compute_compatibility(CUDA_HOME, _C.__file__))
123	            )
124	
125	    data.append(get_env_module())
126	    data.append((&quot;PyTorch&quot;, torch_version + &quot; @&quot; + os.path.dirname(torch.__file__)))
127	    data.append((&quot;PyTorch debug build&quot;, torch.version.debug))
128	    try:
129	        data.append((&quot;torch._C._GLIBCXX_USE_CXX11_ABI&quot;, torch._C._GLIBCXX_USE_CXX11_ABI))
130	    except Exception:
131	        pass
132	
133	    if not has_gpu:
134	        has_gpu_text = &quot;No: torch.cuda.is_available() == False&quot;
135	    else:
136	        has_gpu_text = &quot;Yes&quot;
137	    data.append((&quot;GPU available&quot;, has_gpu_text))
138	    if has_gpu:
139	        devices = defaultdict(list)
140	        for k in range(torch.cuda.device_count()):
141	            cap = &quot;.&quot;.join((str(x) for x in torch.cuda.get_device_capability(k)))
142	            name = torch.cuda.get_device_name(k) + f&quot; (arch={cap})&quot;
143	            devices[name].append(str(k))
144	        for name, devids in devices.items():
145	            data.append((&quot;GPU &quot; + &quot;,&quot;.join(devids), name))
146	
</pre>
</div>


</div>
</div>

<div id="issue-55">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py</a><br>
    <b>Line number: </b>155<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
139	        devices = defaultdict(list)
140	        for k in range(torch.cuda.device_count()):
141	            cap = &quot;.&quot;.join((str(x) for x in torch.cuda.get_device_capability(k)))
142	            name = torch.cuda.get_device_name(k) + f&quot; (arch={cap})&quot;
143	            devices[name].append(str(k))
144	        for name, devids in devices.items():
145	            data.append((&quot;GPU &quot; + &quot;,&quot;.join(devids), name))
146	
147	        if has_rocm:
148	            msg = &quot; - invalid!&quot; if not (ROCM_HOME and os.path.isdir(ROCM_HOME)) else &quot;&quot;
149	            data.append((&quot;ROCM_HOME&quot;, str(ROCM_HOME) + msg))
150	        else:
151	            try:
152	                from torch.utils.collect_env import get_nvidia_driver_version, run as _run
153	
154	                data.append((&quot;Driver version&quot;, get_nvidia_driver_version(_run)))
155	            except Exception:
156	                pass
157	            msg = &quot; - invalid!&quot; if not (CUDA_HOME and os.path.isdir(CUDA_HOME)) else &quot;&quot;
158	            data.append((&quot;CUDA_HOME&quot;, str(CUDA_HOME) + msg))
159	
160	            cuda_arch_list = os.environ.get(&quot;TORCH_CUDA_ARCH_LIST&quot;, None)
161	            if cuda_arch_list:
162	                data.append((&quot;TORCH_CUDA_ARCH_LIST&quot;, cuda_arch_list))
163	    data.append((&quot;Pillow&quot;, PIL.__version__))
164	
165	    try:
166	        data.append(
167	            (
168	                &quot;torchvision&quot;,
169	                str(torchvision.__version__) + &quot; @&quot; + os.path.dirname(torchvision.__file__),
170	            )
171	        )
</pre>
</div>


</div>
</div>

<div id="issue-56">
<div class="issue-block issue-sev-medium">
    <b>hardcoded_tmp_directory: </b> Probable insecure usage of temp file/directory.<br>
    <b>Test ID:</b> B108<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>MEDIUM<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/377.html" target="_blank">CWE-377</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/utils/collect_env.py</a><br>
    <b>Line number: </b>209<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b108_hardcoded_tmp_directory.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b108_hardcoded_tmp_directory.html</a><br>

<div class="code">
<pre>
193	    except (ImportError, AttributeError):
194	        pass
195	
196	    try:
197	        import cv2
198	
199	        data.append((&quot;cv2&quot;, cv2.__version__))
200	    except (ImportError, AttributeError):
201	        data.append((&quot;cv2&quot;, &quot;Not found&quot;))
202	    env_str = tabulate(data) + &quot;\n&quot;
203	    env_str += collect_torch_env()
204	    return env_str
205	
206	
207	def test_nccl_ops():
208	    num_gpu = torch.cuda.device_count()
209	    if os.access(&quot;/tmp&quot;, os.W_OK):
210	        import torch.multiprocessing as mp
211	
212	        dist_url = &quot;file:///tmp/nccl_tmp_file&quot;
213	        print(&quot;Testing NCCL connectivity ... this should not hang.&quot;)
214	        mp.spawn(_test_nccl_worker, nprocs=num_gpu, args=(num_gpu, dist_url), daemon=False)
215	        print(&quot;NCCL succeeded.&quot;)
216	
217	
218	def _test_nccl_worker(rank, num_gpu, dist_url):
219	    import torch.distributed as dist
220	
221	    dist.init_process_group(backend=&quot;NCCL&quot;, init_method=dist_url, rank=rank, world_size=num_gpu)
222	    dist.barrier(device_ids=[rank])
223	
224	
</pre>
</div>


</div>
</div>

<div id="issue-57">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_detectron2/utils/tracing.py" target="_blank">comfyui_controlnet_aux/src/custom_detectron2/utils/tracing.py</a><br>
    <b>Line number: </b>60<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
44	@torch.jit.ignore
45	def assert_fx_safe(condition: bool, message: str) -&gt; torch.Tensor:
46	    &quot;&quot;&quot;An FX-tracing safe version of assert.
47	    Avoids erroneous type assertion triggering when types are masked inside
48	    an fx.proxy.Proxy object during tracing.
49	    Args: condition - either a boolean expression or a string representing
50	    the condition to test. If this assert triggers an exception when tracing
51	    due to dynamic control flow, try encasing the expression in quotation
52	    marks and supplying it as a string.&quot;&quot;&quot;
53	    # Must return a concrete tensor for compatibility with PyTorch &lt;=1.8.
54	    # If &lt;=1.8 compatibility is not needed, return type can be converted to None
55	    if not is_fx_tracing():
56	        try:
57	            if isinstance(condition, str):
58	                caller_frame = inspect.currentframe().f_back
59	                torch._assert(
60	                    eval(condition, caller_frame.f_globals, caller_frame.f_locals), message
61	                )
62	                return torch.ones(1)
63	            else:
64	                torch._assert(condition, message)
65	                return torch.ones(1)
66	        except torch.fx.proxy.TraceError as e:
67	            print(
68	                &quot;Found a non-FX compatible assertion. Skipping the check. Failure is shown below&quot;
69	                + str(e)
70	            )
71	    return torch.zeros(1)
</pre>
</div>


</div>
</div>

<div id="issue-58">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/argutils.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/argutils.py</a><br>
    <b>Line number: </b>3<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	import datetime
2	import os
3	import pickle
4	import subprocess
5	import sys
6	
7	
8	def print_args(args):
9	    opts = vars(args)
10	    print(&#x27;======= Options ========&#x27;)
11	    for k, v in sorted(opts.items()):
12	        print(&#x27;{}: {}&#x27;.format(k, v))
13	    print(&#x27;========================&#x27;)
14	
15	
16	def save_args(args, save_folder, opt_prefix=&#x27;opt&#x27;, verbose=True):
17	    opts = vars(args)
18	    # Create checkpoint folder
19	    if not os.path.exists(save_folder):
20	        os.makedirs(save_folder, exist_ok=True)
21	
22	    # Save options
23	    opt_filename = &#x27;{}.txt&#x27;.format(opt_prefix)
24	    opt_path = os.path.join(save_folder, opt_filename)
25	    with open(opt_path, &#x27;a&#x27;) as opt_file:
26	        opt_file.write(&#x27;====== Options ======\n&#x27;)
27	        for k, v in sorted(opts.items()):
28	            opt_file.write(
29	                &#x27;{option}: {value}\n&#x27;.format(option=str(k), value=str(v)))
30	        opt_file.write(&#x27;=====================\n&#x27;)
31	        opt_file.write(&#x27;launched {} at {}\n&#x27;.format(
32	            str(sys.argv[0]), str(datetime.datetime.now())))
</pre>
</div>


</div>
</div>

<div id="issue-59">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/argutils.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/argutils.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import datetime
2	import os
3	import pickle
4	import subprocess
5	import sys
6	
7	
8	def print_args(args):
9	    opts = vars(args)
10	    print(&#x27;======= Options ========&#x27;)
11	    for k, v in sorted(opts.items()):
12	        print(&#x27;{}: {}&#x27;.format(k, v))
13	    print(&#x27;========================&#x27;)
14	
15	
16	def save_args(args, save_folder, opt_prefix=&#x27;opt&#x27;, verbose=True):
17	    opts = vars(args)
18	    # Create checkpoint folder
19	    if not os.path.exists(save_folder):
20	        os.makedirs(save_folder, exist_ok=True)
21	
22	    # Save options
23	    opt_filename = &#x27;{}.txt&#x27;.format(opt_prefix)
24	    opt_path = os.path.join(save_folder, opt_filename)
25	    with open(opt_path, &#x27;a&#x27;) as opt_file:
26	        opt_file.write(&#x27;====== Options ======\n&#x27;)
27	        for k, v in sorted(opts.items()):
28	            opt_file.write(
29	                &#x27;{option}: {value}\n&#x27;.format(option=str(k), value=str(v)))
30	        opt_file.write(&#x27;=====================\n&#x27;)
31	        opt_file.write(&#x27;launched {} at {}\n&#x27;.format(
32	            str(sys.argv[0]), str(datetime.datetime.now())))
</pre>
</div>


</div>
</div>

<div id="issue-60">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/argutils.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/argutils.py</a><br>
    <b>Line number: </b>35<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
19	    if not os.path.exists(save_folder):
20	        os.makedirs(save_folder, exist_ok=True)
21	
22	    # Save options
23	    opt_filename = &#x27;{}.txt&#x27;.format(opt_prefix)
24	    opt_path = os.path.join(save_folder, opt_filename)
25	    with open(opt_path, &#x27;a&#x27;) as opt_file:
26	        opt_file.write(&#x27;====== Options ======\n&#x27;)
27	        for k, v in sorted(opts.items()):
28	            opt_file.write(
29	                &#x27;{option}: {value}\n&#x27;.format(option=str(k), value=str(v)))
30	        opt_file.write(&#x27;=====================\n&#x27;)
31	        opt_file.write(&#x27;launched {} at {}\n&#x27;.format(
32	            str(sys.argv[0]), str(datetime.datetime.now())))
33	
34	        # Add git info
35	        label = subprocess.check_output([&quot;git&quot;, &quot;describe&quot;,
36	                                         &quot;--always&quot;]).strip()
37	        if subprocess.call(
38	            [&quot;git&quot;, &quot;branch&quot;],
39	                stderr=subprocess.STDOUT,
40	                stdout=open(os.devnull, &#x27;w&#x27;)) == 0:
41	            opt_file.write(&#x27;=== Git info ====\n&#x27;)
42	            opt_file.write(&#x27;{}\n&#x27;.format(label))
43	            commit = subprocess.check_output([&#x27;git&#x27;, &#x27;rev-parse&#x27;, &#x27;HEAD&#x27;])
44	            opt_file.write(&#x27;commit : {}\n&#x27;.format(commit.strip()))
45	
46	    opt_picklename = &#x27;{}.pkl&#x27;.format(opt_prefix)
47	    opt_picklepath = os.path.join(save_folder, opt_picklename)
48	    with open(opt_picklepath, &#x27;wb&#x27;) as opt_file:
49	        pickle.dump(opts, opt_file)
50	    if verbose:
51	        print(&#x27;Saved options to {}&#x27;.format(opt_path))
</pre>
</div>


</div>
</div>

<div id="issue-61">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/argutils.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/argutils.py</a><br>
    <b>Line number: </b>35<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
19	    if not os.path.exists(save_folder):
20	        os.makedirs(save_folder, exist_ok=True)
21	
22	    # Save options
23	    opt_filename = &#x27;{}.txt&#x27;.format(opt_prefix)
24	    opt_path = os.path.join(save_folder, opt_filename)
25	    with open(opt_path, &#x27;a&#x27;) as opt_file:
26	        opt_file.write(&#x27;====== Options ======\n&#x27;)
27	        for k, v in sorted(opts.items()):
28	            opt_file.write(
29	                &#x27;{option}: {value}\n&#x27;.format(option=str(k), value=str(v)))
30	        opt_file.write(&#x27;=====================\n&#x27;)
31	        opt_file.write(&#x27;launched {} at {}\n&#x27;.format(
32	            str(sys.argv[0]), str(datetime.datetime.now())))
33	
34	        # Add git info
35	        label = subprocess.check_output([&quot;git&quot;, &quot;describe&quot;,
36	                                         &quot;--always&quot;]).strip()
37	        if subprocess.call(
38	            [&quot;git&quot;, &quot;branch&quot;],
39	                stderr=subprocess.STDOUT,
40	                stdout=open(os.devnull, &#x27;w&#x27;)) == 0:
41	            opt_file.write(&#x27;=== Git info ====\n&#x27;)
42	            opt_file.write(&#x27;{}\n&#x27;.format(label))
43	            commit = subprocess.check_output([&#x27;git&#x27;, &#x27;rev-parse&#x27;, &#x27;HEAD&#x27;])
44	            opt_file.write(&#x27;commit : {}\n&#x27;.format(commit.strip()))
45	
46	    opt_picklename = &#x27;{}.pkl&#x27;.format(opt_prefix)
47	    opt_picklepath = os.path.join(save_folder, opt_picklename)
48	    with open(opt_picklepath, &#x27;wb&#x27;) as opt_file:
49	        pickle.dump(opts, opt_file)
50	    if verbose:
51	        print(&#x27;Saved options to {}&#x27;.format(opt_path))
</pre>
</div>


</div>
</div>

<div id="issue-62">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/argutils.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/argutils.py</a><br>
    <b>Line number: </b>37<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
21	
22	    # Save options
23	    opt_filename = &#x27;{}.txt&#x27;.format(opt_prefix)
24	    opt_path = os.path.join(save_folder, opt_filename)
25	    with open(opt_path, &#x27;a&#x27;) as opt_file:
26	        opt_file.write(&#x27;====== Options ======\n&#x27;)
27	        for k, v in sorted(opts.items()):
28	            opt_file.write(
29	                &#x27;{option}: {value}\n&#x27;.format(option=str(k), value=str(v)))
30	        opt_file.write(&#x27;=====================\n&#x27;)
31	        opt_file.write(&#x27;launched {} at {}\n&#x27;.format(
32	            str(sys.argv[0]), str(datetime.datetime.now())))
33	
34	        # Add git info
35	        label = subprocess.check_output([&quot;git&quot;, &quot;describe&quot;,
36	                                         &quot;--always&quot;]).strip()
37	        if subprocess.call(
38	            [&quot;git&quot;, &quot;branch&quot;],
39	                stderr=subprocess.STDOUT,
40	                stdout=open(os.devnull, &#x27;w&#x27;)) == 0:
41	            opt_file.write(&#x27;=== Git info ====\n&#x27;)
42	            opt_file.write(&#x27;{}\n&#x27;.format(label))
43	            commit = subprocess.check_output([&#x27;git&#x27;, &#x27;rev-parse&#x27;, &#x27;HEAD&#x27;])
44	            opt_file.write(&#x27;commit : {}\n&#x27;.format(commit.strip()))
45	
46	    opt_picklename = &#x27;{}.pkl&#x27;.format(opt_prefix)
47	    opt_picklepath = os.path.join(save_folder, opt_picklename)
48	    with open(opt_picklepath, &#x27;wb&#x27;) as opt_file:
49	        pickle.dump(opts, opt_file)
50	    if verbose:
51	        print(&#x27;Saved options to {}&#x27;.format(opt_path))
</pre>
</div>


</div>
</div>

<div id="issue-63">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/argutils.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/argutils.py</a><br>
    <b>Line number: </b>37<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
21	
22	    # Save options
23	    opt_filename = &#x27;{}.txt&#x27;.format(opt_prefix)
24	    opt_path = os.path.join(save_folder, opt_filename)
25	    with open(opt_path, &#x27;a&#x27;) as opt_file:
26	        opt_file.write(&#x27;====== Options ======\n&#x27;)
27	        for k, v in sorted(opts.items()):
28	            opt_file.write(
29	                &#x27;{option}: {value}\n&#x27;.format(option=str(k), value=str(v)))
30	        opt_file.write(&#x27;=====================\n&#x27;)
31	        opt_file.write(&#x27;launched {} at {}\n&#x27;.format(
32	            str(sys.argv[0]), str(datetime.datetime.now())))
33	
34	        # Add git info
35	        label = subprocess.check_output([&quot;git&quot;, &quot;describe&quot;,
36	                                         &quot;--always&quot;]).strip()
37	        if subprocess.call(
38	            [&quot;git&quot;, &quot;branch&quot;],
39	                stderr=subprocess.STDOUT,
40	                stdout=open(os.devnull, &#x27;w&#x27;)) == 0:
41	            opt_file.write(&#x27;=== Git info ====\n&#x27;)
42	            opt_file.write(&#x27;{}\n&#x27;.format(label))
43	            commit = subprocess.check_output([&#x27;git&#x27;, &#x27;rev-parse&#x27;, &#x27;HEAD&#x27;])
44	            opt_file.write(&#x27;commit : {}\n&#x27;.format(commit.strip()))
45	
46	    opt_picklename = &#x27;{}.pkl&#x27;.format(opt_prefix)
47	    opt_picklepath = os.path.join(save_folder, opt_picklename)
48	    with open(opt_picklepath, &#x27;wb&#x27;) as opt_file:
49	        pickle.dump(opts, opt_file)
50	    if verbose:
51	        print(&#x27;Saved options to {}&#x27;.format(opt_path))
</pre>
</div>


</div>
</div>

<div id="issue-64">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/argutils.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/argutils.py</a><br>
    <b>Line number: </b>43<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
27	        for k, v in sorted(opts.items()):
28	            opt_file.write(
29	                &#x27;{option}: {value}\n&#x27;.format(option=str(k), value=str(v)))
30	        opt_file.write(&#x27;=====================\n&#x27;)
31	        opt_file.write(&#x27;launched {} at {}\n&#x27;.format(
32	            str(sys.argv[0]), str(datetime.datetime.now())))
33	
34	        # Add git info
35	        label = subprocess.check_output([&quot;git&quot;, &quot;describe&quot;,
36	                                         &quot;--always&quot;]).strip()
37	        if subprocess.call(
38	            [&quot;git&quot;, &quot;branch&quot;],
39	                stderr=subprocess.STDOUT,
40	                stdout=open(os.devnull, &#x27;w&#x27;)) == 0:
41	            opt_file.write(&#x27;=== Git info ====\n&#x27;)
42	            opt_file.write(&#x27;{}\n&#x27;.format(label))
43	            commit = subprocess.check_output([&#x27;git&#x27;, &#x27;rev-parse&#x27;, &#x27;HEAD&#x27;])
44	            opt_file.write(&#x27;commit : {}\n&#x27;.format(commit.strip()))
45	
46	    opt_picklename = &#x27;{}.pkl&#x27;.format(opt_prefix)
47	    opt_picklepath = os.path.join(save_folder, opt_picklename)
48	    with open(opt_picklepath, &#x27;wb&#x27;) as opt_file:
49	        pickle.dump(opts, opt_file)
50	    if verbose:
51	        print(&#x27;Saved options to {}&#x27;.format(opt_path))
</pre>
</div>


</div>
</div>

<div id="issue-65">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/argutils.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/argutils.py</a><br>
    <b>Line number: </b>43<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
27	        for k, v in sorted(opts.items()):
28	            opt_file.write(
29	                &#x27;{option}: {value}\n&#x27;.format(option=str(k), value=str(v)))
30	        opt_file.write(&#x27;=====================\n&#x27;)
31	        opt_file.write(&#x27;launched {} at {}\n&#x27;.format(
32	            str(sys.argv[0]), str(datetime.datetime.now())))
33	
34	        # Add git info
35	        label = subprocess.check_output([&quot;git&quot;, &quot;describe&quot;,
36	                                         &quot;--always&quot;]).strip()
37	        if subprocess.call(
38	            [&quot;git&quot;, &quot;branch&quot;],
39	                stderr=subprocess.STDOUT,
40	                stdout=open(os.devnull, &#x27;w&#x27;)) == 0:
41	            opt_file.write(&#x27;=== Git info ====\n&#x27;)
42	            opt_file.write(&#x27;{}\n&#x27;.format(label))
43	            commit = subprocess.check_output([&#x27;git&#x27;, &#x27;rev-parse&#x27;, &#x27;HEAD&#x27;])
44	            opt_file.write(&#x27;commit : {}\n&#x27;.format(commit.strip()))
45	
46	    opt_picklename = &#x27;{}.pkl&#x27;.format(opt_prefix)
47	    opt_picklepath = os.path.join(save_folder, opt_picklename)
48	    with open(opt_picklepath, &#x27;wb&#x27;) as opt_file:
49	        pickle.dump(opts, opt_file)
50	    if verbose:
51	        print(&#x27;Saved options to {}&#x27;.format(opt_path))
</pre>
</div>


</div>
</div>

<div id="issue-66">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/smpl_handpca_wrapper_HAND_only.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/smpl_handpca_wrapper_HAND_only.py</a><br>
    <b>Line number: </b>32<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
16	  loads the MANO model from a given file location (i.e. a .pkl file location),
17	  or a dictionary object.
18	
19	&#x27;&#x27;&#x27;
20	
21	def col(A):
22	    return A.reshape((-1, 1))
23	
24	def MatVecMult(mtx, vec):
25	    result = mtx.dot(col(vec.ravel())).ravel()
26	    if len(vec.shape) &gt; 1 and vec.shape[1] &gt; 1:
27	        result = result.reshape((-1, vec.shape[1]))
28	    return result
29	
30	def ready_arguments(fname_or_dict, posekey4vposed=&#x27;pose&#x27;):
31	    import numpy as np
32	    import pickle
33	    from custom_manopth.posemapper import posemap
34	
35	    if not isinstance(fname_or_dict, dict):
36	        dd = pickle.load(open(fname_or_dict, &#x27;rb&#x27;), encoding=&#x27;latin1&#x27;)
37	        # dd = pickle.load(open(fname_or_dict, &#x27;rb&#x27;))
38	    else:
39	        dd = fname_or_dict
40	
41	    want_shapemodel = &#x27;shapedirs&#x27; in dd
42	    nposeparms = dd[&#x27;kintree_table&#x27;].shape[1] * 3
43	
44	    if &#x27;trans&#x27; not in dd:
45	        dd[&#x27;trans&#x27;] = np.zeros(3)
46	    if &#x27;pose&#x27; not in dd:
47	        dd[&#x27;pose&#x27;] = np.zeros(nposeparms)
</pre>
</div>


</div>
</div>

<div id="issue-67">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/smpl_handpca_wrapper_HAND_only.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/smpl_handpca_wrapper_HAND_only.py</a><br>
    <b>Line number: </b>36<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
20	
21	def col(A):
22	    return A.reshape((-1, 1))
23	
24	def MatVecMult(mtx, vec):
25	    result = mtx.dot(col(vec.ravel())).ravel()
26	    if len(vec.shape) &gt; 1 and vec.shape[1] &gt; 1:
27	        result = result.reshape((-1, vec.shape[1]))
28	    return result
29	
30	def ready_arguments(fname_or_dict, posekey4vposed=&#x27;pose&#x27;):
31	    import numpy as np
32	    import pickle
33	    from custom_manopth.posemapper import posemap
34	
35	    if not isinstance(fname_or_dict, dict):
36	        dd = pickle.load(open(fname_or_dict, &#x27;rb&#x27;), encoding=&#x27;latin1&#x27;)
37	        # dd = pickle.load(open(fname_or_dict, &#x27;rb&#x27;))
38	    else:
39	        dd = fname_or_dict
40	
41	    want_shapemodel = &#x27;shapedirs&#x27; in dd
42	    nposeparms = dd[&#x27;kintree_table&#x27;].shape[1] * 3
43	
44	    if &#x27;trans&#x27; not in dd:
45	        dd[&#x27;trans&#x27;] = np.zeros(3)
46	    if &#x27;pose&#x27; not in dd:
47	        dd[&#x27;pose&#x27;] = np.zeros(nposeparms)
48	    if &#x27;shapedirs&#x27; in dd and &#x27;betas&#x27; not in dd:
49	        dd[&#x27;betas&#x27;] = np.zeros(dd[&#x27;shapedirs&#x27;].shape[-1])
50	
51	    for s in [
</pre>
</div>


</div>
</div>

<div id="issue-68">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/smpl_handpca_wrapper_HAND_only.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/smpl_handpca_wrapper_HAND_only.py</a><br>
    <b>Line number: </b>82<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
66	        pose_map_res = posemap(dd[&#x27;bs_type&#x27;])(dd[posekey4vposed])
67	        dd[&#x27;v_posed&#x27;] = v_shaped + dd[&#x27;posedirs&#x27;].dot(pose_map_res)
68	    else:
69	        pose_map_res = posemap(dd[&#x27;bs_type&#x27;])(dd[posekey4vposed])
70	        dd_add = dd[&#x27;posedirs&#x27;].dot(pose_map_res)
71	        dd[&#x27;v_posed&#x27;] = dd[&#x27;v_template&#x27;] + dd_add
72	
73	    return dd
74	
75	
76	def load_model(fname_or_dict, ncomps=6, flat_hand_mean=False, v_template=None):
77	    &#x27;&#x27;&#x27; This model loads the fully articulable HAND SMPL model,
78	    and replaces the pose DOFS by ncomps from PCA&#x27;&#x27;&#x27;
79	
80	    from custom_manopth.verts import verts_core
81	    import numpy as np
82	    import pickle
83	    import scipy.sparse as sp
84	    np.random.seed(1)
85	
86	    if not isinstance(fname_or_dict, dict):
87	        smpl_data = pickle.load(open(fname_or_dict, &#x27;rb&#x27;), encoding=&#x27;latin1&#x27;)
88	        # smpl_data = pickle.load(open(fname_or_dict, &#x27;rb&#x27;))
89	    else:
90	        smpl_data = fname_or_dict
91	
92	    rot = 3  # for global orientation!!!
93	
94	    hands_components = smpl_data[&#x27;hands_components&#x27;]
95	    hands_mean = np.zeros(hands_components.shape[
96	        1]) if flat_hand_mean else smpl_data[&#x27;hands_mean&#x27;]
97	    hands_coeffs = smpl_data[&#x27;hands_coeffs&#x27;][:, :ncomps]
</pre>
</div>


</div>
</div>

<div id="issue-69">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_manopth/smpl_handpca_wrapper_HAND_only.py" target="_blank">comfyui_controlnet_aux/src/custom_manopth/smpl_handpca_wrapper_HAND_only.py</a><br>
    <b>Line number: </b>87<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
71	        dd[&#x27;v_posed&#x27;] = dd[&#x27;v_template&#x27;] + dd_add
72	
73	    return dd
74	
75	
76	def load_model(fname_or_dict, ncomps=6, flat_hand_mean=False, v_template=None):
77	    &#x27;&#x27;&#x27; This model loads the fully articulable HAND SMPL model,
78	    and replaces the pose DOFS by ncomps from PCA&#x27;&#x27;&#x27;
79	
80	    from custom_manopth.verts import verts_core
81	    import numpy as np
82	    import pickle
83	    import scipy.sparse as sp
84	    np.random.seed(1)
85	
86	    if not isinstance(fname_or_dict, dict):
87	        smpl_data = pickle.load(open(fname_or_dict, &#x27;rb&#x27;), encoding=&#x27;latin1&#x27;)
88	        # smpl_data = pickle.load(open(fname_or_dict, &#x27;rb&#x27;))
89	    else:
90	        smpl_data = fname_or_dict
91	
92	    rot = 3  # for global orientation!!!
93	
94	    hands_components = smpl_data[&#x27;hands_components&#x27;]
95	    hands_mean = np.zeros(hands_components.shape[
96	        1]) if flat_hand_mean else smpl_data[&#x27;hands_mean&#x27;]
97	    hands_coeffs = smpl_data[&#x27;hands_coeffs&#x27;][:, :ncomps]
98	
99	    selected_components = np.vstack((hands_components[:ncomps]))
100	    hands_mean = hands_mean.copy()
101	
102	    pose_coeffs = np.zeros(rot + selected_components.shape[0])
</pre>
</div>


</div>
</div>

<div id="issue-70">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with cPickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/modeling/_smpl.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/modeling/_smpl.py</a><br>
    <b>Line number: </b>13<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	&quot;&quot;&quot;
2	This file contains the definition of the SMPL model
3	
4	It is adapted from opensource project GraphCMR (https://github.com/nkolot/GraphCMR/)
5	&quot;&quot;&quot;
6	from __future__ import division
7	
8	import torch
9	import torch.nn as nn
10	import numpy as np
11	import scipy.sparse
12	try:
13	    import cPickle as pickle
14	except ImportError:
15	    import pickle
16	
17	from custom_mesh_graphormer.utils.geometric_layers import rodrigues
18	import custom_mesh_graphormer.modeling.data.config as cfg
19	
20	from comfy.model_management import get_torch_device
21	from wrapper_for_mps import sparse_to_dense
22	device = get_torch_device()
23	
24	class SMPL(nn.Module):
25	
26	    def __init__(self, gender=&#x27;neutral&#x27;):
27	        super(SMPL, self).__init__()
28	
29	        if gender==&#x27;m&#x27;:
30	            model_file=cfg.SMPL_Male
31	        elif gender==&#x27;f&#x27;:
32	            model_file=cfg.SMPL_Female
</pre>
</div>


</div>
</div>

<div id="issue-71">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/modeling/_smpl.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/modeling/_smpl.py</a><br>
    <b>Line number: </b>15<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	&quot;&quot;&quot;
2	This file contains the definition of the SMPL model
3	
4	It is adapted from opensource project GraphCMR (https://github.com/nkolot/GraphCMR/)
5	&quot;&quot;&quot;
6	from __future__ import division
7	
8	import torch
9	import torch.nn as nn
10	import numpy as np
11	import scipy.sparse
12	try:
13	    import cPickle as pickle
14	except ImportError:
15	    import pickle
16	
17	from custom_mesh_graphormer.utils.geometric_layers import rodrigues
18	import custom_mesh_graphormer.modeling.data.config as cfg
19	
20	from comfy.model_management import get_torch_device
21	from wrapper_for_mps import sparse_to_dense
22	device = get_torch_device()
23	
24	class SMPL(nn.Module):
25	
26	    def __init__(self, gender=&#x27;neutral&#x27;):
27	        super(SMPL, self).__init__()
28	
29	        if gender==&#x27;m&#x27;:
30	            model_file=cfg.SMPL_Male
31	        elif gender==&#x27;f&#x27;:
32	            model_file=cfg.SMPL_Female
</pre>
</div>


</div>
</div>

<div id="issue-72">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_bodymesh.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_bodymesh.py</a><br>
    <b>Line number: </b>60<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
44	aml_run = Run.get_context()
45	
46	def save_checkpoint(model, args, epoch, iteration, num_trial=10):
47	    checkpoint_dir = op.join(args.output_dir, &#x27;checkpoint-{}-{}&#x27;.format(
48	        epoch, iteration))
49	    if not is_main_process():
50	        return checkpoint_dir
51	    mkdir(checkpoint_dir)
52	    model_to_save = model.module if hasattr(model, &#x27;module&#x27;) else model
53	    for i in range(num_trial):
54	        try:
55	            torch.save(model_to_save, op.join(checkpoint_dir, &#x27;model.bin&#x27;))
56	            torch.save(model_to_save.state_dict(), op.join(checkpoint_dir, &#x27;state_dict.bin&#x27;))
57	            torch.save(args, op.join(checkpoint_dir, &#x27;training_args.bin&#x27;))
58	            logger.info(&quot;Save checkpoint to {}&quot;.format(checkpoint_dir))
59	            break
60	        except:
61	            pass
62	    else:
63	        logger.info(&quot;Failed to save checkpoint after {} trails.&quot;.format(num_trial))
64	    return checkpoint_dir
65	
66	def save_scores(args, split, mpjpe, pampjpe, mpve):
67	    eval_log = []
68	    res = {}
69	    res[&#x27;mPJPE&#x27;] = mpjpe
70	    res[&#x27;PAmPJPE&#x27;] = pampjpe
71	    res[&#x27;mPVE&#x27;] = mpve
72	    eval_log.append(res)
73	    with open(op.join(args.output_dir, split+&#x27;_eval_logs.json&#x27;), &#x27;w&#x27;) as f:
74	        json.dump(eval_log, f)
75	    logger.info(&quot;Save eval scores to {}&quot;.format(args.output_dir))
76	    return
</pre>
</div>


</div>
</div>

<div id="issue-73">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py</a><br>
    <b>Line number: </b>60<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
44	aml_run = Run.get_context()
45	
46	def save_checkpoint(model, args, epoch, iteration, num_trial=10):
47	    checkpoint_dir = op.join(args.output_dir, &#x27;checkpoint-{}-{}&#x27;.format(
48	        epoch, iteration))
49	    if not is_main_process():
50	        return checkpoint_dir
51	    mkdir(checkpoint_dir)
52	    model_to_save = model.module if hasattr(model, &#x27;module&#x27;) else model
53	    for i in range(num_trial):
54	        try:
55	            torch.save(model_to_save, op.join(checkpoint_dir, &#x27;model.bin&#x27;))
56	            torch.save(model_to_save.state_dict(), op.join(checkpoint_dir, &#x27;state_dict.bin&#x27;))
57	            torch.save(args, op.join(checkpoint_dir, &#x27;training_args.bin&#x27;))
58	            logger.info(&quot;Save checkpoint to {}&quot;.format(checkpoint_dir))
59	            break
60	        except:
61	            pass
62	    else:
63	        logger.info(&quot;Failed to save checkpoint after {} trails.&quot;.format(num_trial))
64	    return checkpoint_dir
65	
66	def adjust_learning_rate(optimizer, epoch, args):
67	    &quot;&quot;&quot;
68	    Sets the learning rate to the initial LR decayed by x every y epochs
69	    x = 0.1, y = args.num_train_epochs/2.0 = 100
70	    &quot;&quot;&quot;
71	    lr = args.lr * (0.1 ** (epoch // (args.num_train_epochs/2.0)  ))
72	    for param_group in optimizer.param_groups:
73	        param_group[&#x27;lr&#x27;] = lr
74	
75	def keypoint_2d_loss(criterion_keypoints, pred_keypoints_2d, gt_keypoints_2d, has_pose_2d):
76	    &quot;&quot;&quot;
</pre>
</div>


</div>
</div>

<div id="issue-74">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py</a><br>
    <b>Line number: </b>343<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
327	                joint_output_save.append(pred_3d_joints_from_mesh_list)
328	
329	    if world_size &gt; 1:
330	        torch.distributed.barrier()
331	    print(&#x27;save results to pred.json&#x27;)
332	    output_json_file = &#x27;pred.json&#x27;
333	    print(&#x27;save results to &#x27;, output_json_file)
334	    with open(output_json_file, &#x27;w&#x27;) as f:
335	        json.dump([joint_output_save, mesh_output_save], f)
336	
337	    azure_ckpt_name = &#x27;200&#x27; # args.resume_checkpoint.split(&#x27;/&#x27;)[-2].split(&#x27;-&#x27;)[1]
338	    inference_setting = &#x27;sc%02d_rot%s&#x27;%(int(args.sc*10),str(int(args.rot)))
339	    output_zip_file = args.output_dir + &#x27;ckpt&#x27; + azure_ckpt_name + &#x27;-&#x27; + inference_setting +&#x27;-pred.zip&#x27;
340	
341	    resolved_submit_cmd = &#x27;zip &#x27; + output_zip_file + &#x27; &#x27; + output_json_file
342	    print(resolved_submit_cmd)
343	    os.system(resolved_submit_cmd)
344	    resolved_submit_cmd = &#x27;rm %s&#x27;%(output_json_file)
345	    print(resolved_submit_cmd)
346	    os.system(resolved_submit_cmd)
347	    if world_size &gt; 1:
348	        torch.distributed.barrier()
349	
350	    return 
351	
352	def run_inference_hand_mesh(args, val_loader, Graphormer_model, criterion, criterion_vertices, epoch, mano_model, mesh_sampler, renderer, split):
353	    # switch to evaluate mode
354	    Graphormer_model.eval()
355	    fname_output_save = []
356	    mesh_output_save = []
357	    joint_output_save = []
358	    with torch.no_grad():
</pre>
</div>


</div>
</div>

<div id="issue-75">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py</a><br>
    <b>Line number: </b>346<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
330	        torch.distributed.barrier()
331	    print(&#x27;save results to pred.json&#x27;)
332	    output_json_file = &#x27;pred.json&#x27;
333	    print(&#x27;save results to &#x27;, output_json_file)
334	    with open(output_json_file, &#x27;w&#x27;) as f:
335	        json.dump([joint_output_save, mesh_output_save], f)
336	
337	    azure_ckpt_name = &#x27;200&#x27; # args.resume_checkpoint.split(&#x27;/&#x27;)[-2].split(&#x27;-&#x27;)[1]
338	    inference_setting = &#x27;sc%02d_rot%s&#x27;%(int(args.sc*10),str(int(args.rot)))
339	    output_zip_file = args.output_dir + &#x27;ckpt&#x27; + azure_ckpt_name + &#x27;-&#x27; + inference_setting +&#x27;-pred.zip&#x27;
340	
341	    resolved_submit_cmd = &#x27;zip &#x27; + output_zip_file + &#x27; &#x27; + output_json_file
342	    print(resolved_submit_cmd)
343	    os.system(resolved_submit_cmd)
344	    resolved_submit_cmd = &#x27;rm %s&#x27;%(output_json_file)
345	    print(resolved_submit_cmd)
346	    os.system(resolved_submit_cmd)
347	    if world_size &gt; 1:
348	        torch.distributed.barrier()
349	
350	    return 
351	
352	def run_inference_hand_mesh(args, val_loader, Graphormer_model, criterion, criterion_vertices, epoch, mano_model, mesh_sampler, renderer, split):
353	    # switch to evaluate mode
354	    Graphormer_model.eval()
355	    fname_output_save = []
356	    mesh_output_save = []
357	    joint_output_save = []
358	    with torch.no_grad():
359	        for i, (img_keys, images, annotations) in enumerate(val_loader):
360	            batch_size = images.size(0)
361	            # compute output
</pre>
</div>


</div>
</div>

<div id="issue-76">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py</a><br>
    <b>Line number: </b>409<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
393	                visual_imgs = visual_imgs.transpose(1,2)
394	                visual_imgs = np.asarray(visual_imgs)
395	                
396	                inference_setting = &#x27;sc%02d_rot%s&#x27;%(int(args.sc*10),str(int(args.rot)))
397	                temp_fname = args.output_dir + args.resume_checkpoint[0:-9] + &#x27;freihand_results_&#x27;+inference_setting+&#x27;_batch&#x27;+str(i)+&#x27;.jpg&#x27;
398	                cv2.imwrite(temp_fname, np.asarray(visual_imgs[:,:,::-1]*255))
399	
400	    print(&#x27;save results to pred.json&#x27;)
401	    with open(&#x27;pred.json&#x27;, &#x27;w&#x27;) as f:
402	        json.dump([joint_output_save, mesh_output_save], f)
403	
404	    run_exp_name = args.resume_checkpoint.split(&#x27;/&#x27;)[-3]
405	    run_ckpt_name = args.resume_checkpoint.split(&#x27;/&#x27;)[-2].split(&#x27;-&#x27;)[1]
406	    inference_setting = &#x27;sc%02d_rot%s&#x27;%(int(args.sc*10),str(int(args.rot)))
407	    resolved_submit_cmd = &#x27;zip &#x27; + args.output_dir + run_exp_name + &#x27;-ckpt&#x27;+ run_ckpt_name + &#x27;-&#x27; + inference_setting +&#x27;-pred.zip  &#x27; +  &#x27;pred.json&#x27;
408	    print(resolved_submit_cmd)
409	    os.system(resolved_submit_cmd)
410	    resolved_submit_cmd = &#x27;rm pred.json&#x27;
411	    print(resolved_submit_cmd)
412	    os.system(resolved_submit_cmd)
413	    return 
414	
415	def visualize_mesh( renderer,
416	                    images,
417	                    gt_keypoints_2d,
418	                    pred_vertices, 
419	                    pred_camera,
420	                    pred_keypoints_2d):
421	    &quot;&quot;&quot;Tensorboard logging.&quot;&quot;&quot;
422	    gt_keypoints_2d = gt_keypoints_2d.cpu().numpy()
423	    to_lsp = list(range(21))
424	    rend_imgs = []
</pre>
</div>


</div>
</div>

<div id="issue-77">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_gphmer_handmesh.py</a><br>
    <b>Line number: </b>412<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
396	                inference_setting = &#x27;sc%02d_rot%s&#x27;%(int(args.sc*10),str(int(args.rot)))
397	                temp_fname = args.output_dir + args.resume_checkpoint[0:-9] + &#x27;freihand_results_&#x27;+inference_setting+&#x27;_batch&#x27;+str(i)+&#x27;.jpg&#x27;
398	                cv2.imwrite(temp_fname, np.asarray(visual_imgs[:,:,::-1]*255))
399	
400	    print(&#x27;save results to pred.json&#x27;)
401	    with open(&#x27;pred.json&#x27;, &#x27;w&#x27;) as f:
402	        json.dump([joint_output_save, mesh_output_save], f)
403	
404	    run_exp_name = args.resume_checkpoint.split(&#x27;/&#x27;)[-3]
405	    run_ckpt_name = args.resume_checkpoint.split(&#x27;/&#x27;)[-2].split(&#x27;-&#x27;)[1]
406	    inference_setting = &#x27;sc%02d_rot%s&#x27;%(int(args.sc*10),str(int(args.rot)))
407	    resolved_submit_cmd = &#x27;zip &#x27; + args.output_dir + run_exp_name + &#x27;-ckpt&#x27;+ run_ckpt_name + &#x27;-&#x27; + inference_setting +&#x27;-pred.zip  &#x27; +  &#x27;pred.json&#x27;
408	    print(resolved_submit_cmd)
409	    os.system(resolved_submit_cmd)
410	    resolved_submit_cmd = &#x27;rm pred.json&#x27;
411	    print(resolved_submit_cmd)
412	    os.system(resolved_submit_cmd)
413	    return 
414	
415	def visualize_mesh( renderer,
416	                    images,
417	                    gt_keypoints_2d,
418	                    pred_vertices, 
419	                    pred_camera,
420	                    pred_keypoints_2d):
421	    &quot;&quot;&quot;Tensorboard logging.&quot;&quot;&quot;
422	    gt_keypoints_2d = gt_keypoints_2d.cpu().numpy()
423	    to_lsp = list(range(21))
424	    rend_imgs = []
425	    batch_size = pred_vertices.shape[0]
426	    # Do visualization for the first 6 images of the batch
427	    for i in range(min(batch_size, 10)):
</pre>
</div>


</div>
</div>

<div id="issue-78">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_hand_multiscale.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_hand_multiscale.py</a><br>
    <b>Line number: </b>82<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
66	    print(&#x27;--------------------------&#x27;)
67	    print(&#x27;overall:&#x27;)
68	    print(&#x27;PAMPJPE:&#x27;, 1000*np.mean(pa_joint_error))
69	    print(&#x27;PAMPVPE:&#x27;, 1000*np.mean(pa_vertices_error))
70	
71	    joint_output_save = overall_joints_array.tolist()
72	    mesh_output_save = overall_vertices_array.tolist()
73	
74	    print(&#x27;save results to pred.json&#x27;)
75	    with open(&#x27;pred.json&#x27;, &#x27;w&#x27;) as f:
76	        json.dump([joint_output_save, mesh_output_save], f)
77	
78	
79	    filepath = output_dir+&#x27;ckpt200-multisc-pred.zip&#x27;
80	    resolved_submit_cmd = &#x27;zip &#x27; + filepath + &#x27;  &#x27; +  &#x27;pred.json&#x27;
81	    print(resolved_submit_cmd)
82	    os.system(resolved_submit_cmd)
83	    resolved_submit_cmd = &#x27;rm pred.json&#x27;
84	    print(resolved_submit_cmd)
85	    os.system(resolved_submit_cmd)
86	
87	
88	def run_multiscale_inference(model_path, mode, output_dir):
89	    
90	    if mode==True:
91	        rotations = [0.0]
92	        for i in range(1,10):
93	            rotations.append(i*10)
94	            rotations.append(i*-10)
95	        scale = [0.7,0.8,0.9,1.0,1.1]
96	    else:
97	        rotations = [0.0]
</pre>
</div>


</div>
</div>

<div id="issue-79">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_hand_multiscale.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_hand_multiscale.py</a><br>
    <b>Line number: </b>85<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
69	    print(&#x27;PAMPVPE:&#x27;, 1000*np.mean(pa_vertices_error))
70	
71	    joint_output_save = overall_joints_array.tolist()
72	    mesh_output_save = overall_vertices_array.tolist()
73	
74	    print(&#x27;save results to pred.json&#x27;)
75	    with open(&#x27;pred.json&#x27;, &#x27;w&#x27;) as f:
76	        json.dump([joint_output_save, mesh_output_save], f)
77	
78	
79	    filepath = output_dir+&#x27;ckpt200-multisc-pred.zip&#x27;
80	    resolved_submit_cmd = &#x27;zip &#x27; + filepath + &#x27;  &#x27; +  &#x27;pred.json&#x27;
81	    print(resolved_submit_cmd)
82	    os.system(resolved_submit_cmd)
83	    resolved_submit_cmd = &#x27;rm pred.json&#x27;
84	    print(resolved_submit_cmd)
85	    os.system(resolved_submit_cmd)
86	
87	
88	def run_multiscale_inference(model_path, mode, output_dir):
89	    
90	    if mode==True:
91	        rotations = [0.0]
92	        for i in range(1,10):
93	            rotations.append(i*10)
94	            rotations.append(i*-10)
95	        scale = [0.7,0.8,0.9,1.0,1.1]
96	    else:
97	        rotations = [0.0]
98	        scale = [1.0] 
99	
100	    job_cmd = &quot;python ./src/tools/run_gphmer_handmesh.py &quot; \
</pre>
</div>


</div>
</div>

<div id="issue-80">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_hand_multiscale.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/tools/run_hand_multiscale.py</a><br>
    <b>Line number: </b>118<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
102	            &quot;--resume_checkpoint %s &quot; \
103	            &quot;--per_gpu_eval_batch_size 32 --run_eval_only --num_worker 2 &quot; \
104	            &quot;--multiscale_inference &quot; \
105	            &quot;--rot %f &quot; \
106	            &quot;--sc %s &quot; \
107	            &quot;--arch hrnet-w64 &quot; \
108	            &quot;--num_hidden_layers 4 &quot; \
109	            &quot;--num_attention_heads 4 &quot; \
110	            &quot;--input_feat_dim 2051,512,128 &quot; \
111	            &quot;--hidden_feat_dim 1024,256,64 &quot; \
112	            &quot;--output_dir %s&quot;
113	
114	    for s in scale:
115	        for r in rotations:
116	            resolved_submit_cmd = job_cmd%(model_path, r, s, output_dir)
117	            print(resolved_submit_cmd)
118	            os.system(resolved_submit_cmd)
119	
120	def main(args):
121	    model_path = args.model_path
122	    mode = args.multiscale_inference
123	    output_dir = args.output_dir
124	    run_multiscale_inference(model_path, mode, output_dir)
125	    if mode==True:
126	        multiscale_fusion(output_dir)
127	
128	
129	if __name__ == &quot;__main__&quot;:
130	    parser = argparse.ArgumentParser(description=&quot;Evaluate a checkpoint in the folder&quot;)
131	    parser.add_argument(&quot;--model_path&quot;)
132	    parser.add_argument(&quot;--multiscale_inference&quot;, default=False, action=&#x27;store_true&#x27;,) 
133	    parser.add_argument(&quot;--output_dir&quot;, default=&#x27;output/&#x27;, type=str, required=False,
</pre>
</div>


</div>
</div>

<div id="issue-81">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/comm.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/comm.py</a><br>
    <b>Line number: </b>9<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	&quot;&quot;&quot;
2	Copyright (c) Microsoft Corporation.
3	Licensed under the MIT license.
4	
5	This file contains primitives for multi-gpu communication.
6	This is useful when doing distributed training.
7	&quot;&quot;&quot;
8	
9	import pickle
10	import time
11	
12	import torch
13	import torch.distributed as dist
14	
15	from comfy.model_management import get_torch_device
16	device = get_torch_device()
17	
18	
19	def get_world_size():
20	    if not dist.is_available():
21	        return 1
22	    if not dist.is_initialized():
23	        return 1
24	    return dist.get_world_size()
25	
26	
27	def get_rank():
28	    if not dist.is_available():
29	        return 0
30	    if not dist.is_initialized():
31	        return 0
32	    return dist.get_rank()
</pre>
</div>


</div>
</div>

<div id="issue-82">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/comm.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/comm.py</a><br>
    <b>Line number: </b>101<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
85	
86	    if is_main_process():
87	        tensor_list = []
88	        for _ in size_list:
89	            tensor_list.append(torch.ByteTensor(size=(max_size,)))
90	        dist.gather(tensor, gather_list=tensor_list, dst=0)
91	        del tensor
92	    else:
93	        dist.gather(tensor, gather_list=[], dst=0)
94	        del tensor
95	        return
96	
97	    data_list = []
98	    for tensor in tensor_list:
99	        buffer = tensor.cpu().numpy().tobytes()
100	        del tensor
101	        data_list.append(pickle.loads(buffer))
102	        del buffer
103	
104	    return data_list
105	
106	
107	def all_gather(data):
108	    &quot;&quot;&quot;
109	    Run all_gather on arbitrary picklable data (not necessarily tensors)
110	    Args:
111	        data: any picklable object
112	    Returns:
113	        list[data]: list of data gathered from each rank
114	    &quot;&quot;&quot;
115	    world_size = get_world_size()
116	    if world_size == 1:
</pre>
</div>


</div>
</div>

<div id="issue-83">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/comm.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/comm.py</a><br>
    <b>Line number: </b>145<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
129	    max_size = max(size_list)
130	
131	    # receiving Tensor from all ranks
132	    # we pad the tensor because torch all_gather does not support
133	    # gathering tensors of different shapes
134	    tensor_list = []
135	    for _ in size_list:
136	        tensor_list.append(torch.ByteTensor(size=(max_size,)).to(device))
137	    if local_size != max_size:
138	        padding = torch.ByteTensor(size=(max_size - local_size,)).to(device)
139	        tensor = torch.cat((tensor, padding), dim=0)
140	    dist.all_gather(tensor_list, tensor)
141	
142	    data_list = []
143	    for size, tensor in zip(size_list, tensor_list):
144	        buffer = tensor.cpu().numpy().tobytes()[:size]
145	        data_list.append(pickle.loads(buffer))
146	
147	    return data_list
148	
149	
150	def reduce_dict(input_dict, average=True):
151	    &quot;&quot;&quot;
152	    Args:
153	        input_dict (dict): all the values will be reduced
154	        average (bool): whether to do average or sum
155	    Reduce the values in the dictionary from all processes so that process with rank
156	    0 has the averaged results. Returns a dict with the same fields as
157	    input_dict, after reduction.
158	    &quot;&quot;&quot;
159	    world_size = get_world_size()
160	    if world_size &lt; 2:
</pre>
</div>


</div>
</div>

<div id="issue-84">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/dataset_utils.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/dataset_utils.py</a><br>
    <b>Line number: </b>66<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
50	
51	def load_box_shuffle_file(shuf_file):
52	    if shuf_file is not None:
53	        with open(shuf_file, &#x27;r&#x27;) as fp:
54	            img_shuf_list = []
55	            box_shuf_list = []
56	            for i in fp:
57	                idx = [int(_) for _ in i.strip().split(&#x27;\t&#x27;)]
58	                img_shuf_list.append(idx[0])
59	                box_shuf_list.append(idx[1])
60	        return [img_shuf_list, box_shuf_list]
61	    return None
62	
63	
64	def load_from_yaml_file(file_name):
65	    with open(file_name, &#x27;r&#x27;) as fp:
66	        return yaml.load(fp, Loader=yaml.CLoader)
</pre>
</div>


</div>
</div>

<div id="issue-85">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/miscellaneous.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/miscellaneous.py</a><br>
    <b>Line number: </b>159<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
143	
144	@try_once
145	def try_delete(f):
146	    os.remove(f)
147	
148	
149	def set_seed(seed, n_gpu):
150	    random.seed(seed)
151	    np.random.seed(seed)
152	    torch.manual_seed(seed)
153	    if n_gpu &gt; 0:
154	        torch.cuda.manual_seed_all(seed)
155	
156	
157	def print_and_run_cmd(cmd):
158	    print(cmd)
159	    os.system(cmd)
160	
161	
162	def write_to_yaml_file(context, file_name):
163	    with open(file_name, &#x27;w&#x27;) as fp:
164	        yaml.dump(context, fp, encoding=&#x27;utf-8&#x27;)
165	
166	
167	def load_from_yaml_file(yaml_file):
168	    with open(yaml_file, &#x27;r&#x27;) as fp:
169	        return yaml.load(fp, Loader=yaml.CLoader)
170	
171	
</pre>
</div>


</div>
</div>

<div id="issue-86">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/miscellaneous.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/miscellaneous.py</a><br>
    <b>Line number: </b>169<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
153	    if n_gpu &gt; 0:
154	        torch.cuda.manual_seed_all(seed)
155	
156	
157	def print_and_run_cmd(cmd):
158	    print(cmd)
159	    os.system(cmd)
160	
161	
162	def write_to_yaml_file(context, file_name):
163	    with open(file_name, &#x27;w&#x27;) as fp:
164	        yaml.dump(context, fp, encoding=&#x27;utf-8&#x27;)
165	
166	
167	def load_from_yaml_file(yaml_file):
168	    with open(yaml_file, &#x27;r&#x27;) as fp:
169	        return yaml.load(fp, Loader=yaml.CLoader)
170	
171	
</pre>
</div>


</div>
</div>

<div id="issue-87">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/tsv_file_ops.py" target="_blank">comfyui_controlnet_aux/src/custom_mesh_graphormer/utils/tsv_file_ops.py</a><br>
    <b>Line number: </b>105<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
89	    # images with only ignore labels are not selected. 
90	    line_list = []
91	    rows = tsv_reader(label_file)
92	    for i, row in tqdm(enumerate(rows)):
93	        labels = json.loads(row[1])
94	        if labels:
95	            if ignore_attrs and all([any([lab[attr] for attr in ignore_attrs if attr in lab]) \
96	                                for lab in labels]):
97	                continue
98	            line_list.append([i])
99	
100	    save_file = config_save_file(label_file, save_file, &#x27;.linelist.tsv&#x27;)
101	    tsv_writer(line_list, save_file)
102	
103	def load_from_yaml_file(yaml_file):
104	    with open(yaml_file, &#x27;r&#x27;) as fp:
105	        return yaml.load(fp, Loader=yaml.CLoader)
106	
107	def find_file_path_in_yaml(fname, root):
108	    if fname is not None:
109	        if op.isfile(fname):
110	            return fname
111	        elif op.isfile(op.join(root, fname)):
112	            return op.join(root, fname)
113	        else:
114	            raise FileNotFoundError(
115	                errno.ENOENT, os.strerror(errno.ENOENT), op.join(root, fname)
116	            )
</pre>
</div>


</div>
</div>

<div id="issue-88">
<div class="issue-block issue-sev-medium">
    <b>exec_used: </b> Use of exec detected.<br>
    <b>Test ID:</b> B102<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_midas_repo/midas/backbones/utils.py" target="_blank">comfyui_controlnet_aux/src/custom_midas_repo/midas/backbones/utils.py</a><br>
    <b>Line number: </b>64<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html</a><br>

<div class="code">
<pre>
48	    def forward(self, x):
49	        x = x.transpose(self.dim0, self.dim1)
50	        return x
51	
52	
53	activations = {}
54	
55	
56	def get_activation(name):
57	    def hook(model, input, output):
58	        activations[name] = output
59	
60	    return hook
61	
62	
63	def forward_default(pretrained, x, function_name=&quot;forward_features&quot;):
64	    exec(f&quot;pretrained.model.{function_name}(x)&quot;)
65	
66	    layer_1 = pretrained.activations[&quot;1&quot;]
67	    layer_2 = pretrained.activations[&quot;2&quot;]
68	    layer_3 = pretrained.activations[&quot;3&quot;]
69	    layer_4 = pretrained.activations[&quot;4&quot;]
70	
71	    if hasattr(pretrained, &quot;act_postprocess1&quot;):
72	        layer_1 = pretrained.act_postprocess1(layer_1)
73	    if hasattr(pretrained, &quot;act_postprocess2&quot;):
74	        layer_2 = pretrained.act_postprocess2(layer_2)
75	    if hasattr(pretrained, &quot;act_postprocess3&quot;):
76	        layer_3 = pretrained.act_postprocess3(layer_3)
77	    if hasattr(pretrained, &quot;act_postprocess4&quot;):
78	        layer_4 = pretrained.act_postprocess4(layer_4)
79	
</pre>
</div>


</div>
</div>

<div id="issue-89">
<div class="issue-block issue-sev-medium">
    <b>exec_used: </b> Use of exec detected.<br>
    <b>Test ID:</b> B102<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_midas_repo/midas/backbones/utils.py" target="_blank">comfyui_controlnet_aux/src/custom_midas_repo/midas/backbones/utils.py</a><br>
    <b>Line number: </b>86<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html</a><br>

<div class="code">
<pre>
70	
71	    if hasattr(pretrained, &quot;act_postprocess1&quot;):
72	        layer_1 = pretrained.act_postprocess1(layer_1)
73	    if hasattr(pretrained, &quot;act_postprocess2&quot;):
74	        layer_2 = pretrained.act_postprocess2(layer_2)
75	    if hasattr(pretrained, &quot;act_postprocess3&quot;):
76	        layer_3 = pretrained.act_postprocess3(layer_3)
77	    if hasattr(pretrained, &quot;act_postprocess4&quot;):
78	        layer_4 = pretrained.act_postprocess4(layer_4)
79	
80	    return layer_1, layer_2, layer_3, layer_4
81	
82	
83	def forward_adapted_unflatten(pretrained, x, function_name=&quot;forward_features&quot;):
84	    b, c, h, w = x.shape
85	
86	    exec(f&quot;glob = pretrained.model.{function_name}(x)&quot;)
87	
88	    layer_1 = pretrained.activations[&quot;1&quot;]
89	    layer_2 = pretrained.activations[&quot;2&quot;]
90	    layer_3 = pretrained.activations[&quot;3&quot;]
91	    layer_4 = pretrained.activations[&quot;4&quot;]
92	
93	    layer_1 = pretrained.act_postprocess1[0:2](layer_1)
94	    layer_2 = pretrained.act_postprocess2[0:2](layer_2)
95	    layer_3 = pretrained.act_postprocess3[0:2](layer_3)
96	    layer_4 = pretrained.act_postprocess4[0:2](layer_4)
97	
98	    unflatten = nn.Sequential(
99	        nn.Unflatten(
100	            2,
101	            torch.Size(
</pre>
</div>


</div>
</div>

<div id="issue-90">
<div class="issue-block issue-sev-medium">
    <b>exec_used: </b> Use of exec detected.<br>
    <b>Test ID:</b> B102<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_midas_repo/midas/backbones/vit.py" target="_blank">comfyui_controlnet_aux/src/custom_midas_repo/midas/backbones/vit.py</a><br>
    <b>Line number: </b>150<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html</a><br>

<div class="code">
<pre>
134	    pretrained.model = model
135	
136	    used_number_stages = 0 if use_vit_only else number_stages
137	    for s in range(used_number_stages):
138	        pretrained.model.patch_embed.backbone.stages[s].register_forward_hook(
139	            get_activation(str(s + 1))
140	        )
141	    for s in range(used_number_stages, 4):
142	        pretrained.model.blocks[hooks[s]].register_forward_hook(get_activation(str(s + 1)))
143	
144	    pretrained.activations = activations
145	
146	    readout_oper = get_readout_oper(vit_features, features, use_readout, start_index)
147	
148	    for s in range(used_number_stages):
149	        value = nn.Sequential(nn.Identity(), nn.Identity(), nn.Identity())
150	        exec(f&quot;pretrained.act_postprocess{s + 1}=value&quot;)
151	    for s in range(used_number_stages, 4):
152	        if s &lt; number_stages:
153	            final_layer = nn.ConvTranspose2d(
154	                in_channels=features[s],
155	                out_channels=features[s],
156	                kernel_size=4 // (2 ** s),
157	                stride=4 // (2 ** s),
158	                padding=0,
159	                bias=True,
160	                dilation=1,
161	                groups=1,
162	            )
163	        elif s &gt; number_stages:
164	            final_layer = nn.Conv2d(
165	                in_channels=features[3],
</pre>
</div>


</div>
</div>

<div id="issue-91">
<div class="issue-block issue-sev-medium">
    <b>exec_used: </b> Use of exec detected.<br>
    <b>Test ID:</b> B102<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_midas_repo/midas/backbones/vit.py" target="_blank">comfyui_controlnet_aux/src/custom_midas_repo/midas/backbones/vit.py</a><br>
    <b>Line number: </b>190<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b102_exec_used.html</a><br>

<div class="code">
<pre>
174	        layers = [
175	            readout_oper[s],
176	            Transpose(1, 2),
177	            nn.Unflatten(2, torch.Size([size[0] // 16, size[1] // 16])),
178	            nn.Conv2d(
179	                in_channels=vit_features,
180	                out_channels=features[s],
181	                kernel_size=1,
182	                stride=1,
183	                padding=0,
184	            ),
185	        ]
186	        if final_layer is not None:
187	            layers.append(final_layer)
188	
189	        value = nn.Sequential(*layers)
190	        exec(f&quot;pretrained.act_postprocess{s + 1}=value&quot;)
191	
192	    pretrained.model.start_index = start_index
193	    pretrained.model.patch_size = patch_size
194	
195	    # We inject this function into the VisionTransformer instances so that
196	    # we can use it with interpolated position embeddings without modifying the library source.
197	    pretrained.model.forward_flex = types.MethodType(forward_flex, pretrained.model)
198	
199	    # We inject this function into the VisionTransformer instances so that
200	    # we can use it with interpolated position embeddings without modifying the library source.
201	    pretrained.model._resize_pos_embed = types.MethodType(
202	        _resize_pos_embed, pretrained.model
203	    )
204	
205	    return pretrained
</pre>
</div>


</div>
</div>

<div id="issue-92">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/engine/test.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/engine/test.py</a><br>
    <b>Line number: </b>3<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	import os.path as osp
3	import pickle
4	import shutil
5	import tempfile
6	import time
7	
8	import torch
9	import torch.distributed as dist
10	
11	import custom_mmpkg.custom_mmcv as mmcv
12	from custom_mmpkg.custom_mmcv.runner import get_dist_info
13	
14	
15	def single_gpu_test(model, data_loader):
16	    &quot;&quot;&quot;Test model with a single gpu.
17	
18	    This method tests model with a single gpu and displays test progress bar.
19	
20	    Args:
21	        model (nn.Module): Model to be tested.
22	        data_loader (nn.Dataloader): Pytorch data loader.
23	
24	    Returns:
25	        list: The prediction results.
26	    &quot;&quot;&quot;
27	    model.eval()
28	    results = []
29	    dataset = data_loader.dataset
30	    prog_bar = mmcv.ProgressBar(len(dataset))
31	    for data in data_loader:
32	        with torch.no_grad():
</pre>
</div>


</div>
</div>

<div id="issue-93">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/engine/test.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/engine/test.py</a><br>
    <b>Line number: </b>191<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
175	    shape_tensor = torch.tensor(part_tensor.shape, device=&#x27;cuda&#x27;)
176	    shape_list = [shape_tensor.clone() for _ in range(world_size)]
177	    dist.all_gather(shape_list, shape_tensor)
178	    # padding result part tensor to max length
179	    shape_max = torch.tensor(shape_list).max()
180	    part_send = torch.zeros(shape_max, dtype=torch.uint8, device=&#x27;cuda&#x27;)
181	    part_send[:shape_tensor[0]] = part_tensor
182	    part_recv_list = [
183	        part_tensor.new_zeros(shape_max) for _ in range(world_size)
184	    ]
185	    # gather all result part
186	    dist.all_gather(part_recv_list, part_send)
187	
188	    if rank == 0:
189	        part_list = []
190	        for recv, shape in zip(part_recv_list, shape_list):
191	            part_result = pickle.loads(recv[:shape[0]].cpu().numpy().tobytes())
192	            # When data is severely insufficient, an empty part_result
193	            # on a certain gpu could makes the overall outputs empty.
194	            if part_result:
195	                part_list.append(part_result)
196	        # sort the results
197	        ordered_results = []
198	        for res in zip(*part_list):
199	            ordered_results.extend(list(res))
200	        # the dataloader may pad some samples
201	        ordered_results = ordered_results[:size]
202	        return ordered_results
</pre>
</div>


</div>
</div>

<div id="issue-94">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Audit url open for permitted schemes. Allowing use of file:/ or custom schemes is often unexpected.<br>
    <b>Test ID:</b> B310<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/file_client.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/file_client.py</a><br>
    <b>Line number: </b>695<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen</a><br>

<div class="code">
<pre>
679	                    if list_dir:
680	                        rel_dir = osp.relpath(entry.path, root)
681	                        yield rel_dir
682	                    if recursive:
683	                        yield from _list_dir_or_file(entry.path, list_dir,
684	                                                     list_file, suffix,
685	                                                     recursive)
686	
687	        return _list_dir_or_file(dir_path, list_dir, list_file, suffix,
688	                                 recursive)
689	
690	
691	class HTTPBackend(BaseStorageBackend):
692	    &quot;&quot;&quot;HTTP and HTTPS storage bachend.&quot;&quot;&quot;
693	
694	    def get(self, filepath):
695	        value_buf = urlopen(filepath).read()
696	        return value_buf
697	
698	    def get_text(self, filepath, encoding=&#x27;utf-8&#x27;):
699	        value_buf = urlopen(filepath).read()
700	        return value_buf.decode(encoding)
701	
702	    @contextmanager
703	    def get_local_path(self, filepath: str) -&gt; Iterable[str]:
704	        &quot;&quot;&quot;Download a file from ``filepath``.
705	
706	        ``get_local_path`` is decorated by :meth:`contxtlib.contextmanager`. It
707	        can be called with ``with`` statement, and when exists from the
708	        ``with`` statement, the temporary path will be released.
709	
710	        Args:
</pre>
</div>


</div>
</div>

<div id="issue-95">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Audit url open for permitted schemes. Allowing use of file:/ or custom schemes is often unexpected.<br>
    <b>Test ID:</b> B310<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/file_client.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/file_client.py</a><br>
    <b>Line number: </b>699<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen</a><br>

<div class="code">
<pre>
683	                        yield from _list_dir_or_file(entry.path, list_dir,
684	                                                     list_file, suffix,
685	                                                     recursive)
686	
687	        return _list_dir_or_file(dir_path, list_dir, list_file, suffix,
688	                                 recursive)
689	
690	
691	class HTTPBackend(BaseStorageBackend):
692	    &quot;&quot;&quot;HTTP and HTTPS storage bachend.&quot;&quot;&quot;
693	
694	    def get(self, filepath):
695	        value_buf = urlopen(filepath).read()
696	        return value_buf
697	
698	    def get_text(self, filepath, encoding=&#x27;utf-8&#x27;):
699	        value_buf = urlopen(filepath).read()
700	        return value_buf.decode(encoding)
701	
702	    @contextmanager
703	    def get_local_path(self, filepath: str) -&gt; Iterable[str]:
704	        &quot;&quot;&quot;Download a file from ``filepath``.
705	
706	        ``get_local_path`` is decorated by :meth:`contxtlib.contextmanager`. It
707	        can be called with ``with`` statement, and when exists from the
708	        ``with`` statement, the temporary path will be released.
709	
710	        Args:
711	            filepath (str): Download a file from ``filepath``.
712	
713	        Examples:
714	            &gt;&gt;&gt; client = HTTPBackend()
</pre>
</div>


</div>
</div>

<div id="issue-96">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with PickleHandler module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/handlers/__init__.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/handlers/__init__.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	from .base import BaseFileHandler
3	from .json_handler import JsonHandler
4	from .pickle_handler import PickleHandler
5	from .yaml_handler import YamlHandler
6	
7	__all__ = [&#x27;BaseFileHandler&#x27;, &#x27;JsonHandler&#x27;, &#x27;PickleHandler&#x27;, &#x27;YamlHandler&#x27;]
</pre>
</div>


</div>
</div>

<div id="issue-97">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/handlers/pickle_handler.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/handlers/pickle_handler.py</a><br>
    <b>Line number: </b>2<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	import pickle
3	
4	from .base import BaseFileHandler
5	
6	
7	class PickleHandler(BaseFileHandler):
8	
9	    str_like = False
10	
11	    def load_from_fileobj(self, file, **kwargs):
12	        return pickle.load(file, **kwargs)
13	
14	    def load_from_path(self, filepath, **kwargs):
15	        return super(PickleHandler, self).load_from_path(
16	            filepath, mode=&#x27;rb&#x27;, **kwargs)
17	
18	    def dump_to_str(self, obj, **kwargs):
19	        kwargs.setdefault(&#x27;protocol&#x27;, 2)
20	        return pickle.dumps(obj, **kwargs)
21	
22	    def dump_to_fileobj(self, obj, file, **kwargs):
23	        kwargs.setdefault(&#x27;protocol&#x27;, 2)
24	        pickle.dump(obj, file, **kwargs)
25	
26	    def dump_to_path(self, obj, filepath, **kwargs):
27	        super(PickleHandler, self).dump_to_path(
28	            obj, filepath, mode=&#x27;wb&#x27;, **kwargs)
</pre>
</div>


</div>
</div>

<div id="issue-98">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/handlers/pickle_handler.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/handlers/pickle_handler.py</a><br>
    <b>Line number: </b>12<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	import pickle
3	
4	from .base import BaseFileHandler
5	
6	
7	class PickleHandler(BaseFileHandler):
8	
9	    str_like = False
10	
11	    def load_from_fileobj(self, file, **kwargs):
12	        return pickle.load(file, **kwargs)
13	
14	    def load_from_path(self, filepath, **kwargs):
15	        return super(PickleHandler, self).load_from_path(
16	            filepath, mode=&#x27;rb&#x27;, **kwargs)
17	
18	    def dump_to_str(self, obj, **kwargs):
19	        kwargs.setdefault(&#x27;protocol&#x27;, 2)
20	        return pickle.dumps(obj, **kwargs)
21	
22	    def dump_to_fileobj(self, obj, file, **kwargs):
23	        kwargs.setdefault(&#x27;protocol&#x27;, 2)
24	        pickle.dump(obj, file, **kwargs)
25	
26	    def dump_to_path(self, obj, filepath, **kwargs):
27	        super(PickleHandler, self).dump_to_path(
28	            obj, filepath, mode=&#x27;wb&#x27;, **kwargs)
</pre>
</div>


</div>
</div>

<div id="issue-99">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/handlers/yaml_handler.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/fileio/handlers/yaml_handler.py</a><br>
    <b>Line number: </b>16<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	import yaml
3	
4	try:
5	    from yaml import CLoader as Loader, CDumper as Dumper
6	except ImportError:
7	    from yaml import Loader, Dumper
8	
9	from .base import BaseFileHandler  # isort:skip
10	
11	
12	class YamlHandler(BaseFileHandler):
13	
14	    def load_from_fileobj(self, file, **kwargs):
15	        kwargs.setdefault(&#x27;Loader&#x27;, Loader)
16	        return yaml.load(file, **kwargs)
17	
18	    def dump_to_fileobj(self, obj, file, **kwargs):
19	        kwargs.setdefault(&#x27;Dumper&#x27;, Dumper)
20	        yaml.dump(obj, file, **kwargs)
21	
22	    def dump_to_str(self, obj, **kwargs):
23	        kwargs.setdefault(&#x27;Dumper&#x27;, Dumper)
24	        return yaml.dump(obj, **kwargs)
</pre>
</div>


</div>
</div>

<div id="issue-100">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/ops/nms.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/ops/nms.py</a><br>
    <b>Line number: </b>302<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
286	            i.e. IoU thresholding happens over all boxes,
287	            regardless of the predicted class.
288	
289	    Returns:
290	        tuple: kept dets and indice.
291	    &quot;&quot;&quot;
292	    nms_cfg_ = nms_cfg.copy()
293	    class_agnostic = nms_cfg_.pop(&#x27;class_agnostic&#x27;, class_agnostic)
294	    if class_agnostic:
295	        boxes_for_nms = boxes
296	    else:
297	        max_coordinate = boxes.max()
298	        offsets = idxs.to(boxes) * (max_coordinate + torch.tensor(1).to(boxes))
299	        boxes_for_nms = boxes + offsets[:, None]
300	
301	    nms_type = nms_cfg_.pop(&#x27;type&#x27;, &#x27;nms&#x27;)
302	    nms_op = eval(nms_type)
303	
304	    split_thr = nms_cfg_.pop(&#x27;split_thr&#x27;, 10000)
305	    # Won&#x27;t split to multiple nms nodes when exporting to onnx
306	    if boxes_for_nms.shape[0] &lt; split_thr or torch.onnx.is_in_onnx_export():
307	        dets, keep = nms_op(boxes_for_nms, scores, **nms_cfg_)
308	        boxes = boxes[keep]
309	        # -1 indexing works abnormal in TensorRT
310	        # This assumes `dets` has 5 dimensions where
311	        # the last dimension is score.
312	        # TODO: more elegant way to handle the dimension issue.
313	        # Some type of nms would reweight the score, such as SoftNMS
314	        scores = dets[:, 4]
315	    else:
316	        max_num = nms_cfg_.pop(&#x27;max_num&#x27;, -1)
317	        total_mask = scores.new_zeros(scores.size(), dtype=torch.bool)
</pre>
</div>


</div>
</div>

<div id="issue-101">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/runner/dist_utils.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/runner/dist_utils.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	import functools
3	import os
4	import subprocess
5	from collections import OrderedDict
6	
7	import torch
8	import torch.multiprocessing as mp
9	from torch import distributed as dist
10	from torch._utils import (_flatten_dense_tensors, _take_tensors,
11	                          _unflatten_dense_tensors)
12	
13	
14	def init_dist(launcher, backend=&#x27;nccl&#x27;, **kwargs):
15	    if mp.get_start_method(allow_none=True) is None:
16	        mp.set_start_method(&#x27;spawn&#x27;)
17	    if launcher == &#x27;pytorch&#x27;:
18	        _init_dist_pytorch(backend, **kwargs)
19	    elif launcher == &#x27;mpi&#x27;:
20	        _init_dist_mpi(backend, **kwargs)
21	    elif launcher == &#x27;slurm&#x27;:
22	        _init_dist_slurm(backend, **kwargs)
23	    else:
24	        raise ValueError(f&#x27;Invalid launcher type: {launcher}&#x27;)
25	
26	
27	def _init_dist_pytorch(backend, **kwargs):
28	    # TODO: use local_rank instead of rank % num_gpus
29	    rank = int(os.environ[&#x27;RANK&#x27;])
30	    num_gpus = torch.cuda.device_count()
31	    torch.cuda.set_device(rank % num_gpus)
32	    dist.init_process_group(backend=backend, **kwargs)
</pre>
</div>


</div>
</div>

<div id="issue-102">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/runner/dist_utils.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/runner/dist_utils.py</a><br>
    <b>Line number: </b>59<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
43	def _init_dist_slurm(backend, port=None):
44	    &quot;&quot;&quot;Initialize slurm distributed training environment.
45	
46	    If argument ``port`` is not specified, then the master port will be system
47	    environment variable ``MASTER_PORT``. If ``MASTER_PORT`` is not in system
48	    environment variable, then a default port ``29500`` will be used.
49	
50	    Args:
51	        backend (str): Backend of torch.distributed.
52	        port (int, optional): Master port. Defaults to None.
53	    &quot;&quot;&quot;
54	    proc_id = int(os.environ[&#x27;SLURM_PROCID&#x27;])
55	    ntasks = int(os.environ[&#x27;SLURM_NTASKS&#x27;])
56	    node_list = os.environ[&#x27;SLURM_NODELIST&#x27;]
57	    num_gpus = torch.cuda.device_count()
58	    torch.cuda.set_device(proc_id % num_gpus)
59	    addr = subprocess.getoutput(
60	        f&#x27;scontrol show hostname {node_list} | head -n1&#x27;)
61	    # specify master port
62	    if port is not None:
63	        os.environ[&#x27;MASTER_PORT&#x27;] = str(port)
64	    elif &#x27;MASTER_PORT&#x27; in os.environ:
65	        pass  # use MASTER_PORT in the environment variable
66	    else:
67	        # 29500 is torch.distributed default port
68	        os.environ[&#x27;MASTER_PORT&#x27;] = &#x27;29500&#x27;
69	    # use MASTER_ADDR in the environment variable if it already exists
70	    if &#x27;MASTER_ADDR&#x27; not in os.environ:
71	        os.environ[&#x27;MASTER_ADDR&#x27;] = addr
72	    os.environ[&#x27;WORLD_SIZE&#x27;] = str(ntasks)
73	    os.environ[&#x27;LOCAL_RANK&#x27;] = str(proc_id % num_gpus)
74	    os.environ[&#x27;RANK&#x27;] = str(proc_id)
75	    dist.init_process_group(backend=backend)
</pre>
</div>


</div>
</div>

<div id="issue-103">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/env.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/env.py</a><br>
    <b>Line number: </b>5<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	&quot;&quot;&quot;This file holding some environment constant for sharing by other files.&quot;&quot;&quot;
3	
4	import os.path as osp
5	import subprocess
6	import sys
7	from collections import defaultdict
8	
9	import cv2
10	import torch
11	
12	import custom_mmpkg.custom_mmcv as mmcv
13	from .parrots_wrapper import get_build_config
14	
15	
16	def collect_env():
17	    &quot;&quot;&quot;Collect the information of the running environments.
18	
19	    Returns:
20	        dict: The environment information. The following fields are contained.
21	
22	            - sys.platform: The variable of ``sys.platform``.
23	            - Python: Python version.
24	            - CUDA available: Bool, indicating if CUDA is available.
25	            - GPU devices: Device type of each GPU.
26	            - CUDA_HOME (optional): The env var ``CUDA_HOME``.
27	            - NVCC (optional): NVCC version.
28	            - GCC: GCC version, &quot;n/a&quot; if GCC is not installed.
29	            - PyTorch: PyTorch version.
30	            - PyTorch compiling details: The output of \
31	                ``torch.__config__.show()``.
32	            - TorchVision (optional): TorchVision version.
</pre>
</div>


</div>
</div>

<div id="issue-104">
<div class="issue-block issue-sev-high">
    <b>subprocess_popen_with_shell_equals_true: </b> subprocess call with shell=True identified, security issue.<br>
    <b>Test ID:</b> B602<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/env.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/env.py</a><br>
    <b>Line number: </b>60<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html</a><br>

<div class="code">
<pre>
44	
45	    if cuda_available:
46	        devices = defaultdict(list)
47	        for k in range(torch.cuda.device_count()):
48	            devices[torch.cuda.get_device_name(k)].append(str(k))
49	        for name, device_ids in devices.items():
50	            env_info[&#x27;GPU &#x27; + &#x27;,&#x27;.join(device_ids)] = name
51	
52	        from custom_mmpkg.custom_mmcv.utils.parrots_wrapper import _get_cuda_home
53	        CUDA_HOME = _get_cuda_home()
54	        env_info[&#x27;CUDA_HOME&#x27;] = CUDA_HOME
55	
56	        if CUDA_HOME is not None and osp.isdir(CUDA_HOME):
57	            try:
58	                nvcc = osp.join(CUDA_HOME, &#x27;bin/nvcc&#x27;)
59	                nvcc = subprocess.check_output(
60	                    f&#x27;&quot;{nvcc}&quot; -V | tail -n1&#x27;, shell=True)
61	                nvcc = nvcc.decode(&#x27;utf-8&#x27;).strip()
62	            except subprocess.SubprocessError:
63	                nvcc = &#x27;Not Available&#x27;
64	            env_info[&#x27;NVCC&#x27;] = nvcc
65	
66	    try:
67	        gcc = subprocess.check_output(&#x27;gcc --version | head -n1&#x27;, shell=True)
68	        gcc = gcc.decode(&#x27;utf-8&#x27;).strip()
69	        env_info[&#x27;GCC&#x27;] = gcc
70	    except subprocess.CalledProcessError:  # gcc is unavailable
71	        env_info[&#x27;GCC&#x27;] = &#x27;n/a&#x27;
72	
73	    env_info[&#x27;PyTorch&#x27;] = torch.__version__
74	    env_info[&#x27;PyTorch compiling details&#x27;] = get_build_config()
75	
76	    try:
</pre>
</div>


</div>
</div>

<div id="issue-105">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/env.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/env.py</a><br>
    <b>Line number: </b>67<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
51	
52	        from custom_mmpkg.custom_mmcv.utils.parrots_wrapper import _get_cuda_home
53	        CUDA_HOME = _get_cuda_home()
54	        env_info[&#x27;CUDA_HOME&#x27;] = CUDA_HOME
55	
56	        if CUDA_HOME is not None and osp.isdir(CUDA_HOME):
57	            try:
58	                nvcc = osp.join(CUDA_HOME, &#x27;bin/nvcc&#x27;)
59	                nvcc = subprocess.check_output(
60	                    f&#x27;&quot;{nvcc}&quot; -V | tail -n1&#x27;, shell=True)
61	                nvcc = nvcc.decode(&#x27;utf-8&#x27;).strip()
62	            except subprocess.SubprocessError:
63	                nvcc = &#x27;Not Available&#x27;
64	            env_info[&#x27;NVCC&#x27;] = nvcc
65	
66	    try:
67	        gcc = subprocess.check_output(&#x27;gcc --version | head -n1&#x27;, shell=True)
68	        gcc = gcc.decode(&#x27;utf-8&#x27;).strip()
69	        env_info[&#x27;GCC&#x27;] = gcc
70	    except subprocess.CalledProcessError:  # gcc is unavailable
71	        env_info[&#x27;GCC&#x27;] = &#x27;n/a&#x27;
72	
73	    env_info[&#x27;PyTorch&#x27;] = torch.__version__
74	    env_info[&#x27;PyTorch compiling details&#x27;] = get_build_config()
75	
76	    try:
77	        import torchvision
78	        env_info[&#x27;TorchVision&#x27;] = torchvision.__version__
79	    except ModuleNotFoundError:
80	        pass
81	
82	    env_info[&#x27;OpenCV&#x27;] = cv2.__version__
</pre>
</div>


</div>
</div>

<div id="issue-106">
<div class="issue-block issue-sev-low">
    <b>subprocess_popen_with_shell_equals_true: </b> subprocess call with shell=True seems safe, but may be changed in the future, consider rewriting without shell<br>
    <b>Test ID:</b> B602<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/env.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/env.py</a><br>
    <b>Line number: </b>67<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html</a><br>

<div class="code">
<pre>
51	
52	        from custom_mmpkg.custom_mmcv.utils.parrots_wrapper import _get_cuda_home
53	        CUDA_HOME = _get_cuda_home()
54	        env_info[&#x27;CUDA_HOME&#x27;] = CUDA_HOME
55	
56	        if CUDA_HOME is not None and osp.isdir(CUDA_HOME):
57	            try:
58	                nvcc = osp.join(CUDA_HOME, &#x27;bin/nvcc&#x27;)
59	                nvcc = subprocess.check_output(
60	                    f&#x27;&quot;{nvcc}&quot; -V | tail -n1&#x27;, shell=True)
61	                nvcc = nvcc.decode(&#x27;utf-8&#x27;).strip()
62	            except subprocess.SubprocessError:
63	                nvcc = &#x27;Not Available&#x27;
64	            env_info[&#x27;NVCC&#x27;] = nvcc
65	
66	    try:
67	        gcc = subprocess.check_output(&#x27;gcc --version | head -n1&#x27;, shell=True)
68	        gcc = gcc.decode(&#x27;utf-8&#x27;).strip()
69	        env_info[&#x27;GCC&#x27;] = gcc
70	    except subprocess.CalledProcessError:  # gcc is unavailable
71	        env_info[&#x27;GCC&#x27;] = &#x27;n/a&#x27;
72	
73	    env_info[&#x27;PyTorch&#x27;] = torch.__version__
74	    env_info[&#x27;PyTorch compiling details&#x27;] = get_build_config()
75	
76	    try:
77	        import torchvision
78	        env_info[&#x27;TorchVision&#x27;] = torchvision.__version__
79	    except ModuleNotFoundError:
80	        pass
81	
82	    env_info[&#x27;OpenCV&#x27;] = cv2.__version__
</pre>
</div>


</div>
</div>

<div id="issue-107">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/misc.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/misc.py</a><br>
    <b>Line number: </b>5<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	import collections.abc
3	import functools
4	import itertools
5	import subprocess
6	import warnings
7	from collections import abc
8	from importlib import import_module
9	from inspect import getfullargspec
10	from itertools import repeat
11	
12	
13	# From PyTorch internals
14	def _ntuple(n):
15	
16	    def parse(x):
17	        if isinstance(x, collections.abc.Iterable):
18	            return x
19	        return tuple(repeat(x, n))
20	
21	    return parse
22	
23	
24	to_1tuple = _ntuple(1)
25	to_2tuple = _ntuple(2)
26	to_3tuple = _ntuple(3)
27	to_4tuple = _ntuple(4)
28	to_ntuple = _ntuple
29	
30	
31	def is_str(x):
32	    &quot;&quot;&quot;Whether the input is an string instance.
</pre>
</div>


</div>
</div>

<div id="issue-108">
<div class="issue-block issue-sev-high">
    <b>subprocess_popen_with_shell_equals_true: </b> subprocess call with shell=True identified, security issue.<br>
    <b>Test ID:</b> B602<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/misc.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/misc.py</a><br>
    <b>Line number: </b>254<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html</a><br>

<div class="code">
<pre>
238	
239	        return wrapped_func
240	
241	    return wrap
242	
243	
244	def _check_py_package(package):
245	    try:
246	        import_module(package)
247	    except ImportError:
248	        return False
249	    else:
250	        return True
251	
252	
253	def _check_executable(cmd):
254	    if subprocess.call(f&#x27;which {cmd}&#x27;, shell=True) != 0:
255	        return False
256	    else:
257	        return True
258	
259	
260	def requires_package(prerequisites):
261	    &quot;&quot;&quot;A decorator to check if some python packages are installed.
262	
263	    Example:
264	        &gt;&gt;&gt; @requires_package(&#x27;numpy&#x27;)
265	        &gt;&gt;&gt; func(arg1, args):
266	        &gt;&gt;&gt;     return numpy.zeros(1)
267	        array([0.])
268	        &gt;&gt;&gt; @requires_package([&#x27;numpy&#x27;, &#x27;non_package&#x27;])
269	        &gt;&gt;&gt; func(arg1, args):
</pre>
</div>


</div>
</div>

<div id="issue-109">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/version_utils.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/version_utils.py</a><br>
    <b>Line number: </b>3<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	import os
3	import subprocess
4	import warnings
5	
6	from packaging.version import parse
7	
8	
9	def digit_version(version_str: str, length: int = 4):
10	    &quot;&quot;&quot;Convert a version string into a tuple of integers.
11	
12	    This method is usually used for comparing two versions. For pre-release
13	    versions: alpha &lt; beta &lt; rc.
14	
15	    Args:
16	        version_str (str): The version string.
17	        length (int): The maximum number of version levels. Default: 4.
18	
19	    Returns:
20	        tuple[int]: The version info in digits (integers).
21	    &quot;&quot;&quot;
22	    assert &#x27;parrots&#x27; not in version_str
23	    version = parse(version_str)
24	    assert version.release, f&#x27;failed to parse version {version_str}&#x27;
25	    release = list(version.release)
26	    release = release[:length]
27	    if len(release) &lt; length:
28	        release = release + [0] * (length - len(release))
29	    if version.is_prerelease:
30	        mapping = {&#x27;a&#x27;: -3, &#x27;b&#x27;: -2, &#x27;rc&#x27;: -1}
31	        val = -4
32	        # version.pre can be None
</pre>
</div>


</div>
</div>

<div id="issue-110">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/version_utils.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/utils/version_utils.py</a><br>
    <b>Line number: </b>61<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
45	    else:
46	        release.extend([0, 0])
47	    return tuple(release)
48	
49	
50	def _minimal_ext_cmd(cmd):
51	    # construct minimal environment
52	    env = {}
53	    for k in [&#x27;SYSTEMROOT&#x27;, &#x27;PATH&#x27;, &#x27;HOME&#x27;]:
54	        v = os.environ.get(k)
55	        if v is not None:
56	            env[k] = v
57	    # LANGUAGE is used on win32
58	    env[&#x27;LANGUAGE&#x27;] = &#x27;C&#x27;
59	    env[&#x27;LANG&#x27;] = &#x27;C&#x27;
60	    env[&#x27;LC_ALL&#x27;] = &#x27;C&#x27;
61	    out = subprocess.Popen(
62	        cmd, stdout=subprocess.PIPE, env=env).communicate()[0]
63	    return out
64	
65	
66	def get_git_hash(fallback=&#x27;unknown&#x27;, digits=None):
67	    &quot;&quot;&quot;Get the git hash of the current repo.
68	
69	    Args:
70	        fallback (str, optional): The fallback string when git hash is
71	            unavailable. Defaults to &#x27;unknown&#x27;.
72	        digits (int, optional): kept digits of the hash. Defaults to None,
73	            meaning all digits are kept.
74	
75	    Returns:
76	        str: Git commit hash.
77	    &quot;&quot;&quot;
</pre>
</div>


</div>
</div>

<div id="issue-111">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/video/processing.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/video/processing.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) OpenMMLab. All rights reserved.
2	import os
3	import os.path as osp
4	import subprocess
5	import tempfile
6	
7	from custom_mmpkg.custom_mmcv.utils import requires_executable
8	
9	
10	@requires_executable(&#x27;ffmpeg&#x27;)
11	def convert_video(in_file,
12	                  out_file,
13	                  print_cmd=False,
14	                  pre_options=&#x27;&#x27;,
15	                  **kwargs):
16	    &quot;&quot;&quot;Convert a video with ffmpeg.
17	
18	    This provides a general api to ffmpeg, the executed command is::
19	
20	        `ffmpeg -y &lt;pre_options&gt; -i &lt;in_file&gt; &lt;options&gt; &lt;out_file&gt;`
21	
22	    Options(kwargs) are mapped to ffmpeg commands with the following rules:
23	
24	    - key=val: &quot;-key val&quot;
25	    - key=True: &quot;-key&quot;
26	    - key=False: &quot;&quot;
27	
28	    Args:
29	        in_file (str): Input video filename.
30	        out_file (str): Output video filename.
31	        pre_options (str): Options appears before &quot;-i &lt;in_file&gt;&quot;.
32	        print_cmd (bool): Whether to print the final ffmpeg command.
</pre>
</div>


</div>
</div>

<div id="issue-112">
<div class="issue-block issue-sev-high">
    <b>subprocess_popen_with_shell_equals_true: </b> subprocess call with shell=True identified, security issue.<br>
    <b>Test ID:</b> B602<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/video/processing.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmcv/video/processing.py</a><br>
    <b>Line number: </b>51<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html</a><br>

<div class="code">
<pre>
35	    for k, v in kwargs.items():
36	        if isinstance(v, bool):
37	            if v:
38	                options.append(f&#x27;-{k}&#x27;)
39	        elif k == &#x27;log_level&#x27;:
40	            assert v in [
41	                &#x27;quiet&#x27;, &#x27;panic&#x27;, &#x27;fatal&#x27;, &#x27;error&#x27;, &#x27;warning&#x27;, &#x27;info&#x27;,
42	                &#x27;verbose&#x27;, &#x27;debug&#x27;, &#x27;trace&#x27;
43	            ]
44	            options.append(f&#x27;-loglevel {v}&#x27;)
45	        else:
46	            options.append(f&#x27;-{k} {v}&#x27;)
47	    cmd = f&#x27;ffmpeg -y {pre_options} -i {in_file} {&quot; &quot;.join(options)} &#x27; \
48	          f&#x27;{out_file}&#x27;
49	    if print_cmd:
50	        print(cmd)
51	    subprocess.call(cmd, shell=True)
52	
53	
54	@requires_executable(&#x27;ffmpeg&#x27;)
55	def resize_video(in_file,
56	                 out_file,
57	                 size=None,
58	                 ratio=None,
59	                 keep_ar=False,
60	                 log_level=&#x27;info&#x27;,
61	                 print_cmd=False):
62	    &quot;&quot;&quot;Resize a video.
63	
64	    Args:
65	        in_file (str): Input video filename.
66	        out_file (str): Output video filename.
</pre>
</div>


</div>
</div>

<div id="issue-113">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmseg/apis/test.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmseg/apis/test.py</a><br>
    <b>Line number: </b>2<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	import os.path as osp
2	import pickle
3	import shutil
4	import tempfile
5	
6	import custom_mmpkg.custom_mmcv as mmcv
7	import numpy as np
8	import torch
9	import torch.distributed as dist
10	from custom_mmpkg.custom_mmcv.image import tensor2imgs
11	from custom_mmpkg.custom_mmcv.runner import get_dist_info
12	
13	
14	def np2tmp(array, temp_file_name=None):
15	    &quot;&quot;&quot;Save ndarray to local numpy file.
16	
17	    Args:
18	        array (ndarray): Ndarray to save.
19	        temp_file_name (str): Numpy file name. If &#x27;temp_file_name=None&#x27;, this
20	            function will generate a file name with tempfile.NamedTemporaryFile
21	            to save ndarray. Default: None.
22	
23	    Returns:
24	        str: The numpy file name.
25	    &quot;&quot;&quot;
26	
27	    if temp_file_name is None:
28	        temp_file_name = tempfile.NamedTemporaryFile(
29	            suffix=&#x27;.npy&#x27;, delete=False).name
30	    np.save(temp_file_name, array)
31	    return temp_file_name
32	
</pre>
</div>


</div>
</div>

<div id="issue-114">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmseg/apis/test.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmseg/apis/test.py</a><br>
    <b>Line number: </b>231<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
215	    shape_list = [shape_tensor.clone() for _ in range(world_size)]
216	    dist.all_gather(shape_list, shape_tensor)
217	    # padding result part tensor to max length
218	    shape_max = torch.tensor(shape_list).max()
219	    part_send = torch.zeros(shape_max, dtype=torch.uint8, device=&#x27;cuda&#x27;)
220	    part_send[:shape_tensor[0]] = part_tensor
221	    part_recv_list = [
222	        part_tensor.new_zeros(shape_max) for _ in range(world_size)
223	    ]
224	    # gather all result part
225	    dist.all_gather(part_recv_list, part_send)
226	
227	    if rank == 0:
228	        part_list = []
229	        for recv, shape in zip(part_recv_list, shape_list):
230	            part_list.append(
231	                pickle.loads(recv[:shape[0]].cpu().numpy().tobytes()))
232	        # sort the results
233	        ordered_results = []
234	        for res in zip(*part_list):
235	            ordered_results.extend(list(res))
236	        # the dataloader may pad some samples
237	        ordered_results = ordered_results[:size]
238	        return ordered_results
</pre>
</div>


</div>
</div>

<div id="issue-115">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmseg/core/evaluation/class_names.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmseg/core/evaluation/class_names.py</a><br>
    <b>Line number: </b>130<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
114	dataset_aliases = {
115	    &#x27;cityscapes&#x27;: [&#x27;cityscapes&#x27;],
116	    &#x27;ade&#x27;: [&#x27;ade&#x27;, &#x27;ade20k&#x27;],
117	    &#x27;voc&#x27;: [&#x27;voc&#x27;, &#x27;pascal_voc&#x27;, &#x27;voc12&#x27;, &#x27;voc12aug&#x27;]
118	}
119	
120	
121	def get_classes(dataset):
122	    &quot;&quot;&quot;Get class names of a dataset.&quot;&quot;&quot;
123	    alias2name = {}
124	    for name, aliases in dataset_aliases.items():
125	        for alias in aliases:
126	            alias2name[alias] = name
127	
128	    if mmcv.is_str(dataset):
129	        if dataset in alias2name:
130	            labels = eval(alias2name[dataset] + &#x27;_classes()&#x27;)
131	        else:
132	            raise ValueError(f&#x27;Unrecognized dataset: {dataset}&#x27;)
133	    else:
134	        raise TypeError(f&#x27;dataset must a str, but got {type(dataset)}&#x27;)
135	    return labels
136	
137	
138	def get_palette(dataset):
139	    &quot;&quot;&quot;Get class palette (RGB) of a dataset.&quot;&quot;&quot;
140	    alias2name = {}
141	    for name, aliases in dataset_aliases.items():
142	        for alias in aliases:
143	            alias2name[alias] = name
144	
145	    if mmcv.is_str(dataset):
</pre>
</div>


</div>
</div>

<div id="issue-116">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_mmpkg/custom_mmseg/core/evaluation/class_names.py" target="_blank">comfyui_controlnet_aux/src/custom_mmpkg/custom_mmseg/core/evaluation/class_names.py</a><br>
    <b>Line number: </b>147<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
131	        else:
132	            raise ValueError(f&#x27;Unrecognized dataset: {dataset}&#x27;)
133	    else:
134	        raise TypeError(f&#x27;dataset must a str, but got {type(dataset)}&#x27;)
135	    return labels
136	
137	
138	def get_palette(dataset):
139	    &quot;&quot;&quot;Get class palette (RGB) of a dataset.&quot;&quot;&quot;
140	    alias2name = {}
141	    for name, aliases in dataset_aliases.items():
142	        for alias in aliases:
143	            alias2name[alias] = name
144	
145	    if mmcv.is_str(dataset):
146	        if dataset in alias2name:
147	            labels = eval(alias2name[dataset] + &#x27;_palette()&#x27;)
148	        else:
149	            raise ValueError(f&#x27;Unrecognized dataset: {dataset}&#x27;)
150	    else:
151	        raise TypeError(f&#x27;dataset must a str, but got {type(dataset)}&#x27;)
152	    return labels
</pre>
</div>


</div>
</div>

<div id="issue-117">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_oneformer/evaluation/coco_evaluator.py" target="_blank">comfyui_controlnet_aux/src/custom_oneformer/evaluation/coco_evaluator.py</a><br>
    <b>Line number: </b>14<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# ------------------------------------------------------------------------------
2	# Reference: https://github.com/facebookresearch/detectron2/blob/main/detectron2/evaluation/coco_evaluation.py
3	# Modified by Jitesh Jain (https://github.com/praeclarumjj3)
4	# ------------------------------------------------------------------------------
5	
6	import contextlib
7	import copy
8	import io
9	import itertools
10	import json
11	import logging
12	import numpy as np
13	import os
14	import pickle
15	from collections import OrderedDict
16	import custom_pycocotools.mask as mask_util
17	import torch
18	from custom_pycocotools.coco import COCO
19	from custom_pycocotools.cocoeval import COCOeval
20	from tabulate import tabulate
21	
22	import custom_detectron2.utils.comm as comm
23	from custom_detectron2.config import CfgNode
24	from custom_detectron2.data import MetadataCatalog
25	from custom_detectron2.data.datasets.coco import convert_to_coco_json
26	from custom_detectron2.structures import Boxes, BoxMode, pairwise_iou
27	from custom_detectron2.utils.file_io import PathManager
28	from custom_detectron2.utils.logger import create_small_table
29	
30	from .evaluator import DatasetEvaluator
31	
32	try:
</pre>
</div>


</div>
</div>

<div id="issue-118">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_oneformer/evaluation/detection_coco_evaluator.py" target="_blank">comfyui_controlnet_aux/src/custom_oneformer/evaluation/detection_coco_evaluator.py</a><br>
    <b>Line number: </b>14<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# ------------------------------------------------------------------------------
2	# Reference: https://github.com/facebookresearch/detectron2/blob/main/detectron2/evaluation/coco_evaluation.py
3	# Modified by Jitesh Jain (https://github.com/praeclarumjj3)
4	# ------------------------------------------------------------------------------
5	
6	import contextlib
7	import copy
8	import io
9	import itertools
10	import json
11	import logging
12	import numpy as np
13	import os
14	import pickle
15	from collections import OrderedDict
16	import custom_pycocotools.mask as mask_util
17	import torch
18	from custom_pycocotools.coco import COCO
19	from custom_pycocotools.cocoeval import COCOeval
20	from tabulate import tabulate
21	
22	import custom_detectron2.utils.comm as comm
23	from custom_detectron2.config import CfgNode
24	from custom_detectron2.data import MetadataCatalog
25	from custom_detectron2.data.datasets.coco import convert_to_coco_json
26	from custom_detectron2.structures import Boxes, BoxMode, pairwise_iou
27	from custom_detectron2.utils.file_io import PathManager
28	from custom_detectron2.utils.logger import create_small_table
29	
30	from .evaluator import DatasetEvaluator
31	
32	try:
</pre>
</div>


</div>
</div>

<div id="issue-119">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_oneformer/evaluation/instance_evaluation.py" target="_blank">comfyui_controlnet_aux/src/custom_oneformer/evaluation/instance_evaluation.py</a><br>
    <b>Line number: </b>13<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# ------------------------------------------------------------------------------
2	# Reference: https://github.com/facebookresearch/Mask2Former/blob/main/mask2former/evaluation/instance_evaluation.py
3	# ------------------------------------------------------------------------------
4	
5	import contextlib
6	import copy
7	import io
8	import itertools
9	import json
10	import logging
11	import numpy as np
12	import os
13	import pickle
14	from collections import OrderedDict
15	import custom_pycocotools.mask as mask_util
16	import torch
17	from custom_pycocotools.coco import COCO
18	from custom_pycocotools.cocoeval import COCOeval
19	from tabulate import tabulate
20	
21	import custom_detectron2.utils.comm as comm
22	from custom_detectron2.config import CfgNode
23	from custom_detectron2.data import MetadataCatalog
24	from custom_detectron2.data.datasets.coco import convert_to_coco_json
25	from custom_detectron2.evaluation.coco_evaluation import COCOEvaluator, _evaluate_predictions_on_coco
26	from custom_detectron2.evaluation.fast_eval_api import COCOeval_opt
27	from custom_detectron2.structures import Boxes, BoxMode, pairwise_iou
28	from custom_detectron2.utils.file_io import PathManager
29	from custom_detectron2.utils.logger import create_small_table
30	
31	
32	# modified from COCOEvaluator for instance segmetnat
</pre>
</div>


</div>
</div>

<div id="issue-120">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Audit url open for permitted schemes. Allowing use of file:/ or custom schemes is often unexpected.<br>
    <b>Test ID:</b> B310<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/22.html" target="_blank">CWE-22</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_pycocotools/coco.py" target="_blank">comfyui_controlnet_aux/src/custom_pycocotools/coco.py</a><br>
    <b>Line number: </b>390<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b310-urllib-urlopen</a><br>

<div class="code">
<pre>
374	        :return:
375	        &#x27;&#x27;&#x27;
376	        if tarDir is None:
377	            print(&#x27;Please specify target directory&#x27;)
378	            return -1
379	        if len(imgIds) == 0:
380	            imgs = self.imgs.values()
381	        else:
382	            imgs = self.loadImgs(imgIds)
383	        N = len(imgs)
384	        if not os.path.exists(tarDir):
385	            os.makedirs(tarDir)
386	        for i, img in enumerate(imgs):
387	            tic = time.time()
388	            fname = os.path.join(tarDir, img[&#x27;file_name&#x27;])
389	            if not os.path.exists(fname):
390	                urlretrieve(img[&#x27;coco_url&#x27;], fname)
391	            print(&#x27;downloaded {}/{} images (t={:0.1f}s)&#x27;.format(i, N, time.time()- tic))
392	
393	    def loadNumpyAnnotations(self, data):
394	        &quot;&quot;&quot;
395	        Convert result data from a numpy array [Nx7] where each row contains {imageID,x1,y1,w,h,score,class}
396	        :param  data (numpy.ndarray)
397	        :return: annotations (python nested list)
398	        &quot;&quot;&quot;
399	        print(&#x27;Converting ndarray to lists...&#x27;)
400	        assert(type(data) == np.ndarray)
401	        print(data.shape)
402	        assert(data.shape[1] == 7)
403	        N = data.shape[0]
404	        ann = []
405	        for i in range(N):
</pre>
</div>


</div>
</div>

<div id="issue-121">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_pycocotools/cocoeval.py" target="_blank">comfyui_controlnet_aux/src/custom_pycocotools/cocoeval.py</a><br>
    <b>Line number: </b>407<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
391	                        else:
392	                            recall[t,k,a,m] = 0
393	
394	                        # numpy is slow without cython optimization for accessing elements
395	                        # use python array gets significant speed improvement
396	                        pr = pr.tolist(); q = q.tolist()
397	
398	                        for i in range(nd-1, 0, -1):
399	                            if pr[i] &gt; pr[i-1]:
400	                                pr[i-1] = pr[i]
401	
402	                        inds = np.searchsorted(rc, p.recThrs, side=&#x27;left&#x27;)
403	                        try:
404	                            for ri, pi in enumerate(inds):
405	                                q[ri] = pr[pi]
406	                                ss[ri] = dtScoresSorted[pi]
407	                        except:
408	                            pass
409	                        precision[t,:,k,a,m] = np.array(q)
410	                        scores[t,:,k,a,m] = np.array(ss)
411	        self.eval = {
412	            &#x27;params&#x27;: p,
413	            &#x27;counts&#x27;: [T, R, K, A, M],
414	            &#x27;date&#x27;: datetime.datetime.now().strftime(&#x27;%Y-%m-%d %H:%M:%S&#x27;),
415	            &#x27;precision&#x27;: precision,
416	            &#x27;recall&#x27;:   recall,
417	            &#x27;scores&#x27;: scores,
418	        }
419	        toc = time.time()
420	        print(&#x27;DONE (t={:0.2f}s).&#x27;.format( toc-tic))
421	
422	    def summarize(self):
423	        &#x27;&#x27;&#x27;
</pre>
</div>


</div>
</div>

<div id="issue-122">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_timm/data/parsers/class_map.py" target="_blank">comfyui_controlnet_aux/src/custom_timm/data/parsers/class_map.py</a><br>
    <b>Line number: </b>2<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	import os
2	import pickle
3	
4	def load_class_map(map_or_filename, root=&#x27;&#x27;):
5	    if isinstance(map_or_filename, dict):
6	        assert dict, &#x27;class_map dict must be non-empty&#x27;
7	        return map_or_filename
8	    class_map_path = map_or_filename
9	    if not os.path.exists(class_map_path):
10	        class_map_path = os.path.join(root, class_map_path)
11	        assert os.path.exists(class_map_path), &#x27;Cannot locate specified class map file (%s)&#x27; % map_or_filename
12	    class_map_ext = os.path.splitext(map_or_filename)[-1].lower()
13	    if class_map_ext == &#x27;.txt&#x27;:
14	        with open(class_map_path) as f:
15	            class_to_idx = {v.strip(): k for k, v in enumerate(f)}
16	    elif class_map_ext == &#x27;.pkl&#x27;:
17	        with open(class_map_path,&#x27;rb&#x27;) as f:
18	            class_to_idx = pickle.load(f)
19	    else:
20	        assert False, f&#x27;Unsupported class map file extension ({class_map_ext}).&#x27;
21	    return class_to_idx
22	
</pre>
</div>


</div>
</div>

<div id="issue-123">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_timm/data/parsers/class_map.py" target="_blank">comfyui_controlnet_aux/src/custom_timm/data/parsers/class_map.py</a><br>
    <b>Line number: </b>18<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
2	import pickle
3	
4	def load_class_map(map_or_filename, root=&#x27;&#x27;):
5	    if isinstance(map_or_filename, dict):
6	        assert dict, &#x27;class_map dict must be non-empty&#x27;
7	        return map_or_filename
8	    class_map_path = map_or_filename
9	    if not os.path.exists(class_map_path):
10	        class_map_path = os.path.join(root, class_map_path)
11	        assert os.path.exists(class_map_path), &#x27;Cannot locate specified class map file (%s)&#x27; % map_or_filename
12	    class_map_ext = os.path.splitext(map_or_filename)[-1].lower()
13	    if class_map_ext == &#x27;.txt&#x27;:
14	        with open(class_map_path) as f:
15	            class_to_idx = {v.strip(): k for k, v in enumerate(f)}
16	    elif class_map_ext == &#x27;.pkl&#x27;:
17	        with open(class_map_path,&#x27;rb&#x27;) as f:
18	            class_to_idx = pickle.load(f)
19	    else:
20	        assert False, f&#x27;Unsupported class map file extension ({class_map_ext}).&#x27;
21	    return class_to_idx
22	
</pre>
</div>


</div>
</div>

<div id="issue-124">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_timm/data/parsers/parser_image_in_tar.py" target="_blank">comfyui_controlnet_aux/src/custom_timm/data/parsers/parser_image_in_tar.py</a><br>
    <b>Line number: </b>14<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	&quot;&quot;&quot; A dataset parser that reads tarfile based datasets
2	
3	This parser can read and extract image samples from:
4	* a single tar of image files
5	* a folder of multiple tarfiles containing imagefiles
6	* a tar of tars containing image files
7	
8	Labels are based on the combined folder and/or tar name structure.
9	
10	Hacked together by / Copyright 2020 Ross Wightman
11	&quot;&quot;&quot;
12	import logging
13	import os
14	import pickle
15	import tarfile
16	from glob import glob
17	from typing import List, Tuple, Dict, Set, Optional, Union
18	
19	import numpy as np
20	
21	from custom_timm.utils.misc import natural_key
22	
23	from .class_map import load_class_map
24	from .img_extensions import get_img_extensions
25	from .parser import Parser
26	
27	_logger = logging.getLogger(__name__)
28	CACHE_FILENAME_SUFFIX = &#x27;_tarinfos.pickle&#x27;
29	
30	
31	class TarState:
32	
</pre>
</div>


</div>
</div>

<div id="issue-125">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_timm/data/parsers/parser_image_in_tar.py" target="_blank">comfyui_controlnet_aux/src/custom_timm/data/parsers/parser_image_in_tar.py</a><br>
    <b>Line number: </b>96<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
80	        tar_filenames = glob(os.path.join(root, &#x27;*.tar&#x27;), recursive=True)
81	    num_tars = len(tar_filenames)
82	    tar_bytes = sum([os.path.getsize(f) for f in tar_filenames])
83	    assert num_tars, f&#x27;No .tar files found at specified path ({root}).&#x27;
84	
85	    _logger.info(f&#x27;Scanning {tar_bytes/1024**2:.2f}MB of tar files...&#x27;)
86	    info = dict(tartrees=[])
87	    cache_path = &#x27;&#x27;
88	    if cache_tarinfo is None:
89	        cache_tarinfo = True if tar_bytes &gt; 10*1024**3 else False  # FIXME magic number, 10GB
90	    if cache_tarinfo:
91	        cache_filename = &#x27;_&#x27; + root_name + CACHE_FILENAME_SUFFIX
92	        cache_path = os.path.join(root, cache_filename)
93	    if os.path.exists(cache_path):
94	        _logger.info(f&#x27;Reading tar info from cache file {cache_path}.&#x27;)
95	        with open(cache_path, &#x27;rb&#x27;) as pf:
96	            info = pickle.load(pf)
97	        assert len(info[&#x27;tartrees&#x27;]) == num_tars, &quot;Cached tartree len doesn&#x27;t match number of tarfiles&quot;
98	    else:
99	        for i, fn in enumerate(tar_filenames):
100	            path = &#x27;&#x27; if root_is_tar else os.path.splitext(os.path.basename(fn))[0]
101	            with tarfile.open(fn, mode=&#x27;r|&#x27;) as tf:  # tarinfo scans done in streaming mode
102	                parent_info = dict(name=os.path.relpath(fn, root), path=path, ti=None, children=[], samples=[])
103	                num_samples = _extract_tarinfo(tf, parent_info, extensions=extensions)
104	                num_children = len(parent_info[&quot;children&quot;])
105	                _logger.debug(
106	                    f&#x27;{i}/{num_tars}. Extracted tarinfos from {fn}. {num_children} children, {num_samples} samples.&#x27;)
107	            info[&#x27;tartrees&#x27;].append(parent_info)
108	        if cache_path:
109	            _logger.info(f&#x27;Writing tar info to cache file {cache_path}.&#x27;)
110	            with open(cache_path, &#x27;wb&#x27;) as pf:
111	                pickle.dump(info, pf)
</pre>
</div>


</div>
</div>

<div id="issue-126">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_timm/utils/jit.py" target="_blank">comfyui_controlnet_aux/src/custom_timm/utils/jit.py</a><br>
    <b>Line number: </b>33<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
17	    torch._C._jit_set_profiling_executor(False)
18	    torch._C._jit_set_profiling_mode(False)
19	    torch._C._jit_override_can_fuse_on_gpu(True)
20	    #torch._C._jit_set_texpr_fuser_enabled(True)
21	
22	
23	def set_jit_fuser(fuser):
24	    if fuser == &quot;te&quot;:
25	        # default fuser should be == &#x27;te&#x27;
26	        torch._C._jit_set_profiling_executor(True)
27	        torch._C._jit_set_profiling_mode(True)
28	        torch._C._jit_override_can_fuse_on_cpu(False)
29	        torch._C._jit_override_can_fuse_on_gpu(True)
30	        torch._C._jit_set_texpr_fuser_enabled(True)
31	        try:
32	            torch._C._jit_set_nvfuser_enabled(False)
33	        except Exception:
34	            pass
35	    elif fuser == &quot;old&quot; or fuser == &quot;legacy&quot;:
36	        torch._C._jit_set_profiling_executor(False)
37	        torch._C._jit_set_profiling_mode(False)
38	        torch._C._jit_override_can_fuse_on_gpu(True)
39	        torch._C._jit_set_texpr_fuser_enabled(False)
40	        try:
41	            torch._C._jit_set_nvfuser_enabled(False)
42	        except Exception:
43	            pass
44	    elif fuser == &quot;nvfuser&quot; or fuser == &quot;nvf&quot;:
45	        os.environ[&#x27;PYTORCH_NVFUSER_DISABLE_FALLBACK&#x27;] = &#x27;1&#x27;
46	        #os.environ[&#x27;PYTORCH_NVFUSER_DISABLE_FMA&#x27;] = &#x27;1&#x27;
47	        #os.environ[&#x27;PYTORCH_NVFUSER_JIT_OPT_LEVEL&#x27;] = &#x27;0&#x27;
48	        torch._C._jit_set_texpr_fuser_enabled(False)
49	        torch._C._jit_set_profiling_executor(True)
</pre>
</div>


</div>
</div>

<div id="issue-127">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/src/custom_timm/utils/jit.py" target="_blank">comfyui_controlnet_aux/src/custom_timm/utils/jit.py</a><br>
    <b>Line number: </b>42<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
26	        torch._C._jit_set_profiling_executor(True)
27	        torch._C._jit_set_profiling_mode(True)
28	        torch._C._jit_override_can_fuse_on_cpu(False)
29	        torch._C._jit_override_can_fuse_on_gpu(True)
30	        torch._C._jit_set_texpr_fuser_enabled(True)
31	        try:
32	            torch._C._jit_set_nvfuser_enabled(False)
33	        except Exception:
34	            pass
35	    elif fuser == &quot;old&quot; or fuser == &quot;legacy&quot;:
36	        torch._C._jit_set_profiling_executor(False)
37	        torch._C._jit_set_profiling_mode(False)
38	        torch._C._jit_override_can_fuse_on_gpu(True)
39	        torch._C._jit_set_texpr_fuser_enabled(False)
40	        try:
41	            torch._C._jit_set_nvfuser_enabled(False)
42	        except Exception:
43	            pass
44	    elif fuser == &quot;nvfuser&quot; or fuser == &quot;nvf&quot;:
45	        os.environ[&#x27;PYTORCH_NVFUSER_DISABLE_FALLBACK&#x27;] = &#x27;1&#x27;
46	        #os.environ[&#x27;PYTORCH_NVFUSER_DISABLE_FMA&#x27;] = &#x27;1&#x27;
47	        #os.environ[&#x27;PYTORCH_NVFUSER_JIT_OPT_LEVEL&#x27;] = &#x27;0&#x27;
48	        torch._C._jit_set_texpr_fuser_enabled(False)
49	        torch._C._jit_set_profiling_executor(True)
50	        torch._C._jit_set_profiling_mode(True)
51	        torch._C._jit_can_fuse_on_cpu()
52	        torch._C._jit_can_fuse_on_gpu()
53	        torch._C._jit_override_can_fuse_on_cpu(False)
54	        torch._C._jit_override_can_fuse_on_gpu(False)
55	        torch._C._jit_set_nvfuser_guard_mode(True)
56	        torch._C._jit_set_nvfuser_enabled(True)
57	    else:
58	        assert False, f&quot;Invalid jit fuser ({fuser})&quot;
</pre>
</div>


</div>
</div>

<div id="issue-128">
<div class="issue-block issue-sev-medium">
    <b>request_without_timeout: </b> Requests call without timeout<br>
    <b>Test ID:</b> B113<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>LOW<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/400.html" target="_blank">CWE-400</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/tests/test_controlnet_aux.py" target="_blank">comfyui_controlnet_aux/tests/test_controlnet_aux.py</a><br>
    <b>Line number: </b>39<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html</a><br>

<div class="code">
<pre>
23	    output(name, processor(img))
24	    output(name + &quot;_pil_np&quot;, Image.fromarray(processor(img, output_type=&quot;np&quot;)))
25	    output(name + &quot;_np_np&quot;, Image.fromarray(processor(np.array(img, dtype=np.uint8), output_type=&quot;np&quot;)))
26	    output(name + &quot;_np_pil&quot;, processor(np.array(img, dtype=np.uint8), output_type=&quot;pil&quot;))
27	    output(name + &quot;_scaled&quot;, processor(img, detect_resolution=640, image_resolution=768))
28	
29	def return_pil(name, processor, img):
30	    output(name + &quot;_pil_false&quot;, Image.fromarray(processor(img, return_pil=False)))
31	    output(name + &quot;_pil_true&quot;, processor(img, return_pil=True))
32	
33	@pytest.fixture(scope=&quot;module&quot;)
34	def img():
35	    if os.path.exists(OUTPUT_DIR):
36	        shutil.rmtree(OUTPUT_DIR)
37	    os.mkdir(OUTPUT_DIR)
38	    url = &quot;https://huggingface.co/lllyasviel/sd-controlnet-openpose/resolve/main/images/pose.png&quot;
39	    response = requests.get(url)
40	    img = Image.open(BytesIO(response.content)).convert(&quot;RGB&quot;).resize((512, 512))
41	    return img
42	
43	def test_canny(img):
44	    canny = CannyDetector()
45	    common(&quot;canny&quot;, canny, img)
46	    output(&quot;canny_img&quot;, canny(img=img))
47	
48	def test_hed(img):
49	    hed = HEDdetector.from_pretrained(&quot;lllyasviel/Annotators&quot;)
50	    common(&quot;hed&quot;, hed, img)
51	    return_pil(&quot;hed&quot;, hed, img)
52	    output(&quot;hed_safe&quot;, hed(img, safe=True))
53	    output(&quot;hed_scribble&quot;, hed(img, scribble=True))
54	
</pre>
</div>


</div>
</div>

<div id="issue-129">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/utils.py" target="_blank">comfyui_controlnet_aux/utils.py</a><br>
    <b>Line number: </b>9<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import torch
2	import numpy as np
3	import os
4	import cv2
5	import yaml
6	from pathlib import Path
7	from enum import Enum
8	from .log import log
9	import subprocess
10	import threading
11	import comfy
12	import tempfile
13	
14	here = Path(__file__).parent.resolve()
15	
16	config_path = Path(here, &quot;config.yaml&quot;)
17	
18	if os.path.exists(config_path):
19	    config = yaml.load(open(config_path, &quot;r&quot;), Loader=yaml.FullLoader)
20	
21	    annotator_ckpts_path = str(Path(here, config[&quot;annotator_ckpts_path&quot;]))
22	    TEMP_DIR = config[&quot;custom_temp_path&quot;]
23	    USE_SYMLINKS = config[&quot;USE_SYMLINKS&quot;]
24	    ORT_PROVIDERS = config[&quot;EP_list&quot;]
25	
26	    if USE_SYMLINKS is None or type(USE_SYMLINKS) != bool:
27	        log.error(&quot;USE_SYMLINKS must be a boolean. Using False by default.&quot;)
28	        USE_SYMLINKS = False
29	
30	    if TEMP_DIR is None:
31	        TEMP_DIR = tempfile.gettempdir()
32	    elif not os.path.isdir(TEMP_DIR):
</pre>
</div>


</div>
</div>

<div id="issue-130">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/utils.py" target="_blank">comfyui_controlnet_aux/utils.py</a><br>
    <b>Line number: </b>19<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
3	import os
4	import cv2
5	import yaml
6	from pathlib import Path
7	from enum import Enum
8	from .log import log
9	import subprocess
10	import threading
11	import comfy
12	import tempfile
13	
14	here = Path(__file__).parent.resolve()
15	
16	config_path = Path(here, &quot;config.yaml&quot;)
17	
18	if os.path.exists(config_path):
19	    config = yaml.load(open(config_path, &quot;r&quot;), Loader=yaml.FullLoader)
20	
21	    annotator_ckpts_path = str(Path(here, config[&quot;annotator_ckpts_path&quot;]))
22	    TEMP_DIR = config[&quot;custom_temp_path&quot;]
23	    USE_SYMLINKS = config[&quot;USE_SYMLINKS&quot;]
24	    ORT_PROVIDERS = config[&quot;EP_list&quot;]
25	
26	    if USE_SYMLINKS is None or type(USE_SYMLINKS) != bool:
27	        log.error(&quot;USE_SYMLINKS must be a boolean. Using False by default.&quot;)
28	        USE_SYMLINKS = False
29	
30	    if TEMP_DIR is None:
31	        TEMP_DIR = tempfile.gettempdir()
32	    elif not os.path.isdir(TEMP_DIR):
33	        try:
34	            os.makedirs(TEMP_DIR)
</pre>
</div>


</div>
</div>

<div id="issue-131">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="comfyui_controlnet_aux/utils.py" target="_blank">comfyui_controlnet_aux/utils.py</a><br>
    <b>Line number: </b>201<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
185	def get_unique_axis0(data):
186	    arr = np.asanyarray(data)
187	    idxs = np.lexsort(arr.T)
188	    arr = arr[idxs]
189	    unique_idxs = np.empty(len(arr), dtype=np.bool_)
190	    unique_idxs[:1] = True
191	    unique_idxs[1:] = np.any(arr[:-1, :] != arr[1:, :], axis=-1)
192	    return arr[unique_idxs]
193	
194	#Ref: https://github.com/ltdrdata/ComfyUI-Manager/blob/284e90dc8296a2e1e4f14b4b2d10fba2f52f0e53/__init__.py#L14
195	def handle_stream(stream, prefix):
196	    for line in stream:
197	        print(prefix, line, end=&quot;&quot;)
198	
199	
200	def run_script(cmd, cwd=&#x27;.&#x27;):
201	    process = subprocess.Popen(cmd, cwd=cwd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True, bufsize=1)
202	
203	    stdout_thread = threading.Thread(target=handle_stream, args=(process.stdout, &quot;&quot;))
204	    stderr_thread = threading.Thread(target=handle_stream, args=(process.stderr, &quot;[!]&quot;))
205	
206	    stdout_thread.start()
207	    stderr_thread.start()
208	
209	    stdout_thread.join()
210	    stderr_thread.join()
211	
212	    return process.wait()
213	
214	def nms(x, t, s):
215	    x = cv2.GaussianBlur(x.astype(np.float32), (0, 0), s)
216	
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
