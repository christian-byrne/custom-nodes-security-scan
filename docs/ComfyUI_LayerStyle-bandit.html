
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">47796</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/__init__.py" target="_blank">/ComfyUI_LayerStyle/__init__.py</a><br>
    <b>Line number: </b>64<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
48	    dir = os.path.abspath(dir)
49	
50	    if mkdir and not os.path.exists(dir):
51	        os.makedirs(dir)
52	    return dir
53	
54	py = get_ext_dir(&quot;py&quot;)
55	files = os.listdir(py)
56	for file in files:
57	    if not file.endswith(&quot;.py&quot;):
58	        continue
59	    name = os.path.splitext(file)[0]
60	    imported_module = importlib.import_module(&quot;.py.{}&quot;.format(name), __name__)
61	    try:
62	        NODE_CLASS_MAPPINGS = {**NODE_CLASS_MAPPINGS, **imported_module.NODE_CLASS_MAPPINGS}
63	        NODE_DISPLAY_NAME_MAPPINGS = {**NODE_DISPLAY_NAME_MAPPINGS, **imported_module.NODE_DISPLAY_NAME_MAPPINGS}
64	    except:
65	        pass
66	
67	__all__ = [&quot;NODE_CLASS_MAPPINGS&quot;, &quot;NODE_DISPLAY_NAME_MAPPINGS&quot;]
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/BiRefNet/backbones/build_backbone.py" target="_blank">/ComfyUI_LayerStyle/py/BiRefNet/backbones/build_backbone.py</a><br>
    <b>Line number: </b>23<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
7	from ..config import Config
8	
9	
10	config = Config()
11	
12	def build_backbone(bb_name, pretrained=True, params_settings=&#x27;&#x27;):
13	    if bb_name == &#x27;vgg16&#x27;:
14	        bb_net = list(vgg16(pretrained=VGG16_Weights.DEFAULT if pretrained else None).children())[0]
15	        bb = nn.Sequential(OrderedDict({&#x27;conv1&#x27;: bb_net[:4], &#x27;conv2&#x27;: bb_net[4:9], &#x27;conv3&#x27;: bb_net[9:16], &#x27;conv4&#x27;: bb_net[16:23]}))
16	    elif bb_name == &#x27;vgg16bn&#x27;:
17	        bb_net = list(vgg16_bn(pretrained=VGG16_BN_Weights.DEFAULT if pretrained else None).children())[0]
18	        bb = nn.Sequential(OrderedDict({&#x27;conv1&#x27;: bb_net[:6], &#x27;conv2&#x27;: bb_net[6:13], &#x27;conv3&#x27;: bb_net[13:23], &#x27;conv4&#x27;: bb_net[23:33]}))
19	    elif bb_name == &#x27;resnet50&#x27;:
20	        bb_net = list(resnet50(pretrained=ResNet50_Weights.DEFAULT if pretrained else None).children())
21	        bb = nn.Sequential(OrderedDict({&#x27;conv1&#x27;: nn.Sequential(*bb_net[0:3]), &#x27;conv2&#x27;: bb_net[4], &#x27;conv3&#x27;: bb_net[5], &#x27;conv4&#x27;: bb_net[6]}))
22	    else:
23	        bb = eval(&#x27;{}({})&#x27;.format(bb_name, params_settings))
24	        if pretrained:
25	            bb = load_weights(bb, bb_name)
26	    return bb
27	
28	def load_weights(model, model_name):
29	    save_model = torch.load(config.weights[model_name])
30	    model_dict = model.state_dict()
31	    state_dict = {k: v if v.size() == model_dict[k].size() else model_dict[k] for k, v in save_model.items() if k in model_dict.keys()}
32	    # to ignore the weights with mismatched size when I modify the backbone itself.
33	    if not state_dict:
34	        save_model_keys = list(save_model.keys())
35	        sub_item = save_model_keys[0] if len(save_model_keys) == 1 else None
36	        state_dict = {k: v if v.size() == model_dict[k].size() else model_dict[k] for k, v in save_model[sub_item].items() if k in model_dict.keys()}
37	        if not state_dict or not sub_item:
38	            print(&#x27;Weights are not successully loaded. Check the state dict of weights file.&#x27;)
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/BiRefNet/baseline.py" target="_blank">/ComfyUI_LayerStyle/py/BiRefNet/baseline.py</a><br>
    <b>Line number: </b>40<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
24	    def __init__(self):
25	        super(BiRefNet, self).__init__()
26	        self.config = Config()
27	        self.epoch = 1
28	        self.bb = build_backbone(self.config.bb, pretrained=True)
29	
30	        channels = self.config.lateral_channels_in_collection
31	
32	        if self.config.auxiliary_classification:
33	            self.avgpool = nn.AdaptiveAvgPool2d((1, 1))
34	            self.cls_head = nn.Sequential(
35	                nn.Linear(channels[0], len(class_labels_TR_sorted))
36	            )
37	
38	        if self.config.squeeze_block:
39	            self.squeeze_module = nn.Sequential(*[
40	                eval(self.config.squeeze_block.split(&#x27;_x&#x27;)[0])(channels[0]+sum(self.config.cxt), channels[0])
41	                for _ in range(eval(self.config.squeeze_block.split(&#x27;_x&#x27;)[1]))
42	            ])
43	
44	        self.decoder = Decoder(channels)
45	        
46	        if self.config.locate_head:
47	            self.locate_header = nn.ModuleList([
48	                BasicDecBlk(channels[0], channels[-1]),
49	                nn.Sequential(
50	                    nn.Conv2d(channels[-1], 1, 1, 1, 0),
51	                )
52	            ])
53	
54	        if self.config.ender:
55	            self.dec_end = nn.Sequential(
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/BiRefNet/baseline.py" target="_blank">/ComfyUI_LayerStyle/py/BiRefNet/baseline.py</a><br>
    <b>Line number: </b>41<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
25	        super(BiRefNet, self).__init__()
26	        self.config = Config()
27	        self.epoch = 1
28	        self.bb = build_backbone(self.config.bb, pretrained=True)
29	
30	        channels = self.config.lateral_channels_in_collection
31	
32	        if self.config.auxiliary_classification:
33	            self.avgpool = nn.AdaptiveAvgPool2d((1, 1))
34	            self.cls_head = nn.Sequential(
35	                nn.Linear(channels[0], len(class_labels_TR_sorted))
36	            )
37	
38	        if self.config.squeeze_block:
39	            self.squeeze_module = nn.Sequential(*[
40	                eval(self.config.squeeze_block.split(&#x27;_x&#x27;)[0])(channels[0]+sum(self.config.cxt), channels[0])
41	                for _ in range(eval(self.config.squeeze_block.split(&#x27;_x&#x27;)[1]))
42	            ])
43	
44	        self.decoder = Decoder(channels)
45	        
46	        if self.config.locate_head:
47	            self.locate_header = nn.ModuleList([
48	                BasicDecBlk(channels[0], channels[-1]),
49	                nn.Sequential(
50	                    nn.Conv2d(channels[-1], 1, 1, 1, 0),
51	                )
52	            ])
53	
54	        if self.config.ender:
55	            self.dec_end = nn.Sequential(
56	                nn.Conv2d(1, 16, 3, 1, 1),
</pre>
</div>


</div>
</div>

<div id="issue-4">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/BiRefNet/baseline.py" target="_blank">/ComfyUI_LayerStyle/py/BiRefNet/baseline.py</a><br>
    <b>Line number: </b>66<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
50	                    nn.Conv2d(channels[-1], 1, 1, 1, 0),
51	                )
52	            ])
53	
54	        if self.config.ender:
55	            self.dec_end = nn.Sequential(
56	                nn.Conv2d(1, 16, 3, 1, 1),
57	                nn.Conv2d(16, 1, 3, 1, 1),
58	                nn.ReLU(inplace=True),
59	            )
60	
61	        # refine patch-level segmentation
62	        if self.config.refine:
63	            if self.config.refine == &#x27;itself&#x27;:
64	                self.stem_layer = StemLayer(in_channels=3+1, inter_channels=48, out_channels=3)
65	            else:
66	                self.refiner = eval(&#x27;{}({})&#x27;.format(self.config.refine, &#x27;in_channels=3+1&#x27;))
67	
68	        if self.config.freeze_bb:
69	            # Freeze the backbone...
70	            print(self.named_parameters())
71	            for key, value in self.named_parameters():
72	                if &#x27;bb.&#x27; in key and &#x27;refiner.&#x27; not in key:
73	                    value.requires_grad = False
74	
75	    def forward_enc(self, x):
76	        if self.config.bb in [&#x27;vgg16&#x27;, &#x27;vgg16bn&#x27;, &#x27;resnet50&#x27;]:
77	            x1 = self.bb.conv1(x); x2 = self.bb.conv2(x1); x3 = self.bb.conv3(x2); x4 = self.bb.conv4(x3)
78	        else:
79	            x1, x2, x3, x4 = self.bb(x)
80	            if self.config.mul_scl_ipt == &#x27;cat&#x27;:
81	                B, C, H, W = x.shape
</pre>
</div>


</div>
</div>

<div id="issue-5">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/BiRefNet/baseline.py" target="_blank">/ComfyUI_LayerStyle/py/BiRefNet/baseline.py</a><br>
    <b>Line number: </b>149<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
133	
134	    def forward_ref_end(self, x):
135	        # remove the grids of concatenated preds
136	        return self.dec_end(x) if self.config.ender else x
137	
138	
139	    def forward(self, x):
140	        scaled_preds, class_preds = self.forward_ori(x)
141	        class_preds_lst = [class_preds]
142	        return [scaled_preds, class_preds_lst] if self.training else scaled_preds
143	
144	
145	class Decoder(nn.Module):
146	    def __init__(self, channels):
147	        super(Decoder, self).__init__()
148	        self.config = Config()
149	        DecoderBlock = eval(self.config.dec_blk)
150	        LateralBlock = eval(self.config.lat_blk)
151	
152	        if self.config.dec_ipt:
153	            self.split = self.config.dec_ipt_split
154	            N_dec_ipt = 64
155	            DBlock = SimpleConvs
156	            ic = 64
157	            ipt_cha_opt = 1
158	            self.ipt_blk4 = DBlock(2**8*3 if self.split else 3, [N_dec_ipt, channels[0]//8][ipt_cha_opt], inter_channels=ic)
159	            self.ipt_blk3 = DBlock(2**6*3 if self.split else 3, [N_dec_ipt, channels[1]//8][ipt_cha_opt], inter_channels=ic)
160	            self.ipt_blk2 = DBlock(2**4*3 if self.split else 3, [N_dec_ipt, channels[2]//8][ipt_cha_opt], inter_channels=ic)
161	            self.ipt_blk1 = DBlock(2**0*3 if self.split else 3, [N_dec_ipt, channels[3]//8][ipt_cha_opt], inter_channels=ic)
162	        else:
163	            self.split = None
164	
</pre>
</div>


</div>
</div>

<div id="issue-6">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/BiRefNet/baseline.py" target="_blank">/ComfyUI_LayerStyle/py/BiRefNet/baseline.py</a><br>
    <b>Line number: </b>150<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
134	    def forward_ref_end(self, x):
135	        # remove the grids of concatenated preds
136	        return self.dec_end(x) if self.config.ender else x
137	
138	
139	    def forward(self, x):
140	        scaled_preds, class_preds = self.forward_ori(x)
141	        class_preds_lst = [class_preds]
142	        return [scaled_preds, class_preds_lst] if self.training else scaled_preds
143	
144	
145	class Decoder(nn.Module):
146	    def __init__(self, channels):
147	        super(Decoder, self).__init__()
148	        self.config = Config()
149	        DecoderBlock = eval(self.config.dec_blk)
150	        LateralBlock = eval(self.config.lat_blk)
151	
152	        if self.config.dec_ipt:
153	            self.split = self.config.dec_ipt_split
154	            N_dec_ipt = 64
155	            DBlock = SimpleConvs
156	            ic = 64
157	            ipt_cha_opt = 1
158	            self.ipt_blk4 = DBlock(2**8*3 if self.split else 3, [N_dec_ipt, channels[0]//8][ipt_cha_opt], inter_channels=ic)
159	            self.ipt_blk3 = DBlock(2**6*3 if self.split else 3, [N_dec_ipt, channels[1]//8][ipt_cha_opt], inter_channels=ic)
160	            self.ipt_blk2 = DBlock(2**4*3 if self.split else 3, [N_dec_ipt, channels[2]//8][ipt_cha_opt], inter_channels=ic)
161	            self.ipt_blk1 = DBlock(2**0*3 if self.split else 3, [N_dec_ipt, channels[3]//8][ipt_cha_opt], inter_channels=ic)
162	        else:
163	            self.split = None
164	
165	        self.decoder_block4 = DecoderBlock(channels[0], channels[1])
</pre>
</div>


</div>
</div>

<div id="issue-7">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/BiRefNet/refinement/refiner.py" target="_blank">/ComfyUI_LayerStyle/py/BiRefNet/refinement/refiner.py</a><br>
    <b>Line number: </b>113<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
97	            x1, x2, x3, x4 = self.bb(x)
98	
99	        x4 = self.squeeze_module(x4)
100	
101	        ########## Decoder ##########
102	
103	        features = [x, x1, x2, x3, x4]
104	        scaled_preds = self.decoder(features)
105	
106	        return scaled_preds
107	
108	
109	class Decoder(nn.Module):
110	    def __init__(self, channels):
111	        super(Decoder, self).__init__()
112	        self.config = Config()
113	        DecoderBlock = eval(&#x27;BasicDecBlk&#x27;)
114	        LateralBlock = eval(&#x27;BasicLatBlk&#x27;)
115	
116	        self.decoder_block4 = DecoderBlock(channels[0], channels[1])
117	        self.decoder_block3 = DecoderBlock(channels[1], channels[2])
118	        self.decoder_block2 = DecoderBlock(channels[2], channels[3])
119	        self.decoder_block1 = DecoderBlock(channels[3], channels[3]//2)
120	
121	        self.lateral_block4 = LateralBlock(channels[1], channels[1])
122	        self.lateral_block3 = LateralBlock(channels[2], channels[2])
123	        self.lateral_block2 = LateralBlock(channels[3], channels[3])
124	
125	        if self.config.ms_supervision:
126	            self.conv_ms_spvn_4 = nn.Conv2d(channels[1], 1, 1, 1, 0)
127	            self.conv_ms_spvn_3 = nn.Conv2d(channels[2], 1, 1, 1, 0)
128	            self.conv_ms_spvn_2 = nn.Conv2d(channels[3], 1, 1, 1, 0)
</pre>
</div>


</div>
</div>

<div id="issue-8">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/BiRefNet/refinement/refiner.py" target="_blank">/ComfyUI_LayerStyle/py/BiRefNet/refinement/refiner.py</a><br>
    <b>Line number: </b>114<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
98	
99	        x4 = self.squeeze_module(x4)
100	
101	        ########## Decoder ##########
102	
103	        features = [x, x1, x2, x3, x4]
104	        scaled_preds = self.decoder(features)
105	
106	        return scaled_preds
107	
108	
109	class Decoder(nn.Module):
110	    def __init__(self, channels):
111	        super(Decoder, self).__init__()
112	        self.config = Config()
113	        DecoderBlock = eval(&#x27;BasicDecBlk&#x27;)
114	        LateralBlock = eval(&#x27;BasicLatBlk&#x27;)
115	
116	        self.decoder_block4 = DecoderBlock(channels[0], channels[1])
117	        self.decoder_block3 = DecoderBlock(channels[1], channels[2])
118	        self.decoder_block2 = DecoderBlock(channels[2], channels[3])
119	        self.decoder_block1 = DecoderBlock(channels[3], channels[3]//2)
120	
121	        self.lateral_block4 = LateralBlock(channels[1], channels[1])
122	        self.lateral_block3 = LateralBlock(channels[2], channels[2])
123	        self.lateral_block2 = LateralBlock(channels[3], channels[3])
124	
125	        if self.config.ms_supervision:
126	            self.conv_ms_spvn_4 = nn.Conv2d(channels[1], 1, 1, 1, 0)
127	            self.conv_ms_spvn_3 = nn.Conv2d(channels[2], 1, 1, 1, 0)
128	            self.conv_ms_spvn_2 = nn.Conv2d(channels[3], 1, 1, 1, 0)
129	        self.conv_out1 = nn.Sequential(nn.Conv2d(channels[3]//2, 1, 1, 1, 0))
</pre>
</div>


</div>
</div>

<div id="issue-9">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/birefnet_func.py" target="_blank">/ComfyUI_LayerStyle/py/birefnet_func.py</a><br>
    <b>Line number: </b>61<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
45	    def generate_mask(self, image:Image) -&gt; Image:
46	
47	        if torch.backends.mps.is_available():
48	            device = &quot;mps&quot;
49	        elif torch.cuda.is_available():
50	            device = &quot;cuda&quot;
51	        else:
52	            device = &quot;cpu&quot;
53	
54	        if not self.ready:
55	            model_folder_name = &#x27;BiRefNet&#x27;
56	            model_name = &#x27;BiRefNet-ep480.pth&#x27;
57	            model_file_path = &quot;&quot;
58	            try:
59	                model_file_path = os.path.join(
60	                    os.path.normpath(folder_paths.folder_names_and_paths[model_folder_name][0][0]), model_name)
61	            except:
62	                pass
63	            if not os.path.exists(model_file_path):
64	                model_file_path = os.path.join(folder_paths.models_dir, model_folder_name, model_name)
65	            self.load(model_file_path, device=device)
66	
67	        i = pil2tensor(image)
68	        orig_image = image.convert(&#x27;RGB&#x27;)
69	        np_image = i.squeeze().numpy()
70	        img = self.processor(np_image)
71	        inputs = img[None, ...].to(device)
72	        with torch.no_grad():
73	            scaled_preds = self.model(inputs)[-1].sigmoid()
74	        _mask = nn.functional.interpolate(scaled_preds[0].unsqueeze(0),
75	                                          size=np_image.shape[:2],
76	                                          mode=&#x27;bilinear&#x27;,
77	                                          align_corners=True
</pre>
</div>


</div>
</div>

<div id="issue-10">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/imagefunc.py" target="_blank">/ComfyUI_LayerStyle/py/imagefunc.py</a><br>
    <b>Line number: </b>13<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	&quot;&quot;&quot;Image process functions for ComfyUI nodes
2	by chflame https://github.com/chflame163
3	
4	@author: chflame
5	@title: LayerStyle
6	@nickname: LayerStyle
7	@description: A set of nodes for ComfyUI that can composite layer and mask to achieve Photoshop like functionality.
8	&quot;&quot;&quot;
9	
10	import os
11	import sys
12	sys.path.append(os.path.dirname(os.path.abspath(__file__)))
13	import pickle
14	import copy
15	import re
16	import json
17	import math
18	import glob
19	import numpy as np
20	import torch
21	import scipy.ndimage
22	import cv2
23	import random
24	import time
25	from tqdm import tqdm
26	from functools import lru_cache
27	from typing import Union, List
28	from PIL import Image, ImageFilter, ImageChops, ImageDraw, ImageOps, ImageEnhance, ImageFont
29	from skimage import img_as_float, img_as_ubyte
30	import torchvision.transforms.functional as TF
31	import torch.nn.functional as F
32	import colorsys
</pre>
</div>


</div>
</div>

<div id="issue-11">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/imagefunc.py" target="_blank">/ComfyUI_LayerStyle/py/imagefunc.py</a><br>
    <b>Line number: </b>90<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
74	        return (batch_tensor,)
75	    return wrapper
76	
77	
78	&#x27;&#x27;&#x27;pickle&#x27;&#x27;&#x27;
79	
80	
81	def read_image(filename:str) -&gt; Image:
82	    return Image.open(filename)
83	
84	def pickle_to_file(obj:object, file_path:str):
85	    with open(file_path, &#x27;wb&#x27;) as f:
86	        pickle.dump(obj, f)
87	
88	def load_pickle(file_name:str) -&gt; object:
89	    with open(file_name, &#x27;rb&#x27;) as f:
90	        obj = pickle.load(f)
91	    return obj
92	
93	def load_light_leak_images() -&gt; list:
94	    file = os.path.join(folder_paths.models_dir, &quot;layerstyle&quot;, &quot;light_leak.pkl&quot;)
95	    return load_pickle(file)
96	
97	&#x27;&#x27;&#x27;Converter&#x27;&#x27;&#x27;
98	
99	def cv22ski(cv2_image:np.ndarray) -&gt; np.array:
100	    return img_as_float(cv2_image)
101	
102	def ski2cv2(ski:np.array) -&gt; np.ndarray:
103	    return img_as_ubyte(ski)
104	
105	def cv22pil(cv2_img:np.ndarray) -&gt; Image:
</pre>
</div>


</div>
</div>

<div id="issue-12">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/imagefunc.py" target="_blank">/ComfyUI_LayerStyle/py/imagefunc.py</a><br>
    <b>Line number: </b>1407<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
1391	    upper_bound = (color_value + threshold).clamp(max=255)
1392	    lower_bound = lower_bound.view(1, 1, 1, 3)
1393	    upper_bound = upper_bound.view(1, 1, 1, 3)
1394	    mask = (temp &gt;= lower_bound) &amp; (temp &lt;= upper_bound)
1395	    mask = mask.all(dim=-1)
1396	    mask = mask.float()
1397	    return tensor2pil(mask).convert(&quot;L&quot;)
1398	
1399	@lru_cache(maxsize=1, typed=False)
1400	def load_RMBG_model():
1401	    current_directory = os.path.dirname(os.path.abspath(__file__))
1402	    device = &quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;
1403	    net = BriaRMBG()
1404	    model_path = &quot;&quot;
1405	    try:
1406	        model_path = os.path.join(os.path.normpath(folder_paths.folder_names_and_paths[&#x27;rmbg&#x27;][0][0]), &quot;model.pth&quot;)
1407	    except:
1408	        pass
1409	    if not os.path.exists(model_path):
1410	        model_path = os.path.join(folder_paths.models_dir, &quot;rmbg&quot;, &quot;RMBG-1.4&quot;, &quot;model.pth&quot;)
1411	    if not os.path.exists(model_path):
1412	        model_path = os.path.join(os.path.dirname(current_directory), &quot;RMBG-1.4&quot;, &quot;model.pth&quot;)
1413	    net.load_state_dict(torch.load(model_path, map_location=device))
1414	    net.to(device)
1415	    net.eval()
1416	    return net
1417	
1418	
1419	def RMBG(image:Image) -&gt; Image:
1420	    rmbgmodel = load_RMBG_model()
1421	    w, h = image.size
1422	    im_np = np.array(image.resize((1024, 1024), Image.BILINEAR))
1423	    im_tensor = torch.tensor(im_np, dtype=torch.float32).permute(2, 0, 1)
</pre>
</div>


</div>
</div>

<div id="issue-13">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/imagefunc.py" target="_blank">/ComfyUI_LayerStyle/py/imagefunc.py</a><br>
    <b>Line number: </b>1551<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
1535	    mask = mask.squeeze(0).cpu().detach().numpy().astype(np.uint8) * 255
1536	    trimap = g_trimap(mask, erode_kernel_size, dilate_kernel_size).astype(np.float32)
1537	    trimap[trimap == 128] = 0.5
1538	    trimap[trimap == 255] = 1
1539	    trimap = torch.from_numpy(trimap).unsqueeze(0)
1540	
1541	    return tensor2pil(trimap).convert(&#x27;L&#x27;)
1542	
1543	
1544	def get_a_person_mask_generator_model_path() -&gt; str:
1545	    model_folder_name = &#x27;mediapipe&#x27;
1546	    model_name = &#x27;selfie_multiclass_256x256.tflite&#x27;
1547	
1548	    model_file_path = &quot;&quot;
1549	    try:
1550	        model_file_path = os.path.join(os.path.normpath(folder_paths.folder_names_and_paths[model_folder_name][0][0]), model_name)
1551	    except:
1552	        pass
1553	    if not os.path.exists(model_file_path):
1554	        model_file_path = os.path.join(folder_paths.models_dir, model_folder_name, model_name)
1555	
1556	    if not os.path.exists(model_file_path):
1557	        model_url = f&#x27;https://storage.googleapis.com/mediapipe-models/image_segmenter/selfie_multiclass_256x256/float32/latest/{model_name}&#x27;
1558	        print(f&quot;Downloading &#x27;{model_name}&#x27; model&quot;)
1559	        os.makedirs(model_file_path, exist_ok=True)
1560	        wget.download(model_url, model_file_path)
1561	    return model_file_path
1562	
1563	def mask_fix(images:torch.Tensor, radius:int, fill_holes:int, white_threshold:float, extra_clip:float) -&gt; torch.Tensor:
1564	    d = radius * 2 + 1
1565	    i_dup = copy.deepcopy(images.cpu().numpy())
1566	    for index, image in enumerate(i_dup):
1567	        cleaned = cv2.bilateralFilter(image, 9, 0.05, 8)
</pre>
</div>


</div>
</div>

<div id="issue-14">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/api.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/api.py</a><br>
    <b>Line number: </b>19<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
3	import threading
4	import time
5	import traceback
6	from pathlib import Path
7	from typing import Optional, Dict, List
8	
9	import cv2
10	import numpy as np
11	import socketio
12	import torch
13	
14	try:
15	    torch._C._jit_override_can_fuse_on_cpu(False)
16	    torch._C._jit_override_can_fuse_on_gpu(False)
17	    torch._C._jit_set_texpr_fuser_enabled(False)
18	    torch._C._jit_set_nvfuser_enabled(False)
19	except:
20	    pass
21	
22	
23	import uvicorn
24	from PIL import Image
25	from fastapi import APIRouter, FastAPI, Request, UploadFile
26	from fastapi.encoders import jsonable_encoder
27	from fastapi.exceptions import HTTPException
28	from fastapi.middleware.cors import CORSMiddleware
29	from fastapi.responses import JSONResponse, FileResponse, Response
30	from fastapi.staticfiles import StaticFiles
31	from loguru import logger
32	from socketio import AsyncServer
33	
34	from .file_manager import FileManager
35	from .helper import (
</pre>
</div>


</div>
</div>

<div id="issue-15">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/api.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/api.py</a><br>
    <b>Line number: </b>80<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
64	)
65	
66	CURRENT_DIR = Path(__file__).parent.absolute().resolve()
67	WEB_APP_DIR = CURRENT_DIR / &quot;web_app&quot;
68	
69	
70	def api_middleware(app: FastAPI):
71	    rich_available = False
72	    try:
73	        if os.environ.get(&quot;WEBUI_RICH_EXCEPTIONS&quot;, None) is not None:
74	            import anyio  # importing just so it can be placed on silent list
75	            import starlette  # importing just so it can be placed on silent list
76	            from rich.console import Console
77	
78	            console = Console()
79	            rich_available = True
80	    except Exception:
81	        pass
82	
83	    def handle_exception(request: Request, e: Exception):
84	        err = {
85	            &quot;error&quot;: type(e).__name__,
86	            &quot;detail&quot;: vars(e).get(&quot;detail&quot;, &quot;&quot;),
87	            &quot;body&quot;: vars(e).get(&quot;body&quot;, &quot;&quot;),
88	            &quot;errors&quot;: str(e),
89	        }
90	        if not isinstance(
91	            e, HTTPException
92	        ):  # do not print backtrace on known httpexceptions
93	            message = f&quot;API error: {request.method}: {request.url} {err}&quot;
94	            if rich_available:
95	                print(message)
96	                console.print_exception(
</pre>
</div>


</div>
</div>

<div id="issue-16">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/benchmark.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/benchmark.py</a><br>
    <b>Line number: </b>20<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
4	import os
5	import time
6	
7	import numpy as np
8	import nvidia_smi
9	import psutil
10	import torch
11	
12	from .model_manager import ModelManager
13	from .schema import InpaintRequest, HDStrategy, SDSampler
14	
15	try:
16	    torch._C._jit_override_can_fuse_on_cpu(False)
17	    torch._C._jit_override_can_fuse_on_gpu(False)
18	    torch._C._jit_set_texpr_fuser_enabled(False)
19	    torch._C._jit_set_nvfuser_enabled(False)
20	except:
21	    pass
22	
23	NUM_THREADS = str(4)
24	
25	os.environ[&quot;OMP_NUM_THREADS&quot;] = NUM_THREADS
26	os.environ[&quot;OPENBLAS_NUM_THREADS&quot;] = NUM_THREADS
27	os.environ[&quot;MKL_NUM_THREADS&quot;] = NUM_THREADS
28	os.environ[&quot;VECLIB_MAXIMUM_THREADS&quot;] = NUM_THREADS
29	os.environ[&quot;NUMEXPR_NUM_THREADS&quot;] = NUM_THREADS
30	if os.environ.get(&quot;CACHE_DIR&quot;):
31	    os.environ[&quot;TORCH_HOME&quot;] = os.environ[&quot;CACHE_DIR&quot;]
32	
33	
34	def run_model(model, size):
35	    # RGB
36	    image = np.random.randint(0, 256, (size[0], size[1], 3)).astype(np.uint8)
</pre>
</div>


</div>
</div>

<div id="issue-17">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/download.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/download.py</a><br>
    <b>Line number: </b>112<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
96	                model_type = ModelType.DIFFUSERS_SDXL
97	            else:
98	                raise e
99	    return model_type
100	
101	
102	def scan_single_file_diffusion_models(cache_dir) -&gt; List[ModelInfo]:
103	    cache_dir = Path(cache_dir)
104	    stable_diffusion_dir = cache_dir / &quot;stable_diffusion&quot;
105	    cache_file = stable_diffusion_dir / &quot;iopaint_cache.json&quot;
106	    model_type_cache = {}
107	    if cache_file.exists():
108	        try:
109	            with open(cache_file, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:
110	                model_type_cache = json.load(f)
111	                assert isinstance(model_type_cache, dict)
112	        except:
113	            pass
114	
115	    res = []
116	    for it in stable_diffusion_dir.glob(f&quot;*.*&quot;):
117	        if it.suffix not in [&quot;.safetensors&quot;, &quot;.ckpt&quot;]:
118	            continue
119	        model_abs_path = str(it.absolute())
120	        model_type = model_type_cache.get(it.name)
121	        if model_type is None:
122	            model_type = get_sd_model_type(model_abs_path)
123	        model_type_cache[it.name] = model_type
124	        res.append(
125	            ModelInfo(
126	                name=it.name,
127	                path=model_abs_path,
128	                model_type=model_type,
</pre>
</div>


</div>
</div>

<div id="issue-18">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/download.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/download.py</a><br>
    <b>Line number: </b>144<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
128	                model_type=model_type,
129	                is_single_file_diffusers=True,
130	            )
131	        )
132	    if stable_diffusion_dir.exists():
133	        with open(cache_file, &quot;w&quot;, encoding=&quot;utf-8&quot;) as fw:
134	            json.dump(model_type_cache, fw, indent=2, ensure_ascii=False)
135	
136	    stable_diffusion_xl_dir = cache_dir / &quot;stable_diffusion_xl&quot;
137	    sdxl_cache_file = stable_diffusion_xl_dir / &quot;iopaint_cache.json&quot;
138	    sdxl_model_type_cache = {}
139	    if sdxl_cache_file.exists():
140	        try:
141	            with open(sdxl_cache_file, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:
142	                sdxl_model_type_cache = json.load(f)
143	                assert isinstance(sdxl_model_type_cache, dict)
144	        except:
145	            pass
146	
147	    for it in stable_diffusion_xl_dir.glob(f&quot;*.*&quot;):
148	        if it.suffix not in [&quot;.safetensors&quot;, &quot;.ckpt&quot;]:
149	            continue
150	        model_abs_path = str(it.absolute())
151	        model_type = sdxl_model_type_cache.get(it.name)
152	        if model_type is None:
153	            model_type = get_sdxl_model_type(model_abs_path)
154	        sdxl_model_type_cache[it.name] = model_type
155	        if stable_diffusion_xl_dir.exists():
156	            with open(sdxl_cache_file, &quot;w&quot;, encoding=&quot;utf-8&quot;) as fw:
157	                json.dump(sdxl_model_type_cache, fw, indent=2, ensure_ascii=False)
158	
159	        res.append(
160	            ModelInfo(
</pre>
</div>


</div>
</div>

<div id="issue-19">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak MD5 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/file_manager/utils.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/file_manager/utils.py</a><br>
    <b>Line number: </b>12<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
1	# Copy from: https://github.com/silentsokolov/flask-thumbnails/blob/master/flask_thumbnails/utils.py
2	import hashlib
3	from pathlib import Path
4	
5	from typing import Union
6	
7	
8	def generate_filename(directory: Path, original_filename, *options) -&gt; str:
9	    text = str(directory.absolute()) + original_filename
10	    for v in options:
11	        text += &quot;%s&quot; % v
12	    md5_hash = hashlib.md5()
13	    md5_hash.update(text.encode(&quot;utf-8&quot;))
14	    return md5_hash.hexdigest() + &quot;.jpg&quot;
15	
16	
17	def parse_size(size):
18	    if isinstance(size, int):
19	        # If the size parameter is a single number, assume square aspect.
20	        return [size, size]
21	
22	    if isinstance(size, (tuple, list)):
23	        if len(size) == 1:
24	            # If single value tuple/list is provided, exand it to two elements
25	            return size + type(size)(size)
26	        return size
27	
28	    try:
29	        thumbnail_size = [int(x) for x in size.lower().split(&quot;x&quot;, 1)]
30	    except ValueError:
31	        raise ValueError(  # pylint: disable=raise-missing-from
32	            &quot;Bad thumbnail size format. Valid format is INTxINT.&quot;
</pre>
</div>


</div>
</div>

<div id="issue-20">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak MD5 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/helper.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/helper.py</a><br>
    <b>Line number: </b>21<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
5	import sys
6	from typing import List, Optional, Dict, Tuple
7	
8	from urllib.parse import urlparse
9	import cv2
10	from PIL import Image, ImageOps, PngImagePlugin
11	import numpy as np
12	import torch
13	from .const import MPS_UNSUPPORT_MODELS
14	from loguru import logger
15	from torch.hub import download_url_to_file, get_dir
16	import hashlib
17	from .const import DEFAULT_MODEL_DIR
18	
19	
20	def md5sum(filename):
21	    md5 = hashlib.md5()
22	    with open(filename, &quot;rb&quot;) as f:
23	        for chunk in iter(lambda: f.read(128 * md5.block_size), b&quot;&quot;):
24	            md5.update(chunk)
25	    return md5.hexdigest()
26	
27	
28	def switch_mps_device(model_name, device):
29	    if model_name in MPS_UNSUPPORT_MODELS and str(device) == &quot;mps&quot;:
30	        logger.info(f&quot;{model_name} not support mps, switch to cpu&quot;)
31	        return torch.device(&quot;cpu&quot;)
32	    return device
33	
34	
35	def get_cache_path_by_url(url):
36	    parts = urlparse(url)
</pre>
</div>


</div>
</div>

<div id="issue-21">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/helper.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/helper.py</a><br>
    <b>Line number: </b>170<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
154	            kwargs[&quot;pnginfo&quot;] = pnginfo_data
155	
156	        pil_img.save(output, format=ext, quality=quality, **kwargs)
157	        image_bytes = output.getvalue()
158	    return image_bytes
159	
160	
161	def load_img(img_bytes, gray: bool = False, return_info: bool = False):
162	    alpha_channel = None
163	    image = Image.open(io.BytesIO(img_bytes))
164	
165	    if return_info:
166	        infos = image.info
167	
168	    try:
169	        image = ImageOps.exif_transpose(image)
170	    except:
171	        pass
172	
173	    if gray:
174	        image = image.convert(&quot;L&quot;)
175	        np_img = np.array(image)
176	    else:
177	        if image.mode == &quot;RGBA&quot;:
178	            np_img = np.array(image)
179	            alpha_channel = np_img[:, :, -1]
180	            np_img = cv2.cvtColor(np_img, cv2.COLOR_RGBA2RGB)
181	        else:
182	            image = image.convert(&quot;RGB&quot;)
183	            np_img = np.array(image)
184	
185	    if return_info:
186	        return np_img, alpha_channel, infos
</pre>
</div>


</div>
</div>

<div id="issue-22">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/helper.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/helper.py</a><br>
    <b>Line number: </b>322<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
306	        w = &quot;jpeg&quot;
307	    return w
308	
309	
310	def decode_base64_to_image(
311	    encoding: str, gray=False
312	) -&gt; Tuple[np.array, Optional[np.array], Dict]:
313	    if encoding.startswith(&quot;data:image/&quot;) or encoding.startswith(
314	        &quot;data:application/octet-stream;base64,&quot;
315	    ):
316	        encoding = encoding.split(&quot;;&quot;)[1].split(&quot;,&quot;)[1]
317	    image = Image.open(io.BytesIO(base64.b64decode(encoding)))
318	
319	    alpha_channel = None
320	    try:
321	        image = ImageOps.exif_transpose(image)
322	    except:
323	        pass
324	    # exif_transpose will remove exif rotate info，we must call image.info after exif_transpose
325	    infos = image.info
326	
327	    if gray:
328	        image = image.convert(&quot;L&quot;)
329	        np_img = np.array(image)
330	    else:
331	        if image.mode == &quot;RGBA&quot;:
332	            np_img = np.array(image)
333	            alpha_channel = np_img[:, :, -1]
334	            np_img = cv2.cvtColor(np_img, cv2.COLOR_RGBA2RGB)
335	        else:
336	            image = image.convert(&quot;RGB&quot;)
337	            np_img = np.array(image)
338	
</pre>
</div>


</div>
</div>

<div id="issue-23">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/installer.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/installer.py</a><br>
    <b>Line number: </b>1<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import subprocess
2	import sys
3	
4	
5	def install(package):
6	    subprocess.check_call([sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package])
7	
8	
9	def install_plugins_package():
10	    install(&quot;rembg&quot;)
11	    install(&quot;realesrgan&quot;)
12	    install(&quot;gfpgan&quot;)
</pre>
</div>


</div>
</div>

<div id="issue-24">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/installer.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/installer.py</a><br>
    <b>Line number: </b>6<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
1	import subprocess
2	import sys
3	
4	
5	def install(package):
6	    subprocess.check_call([sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package])
7	
8	
9	def install_plugins_package():
10	    install(&quot;rembg&quot;)
11	    install(&quot;realesrgan&quot;)
12	    install(&quot;gfpgan&quot;)
</pre>
</div>


</div>
</div>

<div id="issue-25">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py</a><br>
    <b>Line number: </b>217<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
201	                 num_heads,
202	                 mixer=&#x27;Global&#x27;,
203	                 local_mixer=(7, 11),
204	                 HW=(8, 25),
205	                 mlp_ratio=4.,
206	                 qkv_bias=False,
207	                 qk_scale=None,
208	                 drop=0.,
209	                 attn_drop=0.,
210	                 drop_path=0.,
211	                 act_layer=nn.GELU,
212	                 norm_layer=&#x27;nn.LayerNorm&#x27;,
213	                 epsilon=1e-6,
214	                 prenorm=True):
215	        super().__init__()
216	        if isinstance(norm_layer, str):
217	            self.norm1 = eval(norm_layer)(dim, eps=epsilon)
218	        else:
219	            self.norm1 = norm_layer(dim)
220	        if mixer == &#x27;Global&#x27; or mixer == &#x27;Local&#x27;:
221	
222	            self.mixer = Attention(
223	                dim,
224	                num_heads=num_heads,
225	                mixer=mixer,
226	                HW=HW,
227	                local_k=local_mixer,
228	                qkv_bias=qkv_bias,
229	                qk_scale=qk_scale,
230	                attn_drop=attn_drop,
231	                proj_drop=drop)
232	        elif mixer == &#x27;Conv&#x27;:
</pre>
</div>


</div>
</div>

<div id="issue-26">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py</a><br>
    <b>Line number: </b>240<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
224	                num_heads=num_heads,
225	                mixer=mixer,
226	                HW=HW,
227	                local_k=local_mixer,
228	                qkv_bias=qkv_bias,
229	                qk_scale=qk_scale,
230	                attn_drop=attn_drop,
231	                proj_drop=drop)
232	        elif mixer == &#x27;Conv&#x27;:
233	            self.mixer = ConvMixer(
234	                dim, num_heads=num_heads, HW=HW, local_k=local_mixer)
235	        else:
236	            raise TypeError(&quot;The mixer must be one of [Global, Local, Conv]&quot;)
237	
238	        self.drop_path = DropPath(drop_path) if drop_path &gt; 0. else Identity()
239	        if isinstance(norm_layer, str):
240	            self.norm2 = eval(norm_layer)(dim, eps=epsilon)
241	        else:
242	            self.norm2 = norm_layer(dim)
243	        mlp_hidden_dim = int(dim * mlp_ratio)
244	        self.mlp_ratio = mlp_ratio
245	        self.mlp = Mlp(in_features=dim,
246	                       hidden_features=mlp_hidden_dim,
247	                       act_layer=act_layer,
248	                       drop=drop)
249	        self.prenorm = prenorm
250	
251	    def forward(self, x):
252	        if self.prenorm:
253	            x = self.norm1(x + self.drop_path(self.mixer(x)))
254	            x = self.norm2(x + self.drop_path(self.mlp(x)))
255	        else:
</pre>
</div>


</div>
</div>

<div id="issue-27">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py</a><br>
    <b>Line number: </b>355<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
339	        self.types = types
340	        if types == &#x27;Pool&#x27;:
341	            self.avgpool = nn.AvgPool2d(
342	                kernel_size=(3, 5), stride=stride, padding=(1, 2))
343	            self.maxpool = nn.MaxPool2d(
344	                kernel_size=(3, 5), stride=stride, padding=(1, 2))
345	            self.proj = nn.Linear(in_channels, out_channels)
346	        else:
347	            self.conv = nn.Conv2d(
348	                in_channels,
349	                out_channels,
350	                kernel_size=3,
351	                stride=stride,
352	                padding=1,
353	                # weight_attr=ParamAttr(initializer=KaimingNormal())
354	            )
355	        self.norm = eval(sub_norm)(out_channels)
356	        if act is not None:
357	            self.act = act()
358	        else:
359	            self.act = None
360	
361	    def forward(self, x):
362	
363	        if self.types == &#x27;Pool&#x27;:
364	            x1 = self.avgpool(x)
365	            x2 = self.maxpool(x)
366	            x = (x1 + x2) * 0.5
367	            out = self.proj(x.flatten(2).permute((0, 2, 1)))
368	        else:
369	            x = self.conv(x)
370	            out = x.flatten(2).permute((0, 2, 1))
</pre>
</div>


</div>
</div>

<div id="issue-28">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py</a><br>
    <b>Line number: </b>429<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
413	        self.prenorm = prenorm
414	        patch_merging = None if patch_merging != &#x27;Conv&#x27; and patch_merging != &#x27;Pool&#x27; else patch_merging
415	        self.patch_embed = PatchEmbed(
416	            img_size=img_size,
417	            in_channels=in_channels,
418	            embed_dim=embed_dim[0],
419	            sub_num=sub_num)
420	        num_patches = self.patch_embed.num_patches
421	        self.HW = [img_size[0] // (2**sub_num), img_size[1] // (2**sub_num)]
422	        self.pos_embed = nn.Parameter(torch.zeros(1, num_patches, embed_dim[0]))
423	        # self.pos_embed = self.create_parameter(
424	        #     shape=[1, num_patches, embed_dim[0]], default_initializer=zeros_)
425	
426	        # self.add_parameter(&quot;pos_embed&quot;, self.pos_embed)
427	
428	        self.pos_drop = nn.Dropout(p=drop_rate)
429	        Block_unit = eval(block_unit)
430	
431	        dpr = np.linspace(0, drop_path_rate, sum(depth))
432	        self.blocks1 = nn.ModuleList(
433	            [
434	            Block_unit(
435	                dim=embed_dim[0],
436	                num_heads=num_heads[0],
437	                mixer=mixer[0:depth[0]][i],
438	                HW=self.HW,
439	                local_mixer=local_mixer[0],
440	                mlp_ratio=mlp_ratio,
441	                qkv_bias=qkv_bias,
442	                qk_scale=qk_scale,
443	                drop=drop_rate,
444	                act_layer=eval(act),
</pre>
</div>


</div>
</div>

<div id="issue-29">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py</a><br>
    <b>Line number: </b>444<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
428	        self.pos_drop = nn.Dropout(p=drop_rate)
429	        Block_unit = eval(block_unit)
430	
431	        dpr = np.linspace(0, drop_path_rate, sum(depth))
432	        self.blocks1 = nn.ModuleList(
433	            [
434	            Block_unit(
435	                dim=embed_dim[0],
436	                num_heads=num_heads[0],
437	                mixer=mixer[0:depth[0]][i],
438	                HW=self.HW,
439	                local_mixer=local_mixer[0],
440	                mlp_ratio=mlp_ratio,
441	                qkv_bias=qkv_bias,
442	                qk_scale=qk_scale,
443	                drop=drop_rate,
444	                act_layer=eval(act),
445	                attn_drop=attn_drop_rate,
446	                drop_path=dpr[0:depth[0]][i],
447	                norm_layer=norm_layer,
448	                epsilon=epsilon,
449	                prenorm=prenorm) for i in range(depth[0])
450	        ]
451	        )
452	        if patch_merging is not None:
453	            self.sub_sample1 = SubSample(
454	                embed_dim[0],
455	                embed_dim[1],
456	                sub_norm=sub_norm,
457	                stride=[2, 1],
458	                types=patch_merging)
459	            HW = [self.HW[0] // 2, self.HW[1]]
</pre>
</div>


</div>
</div>

<div id="issue-30">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py</a><br>
    <b>Line number: </b>474<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
458	                types=patch_merging)
459	            HW = [self.HW[0] // 2, self.HW[1]]
460	        else:
461	            HW = self.HW
462	        self.patch_merging = patch_merging
463	        self.blocks2 = nn.ModuleList([
464	            Block_unit(
465	                dim=embed_dim[1],
466	                num_heads=num_heads[1],
467	                mixer=mixer[depth[0]:depth[0] + depth[1]][i],
468	                HW=HW,
469	                local_mixer=local_mixer[1],
470	                mlp_ratio=mlp_ratio,
471	                qkv_bias=qkv_bias,
472	                qk_scale=qk_scale,
473	                drop=drop_rate,
474	                act_layer=eval(act),
475	                attn_drop=attn_drop_rate,
476	                drop_path=dpr[depth[0]:depth[0] + depth[1]][i],
477	                norm_layer=norm_layer,
478	                epsilon=epsilon,
479	                prenorm=prenorm) for i in range(depth[1])
480	        ])
481	        if patch_merging is not None:
482	            self.sub_sample2 = SubSample(
483	                embed_dim[1],
484	                embed_dim[2],
485	                sub_norm=sub_norm,
486	                stride=[2, 1],
487	                types=patch_merging)
488	            HW = [self.HW[0] // 4, self.HW[1]]
489	        else:
</pre>
</div>


</div>
</div>

<div id="issue-31">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py</a><br>
    <b>Line number: </b>502<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
486	                stride=[2, 1],
487	                types=patch_merging)
488	            HW = [self.HW[0] // 4, self.HW[1]]
489	        else:
490	            HW = self.HW
491	        self.blocks3 = nn.ModuleList([
492	            Block_unit(
493	                dim=embed_dim[2],
494	                num_heads=num_heads[2],
495	                mixer=mixer[depth[0] + depth[1]:][i],
496	                HW=HW,
497	                local_mixer=local_mixer[2],
498	                mlp_ratio=mlp_ratio,
499	                qkv_bias=qkv_bias,
500	                qk_scale=qk_scale,
501	                drop=drop_rate,
502	                act_layer=eval(act),
503	                attn_drop=attn_drop_rate,
504	                drop_path=dpr[depth[0] + depth[1]:][i],
505	                norm_layer=norm_layer,
506	                epsilon=epsilon,
507	                prenorm=prenorm) for i in range(depth[2])
508	        ])
509	        self.last_stage = last_stage
510	        if last_stage:
511	            self.avg_pool = nn.AdaptiveAvgPool2d((1, out_char_num))
512	            self.last_conv = nn.Conv2d(
513	                in_channels=embed_dim[2],
514	                out_channels=self.out_channels,
515	                kernel_size=1,
516	                stride=1,
517	                padding=0,
</pre>
</div>


</div>
</div>

<div id="issue-32">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/model/anytext/ocr_recog/RecSVTR.py</a><br>
    <b>Line number: </b>522<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
506	                epsilon=epsilon,
507	                prenorm=prenorm) for i in range(depth[2])
508	        ])
509	        self.last_stage = last_stage
510	        if last_stage:
511	            self.avg_pool = nn.AdaptiveAvgPool2d((1, out_char_num))
512	            self.last_conv = nn.Conv2d(
513	                in_channels=embed_dim[2],
514	                out_channels=self.out_channels,
515	                kernel_size=1,
516	                stride=1,
517	                padding=0,
518	                bias=False)
519	            self.hardswish = nn.Hardswish()
520	            self.dropout = nn.Dropout(p=last_drop)
521	        if not prenorm:
522	            self.norm = eval(norm_layer)(embed_dim[-1], epsilon=epsilon)
523	        self.use_lenhead = use_lenhead
524	        if use_lenhead:
525	            self.len_conv = nn.Linear(embed_dim[2], self.out_channels)
526	            self.hardswish_len = nn.Hardswish()
527	            self.dropout_len = nn.Dropout(
528	                p=last_drop)
529	
530	        trunc_normal_(self.pos_embed,std=.02)
531	        self.apply(self._init_weights)
532	
533	    def _init_weights(self, m):
534	        if isinstance(m, nn.Linear):
535	            trunc_normal_(m.weight,std=.02)
536	            if isinstance(m, nn.Linear) and m.bias is not None:
537	                zeros_(m.bias)
</pre>
</div>


</div>
</div>

<div id="issue-33">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak MD5 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/iopaint/plugins/interactive_seg.py" target="_blank">/ComfyUI_LayerStyle/py/iopaint/plugins/interactive_seg.py</a><br>
    <b>Line number: </b>84<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
68	            self.predictor = SamPredictor(
69	                sam_model_registry[model_name](checkpoint=model_path).to(self.device)
70	            )
71	        self.prev_img_md5 = None
72	
73	    def switch_model(self, new_model_name):
74	        if self.model_name == new_model_name:
75	            return
76	
77	        logger.info(
78	            f&quot;Switching InteractiveSeg model from {self.model_name} to {new_model_name}&quot;
79	        )
80	        self._init_session(new_model_name)
81	        self.model_name = new_model_name
82	
83	    def gen_mask(self, rgb_np_img, req: RunPluginRequest) -&gt; np.ndarray:
84	        img_md5 = hashlib.md5(req.image.encode(&quot;utf-8&quot;)).hexdigest()
85	        return self.forward(rgb_np_img, req.clicks, img_md5)
86	
87	    @torch.inference_mode()
88	    def forward(self, rgb_np_img, clicks: List[List], img_md5: str):
89	        input_point = []
90	        input_label = []
91	        for click in clicks:
92	            x = click[0]
93	            y = click[1]
94	            input_point.append([x, y])
95	            input_label.append(click[2])
96	
97	        if img_md5 and img_md5 != self.prev_img_md5:
98	            self.prev_img_md5 = img_md5
99	            self.predictor.set_image(rgb_np_img)
</pre>
</div>


</div>
</div>

<div id="issue-34">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py</a><br>
    <b>Line number: </b>13<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved
2	&quot;&quot;&quot;
3	Misc functions, including distributed helpers.
4	
5	Mostly copy-paste from torchvision references.
6	&quot;&quot;&quot;
7	import colorsys
8	import datetime
9	import functools
10	import io
11	import json
12	import os
13	import pickle
14	import subprocess
15	import time
16	from collections import OrderedDict, defaultdict, deque
17	from typing import List, Optional
18	
19	import numpy as np
20	import torch
21	import torch.distributed as dist
22	
23	# needed due to empty tensor bug in pytorch and torchvision 0.5
24	import torchvision
25	from torch import Tensor
26	
27	__torchvision_need_compat_flag = float(torchvision.__version__.split(&quot;.&quot;)[1]) &lt; 7
28	if __torchvision_need_compat_flag:
29	    from torchvision.ops import _new_empty_tensor
30	    from torchvision.ops.misc import _output_size
31	
32	
</pre>
</div>


</div>
</div>

<div id="issue-35">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py</a><br>
    <b>Line number: </b>14<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	# Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved
2	&quot;&quot;&quot;
3	Misc functions, including distributed helpers.
4	
5	Mostly copy-paste from torchvision references.
6	&quot;&quot;&quot;
7	import colorsys
8	import datetime
9	import functools
10	import io
11	import json
12	import os
13	import pickle
14	import subprocess
15	import time
16	from collections import OrderedDict, defaultdict, deque
17	from typing import List, Optional
18	
19	import numpy as np
20	import torch
21	import torch.distributed as dist
22	
23	# needed due to empty tensor bug in pytorch and torchvision 0.5
24	import torchvision
25	from torch import Tensor
26	
27	__torchvision_need_compat_flag = float(torchvision.__version__.split(&quot;.&quot;)[1]) &lt; 7
28	if __torchvision_need_compat_flag:
29	    from torchvision.ops import _new_empty_tensor
30	    from torchvision.ops.misc import _output_size
31	
32	
</pre>
</div>


</div>
</div>

<div id="issue-36">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py</a><br>
    <b>Line number: </b>215<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
199	    max_size = max(size_list)
200	
201	    # receiving Tensor from all ranks
202	    # we pad the tensor because torch all_gather does not support
203	    # gathering tensors of different shapes
204	    tensor_list = []
205	    for _ in size_list:
206	        tensor_list.append(torch.empty((max_size,), dtype=torch.uint8, device=&quot;cuda&quot;))
207	    if local_size != max_size:
208	        padding = torch.empty(size=(max_size - local_size,), dtype=torch.uint8, device=&quot;cuda&quot;)
209	        tensor = torch.cat((tensor, padding), dim=0)
210	    dist.all_gather(tensor_list, tensor)
211	
212	    data_list = []
213	    for size, tensor in zip(size_list, tensor_list):
214	        buffer = tensor.cpu().numpy().tobytes()[:size]
215	        data_list.append(pickle.loads(buffer))
216	
217	    return data_list
218	
219	
220	def reduce_dict(input_dict, average=True):
221	    &quot;&quot;&quot;
222	    Args:
223	        input_dict (dict): all the values will be reduced
224	        average (bool): whether to do average or sum
225	    Reduce the values in the dictionary from all processes so that all processes
226	    have the averaged results. Returns a dict with the same fields as
227	    input_dict, after reduction.
228	    &quot;&quot;&quot;
229	    world_size = get_world_size()
230	    if world_size &lt; 2:
</pre>
</div>


</div>
</div>

<div id="issue-37">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py</a><br>
    <b>Line number: </b>366<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
350	                    )
351	            i += 1
352	            end = time.time()
353	        total_time = time.time() - start_time
354	        total_time_str = str(datetime.timedelta(seconds=int(total_time)))
355	        print_func(
356	            &quot;{} Total time: {} ({:.4f} s / it)&quot;.format(
357	                header, total_time_str, total_time / len(iterable)
358	            )
359	        )
360	
361	
362	def get_sha():
363	    cwd = os.path.dirname(os.path.abspath(__file__))
364	
365	    def _run(command):
366	        return subprocess.check_output(command, cwd=cwd).decode(&quot;ascii&quot;).strip()
367	
368	    sha = &quot;N/A&quot;
369	    diff = &quot;clean&quot;
370	    branch = &quot;N/A&quot;
371	    try:
372	        sha = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;])
373	        subprocess.check_output([&quot;git&quot;, &quot;diff&quot;], cwd=cwd)
374	        diff = _run([&quot;git&quot;, &quot;diff-index&quot;, &quot;HEAD&quot;])
375	        diff = &quot;has uncommited changes&quot; if diff else &quot;clean&quot;
376	        branch = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;--abbrev-ref&quot;, &quot;HEAD&quot;])
377	    except Exception:
378	        pass
379	    message = f&quot;sha: {sha}, status: {diff}, branch: {branch}&quot;
380	    return message
381	
</pre>
</div>


</div>
</div>

<div id="issue-38">
<div class="issue-block issue-sev-low">
    <b>start_process_with_partial_path: </b> Starting a process with a partial executable path<br>
    <b>Test ID:</b> B607<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py</a><br>
    <b>Line number: </b>373<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b607_start_process_with_partial_path.html</a><br>

<div class="code">
<pre>
357	                header, total_time_str, total_time / len(iterable)
358	            )
359	        )
360	
361	
362	def get_sha():
363	    cwd = os.path.dirname(os.path.abspath(__file__))
364	
365	    def _run(command):
366	        return subprocess.check_output(command, cwd=cwd).decode(&quot;ascii&quot;).strip()
367	
368	    sha = &quot;N/A&quot;
369	    diff = &quot;clean&quot;
370	    branch = &quot;N/A&quot;
371	    try:
372	        sha = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;])
373	        subprocess.check_output([&quot;git&quot;, &quot;diff&quot;], cwd=cwd)
374	        diff = _run([&quot;git&quot;, &quot;diff-index&quot;, &quot;HEAD&quot;])
375	        diff = &quot;has uncommited changes&quot; if diff else &quot;clean&quot;
376	        branch = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;--abbrev-ref&quot;, &quot;HEAD&quot;])
377	    except Exception:
378	        pass
379	    message = f&quot;sha: {sha}, status: {diff}, branch: {branch}&quot;
380	    return message
381	
382	
383	def collate_fn(batch):
384	    # import ipdb; ipdb.set_trace()
385	    batch = list(zip(*batch))
386	    batch[0] = nested_tensor_from_tensor_list(batch[0])
387	    return tuple(batch)
388	
</pre>
</div>


</div>
</div>

<div id="issue-39">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py</a><br>
    <b>Line number: </b>373<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
357	                header, total_time_str, total_time / len(iterable)
358	            )
359	        )
360	
361	
362	def get_sha():
363	    cwd = os.path.dirname(os.path.abspath(__file__))
364	
365	    def _run(command):
366	        return subprocess.check_output(command, cwd=cwd).decode(&quot;ascii&quot;).strip()
367	
368	    sha = &quot;N/A&quot;
369	    diff = &quot;clean&quot;
370	    branch = &quot;N/A&quot;
371	    try:
372	        sha = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;])
373	        subprocess.check_output([&quot;git&quot;, &quot;diff&quot;], cwd=cwd)
374	        diff = _run([&quot;git&quot;, &quot;diff-index&quot;, &quot;HEAD&quot;])
375	        diff = &quot;has uncommited changes&quot; if diff else &quot;clean&quot;
376	        branch = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;--abbrev-ref&quot;, &quot;HEAD&quot;])
377	    except Exception:
378	        pass
379	    message = f&quot;sha: {sha}, status: {diff}, branch: {branch}&quot;
380	    return message
381	
382	
383	def collate_fn(batch):
384	    # import ipdb; ipdb.set_trace()
385	    batch = list(zip(*batch))
386	    batch[0] = nested_tensor_from_tensor_list(batch[0])
387	    return tuple(batch)
388	
</pre>
</div>


</div>
</div>

<div id="issue-40">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/misc.py</a><br>
    <b>Line number: </b>377<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
361	
362	def get_sha():
363	    cwd = os.path.dirname(os.path.abspath(__file__))
364	
365	    def _run(command):
366	        return subprocess.check_output(command, cwd=cwd).decode(&quot;ascii&quot;).strip()
367	
368	    sha = &quot;N/A&quot;
369	    diff = &quot;clean&quot;
370	    branch = &quot;N/A&quot;
371	    try:
372	        sha = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;])
373	        subprocess.check_output([&quot;git&quot;, &quot;diff&quot;], cwd=cwd)
374	        diff = _run([&quot;git&quot;, &quot;diff-index&quot;, &quot;HEAD&quot;])
375	        diff = &quot;has uncommited changes&quot; if diff else &quot;clean&quot;
376	        branch = _run([&quot;git&quot;, &quot;rev-parse&quot;, &quot;--abbrev-ref&quot;, &quot;HEAD&quot;])
377	    except Exception:
378	        pass
379	    message = f&quot;sha: {sha}, status: {diff}, branch: {branch}&quot;
380	    return message
381	
382	
383	def collate_fn(batch):
384	    # import ipdb; ipdb.set_trace()
385	    batch = list(zip(*batch))
386	    batch[0] = nested_tensor_from_tensor_list(batch[0])
387	    return tuple(batch)
388	
389	
390	def _max_by_axis(the_list):
391	    # type: (List[List[int]]) -&gt; List[int]
392	    maxes = the_list[0]
393	    for sublist in the_list[1:]:
</pre>
</div>


</div>
</div>

<div id="issue-41">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with pickle module.<br>
    <b>Test ID:</b> B403<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/slio.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/slio.py</a><br>
    <b>Line number: </b>6<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b403-import-pickle</a><br>

<div class="code">
<pre>
1	# ==========================================================
2	# Modified from mmcv
3	# ==========================================================
4	
5	import json
6	import pickle
7	from abc import ABCMeta, abstractmethod
8	from pathlib import Path
9	
10	import yaml
11	
12	try:
13	    from yaml import CLoader as Loader, CDumper as Dumper
14	except ImportError:
15	    from yaml import Loader, Dumper
16	
17	
18	# ===========================
19	# Rigister handler
20	# ===========================
21	
22	
23	class BaseFileHandler(metaclass=ABCMeta):
24	    @abstractmethod
25	    def load_from_fileobj(self, file, **kwargs):
26	        pass
27	
28	    @abstractmethod
29	    def dump_to_fileobj(self, obj, file, **kwargs):
30	        pass
31	
32	    @abstractmethod
</pre>
</div>


</div>
</div>

<div id="issue-42">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.<br>
    <b>Test ID:</b> B301<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/502.html" target="_blank">CWE-502</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/slio.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/slio.py</a><br>
    <b>Line number: </b>58<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b301-pickle</a><br>

<div class="code">
<pre>
42	            self.dump_to_fileobj(obj, f, **kwargs)
43	
44	
45	class JsonHandler(BaseFileHandler):
46	    def load_from_fileobj(self, file):
47	        return json.load(file)
48	
49	    def dump_to_fileobj(self, obj, file, **kwargs):
50	        json.dump(obj, file, **kwargs)
51	
52	    def dump_to_str(self, obj, **kwargs):
53	        return json.dumps(obj, **kwargs)
54	
55	
56	class PickleHandler(BaseFileHandler):
57	    def load_from_fileobj(self, file, **kwargs):
58	        return pickle.load(file, **kwargs)
59	
60	    def load_from_path(self, filepath, **kwargs):
61	        return super(PickleHandler, self).load_from_path(filepath, mode=&quot;rb&quot;, **kwargs)
62	
63	    def dump_to_str(self, obj, **kwargs):
64	        kwargs.setdefault(&quot;protocol&quot;, 2)
65	        return pickle.dumps(obj, **kwargs)
66	
67	    def dump_to_fileobj(self, obj, file, **kwargs):
68	        kwargs.setdefault(&quot;protocol&quot;, 2)
69	        pickle.dump(obj, file, **kwargs)
70	
71	    def dump_to_path(self, obj, filepath, **kwargs):
72	        super(PickleHandler, self).dump_to_path(obj, filepath, mode=&quot;wb&quot;, **kwargs)
73	
</pre>
</div>


</div>
</div>

<div id="issue-43">
<div class="issue-block issue-sev-medium">
    <b>yaml_load: </b> Use of unsafe yaml load. Allows instantiation of arbitrary objects. Consider yaml.safe_load().<br>
    <b>Test ID:</b> B506<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/20.html" target="_blank">CWE-20</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/local_groundingdino/util/slio.py" target="_blank">/ComfyUI_LayerStyle/py/local_groundingdino/util/slio.py</a><br>
    <b>Line number: </b>78<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b506_yaml_load.html</a><br>

<div class="code">
<pre>
62	
63	    def dump_to_str(self, obj, **kwargs):
64	        kwargs.setdefault(&quot;protocol&quot;, 2)
65	        return pickle.dumps(obj, **kwargs)
66	
67	    def dump_to_fileobj(self, obj, file, **kwargs):
68	        kwargs.setdefault(&quot;protocol&quot;, 2)
69	        pickle.dump(obj, file, **kwargs)
70	
71	    def dump_to_path(self, obj, filepath, **kwargs):
72	        super(PickleHandler, self).dump_to_path(obj, filepath, mode=&quot;wb&quot;, **kwargs)
73	
74	
75	class YamlHandler(BaseFileHandler):
76	    def load_from_fileobj(self, file, **kwargs):
77	        kwargs.setdefault(&quot;Loader&quot;, Loader)
78	        return yaml.load(file, **kwargs)
79	
80	    def dump_to_fileobj(self, obj, file, **kwargs):
81	        kwargs.setdefault(&quot;Dumper&quot;, Dumper)
82	        yaml.dump(obj, file, **kwargs)
83	
84	    def dump_to_str(self, obj, **kwargs):
85	        kwargs.setdefault(&quot;Dumper&quot;, Dumper)
86	        return yaml.dump(obj, **kwargs)
87	
88	
89	file_handlers = {
90	    &quot;json&quot;: JsonHandler(),
91	    &quot;yaml&quot;: YamlHandler(),
92	    &quot;yml&quot;: YamlHandler(),
93	    &quot;pickle&quot;: PickleHandler(),
</pre>
</div>


</div>
</div>

<div id="issue-44">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_LayerStyle/py/segformer_ultra.py" target="_blank">/ComfyUI_LayerStyle/py/segformer_ultra.py</a><br>
    <b>Line number: </b>17<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
1	&#x27;&#x27;&#x27;
2	原始代码来自 https://github.com/StartHua/Comfyui_segformer_b2_clothes
3	&#x27;&#x27;&#x27;
4	
5	from transformers import SegformerImageProcessor, AutoModelForSemanticSegmentation
6	import torch.nn as nn
7	from .imagefunc import *
8	
9	NODE_NAME = &#x27;SegformerB2ClothesUltra&#x27;
10	
11	# 切割服装
12	def get_segmentation(tensor_image):
13	    cloth = tensor2pil(tensor_image)
14	    model_folder_path = os.path.join(folder_paths.models_dir, &quot;segformer_b2_clothes&quot;)
15	    try:
16	        model_folder_path = os.path.normpath(folder_paths.folder_names_and_paths[&#x27;segformer_b2_clothes&#x27;][0][0])
17	    except:
18	        pass
19	
20	    processor = SegformerImageProcessor.from_pretrained(model_folder_path)
21	    model = AutoModelForSemanticSegmentation.from_pretrained(model_folder_path)
22	    # 预处理和预测
23	    inputs = processor(images=cloth, return_tensors=&quot;pt&quot;)
24	    outputs = model(**inputs)
25	    logits = outputs.logits.cpu()
26	    upsampled_logits = nn.functional.interpolate(logits, size=cloth.size[::-1], mode=&quot;bilinear&quot;, align_corners=False)
27	    pred_seg = upsampled_logits.argmax(dim=1)[0].numpy()
28	    return pred_seg,cloth
29	
30	
31	class Segformer_B2_Clothes:
32	
33	    def __init__(self):
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
