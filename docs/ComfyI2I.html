
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">1111</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="ComfyI2I/ComfyI2I.py" target="_blank">ComfyI2I/ComfyI2I.py</a><br>
    <b>Line number: </b>27<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
11	# THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
12	# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
13	# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
14	# THE SOFTWARE.
15	
16	import numpy as np
17	from collections import namedtuple
18	import cv2
19	import torch
20	import sys
21	import os
22	import folder_paths as comfy_paths
23	from torchvision.ops import masks_to_boxes
24	import torchvision.transforms.functional as TF
25	import torch.nn.functional as F
26	from PIL import Image, ImageFilter, ImageOps
27	import subprocess
28	import math
29	
30	# Check for CUDA availability
31	device = &#x27;cuda&#x27; if torch.cuda.is_available() else &#x27;cpu&#x27;
32	
33	ARRAY_DATATYPE = torch.int32  # Corresponding to &#x27;l&#x27;
34	
35	Rgb = namedtuple(&#x27;Rgb&#x27;, (&#x27;r&#x27;, &#x27;g&#x27;, &#x27;b&#x27;))
36	Hsl = namedtuple(&#x27;Hsl&#x27;, (&#x27;h&#x27;, &#x27;s&#x27;, &#x27;l&#x27;))
37	
38	VERY_BIG_SIZE = 1024 * 1024
39	MAX_RESOLUTION=8192
40	    
41	MODELS_DIR =  comfy_paths.models_dir
42	
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="ComfyI2I/ComfyI2I.py" target="_blank">ComfyI2I/ComfyI2I.py</a><br>
    <b>Line number: </b>932<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
916	                    &quot;mask&quot;: (&quot;MASK&quot;,),
917	                },
918	        }
919	
920	    CATEGORY = &quot;I2I&quot;
921	
922	    RETURN_TYPES = (&quot;IMAGE&quot;, &quot;MASK&quot;, &quot;MASK_MAPPING&quot;,)
923	    RETURN_NAMES = (&quot;mask_image&quot;, &quot;mask&quot;, &quot;mask mapping&quot;)
924	    FUNCTION = &quot;Mask_Ops&quot;
925	
926	    def Mask_Ops(self, image, text, separate_mask, text_sigma, use_text, blend_percentage, black_level, mid_level, white_level, channel, shrink_grow, invert=0, blur_radius=5.0, mask=None):
927	        channels = [&quot;red&quot;, &quot;green&quot;, &quot;blue&quot;]
928	
929	        # Freeze PIP modules
930	        def packages(versions=False):
931	            import sys
932	            import subprocess
933	            return [( r.decode().split(&#x27;==&#x27;)[0] if not versions else r.decode() ) for r in subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;freeze&#x27;]).split()]
934	
935	        # PIL to Mask
936	        def pil2mask(image):
937	            image_np = np.array(image.convert(&quot;L&quot;)).astype(np.float32) / 255.0
938	            mask = torch.from_numpy(image_np)
939	            return 1.0 - mask
940	
941	        def gaussian_region(image, radius=5.0):
942	            image = ImageOps.invert(image.convert(&quot;L&quot;))
943	            image = image.filter(ImageFilter.GaussianBlur(radius=int(radius)))
944	            return image.convert(&quot;RGB&quot;)
945	
946	        # scipy handling
947	        if &#x27;scipy&#x27; not in packages():
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="ComfyI2I/ComfyI2I.py" target="_blank">ComfyI2I/ComfyI2I.py</a><br>
    <b>Line number: </b>933<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
917	                },
918	        }
919	
920	    CATEGORY = &quot;I2I&quot;
921	
922	    RETURN_TYPES = (&quot;IMAGE&quot;, &quot;MASK&quot;, &quot;MASK_MAPPING&quot;,)
923	    RETURN_NAMES = (&quot;mask_image&quot;, &quot;mask&quot;, &quot;mask mapping&quot;)
924	    FUNCTION = &quot;Mask_Ops&quot;
925	
926	    def Mask_Ops(self, image, text, separate_mask, text_sigma, use_text, blend_percentage, black_level, mid_level, white_level, channel, shrink_grow, invert=0, blur_radius=5.0, mask=None):
927	        channels = [&quot;red&quot;, &quot;green&quot;, &quot;blue&quot;]
928	
929	        # Freeze PIP modules
930	        def packages(versions=False):
931	            import sys
932	            import subprocess
933	            return [( r.decode().split(&#x27;==&#x27;)[0] if not versions else r.decode() ) for r in subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;freeze&#x27;]).split()]
934	
935	        # PIL to Mask
936	        def pil2mask(image):
937	            image_np = np.array(image.convert(&quot;L&quot;)).astype(np.float32) / 255.0
938	            mask = torch.from_numpy(image_np)
939	            return 1.0 - mask
940	
941	        def gaussian_region(image, radius=5.0):
942	            image = ImageOps.invert(image.convert(&quot;L&quot;))
943	            image = image.filter(ImageFilter.GaussianBlur(radius=int(radius)))
944	            return image.convert(&quot;RGB&quot;)
945	
946	        # scipy handling
947	        if &#x27;scipy&#x27; not in packages():
948	            cstr(&quot;Installing `scipy` ...&quot;).msg.print()
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="ComfyI2I/ComfyI2I.py" target="_blank">ComfyI2I/ComfyI2I.py</a><br>
    <b>Line number: </b>949<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
933	            return [( r.decode().split(&#x27;==&#x27;)[0] if not versions else r.decode() ) for r in subprocess.check_output([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;freeze&#x27;]).split()]
934	
935	        # PIL to Mask
936	        def pil2mask(image):
937	            image_np = np.array(image.convert(&quot;L&quot;)).astype(np.float32) / 255.0
938	            mask = torch.from_numpy(image_np)
939	            return 1.0 - mask
940	
941	        def gaussian_region(image, radius=5.0):
942	            image = ImageOps.invert(image.convert(&quot;L&quot;))
943	            image = image.filter(ImageFilter.GaussianBlur(radius=int(radius)))
944	            return image.convert(&quot;RGB&quot;)
945	
946	        # scipy handling
947	        if &#x27;scipy&#x27; not in packages():
948	            cstr(&quot;Installing `scipy` ...&quot;).msg.print()
949	            subprocess.check_call([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;scipy&#x27;])
950	            try:
951	                import scipy
952	            except ImportError as e:
953	                cstr(&quot;Unable to import tools for certain masking procedures.&quot;).msg.print()
954	                print(e)
955	
956	        def smooth_region(image, tolerance):
957	            from scipy.ndimage import gaussian_filter
958	            image = image.convert(&quot;L&quot;)
959	            mask_array = np.array(image)
960	            smoothed_array = gaussian_filter(mask_array, sigma=tolerance)
961	            threshold = np.max(smoothed_array) / 2
962	            smoothed_mask = np.where(smoothed_array &gt;= threshold, 255, 0).astype(np.uint8)
963	            smoothed_image = Image.fromarray(smoothed_mask, mode=&quot;L&quot;)
964	            return ImageOps.invert(smoothed_image.convert(&quot;RGB&quot;))
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
