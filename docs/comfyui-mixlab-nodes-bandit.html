
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">8981</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/__init__.py" target="_blank">/comfyui-mixlab-nodes/__init__.py</a><br>
    <b>Line number: </b>3<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	#
2	import os
3	import subprocess
4	import importlib.util
5	import sys,json
6	import urllib
7	import hashlib
8	import datetime
9	import folder_paths
10	import logging
11	import base64,io,re
12	from PIL import Image
13	from comfy.cli_args import args
14	python = sys.executable
15	
16	#修复 sys.stdout.isatty()  object has no attribute &#x27;isatty&#x27;
17	try:
18	    sys.stdout.isatty()
19	except:
20	    print(&#x27;#fix sys.stdout.isatty&#x27;)
21	    sys.stdout.isatty = lambda: False
22	
23	llama_port=None
24	llama_model=&quot;&quot;
25	llama_chat_format=&quot;&quot;
26	
27	try:
28	    from .nodes.ChatGPT import get_llama_models,get_llama_model_path,llama_cpp_client
29	    llama_cpp_client(&quot;&quot;)
30	
31	except:
32	    print(&quot;##nodes.ChatGPT ImportError&quot;)
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-high">
    <b>subprocess_popen_with_shell_equals_true: </b> subprocess call with shell=True identified, security issue.<br>
    <b>Test ID:</b> B602<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/__init__.py" target="_blank">/comfyui-mixlab-nodes/__init__.py</a><br>
    <b>Line number: </b>62<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b602_subprocess_popen_with_shell_equals_true.html</a><br>

<div class="code">
<pre>
46	    print(&quot;pip install -r requirements.txt&quot;)
47	    sys.exit()
48	   
49	def is_installed(package, package_overwrite=None):
50	    try:
51	        spec = importlib.util.find_spec(package)
52	    except ModuleNotFoundError:
53	        pass
54	
55	    package = package_overwrite or package
56	
57	    if spec is None:
58	        print(f&quot;Installing {package}...&quot;)
59	        # 清华源 -i https://pypi.tuna.tsinghua.edu.cn/simple
60	        command = f&#x27;&quot;{python}&quot; -m pip install {package}&#x27;
61	  
62	        result = subprocess.run(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True, env=os.environ)
63	
64	        if result.returncode != 0:
65	            print(f&quot;Couldn&#x27;t install\nCommand: {command}\nError code: {result.returncode}&quot;)
66	    else:
67	        print(package+&#x27;## OK&#x27;)
68	     
69	try:
70	    import OpenSSL
71	except ImportError:
72	    print(&quot;Module &#x27;pyOpenSSL&#x27; not installed. Please install it via:&quot;)
73	    print(&quot;pip install pyOpenSSL&quot;)
74	    print(&quot;or&quot;)
75	    print(&quot;pip install -r requirements.txt&quot;)
76	    is_installed(&#x27;pyOpenSSL&#x27;)
77	    sys.exit()
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak MD5 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/__init__.py" target="_blank">/comfyui-mixlab-nodes/__init__.py</a><br>
    <b>Line number: </b>128<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
112	  Returns:
113	    去除前缀后的 base64 字符串
114	  &quot;&quot;&quot;
115	
116	  # 使用正则表达式匹配常见的前缀
117	  pattern = r&#x27;^data:image\/(.*);base64,(.+)$&#x27;
118	  match = re.match(pattern, base64_str)
119	  if match:
120	    # 如果匹配到常见的前缀，则去除前缀并返回
121	    return match.group(2)
122	  else:
123	    # 如果不匹配到常见的前缀，则直接返回
124	    return base64_str
125	
126	def calculate_md5(string):
127	    encoded_string = string.encode()
128	    md5_hash = hashlib.md5(encoded_string).hexdigest()
129	    return md5_hash
130	
131	
132	def create_key(key_p,crt_p):
133	    import OpenSSL
134	    # 生成自签名证书
135	    # 生成私钥
136	    private_key = OpenSSL.crypto.PKey()
137	    private_key.generate_key(OpenSSL.crypto.TYPE_RSA, 2048)
138	
139	    # 生成CSR
140	    csr = OpenSSL.crypto.X509Req()
141	    csr.get_subject().CN = &quot;mixlab.com&quot;  # 设置证书的通用名称
142	    csr.set_pubkey(private_key)
143	    csr.sign(private_key, &quot;sha256&quot;)
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-medium">
    <b>hardcoded_bind_all_interfaces: </b> Possible binding to all interfaces.<br>
    <b>Test ID:</b> B104<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>MEDIUM<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/605.html" target="_blank">CWE-605</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/__init__.py" target="_blank">/comfyui-mixlab-nodes/__init__.py</a><br>
    <b>Line number: </b>516<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b104_hardcoded_bind_all_interfaces.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b104_hardcoded_bind_all_interfaces.html</a><br>

<div class="code">
<pre>
500	
501	
502	        success = False
503	        for i in range(11):  # 尝试最多11次
504	            if await check_port_available(address, http_port + 1 + i):
505	                https_port = http_port + 1 + i
506	                site2 = web.TCPSite(runner, address, https_port, ssl_context=ssl_context)
507	                await site2.start()
508	                success = True
509	                break
510	
511	        if not success:
512	            raise RuntimeError(f&quot;Ports {http_port + 1} to {http_port + 10} are all in use.&quot;)
513	
514	        if address == &#x27;&#x27;:
515	            address = &#x27;127.0.0.1&#x27;
516	        if address==&#x27;0.0.0.0&#x27;:
517	            address = &#x27;127.0.0.1&#x27;
518	            
519	        if verbose:
520	
521	            logging.info(&quot;\n&quot;)
522	            logging.info(&quot;\n\nStarting server&quot;)
523	
524	            # print(&quot;\033[93mStarting server\n&quot;)
525	            logging.info(&quot;\033[93mTo see the GUI go to: http://{}:{}&quot;.format(address, http_port))
526	            logging.info(&quot;\033[93mTo see the GUI go to: https://{}:{}\033[0m&quot;.format(address, https_port))
527	 
528	            # print(&quot;\033[93mTo see the GUI go to: http://{}:{}&quot;.format(address, http_port))
529	            # print(&quot;\033[93mTo see the GUI go to: https://{}:{}\033[0m&quot;.format(address, https_port))
530	
531	        if call_on_start is not None:
</pre>
</div>


</div>
</div>

<div id="issue-4">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/__init__.py" target="_blank">/comfyui-mixlab-nodes/__init__.py</a><br>
    <b>Line number: </b>837<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
821	    # print(data)
822	    if llama_port and llama_model and llama_chat_format:
823	        return web.json_response({&quot;port&quot;:llama_port,&quot;model&quot;:llama_model,&quot;chat_format&quot;:llama_chat_format} )
824	    try:
825	        result=await start_local_llm(data)
826	    except:
827	        result= {&quot;port&quot;:None,&quot;model&quot;:&quot;&quot;,&quot;llama_cpp_error&quot;:True}
828	        print(&#x27;start_local_llm error&#x27;)
829	
830	    return web.json_response(result)
831	
832	# 重启服务
833	@routes.post(&#x27;/mixlab/re_start&#x27;)
834	def re_start(request):
835	    try:
836	        sys.stdout.close_log()
837	    except Exception as e:
838	        pass
839	    return os.execv(sys.executable, [sys.executable] + sys.argv)
840	
841	
842	
843	# 导入节点
844	from .nodes.PromptNode import GLIGENTextBoxApply_Advanced,EmbeddingPrompt,RandomPrompt,PromptSlide,PromptSimplification,PromptImage,JoinWithDelimiter
845	from .nodes.ImageNode import ImageListToBatch_,ComparingTwoFrames,LoadImages_,CompositeImages,GridDisplayAndSave,GridInput,ImagesPrompt,SaveImageAndMetadata,SaveImageToLocal,SplitImage,GridOutput,GetImageSize_,MirroredImage,ImageColorTransfer,NoiseImage,TransparentImage,GradientImage,LoadImagesFromPath,LoadImagesFromURL,ResizeImage,TextImage,SvgImage,Image3D,ShowLayer,NewLayer,MergeLayers,CenterImage,AreaToMask,SmoothMask,SplitLongMask,ImageCropByAlpha,EnhanceImage,FaceToMask
846	# from .nodes.Vae import VAELoader,VAEDecode
847	from .nodes.ScreenShareNode import ScreenShareNode,FloatingVideo
848	
849	from .nodes.Audio import AudioPlayNode,SpeechRecognition,SpeechSynthesis
850	from .nodes.Utils import IncrementingListNode,ListSplit,CreateLoraNames,CreateSampler_names,CreateCkptNames,CreateSeedNode,TESTNODE_,TESTNODE_TOKEN,AppInfo,IntNumber,FloatSlider,TextInput,ColorInput,FontInput,TextToNumber,DynamicDelayProcessor,LimitNumber,SwitchByIndex,MultiplicationNode
851	from .nodes.Mask import PreviewMask_,MaskListReplace,MaskListMerge,OutlineMask,FeatheredMask
852	
853	from .nodes.Style import ApplyVisualStylePrompting,StyleAlignedReferenceSampler,StyleAlignedBatchAlign,StyleAlignedSampleReferenceLatents
</pre>
</div>


</div>
</div>

<div id="issue-5">
<div class="issue-block issue-sev-low">
    <b>start_process_with_no_shell: </b> Starting a process without a shell.<br>
    <b>Test ID:</b> B606<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>MEDIUM<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/__init__.py" target="_blank">/comfyui-mixlab-nodes/__init__.py</a><br>
    <b>Line number: </b>839<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b606_start_process_with_no_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b606_start_process_with_no_shell.html</a><br>

<div class="code">
<pre>
823	        return web.json_response({&quot;port&quot;:llama_port,&quot;model&quot;:llama_model,&quot;chat_format&quot;:llama_chat_format} )
824	    try:
825	        result=await start_local_llm(data)
826	    except:
827	        result= {&quot;port&quot;:None,&quot;model&quot;:&quot;&quot;,&quot;llama_cpp_error&quot;:True}
828	        print(&#x27;start_local_llm error&#x27;)
829	
830	    return web.json_response(result)
831	
832	# 重启服务
833	@routes.post(&#x27;/mixlab/re_start&#x27;)
834	def re_start(request):
835	    try:
836	        sys.stdout.close_log()
837	    except Exception as e:
838	        pass
839	    return os.execv(sys.executable, [sys.executable] + sys.argv)
840	
841	
842	
843	# 导入节点
844	from .nodes.PromptNode import GLIGENTextBoxApply_Advanced,EmbeddingPrompt,RandomPrompt,PromptSlide,PromptSimplification,PromptImage,JoinWithDelimiter
845	from .nodes.ImageNode import ImageListToBatch_,ComparingTwoFrames,LoadImages_,CompositeImages,GridDisplayAndSave,GridInput,ImagesPrompt,SaveImageAndMetadata,SaveImageToLocal,SplitImage,GridOutput,GetImageSize_,MirroredImage,ImageColorTransfer,NoiseImage,TransparentImage,GradientImage,LoadImagesFromPath,LoadImagesFromURL,ResizeImage,TextImage,SvgImage,Image3D,ShowLayer,NewLayer,MergeLayers,CenterImage,AreaToMask,SmoothMask,SplitLongMask,ImageCropByAlpha,EnhanceImage,FaceToMask
846	# from .nodes.Vae import VAELoader,VAEDecode
847	from .nodes.ScreenShareNode import ScreenShareNode,FloatingVideo
848	
849	from .nodes.Audio import AudioPlayNode,SpeechRecognition,SpeechSynthesis
850	from .nodes.Utils import IncrementingListNode,ListSplit,CreateLoraNames,CreateSampler_names,CreateCkptNames,CreateSeedNode,TESTNODE_,TESTNODE_TOKEN,AppInfo,IntNumber,FloatSlider,TextInput,ColorInput,FontInput,TextToNumber,DynamicDelayProcessor,LimitNumber,SwitchByIndex,MultiplicationNode
851	from .nodes.Mask import PreviewMask_,MaskListReplace,MaskListMerge,OutlineMask,FeatheredMask
852	
853	from .nodes.Style import ApplyVisualStylePrompting,StyleAlignedReferenceSampler,StyleAlignedBatchAlign,StyleAlignedSampleReferenceLatents
854	
</pre>
</div>


</div>
</div>

<div id="issue-6">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak SHA1 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/ChatGPT.py" target="_blank">/comfyui-mixlab-nodes/nodes/ChatGPT.py</a><br>
    <b>Line number: </b>20<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
4	import re,json,os,string,random
5	import folder_paths
6	import hashlib
7	import codecs,sys
8	import importlib.util
9	
10	
11	def is_installed(package):
12	    try:
13	        spec = importlib.util.find_spec(package)
14	    except ModuleNotFoundError:
15	        return False
16	    return spec is not None
17	
18	
19	def get_unique_hash(string):
20	    hash_object = hashlib.sha1(string.encode())
21	    unique_hash = hash_object.hexdigest()
22	    return unique_hash
23	
24	def generate_random_string(length):
25	    letters = string.ascii_letters + string.digits
26	    return &#x27;&#x27;.join(random.choice(letters) for _ in range(length))
27	
28	class AnyType(str):
29	  &quot;&quot;&quot;A special class that is always equal in not equal comparisons. Credit to pythongosssss&quot;&quot;&quot;
30	
31	  def __ne__(self, __value: object) -&gt; bool:
32	    return False
33	
34	any_type = AnyType(&quot;*&quot;)
35	
</pre>
</div>


</div>
</div>

<div id="issue-7">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/ChatGPT.py" target="_blank">/comfyui-mixlab-nodes/nodes/ChatGPT.py</a><br>
    <b>Line number: </b>65<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
49	    # https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/create-resource?pivots=web-portal#create-a-resource
50	    azure_endpoint=url
51	    )
52	    return client
53	
54	def openai_client(key,url):
55	    client = openai.OpenAI(
56	    api_key=key,
57	    base_url=url
58	    )
59	    return client
60	
61	def ZhipuAI_client(key):
62	
63	    try:
64	        if is_installed(&#x27;zhipuai&#x27;)==False:
65	            import subprocess
66	
67	            # 安装
68	            print(&#x27;#pip install zhipuai&#x27;)
69	
70	            result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;zhipuai&#x27;], capture_output=True, text=True)
71	
72	            #检查命令执行结果
73	            if result.returncode == 0:
74	                print(&quot;#install success&quot;)
75	                from zhipuai import ZhipuAI
76	            else:
77	                print(&quot;#install error&quot;)
78	            
79	        else:
80	            from zhipuai import ZhipuAI
</pre>
</div>


</div>
</div>

<div id="issue-8">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/ChatGPT.py" target="_blank">/comfyui-mixlab-nodes/nodes/ChatGPT.py</a><br>
    <b>Line number: </b>70<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
54	def openai_client(key,url):
55	    client = openai.OpenAI(
56	    api_key=key,
57	    base_url=url
58	    )
59	    return client
60	
61	def ZhipuAI_client(key):
62	
63	    try:
64	        if is_installed(&#x27;zhipuai&#x27;)==False:
65	            import subprocess
66	
67	            # 安装
68	            print(&#x27;#pip install zhipuai&#x27;)
69	
70	            result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;zhipuai&#x27;], capture_output=True, text=True)
71	
72	            #检查命令执行结果
73	            if result.returncode == 0:
74	                print(&quot;#install success&quot;)
75	                from zhipuai import ZhipuAI
76	            else:
77	                print(&quot;#install error&quot;)
78	            
79	        else:
80	            from zhipuai import ZhipuAI
81	    except:
82	        print(&quot;#install zhipuai error&quot;)
83	
84	    client = ZhipuAI(
85	        api_key=key, # 填写您的 APIKey
</pre>
</div>


</div>
</div>

<div id="issue-9">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/ChatGPT.py" target="_blank">/comfyui-mixlab-nodes/nodes/ChatGPT.py</a><br>
    <b>Line number: </b>122<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
106	        for file in files:
107	            if os.path.isfile(os.path.join(model_path, file)):
108	                res.append(file)
109	        res=phi_sort(res)
110	    return res
111	
112	llama_modes_list=get_llama_models()
113	
114	def get_llama_model_path(file_name):
115	    model_path=get_llama_path()
116	    mp=os.path.join(model_path,file_name)
117	    return mp
118	
119	def llama_cpp_client(file_name):
120	    try:
121	        if is_installed(&#x27;llama_cpp&#x27;)==False:
122	            import subprocess
123	
124	            # 安装
125	            print(&#x27;#pip install llama-cpp-python&#x27;)
126	 
127	            result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, 
128	                                     &#x27;install&#x27;, 
129	                                     &#x27;llama-cpp-python&#x27;,
130	                                     &#x27;--extra-index-url&#x27;,
131	                                     &#x27;https://abetlen.github.io/llama-cpp-python/whl/cu121&#x27;
132	                                     ], capture_output=True, text=True)
133	
134	            #检查命令执行结果
135	            if result.returncode == 0:
136	                print(&quot;#install success&quot;)
137	                from llama_cpp import Llama
</pre>
</div>


</div>
</div>

<div id="issue-10">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/ChatGPT.py" target="_blank">/comfyui-mixlab-nodes/nodes/ChatGPT.py</a><br>
    <b>Line number: </b>127<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
111	
112	llama_modes_list=get_llama_models()
113	
114	def get_llama_model_path(file_name):
115	    model_path=get_llama_path()
116	    mp=os.path.join(model_path,file_name)
117	    return mp
118	
119	def llama_cpp_client(file_name):
120	    try:
121	        if is_installed(&#x27;llama_cpp&#x27;)==False:
122	            import subprocess
123	
124	            # 安装
125	            print(&#x27;#pip install llama-cpp-python&#x27;)
126	 
127	            result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, 
128	                                     &#x27;install&#x27;, 
129	                                     &#x27;llama-cpp-python&#x27;,
130	                                     &#x27;--extra-index-url&#x27;,
131	                                     &#x27;https://abetlen.github.io/llama-cpp-python/whl/cu121&#x27;
132	                                     ], capture_output=True, text=True)
133	
134	            #检查命令执行结果
135	            if result.returncode == 0:
136	                print(&quot;#install success&quot;)
137	                from llama_cpp import Llama
138	
139	                subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, 
140	                                     &#x27;install&#x27;, 
141	                                     &#x27;llama-cpp-python[server]&#x27;
142	                                     ], capture_output=True, text=True)
143	
144	            else:
145	                print(&quot;#install error&quot;)
146	            
147	        else:
</pre>
</div>


</div>
</div>

<div id="issue-11">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/ChatGPT.py" target="_blank">/comfyui-mixlab-nodes/nodes/ChatGPT.py</a><br>
    <b>Line number: </b>139<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
123	
124	            # 安装
125	            print(&#x27;#pip install llama-cpp-python&#x27;)
126	 
127	            result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, 
128	                                     &#x27;install&#x27;, 
129	                                     &#x27;llama-cpp-python&#x27;,
130	                                     &#x27;--extra-index-url&#x27;,
131	                                     &#x27;https://abetlen.github.io/llama-cpp-python/whl/cu121&#x27;
132	                                     ], capture_output=True, text=True)
133	
134	            #检查命令执行结果
135	            if result.returncode == 0:
136	                print(&quot;#install success&quot;)
137	                from llama_cpp import Llama
138	
139	                subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, 
140	                                     &#x27;install&#x27;, 
141	                                     &#x27;llama-cpp-python[server]&#x27;
142	                                     ], capture_output=True, text=True)
143	
144	            else:
145	                print(&quot;#install error&quot;)
146	            
147	        else:
148	            from llama_cpp import Llama
149	    except:
150	        print(&quot;#install llama-cpp-python error&quot;)
151	
152	    if file_name:
153	        mp=get_llama_model_path(file_name)
154	        # file_name=get_llama_models()[0]
155	        # model_path=os.path.join(folder_paths.models_dir, &quot;llamafile&quot;)
156	        # mp=os.path.join(model_path,file_name)
157	
</pre>
</div>


</div>
</div>

<div id="issue-12">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/ClipInterrogator.py" target="_blank">/comfyui-mixlab-nodes/nodes/ClipInterrogator.py</a><br>
    <b>Line number: </b>30<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
14	# from clip_interrogator import Config, Interrogator
15	
16	
17	global _available
18	_available=False
19	
20	def is_installed(package):
21	    try:
22	        spec = importlib.util.find_spec(package)
23	    except ModuleNotFoundError:
24	        return False
25	    return spec is not None
26	
27	
28	try:
29	    if is_installed(&#x27;clip_interrogator&#x27;)==False:
30	        import subprocess
31	
32	        # 安装
33	        print(&#x27;#pip install clip-interrogator==0.6.0&#x27;)
34	
35	        result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;clip-interrogator==0.6.0&#x27;], capture_output=True, text=True)
36	
37	        #检查命令执行结果
38	        if result.returncode == 0:
39	            print(&quot;#install success&quot;)
40	            from clip_interrogator import Config, Interrogator
41	            _available=True
42	        else:
43	            print(&quot;#install error&quot;)
44	        
45	    else:
</pre>
</div>


</div>
</div>

<div id="issue-13">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/ClipInterrogator.py" target="_blank">/comfyui-mixlab-nodes/nodes/ClipInterrogator.py</a><br>
    <b>Line number: </b>35<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
19	
20	def is_installed(package):
21	    try:
22	        spec = importlib.util.find_spec(package)
23	    except ModuleNotFoundError:
24	        return False
25	    return spec is not None
26	
27	
28	try:
29	    if is_installed(&#x27;clip_interrogator&#x27;)==False:
30	        import subprocess
31	
32	        # 安装
33	        print(&#x27;#pip install clip-interrogator==0.6.0&#x27;)
34	
35	        result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;clip-interrogator==0.6.0&#x27;], capture_output=True, text=True)
36	
37	        #检查命令执行结果
38	        if result.returncode == 0:
39	            print(&quot;#install success&quot;)
40	            from clip_interrogator import Config, Interrogator
41	            _available=True
42	        else:
43	            print(&quot;#install error&quot;)
44	        
45	    else:
46	        from clip_interrogator import Config, Interrogator
47	        _available=True
48	
49	except:
50	    _available=False
</pre>
</div>


</div>
</div>

<div id="issue-14">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/Lama.py" target="_blank">/comfyui-mixlab-nodes/nodes/Lama.py</a><br>
    <b>Line number: </b>21<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
5	import importlib.util
6	import numpy as np
7	
8	import torch
9	
10	global _available
11	_available=False
12	
13	def is_installed(package):
14	    try:
15	        spec = importlib.util.find_spec(package)
16	    except ModuleNotFoundError:
17	        return False
18	    return spec is not None
19	
20	if is_installed(&#x27;simple_lama_inpainting&#x27;)==False:
21	    import subprocess
22	    from packaging import version
23	    
24	    if version.parse(torch.__version__)&gt;=version.parse(&#x27;2.1&#x27;):
25	        # 安装
26	        print(&#x27;#pip install simple_lama_inpainting&#x27;)
27	
28	        result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;simple_lama_inpainting&#x27;], capture_output=True, text=True)
29	
30	        #检查命令执行结果
31	        if result.returncode == 0:
32	            print(&quot;#install success&quot;)
33	            from simple_lama_inpainting import SimpleLama
34	            _available=True
35	        else:
36	            print(&quot;#install error&quot;)
</pre>
</div>


</div>
</div>

<div id="issue-15">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/Lama.py" target="_blank">/comfyui-mixlab-nodes/nodes/Lama.py</a><br>
    <b>Line number: </b>28<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
12	
13	def is_installed(package):
14	    try:
15	        spec = importlib.util.find_spec(package)
16	    except ModuleNotFoundError:
17	        return False
18	    return spec is not None
19	
20	if is_installed(&#x27;simple_lama_inpainting&#x27;)==False:
21	    import subprocess
22	    from packaging import version
23	    
24	    if version.parse(torch.__version__)&gt;=version.parse(&#x27;2.1&#x27;):
25	        # 安装
26	        print(&#x27;#pip install simple_lama_inpainting&#x27;)
27	
28	        result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;simple_lama_inpainting&#x27;], capture_output=True, text=True)
29	
30	        #检查命令执行结果
31	        if result.returncode == 0:
32	            print(&quot;#install success&quot;)
33	            from simple_lama_inpainting import SimpleLama
34	            _available=True
35	        else:
36	            print(&quot;#install error&quot;)
37	    else:
38	        print(&#x27;#pls check your torch version &gt;= 2.1&#x27;)
39	
40	else:
41	    from simple_lama_inpainting import SimpleLama
42	    _available=True
43	
</pre>
</div>


</div>
</div>

<div id="issue-16">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/RembgNode.py" target="_blank">/comfyui-mixlab-nodes/nodes/RembgNode.py</a><br>
    <b>Line number: </b>511<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
495	            if not filename.startswith(&#x27;.&#x27;):
496	                name, ext = os.path.splitext(os.path.basename(filename))
497	                filenames.append(name)
498	    return filenames
499	
500	
501	def is_installed(package):
502	    try:
503	        spec = importlib.util.find_spec(package)
504	    except ModuleNotFoundError:
505	        return False
506	    return spec is not None
507	
508	
509	try:
510	    if is_installed(&#x27;rembg&#x27;)==False:
511	        import subprocess
512	
513	        # 安装
514	        print(&#x27;#pip install rembg[gpu]&#x27;)
515	
516	        result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;rembg[gpu]&#x27;], capture_output=True, text=True)
517	
518	        #检查命令执行结果
519	        if result.returncode == 0:
520	            print(&quot;#install success&quot;)
521	            from rembg import new_session, remove
522	            _available=True
523	        else:
524	            print(&quot;#install error&quot;)
525	        
526	    else:
</pre>
</div>


</div>
</div>

<div id="issue-17">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/RembgNode.py" target="_blank">/comfyui-mixlab-nodes/nodes/RembgNode.py</a><br>
    <b>Line number: </b>516<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
500	
501	def is_installed(package):
502	    try:
503	        spec = importlib.util.find_spec(package)
504	    except ModuleNotFoundError:
505	        return False
506	    return spec is not None
507	
508	
509	try:
510	    if is_installed(&#x27;rembg&#x27;)==False:
511	        import subprocess
512	
513	        # 安装
514	        print(&#x27;#pip install rembg[gpu]&#x27;)
515	
516	        result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;rembg[gpu]&#x27;], capture_output=True, text=True)
517	
518	        #检查命令执行结果
519	        if result.returncode == 0:
520	            print(&quot;#install success&quot;)
521	            from rembg import new_session, remove
522	            _available=True
523	        else:
524	            print(&quot;#install error&quot;)
525	        
526	    else:
527	        from rembg import new_session, remove
528	        _available=True
529	
530	except:
531	    _available=False
</pre>
</div>


</div>
</div>

<div id="issue-18">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/TextGenerateNode.py" target="_blank">/comfyui-mixlab-nodes/nodes/TextGenerateNode.py</a><br>
    <b>Line number: </b>50<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
34	zh_en_model_path=os.path.join(prompt_generator, &quot;opus-mt-zh-en&quot;)
35	if not os.path.exists(zh_en_model_path):
36	    print(f&quot;## zh_en_model not found: {zh_en_model_path}, pls download from https://huggingface.co/Helsinki-NLP/opus-mt-zh-en/tree/main&quot;)
37	    zh_en_model_path=&#x27;Helsinki-NLP/opus-mt-zh-en&#x27;
38	
39	
40	def is_installed(package):
41	    try:
42	        spec = importlib.util.find_spec(package)
43	    except ModuleNotFoundError:
44	        return False
45	    return spec is not None
46	
47	
48	try:
49	    if is_installed(&#x27;sentencepiece&#x27;)==False:
50	        import subprocess
51	
52	        # 安装
53	        print(&#x27;#pip install sentencepiece&#x27;)
54	
55	        result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;sentencepiece&#x27;], capture_output=True, text=True)
56	
57	        #检查命令执行结果
58	        if result.returncode == 0 and is_installed(&#x27;sentencepiece&#x27;):
59	            print(&quot;#install success&quot;)
60	            _available=True
61	        else:
62	            print(&quot;#install error&quot;)
63	            _available=False
64	        
65	    else:
</pre>
</div>


</div>
</div>

<div id="issue-19">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/TextGenerateNode.py" target="_blank">/comfyui-mixlab-nodes/nodes/TextGenerateNode.py</a><br>
    <b>Line number: </b>55<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
39	
40	def is_installed(package):
41	    try:
42	        spec = importlib.util.find_spec(package)
43	    except ModuleNotFoundError:
44	        return False
45	    return spec is not None
46	
47	
48	try:
49	    if is_installed(&#x27;sentencepiece&#x27;)==False:
50	        import subprocess
51	
52	        # 安装
53	        print(&#x27;#pip install sentencepiece&#x27;)
54	
55	        result = subprocess.run([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, &#x27;sentencepiece&#x27;], capture_output=True, text=True)
56	
57	        #检查命令执行结果
58	        if result.returncode == 0 and is_installed(&#x27;sentencepiece&#x27;):
59	            print(&quot;#install success&quot;)
60	            _available=True
61	        else:
62	            print(&quot;#install error&quot;)
63	            _available=False
64	        
65	    else:
66	        _available=True
67	
68	except:
69	    _available=False
70	
</pre>
</div>


</div>
</div>

<div id="issue-20">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/Video.py" target="_blank">/comfyui-mixlab-nodes/nodes/Video.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import os
2	import hashlib
3	import json
4	import subprocess
5	import shutil
6	import re
7	import time,math
8	import numpy as np
9	from typing import List
10	import torch
11	from PIL import Image, ImageOps
12	from PIL.PngImagePlugin import PngInfo
13	import cv2,random,string
14	from pathlib import Path
15	
16	import folder_paths
17	from comfy.k_diffusion.utils import FolderOfImages
18	from comfy.utils import common_upscale
19	
20	import torchaudio
21	import base64
22	
23	import mimetypes
24	
25	
26	
27	def get_frames(frame_count, frames, revert=False):
28	    if not revert:
29	        if frame_count &lt;= len(frames):
30	            return frames[:frame_count]
31	        else:
32	            return [frames[i % len(frames)] for i in range(frame_count)]
</pre>
</div>


</div>
</div>

<div id="issue-21">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/Video.py" target="_blank">/comfyui-mixlab-nodes/nodes/Video.py</a><br>
    <b>Line number: </b>240<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
224	    except:
225	        print(&quot;ffmpeg could not be found. Outputs that require it have been disabled&quot;)
226	
227	
228	def combine_audio_video(audio_path, video_path, output_path):
229	   
230	    command = [
231	        ffmpeg_path,
232	        &#x27;-i&#x27;, video_path,
233	        &#x27;-i&#x27;, audio_path,
234	        &#x27;-c:v&#x27;, &#x27;copy&#x27;,
235	        &#x27;-c:a&#x27;, &#x27;aac&#x27;,
236	        &#x27;-shortest&#x27;,
237	        output_path
238	    ]
239	    
240	    subprocess.run(command, check=True)
241	    return output_path
242	
243	
244	
245	
246	# Tensor to PIL
247	def tensor2pil(image):
248	    return Image.fromarray(np.clip(255. * image.cpu().numpy().squeeze(), 0, 255).astype(np.uint8))
249	
250	# Convert PIL to Tensor
251	def pil2tensor(image):
252	    return torch.from_numpy(np.array(image).astype(np.float32) / 255.0).unsqueeze(0)
253	
254	def count_files(directory):
255	    count = 0
</pre>
</div>


</div>
</div>

<div id="issue-22">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/Video.py" target="_blank">/comfyui-mixlab-nodes/nodes/Video.py</a><br>
    <b>Line number: </b>651<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
635	        os.makedirs(folder_paths.get_temp_directory(), exist_ok=True)
636	
637	        metadata_path = os.path.join(folder_paths.get_temp_directory(), &quot;metadata.txt&quot;)
638	        #metadata from file should  escape = ; # \ and newline
639	        #From my testing, though, only backslashes need escapes and = in particular causes problems
640	        #It is likely better to prioritize future compatibility with containers that don&#x27;t support
641	        #or shouldn&#x27;t use the comment tag for embedding metadata
642	        metadata = metadata.replace(&quot;\\&quot;,&quot;\\\\&quot;)
643	        metadata = metadata.replace(&quot;;&quot;,&quot;\\;&quot;)
644	        metadata = metadata.replace(&quot;#&quot;,&quot;\\#&quot;)
645	        #metadata = metadata.replace(&quot;=&quot;,&quot;\\=&quot;)
646	        metadata = metadata.replace(&quot;\n&quot;,&quot;\\\n&quot;)
647	        with open(metadata_path, &quot;w&quot;) as f:
648	            f.write(&quot;;FFMETADATA1\n&quot;)
649	            f.write(metadata)
650	        args = args[:1] + [&quot;-i&quot;, metadata_path] + args[1:] + [file_path]
651	        with subprocess.Popen(args, stdin=subprocess.PIPE, env=env) as proc:
652	            for frame in frames:
653	                proc.stdin.write(frame.tobytes())
654	
655	    def run(
656	        self,
657	        image_batch,
658	        frame_rate: int,
659	        loop_count: int,
660	        filename_prefix=&quot;AnimateDiff&quot;,
661	        format=&quot;image/gif&quot;,
662	        pingpong=False,
663	        save_image=True,
664	        metadata=False,
665	        prompt=None,
666	        extra_pnginfo=None,
</pre>
</div>


</div>
</div>

<div id="issue-23">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/Video.py" target="_blank">/comfyui-mixlab-nodes/nodes/Video.py</a><br>
    <b>Line number: </b>772<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
756	            # in a manor not solely related to other arguments
757	            if os.name == &#x27;posix&#x27;:
758	                max_arg_length = 4096*32
759	            else:
760	                max_arg_length = 32767 - len(&quot; &quot;.join(args + [metadata_args[0]] + [file_path])) - 1
761	            #test max limit
762	            #metadata_args[1] = metadata_args[1] + &quot;a&quot;*(max_arg_length - len(metadata_args[1])-1)
763	
764	            env=os.environ.copy()
765	            if  &quot;environment&quot; in video_format:
766	                env.update(video_format[&quot;environment&quot;])
767	            if len(metadata_args[1]) &gt;= max_arg_length:
768	                print(f&quot;Using fallback file for extremely long metadata: {len(metadata_args[1])}/{max_arg_length}&quot;)
769	                self.save_with_tempfile(args, metadata_args[1], file_path, frames, env)
770	            else:
771	                try:
772	                    with subprocess.Popen(args + metadata_args + [file_path],
773	                                          stdin=subprocess.PIPE, env=env) as proc:
774	                        for frame in frames:
775	                            proc.stdin.write(frame.tobytes())
776	                except FileNotFoundError as e:
777	                    if &quot;winerror&quot; in dir(e) and e.winerror == 206:
778	                        print(&quot;Metadata was too long. Retrying with fallback file&quot;)
779	                        self.save_with_tempfile(args, metadata_args[1], file_path, frames, env)
780	                    else:
781	                        raise
782	                except OSError as e:
783	                    if &quot;errno&quot; in dir(e) and e.errno == 7:
784	                        print(&quot;Metadata was too long. Retrying with fallback file&quot;)
785	                        self.save_with_tempfile(args, metadata_args[1], file_path, frames, env)
786	                    else:
787	                        raise
788	
</pre>
</div>


</div>
</div>

<div id="issue-24">
<div class="issue-block issue-sev-high">
    <b>hashlib: </b> Use of weak MD5 hash for security. Consider usedforsecurity=False<br>
    <b>Test ID:</b> B324<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/327.html" target="_blank">CWE-327</a><br>
    <b>File: </b><a href="/comfyui-mixlab-nodes/nodes/edit_mask.py" target="_blank">/comfyui-mixlab-nodes/nodes/edit_mask.py</a><br>
    <b>Line number: </b>24<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b324_hashlib.html</a><br>

<div class="code">
<pre>
8	import node_helpers
9	import hashlib
10	
11	# Tensor to PIL
12	def tensor2pil(image):
13	    return Image.fromarray(np.clip(255. * image.cpu().numpy().squeeze(), 0, 255).astype(np.uint8))
14	
15	# tensor 取hash值
16	def tensor_to_hash(tensor):
17	    # 将 Tensor 转换为 NumPy 数组
18	    np_array = tensor.cpu().numpy()
19	    
20	    # 将 NumPy 数组转换为字节数据
21	    byte_data = np_array.tobytes()
22	    
23	    # 计算哈希值
24	    hash_value = hashlib.md5(byte_data).hexdigest()
25	    
26	    return hash_value
27	
28	
29	def create_temp_file(image):
30	    output_dir = folder_paths.get_temp_directory()
31	
32	    (
33	            full_output_folder,
34	            filename,
35	            counter,
36	            subfolder,
37	            _,
38	        ) = folder_paths.get_save_image_path(&#x27;material&#x27;, output_dir)
39	
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
