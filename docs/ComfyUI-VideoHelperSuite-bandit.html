
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">1710</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py</a><br>
    <b>Line number: </b>4<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import os
2	import sys
3	import json
4	import subprocess
5	import numpy as np
6	import re
7	import datetime
8	from typing import List
9	import torch
10	from PIL import Image, ExifTags
11	from PIL.PngImagePlugin import PngInfo
12	from pathlib import Path
13	
14	import folder_paths
15	from .logger import logger
16	from .image_latent_nodes import *
17	from .load_video_nodes import LoadVideoUpload, LoadVideoPath
18	from .load_images_nodes import LoadImagesFromDirectoryUpload, LoadImagesFromDirectoryPath
19	from .batched_nodes import VAEEncodeBatched, VAEDecodeBatched
20	from .utils import ffmpeg_path, get_audio, hash_path, validate_path, requeue_workflow, gifski_path, calculate_file_hash
21	
22	folder_paths.folder_names_and_paths[&quot;VHS_video_formats&quot;] = (
23	    [
24	        os.path.join(os.path.dirname(os.path.abspath(__file__)), &quot;..&quot;, &quot;video_formats&quot;),
25	    ],
26	    [&quot;.json&quot;]
27	)
28	audio_extensions = [&#x27;mp3&#x27;, &#x27;mp4&#x27;, &#x27;wav&#x27;, &#x27;ogg&#x27;]
29	
30	def gen_format_widgets(video_format):
31	    for k in video_format:
32	        if k.endswith(&quot;_pass&quot;):
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py</a><br>
    <b>Line number: </b>116<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
100	    frame_data = yield
101	    if video_format.get(&#x27;save_metadata&#x27;, &#x27;False&#x27;) != &#x27;False&#x27;:
102	        os.makedirs(folder_paths.get_temp_directory(), exist_ok=True)
103	        metadata = json.dumps(video_metadata)
104	        metadata_path = os.path.join(folder_paths.get_temp_directory(), &quot;metadata.txt&quot;)
105	        #metadata from file should  escape = ; # \ and newline
106	        metadata = metadata.replace(&quot;\\&quot;,&quot;\\\\&quot;)
107	        metadata = metadata.replace(&quot;;&quot;,&quot;\\;&quot;)
108	        metadata = metadata.replace(&quot;#&quot;,&quot;\\#&quot;)
109	        metadata = metadata.replace(&quot;=&quot;,&quot;\\=&quot;)
110	        metadata = metadata.replace(&quot;\n&quot;,&quot;\\\n&quot;)
111	        metadata = &quot;comment=&quot; + metadata
112	        with open(metadata_path, &quot;w&quot;) as f:
113	            f.write(&quot;;FFMETADATA1\n&quot;)
114	            f.write(metadata)
115	        m_args = args[:1] + [&quot;-i&quot;, metadata_path] + args[1:] + [&quot;-metadata&quot;, &quot;creation_time=now&quot;]
116	        with subprocess.Popen(m_args + [file_path], stderr=subprocess.PIPE,
117	                              stdin=subprocess.PIPE, env=env) as proc:
118	            try:
119	                while frame_data is not None:
120	                    proc.stdin.write(frame_data)
121	                    #TODO: skip flush for increased speed
122	                    frame_data = yield
123	                proc.stdin.flush()
124	                proc.stdin.close()
125	                res = proc.stderr.read()
126	            except BrokenPipeError as e:
127	                err = proc.stderr.read()
128	                #Check if output file exists. If it does, the re-execution
129	                #will also fail. This obscures the cause of the error
130	                #and seems to never occur concurrent to the metadata issue
131	                if os.path.exists(file_path):
132	                    raise Exception(&quot;An error occured in the ffmpeg subprocess:\n&quot; \
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py</a><br>
    <b>Line number: </b>138<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
122	                    frame_data = yield
123	                proc.stdin.flush()
124	                proc.stdin.close()
125	                res = proc.stderr.read()
126	            except BrokenPipeError as e:
127	                err = proc.stderr.read()
128	                #Check if output file exists. If it does, the re-execution
129	                #will also fail. This obscures the cause of the error
130	                #and seems to never occur concurrent to the metadata issue
131	                if os.path.exists(file_path):
132	                    raise Exception(&quot;An error occured in the ffmpeg subprocess:\n&quot; \
133	                            + err.decode(&quot;utf-8&quot;))
134	                #Res was not set
135	                print(err.decode(&quot;utf-8&quot;), end=&quot;&quot;, file=sys.stderr)
136	                logger.warn(&quot;An error occurred when saving with metadata&quot;)
137	    if res != b&#x27;&#x27;:
138	        with subprocess.Popen(args + [file_path], stderr=subprocess.PIPE,
139	                              stdin=subprocess.PIPE, env=env) as proc:
140	            try:
141	                while frame_data is not None:
142	                    proc.stdin.write(frame_data)
143	                    frame_data = yield
144	                proc.stdin.flush()
145	                proc.stdin.close()
146	                res = proc.stderr.read()
147	            except BrokenPipeError as e:
148	                res = proc.stderr.read()
149	                raise Exception(&quot;An error occured in the ffmpeg subprocess:\n&quot; \
150	                        + res.decode(&quot;utf-8&quot;))
151	    if len(res) &gt; 0:
152	        print(res.decode(&quot;utf-8&quot;), end=&quot;&quot;, file=sys.stderr)
153	
154	def to_pingpong(inp):
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py</a><br>
    <b>Line number: </b>396<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
380	                    meta_batch.outputs.pop(unique_id)
381	                    if len(meta_batch.outputs) == 0:
382	                        meta_batch.reset()
383	            else:
384	                #batch is unfinished
385	                #TODO: Check if empty output breaks other custom nodes
386	                return {&quot;ui&quot;: {&quot;unfinished_batch&quot;: [True]}, &quot;result&quot;: ((save_output, []),)}
387	
388	            output_files.append(file_path)
389	
390	            if &quot;gifski_pass&quot; in video_format:
391	                gif_output = f&quot;{filename}_{counter:05}.gif&quot;
392	                gif_output_path = os.path.join( full_output_folder, gif_output)
393	                gifski_args = [gifski_path] + video_format[&quot;gifski_pass&quot;] \
394	                        + [&quot;-o&quot;, gif_output_path, file_path]
395	                try:
396	                    res = subprocess.run(gifski_args, env=env, check=True, capture_output=True)
397	                except subprocess.CalledProcessError as e:
398	                    raise Exception(&quot;An error occured in the gifski subprocess:\n&quot; \
399	                            + e.stderr.decode(&quot;utf-8&quot;))
400	                if res.stderr:
401	                    print(res.stderr.decode(&quot;utf-8&quot;), end=&quot;&quot;, file=sys.stderr)
402	                #output format is actually an image and should be correctly marked
403	                #TODO: Evaluate a more consistent solution for this
404	                format = &quot;image/gif&quot;
405	                output_files.append(gif_output_path)
406	                file = gif_output
407	
408	            elif audio is not None and audio() is not False:
409	                # Create audio file if input was provided
410	                output_file_with_audio = f&quot;{filename}_{counter:05}-audio.{video_format[&#x27;extension&#x27;]}&quot;
411	                output_file_with_audio_path = os.path.join(full_output_folder, output_file_with_audio)
</pre>
</div>


</div>
</div>

<div id="issue-4">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/nodes.py</a><br>
    <b>Line number: </b>426<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
410	                output_file_with_audio = f&quot;{filename}_{counter:05}-audio.{video_format[&#x27;extension&#x27;]}&quot;
411	                output_file_with_audio_path = os.path.join(full_output_folder, output_file_with_audio)
412	                if &quot;audio_pass&quot; not in video_format:
413	                    logger.warn(&quot;Selected video format does not have explicit audio support&quot;)
414	                    video_format[&quot;audio_pass&quot;] = [&quot;-c:a&quot;, &quot;libopus&quot;]
415	
416	
417	                # FFmpeg command with audio re-encoding
418	                #TODO: expose audio quality options if format widgets makes it in
419	                #Reconsider forcing apad/shortest
420	                mux_args = [ffmpeg_path, &quot;-v&quot;, &quot;error&quot;, &quot;-n&quot;, &quot;-i&quot;, file_path,
421	                            &quot;-i&quot;, &quot;-&quot;, &quot;-c:v&quot;, &quot;copy&quot;] \
422	                            + video_format[&quot;audio_pass&quot;] \
423	                            + [&quot;-af&quot;, &quot;apad&quot;, &quot;-shortest&quot;, output_file_with_audio_path]
424	
425	                try:
426	                    res = subprocess.run(mux_args, input=audio(), env=env,
427	                                         capture_output=True, check=True)
428	                except subprocess.CalledProcessError as e:
429	                    raise Exception(&quot;An error occured in the ffmpeg subprocess:\n&quot; \
430	                            + e.stderr.decode(&quot;utf-8&quot;))
431	                if res.stderr:
432	                    print(res.stderr.decode(&quot;utf-8&quot;), end=&quot;&quot;, file=sys.stderr)
433	                output_files.append(output_file_with_audio_path)
434	                #Return this file with audio to the webui.
435	                #It will be muted unless opened or saved with right click
436	                file = output_file_with_audio
437	
438	        previews = [
439	            {
440	                &quot;filename&quot;: file,
441	                &quot;subfolder&quot;: subfolder,
442	                &quot;type&quot;: &quot;output&quot; if save_output else &quot;temp&quot;,
</pre>
</div>


</div>
</div>

<div id="issue-5">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/server.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/server.py</a><br>
    <b>Line number: </b>5<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import server
2	import folder_paths
3	import os
4	import time
5	import subprocess
6	from .utils import is_url, get_sorted_dir_files_from_directory, ffmpeg_path, validate_sequence
7	from comfy.k_diffusion.utils import FolderOfImages
8	
9	web = server.web
10	
11	def is_safe(path):
12	    if &quot;VHS_STRICT_PATHS&quot; not in os.environ:
13	        return True
14	    basedir = os.path.abspath(&#x27;.&#x27;)
15	    try:
16	        common_path = os.path.commonpath([basedir, path])
17	    except:
18	        #Different drive on windows
19	        return False
20	    return common_path == basedir
21	
22	@server.PromptServer.instance.routes.get(&quot;/viewvideo&quot;)
23	async def view_video(request):
24	    query = request.rel_url.query
25	    if &quot;filename&quot; not in query:
26	        return web.Response(status=404)
27	    filename = query[&quot;filename&quot;]
28	
29	    #Path code misformats urls on windows and must be skipped
30	    if is_url(filename):
31	        file = filename
32	    else:
</pre>
</div>


</div>
</div>

<div id="issue-6">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/server.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/server.py</a><br>
    <b>Line number: </b>111<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
95	            #Aspect ratio is likely changed. A more complex command is required
96	            #to crop the output to the new aspect ratio
97	            ar = float(size[0])/float(size[1])
98	            vfilters.append(f&quot;crop=if(gt({ar}\\,a)\\,iw\\,ih*{ar}):if(gt({ar}\\,a)\\,iw/{ar}\\,ih)&quot;)
99	        size = &#x27;:&#x27;.join(size)
100	        vfilters.append(f&quot;scale={size}&quot;)
101	    vfilters.append(&quot;setpts=PTS-STARTPTS&quot;)
102	    if len(vfilters) &gt; 0:
103	        args += [&quot;-vf&quot;, &quot;,&quot;.join(vfilters)]
104	    if int(query.get(&#x27;frame_load_cap&#x27;, 0)) &gt; 0:
105	        args += [&quot;-frames:v&quot;, query[&#x27;frame_load_cap&#x27;]]
106	    #TODO:reconsider adding high frame cap/setting default frame cap on node
107	
108	    args += [&#x27;-c:v&#x27;, &#x27;libvpx-vp9&#x27;,&#x27;-deadline&#x27;, &#x27;realtime&#x27;, &#x27;-cpu-used&#x27;, &#x27;8&#x27;, &#x27;-f&#x27;, &#x27;webm&#x27;, &#x27;-&#x27;]
109	
110	    try:
111	        with subprocess.Popen(args, stdout=subprocess.PIPE) as proc:
112	            try:
113	                resp = web.StreamResponse()
114	                resp.content_type = &#x27;video/webm&#x27;
115	                resp.headers[&quot;Content-Disposition&quot;] = f&quot;filename=\&quot;{filename}\&quot;&quot;
116	                await resp.prepare(request)
117	                while True:
118	                    bytes_read = proc.stdout.read()
119	                    if bytes_read is None:
120	                        #TODO: check for timeout here
121	                        time.sleep(.1)
122	                        continue
123	                    if len(bytes_read) == 0:
124	                        break
125	                    await resp.write(bytes_read)
126	            except ConnectionResetError as e:
</pre>
</div>


</div>
</div>

<div id="issue-7">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/utils.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/utils.py</a><br>
    <b>Line number: </b>5<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import hashlib
2	import os
3	from typing import Iterable
4	import shutil
5	import subprocess
6	import re
7	
8	import server
9	from .logger import logger
10	
11	BIGMIN = -(2**53-1)
12	BIGMAX = (2**53-1)
13	
14	DIMMAX = 8192
15	
16	def ffmpeg_suitability(path):
17	    try:
18	        version = subprocess.run([path, &quot;-version&quot;], check=True,
19	                                 capture_output=True).stdout.decode(&quot;utf-8&quot;)
20	    except:
21	        return 0
22	    score = 0
23	    #rough layout of the importance of various features
24	    simple_criterion = [(&quot;libvpx&quot;, 20),(&quot;264&quot;,10), (&quot;265&quot;,3),
25	                        (&quot;svtav1&quot;,5),(&quot;libopus&quot;, 1)]
26	    for criterion in simple_criterion:
27	        if version.find(criterion[0]) &gt;= 0:
28	            score += criterion[1]
29	    #obtain rough compile year from copyright information
30	    copyright_index = version.find(&#x27;2000-2&#x27;)
31	    if copyright_index &gt;= 0:
32	        copyright_year = version[copyright_index+6:copyright_index+9]
</pre>
</div>


</div>
</div>

<div id="issue-8">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/utils.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/utils.py</a><br>
    <b>Line number: </b>18<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
2	import os
3	from typing import Iterable
4	import shutil
5	import subprocess
6	import re
7	
8	import server
9	from .logger import logger
10	
11	BIGMIN = -(2**53-1)
12	BIGMAX = (2**53-1)
13	
14	DIMMAX = 8192
15	
16	def ffmpeg_suitability(path):
17	    try:
18	        version = subprocess.run([path, &quot;-version&quot;], check=True,
19	                                 capture_output=True).stdout.decode(&quot;utf-8&quot;)
20	    except:
21	        return 0
22	    score = 0
23	    #rough layout of the importance of various features
24	    simple_criterion = [(&quot;libvpx&quot;, 20),(&quot;264&quot;,10), (&quot;265&quot;,3),
25	                        (&quot;svtav1&quot;,5),(&quot;libopus&quot;, 1)]
26	    for criterion in simple_criterion:
27	        if version.find(criterion[0]) &gt;= 0:
28	            score += criterion[1]
29	    #obtain rough compile year from copyright information
30	    copyright_index = version.find(&#x27;2000-2&#x27;)
31	    if copyright_index &gt;= 0:
32	        copyright_year = version[copyright_index+6:copyright_index+9]
33	        if copyright_year.isnumeric():
34	            score += int(copyright_year)
</pre>
</div>


</div>
</div>

<div id="issue-9">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI-VideoHelperSuite/videohelpersuite/utils.py" target="_blank">/ComfyUI-VideoHelperSuite/videohelpersuite/utils.py</a><br>
    <b>Line number: </b>152<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
136	                        for inp in prompt[output_uid][&#x27;inputs&#x27;].values():
137	                            if inp == [bm_uid, 0]:
138	                                managed_outputs+=1
139	        requeue_guard = [run_number, 0, managed_outputs, {}]
140	    requeue_guard[1] = requeue_guard[1]+1
141	    requeue_guard[3][requeue_required[0]] = requeue_required[1]
142	    if requeue_guard[1] == requeue_guard[2] and max(requeue_guard[3].values()):
143	        requeue_workflow_unchecked()
144	
145	def get_audio(file, start_time=0, duration=0):
146	    args = [ffmpeg_path, &quot;-v&quot;, &quot;error&quot;, &quot;-i&quot;, file]
147	    if start_time &gt; 0:
148	        args += [&quot;-ss&quot;, str(start_time)]
149	    if duration &gt; 0:
150	        args += [&quot;-t&quot;, str(duration)]
151	    try:
152	        res =  subprocess.run(args + [&quot;-f&quot;, &quot;wav&quot;, &quot;-&quot;],
153	                              stdout=subprocess.PIPE, check=True).stdout
154	    except subprocess.CalledProcessError as e:
155	        logger.warning(f&quot;Failed to extract audio from: {file}&quot;)
156	        return False
157	    return res
158	
159	
160	def lazy_eval(func):
161	    class Cache:
162	        def __init__(self, func):
163	            self.res = None
164	            self.func = func
165	        def get(self):
166	            if self.res is None:
167	                self.res = self.func()
168	            return self.res
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
