
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">3657</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_VLM_nodes/__init__.py" target="_blank">/ComfyUI_VLM_nodes/__init__.py</a><br>
    <b>Line number: </b>6<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import importlib.util
2	import os
3	import importlib
4	import pkg_resources
5	import sys
6	import subprocess
7	import folder_paths
8	
9	supported_LLava_extensions = set([&#x27;.gguf&#x27;])
10	
11	try:
12	    folder_paths.folder_names_and_paths[&quot;LLavacheckpoints&quot;] = (folder_paths.folder_names_and_paths[&quot;LLavacheckpoints&quot;][0], supported_LLava_extensions)
13	except:
14	    # check if LLavacheckpoints exists otherwise create
15	    if not os.path.isdir(os.path.join(folder_paths.models_dir, &quot;LLavacheckpoints&quot;)):
16	        os.mkdir(os.path.join(folder_paths.models_dir, &quot;LLavacheckpoints&quot;))
17	        
18	    folder_paths.folder_names_and_paths[&quot;LLavacheckpoints&quot;] = ([os.path.join(folder_paths.models_dir, &quot;LLavacheckpoints&quot;)], supported_LLava_extensions)
19	
20	# Define the check_requirements_installed function here or import it
21	def check_requirements_installed(requirements_path):
22	    with open(requirements_path, &#x27;r&#x27;) as f:
23	        requirements = [pkg_resources.Requirement.parse(line.strip()) for line in f if line.strip()]
24	
25	    installed_packages = {pkg.key: pkg for pkg in pkg_resources.working_set}
26	    installed_packages_set = set(installed_packages.keys())
27	    missing_packages = []
28	    for requirement in requirements:
29	        if requirement.key not in installed_packages_set or not installed_packages[requirement.key] in requirement:
30	            missing_packages.append(str(requirement))
31	
32	    if missing_packages:
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_VLM_nodes/__init__.py" target="_blank">/ComfyUI_VLM_nodes/__init__.py</a><br>
    <b>Line number: </b>35<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
19	
20	# Define the check_requirements_installed function here or import it
21	def check_requirements_installed(requirements_path):
22	    with open(requirements_path, &#x27;r&#x27;) as f:
23	        requirements = [pkg_resources.Requirement.parse(line.strip()) for line in f if line.strip()]
24	
25	    installed_packages = {pkg.key: pkg for pkg in pkg_resources.working_set}
26	    installed_packages_set = set(installed_packages.keys())
27	    missing_packages = []
28	    for requirement in requirements:
29	        if requirement.key not in installed_packages_set or not installed_packages[requirement.key] in requirement:
30	            missing_packages.append(str(requirement))
31	
32	    if missing_packages:
33	        print(f&quot;Missing or outdated packages: {&#x27;, &#x27;.join(missing_packages)}&quot;)
34	        print(&quot;Installing/Updating missing packages...&quot;)
35	        subprocess.check_call([sys.executable, &#x27;-s&#x27;, &#x27;-m&#x27;, &#x27;pip&#x27;, &#x27;install&#x27;, *missing_packages])
36	    else:
37	        print(&quot;All packages from requirements.txt are installed and up to date.&quot;)
38	
39	requirements_path  = os.path.join(os.path.dirname(os.path.realpath(__file__)), &quot;requirements.txt&quot;)
40	check_requirements_installed(requirements_path)
41	
42	from .install_init import init, get_system_info, install_llama, install_autogptq
43	system_info = get_system_info()
44	install_llama(system_info)
45	llama_cpp_agent_path  = os.path.join(os.path.dirname(os.path.realpath(__file__)), &quot;cpp_agent_req.txt&quot;)
46	check_requirements_installed(llama_cpp_agent_path)
47	install_autogptq(system_info)
48	
49	init()
50	
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-low">
    <b>blacklist: </b> Consider possible security implications associated with the subprocess module.<br>
    <b>Test ID:</b> B404<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_VLM_nodes/install_init.py" target="_blank">/ComfyUI_VLM_nodes/install_init.py</a><br>
    <b>Line number: </b>7<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_imports.html#b404-import-subprocess</a><br>

<div class="code">
<pre>
1	import os
2	import json
3	import shutil
4	from os.path import join, dirname, abspath, exists
5	from os import makedirs, symlink, readlink
6	import platform
7	import subprocess
8	import sys
9	import importlib.util
10	import re
11	import torch
12	import cpuinfo
13	import packaging.tags
14	from requests import get
15	import asyncio
16	import inspect
17	import aiohttp
18	from server import PromptServer
19	from tqdm import tqdm
20	import pkg_resources
21	
22	
23	
24	def get_python_version():
25	    &quot;&quot;&quot;Return the Python version in a concise format, e.g., &#x27;39&#x27; for Python 3.9.&quot;&quot;&quot;
26	    version_match = re.match(r&quot;3\.(\d+)&quot;, platform.python_version())
27	    if version_match:
28	        return &quot;3&quot; + version_match.group(1)
29	    else:
30	        return None
31	
32	def get_system_info():
</pre>
</div>


</div>
</div>

<div id="issue-3">
<div class="issue-block issue-sev-medium">
    <b>request_without_timeout: </b> Requests call without timeout<br>
    <b>Test ID:</b> B113<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>LOW<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/400.html" target="_blank">CWE-400</a><br>
    <b>File: </b><a href="/ComfyUI_VLM_nodes/install_init.py" target="_blank">/ComfyUI_VLM_nodes/install_init.py</a><br>
    <b>Line number: </b>80<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html</a><br>

<div class="code">
<pre>
64	        except Exception as e:
65	            # Handle unexpected errors gracefully
66	            print(f&quot;Error retrieving CPU information: {e}&quot;)
67	            system_info[&#x27;avx2&#x27;] = False
68	    else:
69	        # Handle the case where the cpuinfo module is not installed
70	        print(&quot;cpuinfo module not available.&quot;)
71	        system_info[&#x27;avx2&#x27;] = False
72	    # Determine the platform tag
73	    if importlib.util.find_spec(&#x27;packaging.tags&#x27;):        
74	        system_info[&#x27;platform_tag&#x27;] = next(packaging.tags.sys_tags()).platform
75	
76	    return system_info
77	
78	def latest_lamacpp():
79	    try:        
80	        response = get(&quot;https://api.github.com/repos/abetlen/llama-cpp-python/releases/latest&quot;)
81	        return response.json()[&quot;tag_name&quot;].replace(&quot;v&quot;, &quot;&quot;)
82	    except Exception:
83	        return &quot;0.2.20&quot;
84	
85	def install_package(package_name, custom_command=None):
86	    if not package_is_installed(package_name):
87	        print(f&quot;Installing {package_name}...&quot;)
88	        command = [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package_name, &quot;--no-cache-dir&quot;]
89	        if custom_command:
90	            command += custom_command.split()
91	        subprocess.check_call(command)
92	    else:
93	        print(f&quot;{package_name} is already installed.&quot;)
94	
95	def package_is_installed(package_name):
</pre>
</div>


</div>
</div>

<div id="issue-4">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_VLM_nodes/install_init.py" target="_blank">/ComfyUI_VLM_nodes/install_init.py</a><br>
    <b>Line number: </b>91<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
75	
76	    return system_info
77	
78	def latest_lamacpp():
79	    try:        
80	        response = get(&quot;https://api.github.com/repos/abetlen/llama-cpp-python/releases/latest&quot;)
81	        return response.json()[&quot;tag_name&quot;].replace(&quot;v&quot;, &quot;&quot;)
82	    except Exception:
83	        return &quot;0.2.20&quot;
84	
85	def install_package(package_name, custom_command=None):
86	    if not package_is_installed(package_name):
87	        print(f&quot;Installing {package_name}...&quot;)
88	        command = [sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, package_name, &quot;--no-cache-dir&quot;]
89	        if custom_command:
90	            command += custom_command.split()
91	        subprocess.check_call(command)
92	    else:
93	        print(f&quot;{package_name} is already installed.&quot;)
94	
95	def package_is_installed(package_name):
96	    return importlib.util.find_spec(package_name) is not None
97	
98	def install_llama(system_info):
99	    imported = package_is_installed(&quot;llama-cpp-python&quot;) or package_is_installed(&quot;llama_cpp&quot;)
100	    if imported:
101	        print(&quot;llama-cpp installed&quot;)
102	    else:
103	        lcpp_version = latest_lamacpp()
104	        base_url = &quot;https://github.com/abetlen/llama-cpp-python/releases/download/v&quot;
105	        avx = &quot;AVX2&quot; if system_info[&#x27;avx2&#x27;] else &quot;AVX&quot;
106	        if system_info[&#x27;gpu&#x27;]:
</pre>
</div>


</div>
</div>

<div id="issue-5">
<div class="issue-block issue-sev-low">
    <b>subprocess_without_shell_equals_true: </b> subprocess call - check for execution of untrusted input.<br>
    <b>Test ID:</b> B603<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_VLM_nodes/install_init.py" target="_blank">/ComfyUI_VLM_nodes/install_init.py</a><br>
    <b>Line number: </b>144<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b603_subprocess_without_shell_equals_true.html</a><br>

<div class="code">
<pre>
128	            if &#x27;cuda_version&#x27; in system_info and system_info[&#x27;cuda_version&#x27;] in [&#x27;cu118&#x27;, &#x27;cu121&#x27;]:
129	                if system_info[&#x27;cuda_version&#x27;] == &#x27;cu118&#x27;:
130	                    base_command += [&quot;--extra-index-url&quot;, &quot;https://huggingface.github.io/autogptq-index/whl/cu118/&quot;]
131	                # No extra URL needed for cu121 as it&#x27;s the default
132	            elif &#x27;rocm_version&#x27; in system_info and system_info[&#x27;rocm_version&#x27;] == &#x27;rocm573&#x27;:
133	                base_command += [&quot;--extra-index-url&quot;, &quot;https://huggingface.github.io/autogptq-index/whl/rocm573/&quot;]
134	            else:
135	                print(&quot;Unsupported GPU configuration for AutoGPTQ.&quot;)
136	                return
137	        else:
138	            print(&quot;No GPU detected. AutoGPTQ installation requires a GPU with CUDA or ROCm support.&quot;)
139	            return
140	        
141	        # Execute the installation command
142	        try:
143	            print(f&quot;Installing AutoGPTQ with command: {&#x27; &#x27;.join(base_command)}&quot;)
144	            subprocess.check_call(base_command)
145	        except Exception as e:
146	            print(f&quot;Failed to install AutoGPTQ: {e}&quot;)
147	
148	config = None
149	
150	def is_logging_enabled():
151	    config = get_extension_config()
152	    if &quot;logging&quot; not in config:
153	        return False
154	    return config[&quot;logging&quot;]
155	
156	def log(message, type=None, always=False, name=None):
157	    if not always and not is_logging_enabled():
158	        return
159	
</pre>
</div>


</div>
</div>

<div id="issue-6">
<div class="issue-block issue-sev-low">
    <b>try_except_pass: </b> Try, Except, Pass detected.<br>
    <b>Test ID:</b> B110<br>
    <b>Severity: </b>LOW<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/703.html" target="_blank">CWE-703</a><br>
    <b>File: </b><a href="/ComfyUI_VLM_nodes/install_init.py" target="_blank">/ComfyUI_VLM_nodes/install_init.py</a><br>
    <b>Line number: </b>233<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b110_try_except_pass.html</a><br>

<div class="code">
<pre>
217	                type=&quot;ERROR&quot;, always=True, name=&quot;???&quot;)
218	            print(f&quot;Extension path: {get_ext_dir()}&quot;)
219	            return {&quot;name&quot;: &quot;Unknown&quot;, &quot;version&quot;: -1}
220	
221	    with open(config_path, &quot;r&quot;) as f:
222	        config = json.loads(f.read())
223	    return config
224	
225	def link_js(src, dst):
226	    src = os.path.abspath(src)
227	    dst = os.path.abspath(dst)
228	    if os.name == &quot;nt&quot;:
229	        try:
230	            import _winapi
231	            _winapi.CreateJunction(src, dst)
232	            return True
233	        except:
234	            pass
235	    try:
236	        os.symlink(src, dst)
237	        return True
238	    except:
239	        import logging
240	        logging.exception(&#x27;&#x27;)
241	        return False
242	
243	def is_junction(path):
244	    if os.name != &quot;nt&quot;:
245	        return False
246	    try:
247	        return bool(os.readlink(path))
248	    except OSError:
249	        return False
</pre>
</div>


</div>
</div>

<div id="issue-7">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/ComfyUI_VLM_nodes/nodes/suggest.py" target="_blank">/ComfyUI_VLM_nodes/nodes/suggest.py</a><br>
    <b>Line number: </b>599<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
583	                &quot;attribute_description&quot;: (&quot;STRING&quot;, {&quot;default&quot;: &quot;&quot;}),
584	                &quot;categories&quot;: (&quot;STRING&quot;, {&quot;default&quot;: &quot;&quot;}),
585	            }
586	        }
587	
588	    RETURN_TYPES = (&quot;STRING&quot;,)
589	    FUNCTION = &quot;keyword_extract&quot;
590	    CATEGORY = &quot;VLM Nodes/LLM&quot;
591	
592	    def keyword_extract(self, prompt, model, temperature, attribute_name, attribute_type, attribute_description, categories):
593	        setter = PydanticAttributeSetter()
594	        
595	        if attribute_type == &quot;Category&quot;:
596	            categories = categories.split(&quot;,&quot;)
597	            setter.add_attribute(attribute_name, Literal, attribute_description, categories)
598	        else:
599	            attribute_type = eval(attribute_type)
600	            setter.add_attribute(attribute_name, attribute_type, attribute_description)
601	
602	        Analysis = setter.create_model(&quot;Analysis&quot;)
603	
604	        gbnf_grammar, documentation = generate_gbnf_grammar_and_documentation([Analysis])
605	        grammar = LlamaGrammar.from_string(gbnf_grammar, verbose=False)
606	
607	        wrapped_model = LlamaCppAgent(model, debug_output=True,
608	            system_prompt=f&quot;You are an advanced AI, tasked to create JSON database entries for analysis. \n\n\n{documentation}&quot;)
609	
610	        response = wrapped_model.get_chat_response(prompt, temperature=temperature, grammar=grammar)
611	        parsed_response = json.loads(response)
612	        
613	        return (next(iter(parsed_response.values())),)
614	
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
