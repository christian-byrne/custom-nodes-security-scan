
<!DOCTYPE html>
<html>
<head>

<meta charset="UTF-8">

<title>
    Bandit Report
</title>

<style>

html * {
    font-family: "Arial", sans-serif;
}

pre {
    font-family: "Monaco", monospace;
}

.bordered-box {
    border: 1px solid black;
    padding-top:.5em;
    padding-bottom:.5em;
    padding-left:1em;
}

.metrics-box {
    font-size: 1.1em;
    line-height: 130%;
}

.metrics-title {
    font-size: 1.5em;
    font-weight: 500;
    margin-bottom: .25em;
}

.issue-description {
    font-size: 1.3em;
    font-weight: 500;
}

.candidate-issues {
    margin-left: 2em;
    border-left: solid 1px; LightGray;
    padding-left: 5%;
    margin-top: .2em;
    margin-bottom: .2em;
}

.issue-block {
    border: 1px solid LightGray;
    padding-left: .5em;
    padding-top: .5em;
    padding-bottom: .5em;
    margin-bottom: .5em;
}

.issue-sev-high {
    background-color: Pink;
}

.issue-sev-medium {
    background-color: NavajoWhite;
}

.issue-sev-low {
    background-color: LightCyan;
}

</style>
</head>

<body>

<div id="metrics">
    <div class="metrics-box bordered-box">
        <div class="metrics-title">
            Metrics:<br>
        </div>
        Total lines of code: <span id="loc">2488</span><br>
        Total lines skipped (#nosec): <span id="nosec">0</span>
    </div>
</div>




<br>
<div id="results">
    
<div id="issue-0">
<div class="issue-block issue-sev-medium">
    <b>request_without_timeout: </b> Requests call without timeout<br>
    <b>Test ID:</b> B113<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>LOW<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/400.html" target="_blank">CWE-400</a><br>
    <b>File: </b><a href="/eden_comfy_pipelines/clip_utils/clip_interrogator.py" target="_blank">/eden_comfy_pipelines/clip_utils/clip_interrogator.py</a><br>
    <b>Line number: </b>420<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b113_request_without_timeout.html</a><br>

<div class="code">
<pre>
404	        num_chunks = int(math.ceil(len(self.labels)/self.chunk_size))
405	        keep_per_chunk = int(self.chunk_size / num_chunks)
406	
407	        top_labels, top_embeds = [], []
408	        for chunk_idx in tqdm(range(num_chunks), disable=self.config.quiet):
409	            start = chunk_idx*self.chunk_size
410	            stop = min(start+self.chunk_size, len(self.embeds))
411	            tops = self._rank(image_features, self.embeds[start:stop], top_count=keep_per_chunk, reverse=reverse)
412	            top_labels.extend([self.labels[start+i] for i in tops])
413	            top_embeds.extend([self.embeds[start+i] for i in tops])
414	
415	        tops = self._rank(image_features, top_embeds, top_count=top_count)
416	        return [top_labels[i] for i in tops]
417	
418	
419	def _download_file(url: str, filepath: str, chunk_size: int = 4*1024*1024, quiet: bool = False):
420	    r = requests.get(url, stream=True)
421	    if r.status_code != 200:
422	        return
423	
424	    file_size = int(r.headers.get(&quot;Content-Length&quot;, 0))
425	    filename = url.split(&quot;/&quot;)[-1]
426	    progress = tqdm(total=file_size, unit=&quot;B&quot;, unit_scale=True, desc=filename, disable=quiet)
427	    with open(filepath, &quot;wb&quot;) as f:
428	        for chunk in r.iter_content(chunk_size=chunk_size):
429	            if chunk:
430	                f.write(chunk)
431	                progress.update(len(chunk))
432	    progress.close()
433	
434	def _merge_tables(tables: List[LabelTable], ci: Interrogator) -&gt; LabelTable:
435	    m = LabelTable([], None, ci)
</pre>
</div>


</div>
</div>

<div id="issue-1">
<div class="issue-block issue-sev-medium">
    <b>blacklist: </b> Use of possibly insecure function - consider using safer ast.literal_eval.<br>
    <b>Test ID:</b> B307<br>
    <b>Severity: </b>MEDIUM<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/eden_comfy_pipelines/img_utils/img_nodes.py" target="_blank">/eden_comfy_pipelines/img_utils/img_nodes.py</a><br>
    <b>Line number: </b>854<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval" target="_blank">https://bandit.readthedocs.io/en/1.7.9/blacklists/blacklist_calls.html#b307-eval</a><br>

<div class="code">
<pre>
838	        &#x27;&#x27;&#x27;
839	
840	        # Ensure the input is a PyTorch tensor
841	        if not isinstance(image, torch.Tensor):
842	            raise TypeError(&quot;The image must be a PyTorch tensor&quot;)
843	
844	        input_device = image.device
845	        input_dtype  = image.dtype
846	
847	        # Normalize image if needed
848	        if image.max() &gt; 1:
849	            image = image.float() / 255.0
850	
851	        # Define the mathematical function securely
852	        def safe_eval(expr, x):
853	            allowed_functions = {&quot;sin&quot;: np.sin, &quot;cos&quot;: np.cos, &quot;exp&quot;: np.exp}  # Extend this as needed
854	            return eval(expr, {&quot;__builtins__&quot;: None}, allowed_functions)
855	
856	        # Create a vectorized version of the safe_eval function
857	        vectorized_func = np.vectorize(lambda x: safe_eval(math_string, x))
858	
859	        # Apply the function to the numpy version of the image
860	        transformed_image = torch.from_numpy(vectorized_func(image.cpu().numpy()))
861	
862	        # Clip and rescale if necessary
863	        transformed_image = torch.clamp(transformed_image, 0, 1)
864	        if input_dtype == torch.uint8:
865	            transformed_image = (transformed_image * 255).to(torch.uint8)
866	
867	        # Convert back to original device and dtype
868	        output_image = transformed_image.to(input_device, dtype=input_dtype)
869	
</pre>
</div>


</div>
</div>

<div id="issue-2">
<div class="issue-block issue-sev-high">
    <b>start_process_with_a_shell: </b> Starting a process with a shell, possible injection detected, security issue.<br>
    <b>Test ID:</b> B605<br>
    <b>Severity: </b>HIGH<br>
    <b>Confidence: </b>HIGH<br>
    <b>CWE: </b><a href="https://cwe.mitre.org/data/definitions/78.html" target="_blank">CWE-78</a><br>
    <b>File: </b><a href="/eden_comfy_pipelines/ip_adapter_utils/moodmix_utils.py" target="_blank">/eden_comfy_pipelines/ip_adapter_utils/moodmix_utils.py</a><br>
    <b>Line number: </b>256<br>
    <b>More info: </b><a href="https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html" target="_blank">https://bandit.readthedocs.io/en/1.7.9/plugins/b605_start_process_with_a_shell.html</a><br>

<div class="code">
<pre>
240	                    image_filename
241	                )
242	            else:
243	                pass
244	
245	        embedding_filenames_to_be_deleted = []
246	        for embedding_filename in all_embedding_filenames:
247	            image_id = os.path.basename(embedding_filename).split(&quot;.&quot;)[0]
248	            corresponding_image_filename = os.path.join(cache_dir, f&quot;{image_id}.jpg&quot;)
249	            if corresponding_image_filename not in all_image_filenames:
250	                embedding_filenames_to_be_deleted.append(
251	                    embedding_filename
252	                )
253	
254	        for embedding_filename in embedding_filenames_to_be_deleted:
255	            print(f&quot;[FolderScanner] Deleting: {embedding_filename}&quot;)
256	            os.system(
257	                f&quot;rm {embedding_filename}&quot;
258	            )
259	
260	        return (image_filenames_without_embeddings,)
261	
262	class Load_Embeddings_From_Folder:
263	    @classmethod
264	    def INPUT_TYPES(s):
265	        return {
266	            &quot;required&quot;: {
267	                &quot;directory_path&quot;: (&quot;STRING&quot;, {&quot;default&quot;: &quot;eden_images/xander_big&quot;}),
268	            }
269	        }
270	    RETURN_TYPES = (&quot;EMBEDS&quot;, &quot;FLOAT&quot;)
271	    RETURN_NAMES = (&quot;embeddings&quot;, &quot;avg_embed_norm&quot;)
272	    FUNCTION = &quot;load&quot;
273	    CATEGORY = &quot;Eden ðŸŒ±&quot;
</pre>
</div>


</div>
</div>

</div>

</body>
</html>
